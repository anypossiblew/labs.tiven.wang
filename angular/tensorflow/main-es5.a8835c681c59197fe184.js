(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,n){t.exports=n("zUnb")},1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},5:function(t,e){},6:function(t,e){},7:function(t,e){},8:function(t,e){},9:function(t,e){},zUnb:function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"array",function(){return bG}),n.d(r,"Dataset",function(){return gG}),n.d(r,"zip",function(){return wG}),n.d(r,"CSVDataset",function(){return AG}),n.d(r,"TextLineDataset",function(){return EG}),n.d(r,"csv",function(){return GG}),n.d(r,"func",function(){return qG}),n.d(r,"generator",function(){return KG}),n.d(r,"microphone",function(){return XG}),n.d(r,"webcam",function(){return $G}),n.d(r,"FileDataSource",function(){return jG}),n.d(r,"URLDataSource",function(){return HG}),n.d(r,"version_data",function(){return YG});var o={};n.r(o),n.d(o,"data",function(){return r}),n.d(o,"version",function(){return QG}),n.d(o,"AdadeltaOptimizer",function(){return ok}),n.d(o,"AdagradOptimizer",function(){return ik}),n.d(o,"AdamOptimizer",function(){return ak}),n.d(o,"AdamaxOptimizer",function(){return sk}),n.d(o,"DataStorage",function(){return Ag}),n.d(o,"ENV",function(){return Kh}),n.d(o,"Environment",function(){return Gh}),n.d(o,"KernelBackend",function(){return Tg}),n.d(o,"MomentumOptimizer",function(){return lk}),n.d(o,"Optimizer",function(){return rk}),n.d(o,"RMSPropOptimizer",function(){return ck}),n.d(o,"Rank",function(){return Jf}),n.d(o,"Reduction",function(){return dE}),n.d(o,"SGDOptimizer",function(){return uk}),n.d(o,"Tensor",function(){return Qf}),n.d(o,"TensorBuffer",function(){return Kf}),n.d(o,"Variable",function(){return Zf}),n.d(o,"abs",function(){return xw}),n.d(o,"acos",function(){return Cw}),n.d(o,"acosh",function(){return Ew}),n.d(o,"add",function(){return dC}),n.d(o,"addN",function(){return mC}),n.d(o,"addStrict",function(){return vC}),n.d(o,"all",function(){return Gx}),n.d(o,"any",function(){return qx}),n.d(o,"argMax",function(){return Kx}),n.d(o,"argMin",function(){return $x}),n.d(o,"asin",function(){return Sw}),n.d(o,"asinh",function(){return kw}),n.d(o,"atan",function(){return Nw}),n.d(o,"atan2",function(){return gC}),n.d(o,"atanh",function(){return Iw}),n.d(o,"avgPool",function(){return Lx}),n.d(o,"backend",function(){return Om}),n.d(o,"backend_util",function(){return Kg}),n.d(o,"basicLSTMCell",function(){return JC}),n.d(o,"batchNorm",function(){return hx}),n.d(o,"batchNorm2d",function(){return fx}),n.d(o,"batchNorm3d",function(){return dx}),n.d(o,"batchNorm4d",function(){return mx}),n.d(o,"batchNormalization",function(){return px}),n.d(o,"batchNormalization2d",function(){return ux}),n.d(o,"batchNormalization3d",function(){return lx}),n.d(o,"batchNormalization4d",function(){return cx}),n.d(o,"batchToSpaceND",function(){return Fv}),n.d(o,"browser",function(){return HS}),n.d(o,"buffer",function(){return Ov}),n.d(o,"cast",function(){return Pv}),n.d(o,"ceil",function(){return Rw}),n.d(o,"clipByValue",function(){return Aw}),n.d(o,"clone",function(){return Lv}),n.d(o,"complex",function(){return Qm}),n.d(o,"concat",function(){return vv}),n.d(o,"concat1d",function(){return gv}),n.d(o,"concat2d",function(){return yv}),n.d(o,"concat3d",function(){return bv}),n.d(o,"concat4d",function(){return wv}),n.d(o,"conv1d",function(){return bx}),n.d(o,"conv2d",function(){return wx}),n.d(o,"conv2dDerFilter",function(){return Cx}),n.d(o,"conv2dTranspose",function(){return kx}),n.d(o,"conv3d",function(){return xx}),n.d(o,"cos",function(){return Tw}),n.d(o,"cosh",function(){return _w}),n.d(o,"cumsum",function(){return Bv}),n.d(o,"customGrad",function(){return kg}),n.d(o,"deprecationWarn",function(){return ym}),n.d(o,"depthToSpace",function(){return zv}),n.d(o,"depthwiseConv2d",function(){return Ex}),n.d(o,"disableDeprecationWarnings",function(){return gm}),n.d(o,"dispose",function(){return Em}),n.d(o,"disposeVariables",function(){return bm}),n.d(o,"div",function(){return yC}),n.d(o,"divStrict",function(){return bC}),n.d(o,"dot",function(){return Ix}),n.d(o,"dropout",function(){return hE}),n.d(o,"elu",function(){return VC}),n.d(o,"enableDebugMode",function(){return vm}),n.d(o,"enableProdMode",function(){return mm}),n.d(o,"environment",function(){return Xh}),n.d(o,"equal",function(){return nC}),n.d(o,"equalStrict",function(){return rC}),n.d(o,"erf",function(){return Dw}),n.d(o,"exp",function(){return Ow}),n.d(o,"expandDims",function(){return Uv}),n.d(o,"expm1",function(){return Mw}),n.d(o,"eye",function(){return Vv}),n.d(o,"fft",function(){return iE}),n.d(o,"fill",function(){return pv}),n.d(o,"findBackend",function(){return Tm}),n.d(o,"findBackendFactory",function(){return _m}),n.d(o,"floor",function(){return Fw}),n.d(o,"floorDiv",function(){return wC}),n.d(o,"frame",function(){return gE}),n.d(o,"fused",function(){return UE}),n.d(o,"gather",function(){return QC}),n.d(o,"gatherND",function(){return pE}),n.d(o,"getBackend",function(){return Rm}),n.d(o,"grad",function(){return wg}),n.d(o,"grads",function(){return xg}),n.d(o,"greater",function(){return oC}),n.d(o,"greaterEqual",function(){return iC}),n.d(o,"greaterEqualStrict",function(){return aC}),n.d(o,"greaterStrict",function(){return sC}),n.d(o,"hammingWindow",function(){return vE}),n.d(o,"hannWindow",function(){return mE}),n.d(o,"ifft",function(){return aE}),n.d(o,"imag",function(){return Jm}),n.d(o,"image",function(){return BE}),n.d(o,"io",function(){return US}),n.d(o,"irfft",function(){return uE}),n.d(o,"isFinite",function(){return Kw}),n.d(o,"isInf",function(){return qw}),n.d(o,"isNaN",function(){return Gw}),n.d(o,"keep",function(){return Sm}),n.d(o,"leakyRelu",function(){return WC}),n.d(o,"less",function(){return uC}),n.d(o,"lessEqual",function(){return lC}),n.d(o,"lessEqualStrict",function(){return cC}),n.d(o,"lessStrict",function(){return pC}),n.d(o,"linalg",function(){return DE}),n.d(o,"linspace",function(){return hv}),n.d(o,"localResponseNormalization",function(){return KC}),n.d(o,"log",function(){return Pw}),n.d(o,"log1p",function(){return Lw}),n.d(o,"logSigmoid",function(){return Bw}),n.d(o,"logSoftmax",function(){return Rg}),n.d(o,"logSumExp",function(){return Xx}),n.d(o,"logicalAnd",function(){return FC}),n.d(o,"logicalNot",function(){return PC}),n.d(o,"logicalOr",function(){return LC}),n.d(o,"logicalXor",function(){return BC}),n.d(o,"losses",function(){return RE}),n.d(o,"matMul",function(){return Nx}),n.d(o,"math",function(){return WS}),n.d(o,"max",function(){return Yx}),n.d(o,"maxPool",function(){return Px}),n.d(o,"maximum",function(){return xC}),n.d(o,"maximumStrict",function(){return CC}),n.d(o,"mean",function(){return Qx}),n.d(o,"memory",function(){return wm}),n.d(o,"min",function(){return Zx}),n.d(o,"minimum",function(){return EC}),n.d(o,"minimumStrict",function(){return SC}),n.d(o,"mod",function(){return kC}),n.d(o,"modStrict",function(){return NC}),n.d(o,"moments",function(){return Jx}),n.d(o,"movingAverage",function(){return eE}),n.d(o,"mul",function(){return IC}),n.d(o,"mulStrict",function(){return RC}),n.d(o,"multiRNNCell",function(){return tE}),n.d(o,"multinomial",function(){return Wv}),n.d(o,"neg",function(){return zw}),n.d(o,"nextFrame",function(){return dk}),n.d(o,"norm",function(){return $C}),n.d(o,"notEqual",function(){return hC}),n.d(o,"notEqualStrict",function(){return fC}),n.d(o,"oneHot",function(){return jv}),n.d(o,"ones",function(){return lv}),n.d(o,"onesLike",function(){return dv}),n.d(o,"op",function(){return Ym}),n.d(o,"outerProduct",function(){return Rx}),n.d(o,"pad",function(){return Hv}),n.d(o,"pad1d",function(){return Gv}),n.d(o,"pad2d",function(){return qv}),n.d(o,"pad3d",function(){return Kv}),n.d(o,"pad4d",function(){return $v}),n.d(o,"pool",function(){return Bx}),n.d(o,"pow",function(){return AC}),n.d(o,"powStrict",function(){return TC}),n.d(o,"prelu",function(){return jC}),n.d(o,"print",function(){return Mv}),n.d(o,"prod",function(){return eC}),n.d(o,"profile",function(){return xm}),n.d(o,"rand",function(){return Xv}),n.d(o,"randomNormal",function(){return Yv}),n.d(o,"randomUniform",function(){return Qv}),n.d(o,"range",function(){return fv}),n.d(o,"ready",function(){return Im}),n.d(o,"real",function(){return Zm}),n.d(o,"reciprocal",function(){return Uw}),n.d(o,"registerBackend",function(){return Dm}),n.d(o,"relu",function(){return HC}),n.d(o,"removeBackend",function(){return Am}),n.d(o,"reshape",function(){return Zv}),n.d(o,"reverse",function(){return Ax}),n.d(o,"reverse1d",function(){return Tx}),n.d(o,"reverse2d",function(){return _x}),n.d(o,"reverse3d",function(){return Dx}),n.d(o,"reverse4d",function(){return Ox}),n.d(o,"rfft",function(){return sE}),n.d(o,"round",function(){return Vw}),n.d(o,"rsqrt",function(){return Ww}),n.d(o,"scalar",function(){return nv}),n.d(o,"scatterND",function(){return oE}),n.d(o,"selu",function(){return GC}),n.d(o,"separableConv2d",function(){return Sx}),n.d(o,"serialization",function(){return $S}),n.d(o,"setBackend",function(){return Nm}),n.d(o,"setPlatform",function(){return Mm}),n.d(o,"setdiff1dAsync",function(){return ig}),n.d(o,"sigmoid",function(){return jw}),n.d(o,"sign",function(){return Hw}),n.d(o,"signal",function(){return yE}),n.d(o,"sin",function(){return $w}),n.d(o,"sinh",function(){return Xw}),n.d(o,"slice",function(){return zx}),n.d(o,"slice1d",function(){return Ux}),n.d(o,"slice2d",function(){return Vx}),n.d(o,"slice3d",function(){return Wx}),n.d(o,"slice4d",function(){return jx}),n.d(o,"softmax",function(){return Ig}),n.d(o,"softplus",function(){return Yw}),n.d(o,"spaceToBatchND",function(){return Jv}),n.d(o,"sparseToDense",function(){return cE}),n.d(o,"spectral",function(){return lE}),n.d(o,"split",function(){return xv}),n.d(o,"sqrt",function(){return Qw}),n.d(o,"square",function(){return Zw}),n.d(o,"squaredDifference",function(){return _C}),n.d(o,"squaredDifferenceStrict",function(){return DC}),n.d(o,"squeeze",function(){return tg}),n.d(o,"stack",function(){return eg}),n.d(o,"step",function(){return Jw}),n.d(o,"stridedSlice",function(){return nE}),n.d(o,"sub",function(){return OC}),n.d(o,"subStrict",function(){return MC}),n.d(o,"sum",function(){return tC}),n.d(o,"tan",function(){return tx}),n.d(o,"tanh",function(){return ex}),n.d(o,"tensor",function(){return tv}),n.d(o,"tensor1d",function(){return rv}),n.d(o,"tensor2d",function(){return ov}),n.d(o,"tensor3d",function(){return iv}),n.d(o,"tensor4d",function(){return av}),n.d(o,"tensor5d",function(){return sv}),n.d(o,"tensor6d",function(){return uv}),n.d(o,"tensor_util",function(){return fd}),n.d(o,"test_util",function(){return tk}),n.d(o,"tidy",function(){return Cm}),n.d(o,"tile",function(){return ng}),n.d(o,"time",function(){return km}),n.d(o,"topk",function(){return rE}),n.d(o,"train",function(){return hk}),n.d(o,"transpose",function(){return qC}),n.d(o,"truncatedNormal",function(){return rg}),n.d(o,"unsortedSegmentSum",function(){return ZC}),n.d(o,"unstack",function(){return og}),n.d(o,"util",function(){return Uf}),n.d(o,"valueAndGrad",function(){return Cg}),n.d(o,"valueAndGrads",function(){return Eg}),n.d(o,"variable",function(){return id}),n.d(o,"variableGrads",function(){return Sg}),n.d(o,"version_core",function(){return ek}),n.d(o,"webgl",function(){return nk}),n.d(o,"where",function(){return zC}),n.d(o,"whereAsync",function(){return UC}),n.d(o,"zeros",function(){return cv}),n.d(o,"zerosLike",function(){return mv}),n.d(o,"constraints",function(){return cB}),n.d(o,"initializers",function(){return mz}),n.d(o,"layers",function(){return JW}),n.d(o,"metrics",function(){return tj}),n.d(o,"models",function(){return ej}),n.d(o,"regularizers",function(){return nj}),n.d(o,"CallbackList",function(){return jz}),n.d(o,"CustomCallback",function(){return qz}),n.d(o,"History",function(){return Gz}),n.d(o,"Callback",function(){return rj}),n.d(o,"callbacks",function(){return lj}),n.d(o,"EarlyStopping",function(){return uj}),n.d(o,"InputSpec",function(){return _z}),n.d(o,"SymbolicTensor",function(){return Dz}),n.d(o,"LayersModel",function(){return ZU}),n.d(o,"input",function(){return oV}),n.d(o,"loadLayersModel",function(){return rV}),n.d(o,"model",function(){return eV}),n.d(o,"registerCallbackConstructor",function(){return iV}),n.d(o,"sequential",function(){return nV}),n.d(o,"RNN",function(){return OW}),n.d(o,"Sequential",function(){return tV}),n.d(o,"LayerVariable",function(){return Nz}),n.d(o,"version_layers",function(){return CU}),n.d(o,"GraphModel",function(){return kH}),n.d(o,"loadGraphModel",function(){return NH}),n.d(o,"deregisterOp",function(){return vj}),n.d(o,"registerOp",function(){return dj}),n.d(o,"version_converter",function(){return IH});var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function u(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function l(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(Tz){i(Tz)}}function s(t){try{u(r.throw(t))}catch(Tz){i(Tz)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function p(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(Tz){i=[6,Tz],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function h(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function f(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function d(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}var m=Array.isArray||function(t){return t&&"number"==typeof t.length};function v(t){return null!==t&&"object"==typeof t}function g(t){return"function"==typeof t}function y(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}y.prototype=Object.create(Error.prototype);var b=y,w=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var n=this._parent,r=this._parents,o=this._unsubscribe,i=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var a=-1,s=r?r.length:0;n;)n.remove(this),n=++a<s&&r[a]||null;if(g(o))try{o.call(this)}catch(Tz){e=!0,t=Tz instanceof b?x(Tz.errors):[Tz]}if(m(i))for(a=-1,s=i.length;++a<s;){var u=i[a];if(v(u))try{u.unsubscribe()}catch(Tz){e=!0,t=t||[],Tz instanceof b?t=t.concat(x(Tz.errors)):t.push(Tz)}}if(e)throw new b(t)}},t.prototype.add=function(e){var n=e;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:if(!e)return t.EMPTY;throw new Error("unrecognized teardown "+e+" added to Subscription.")}if(n._addParent(this)){var o=this._subscriptions;o?o.push(n):this._subscriptions=[n]}return n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.prototype._addParent=function(t){var e=this._parent,n=this._parents;return e!==t&&(e?n?-1===n.indexOf(t)&&(n.push(t),!0):(this._parents=[t],!0):(this._parent=t,!0))},t.EMPTY=((e=new t).closed=!0,e),t}();function x(t){return t.reduce(function(t,e){return t.concat(e instanceof b?e.errors:e)},[])}var C=!1,E={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){C=t},get useDeprecatedSynchronousErrorHandling(){return C}};function S(t){setTimeout(function(){throw t})}var k={closed:!0,next:function(t){},error:function(t){if(E.useDeprecatedSynchronousErrorHandling)throw t;S(t)},complete:function(){}},N="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),I=function(t){function e(n,r,o){var i=t.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=k;break;case 1:if(!n){i.destination=k;break}if("object"==typeof n){n instanceof e?(i.syncErrorThrowable=n.syncErrorThrowable,i.destination=n,n.add(i)):(i.syncErrorThrowable=!0,i.destination=new R(i,n));break}default:i.syncErrorThrowable=!0,i.destination=new R(i,n,r,o)}return i}return a(e,t),e.prototype[N]=function(){return this},e.create=function(t,n,r){var o=new e(t,n,r);return o.syncErrorThrowable=!1,o},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this},e}(w),R=function(t){function e(e,n,r,o){var i,a=t.call(this)||this;a._parentSubscriber=e;var s=a;return g(n)?i=n:n&&(i=n.next,r=n.error,o=n.complete,n!==k&&(g((s=Object.create(n)).unsubscribe)&&a.add(s.unsubscribe.bind(s)),s.unsubscribe=a.unsubscribe.bind(a))),a._context=s,a._next=i,a._error=r,a._complete=o,a}return a(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;E.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=E.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):S(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;S(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};E.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),E.useDeprecatedSynchronousErrorHandling)throw n;S(n)}},e.prototype.__tryOrSetError=function(t,e,n){if(!E.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return E.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(S(r),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(I),A="function"==typeof Symbol&&Symbol.observable||"@@observable";function T(){}function _(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return D(t)}function D(t){return t?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:T}var O=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,o=function(t,e,n){if(t){if(t instanceof I)return t;if(t[N])return t[N]()}return t||e||n?new I(t,e,n):new I(k)}(t,e,n);if(o.add(r?r.call(o,this.source):this.source||E.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),E.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){E.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t.destination;if(t.closed||t.isStopped)return!1;t=e&&e instanceof I?e:null}return!0}(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=M(e))(function(e,r){var o;o=n.subscribe(function(e){try{t(e)}catch(n){r(n),o&&o.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[A]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:D(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=M(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function M(t){if(t||(t=E.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function F(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}F.prototype=Object.create(Error.prototype);var P=F,L=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return a(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(w),B=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return a(e,t),e}(I),z=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return a(e,t),e.prototype[N]=function(){return new B(this)},e.prototype.lift=function(t){var e=new U(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new P;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].next(t)},e.prototype.error=function(t){if(this.closed)throw new P;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),o=0;o<n;o++)r[o].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new P;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new P;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new P;return this.hasError?(t.error(this.thrownError),w.EMPTY):this.isStopped?(t.complete(),w.EMPTY):(this.observers.push(t),new L(this,t))},e.prototype.asObservable=function(){var t=new O;return t.source=this,t},e.create=function(t,e){return new U(t,e)},e}(O),U=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return a(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):w.EMPTY},e}(z);function V(t){return t&&"function"==typeof t.schedule}var W=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parent=e,o.outerValue=n,o.outerIndex=r,o.index=0,o}return a(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(I),j=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.closed||e.complete()}},H=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,S),e}};function G(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var q=G(),K=function(t){return function(e){for(var n=t[q]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(function(){n.return&&n.return()}),e}},$=function(t){return function(e){var n=t[A]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}},X=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Y(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var Q=function(t){if(t instanceof O)return function(e){return t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e)};if(t&&"function"==typeof t[A])return $(t);if(X(t))return j(t);if(Y(t))return H(t);if(t&&"function"==typeof t[q])return K(t);var e=v(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Z(t,e,n,r,o){if(void 0===o&&(o=new W(t,n,r)),!o.closed)return Q(e)(o)}var J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(I);function tt(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new et(t,e))}}var et=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new nt(t,this.project,this.thisArg))},t}(),nt=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.project=n,o.count=0,o.thisArg=r||o,o}return a(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(I);function rt(t,e){return new O(e?function(n){var r=new w,o=0;return r.add(e.schedule(function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()})),r}:j(t))}function ot(t,e){if(!e)return t instanceof O?t:new O(Q(t));if(null!=t){if(function(t){return t&&"function"==typeof t[A]}(t))return function(t,e){return new O(e?function(n){var r=new w;return r.add(e.schedule(function(){var o=t[A]();r.add(o.subscribe({next:function(t){r.add(e.schedule(function(){return n.next(t)}))},error:function(t){r.add(e.schedule(function(){return n.error(t)}))},complete:function(){r.add(e.schedule(function(){return n.complete()}))}}))})),r}:$(t))}(t,e);if(Y(t))return function(t,e){return new O(e?function(n){var r=new w;return r.add(e.schedule(function(){return t.then(function(t){r.add(e.schedule(function(){n.next(t),r.add(e.schedule(function(){return n.complete()}))}))},function(t){r.add(e.schedule(function(){return n.error(t)}))})})),r}:H(t))}(t,e);if(X(t))return rt(t,e);if(function(t){return t&&"function"==typeof t[q]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new O(e?function(n){var r,o=new w;return o.add(function(){r&&"function"==typeof r.return&&r.return()}),o.add(e.schedule(function(){r=t[q](),o.add(e.schedule(function(){if(!n.closed){var t,e;try{var o=r.next();t=o.value,e=o.done}catch(i){return void n.error(i)}e?n.complete():(n.next(t),this.schedule())}}))})),o}:K(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function it(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(it(function(n,r){return ot(t(n,r)).pipe(tt(function(t,o){return e(n,t,r,o)}))},n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new at(t,n))})}var at=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new st(t,this.project,this.concurrent))},t}(),st=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var o=t.call(this,e)||this;return o.project=n,o.concurrent=r,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return a(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=new W(this,void 0,void 0);this.destination.add(r),Z(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(J);function ut(t){return t}function lt(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),it(ut,t)}function ct(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,r=null,o=t[t.length-1];return V(o)?(r=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof o&&(n=t.pop()),null===r&&1===t.length&&t[0]instanceof O?t[0]:lt(n)(rt(t,r))}function pt(){return function(t){return t.lift(new ht(t))}}var ht=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var r=new ft(t,n),o=e.subscribe(r);return r.closed||(r.connection=n.connect()),o},t}(),ft=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return a(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},e}(I),dt=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return a(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new w).add(this.source.subscribe(new vt(this.getSubject(),this))),t.closed?(this._connection=null,t=w.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return pt()(this)},e}(O).prototype,mt={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:dt._subscribe},_isComplete:{value:dt._isComplete,writable:!0},getSubject:{value:dt.getSubject},connect:{value:dt.connect},refCount:{value:dt.refCount}},vt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.connectable=n,r}return a(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(B);function gt(t,e){return function(n){var r;if(r="function"==typeof t?t:function(){return t},"function"==typeof e)return n.lift(new yt(r,e));var o=Object.create(n,mt);return o.source=n,o.subjectFactory=r,o}}var yt=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,r=this.subjectFactory(),o=n(r).subscribe(t);return o.add(e.subscribe(r)),o},t}();function bt(){return new z}var wt="__parameters__",xt="__prop__metadata__";function Ct(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var r=t.apply(void 0,d(e));for(var o in r)this[o]=r[o]}}}function Et(t,e,n){var r=Ct(e);function o(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof o)return r.apply(this,e),this;var i=new((t=o).bind.apply(t,d([void 0],e)));return a.annotation=i,a;function a(t,e,n){for(var r=t.hasOwnProperty(wt)?t[wt]:Object.defineProperty(t,wt,{value:[]})[wt];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(i),t}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o}function St(t,e,n,r){var o=Ct(e);function i(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this instanceof i)return o.apply(this,e),this;var a=new((t=i).bind.apply(t,d([void 0],e)));return function(t,n){var o=t.constructor,i=o.hasOwnProperty(xt)?o[xt]:Object.defineProperty(o,xt,{value:{}})[xt];i[n]=i.hasOwnProperty(n)&&i[n]||[],i[n].unshift(a),r&&r.apply(void 0,d([t,n],e))}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}var kt=Et("Inject",function(t){return{token:t}}),Nt=Et("Optional"),It=Et("Self"),Rt=Et("SkipSelf"),At=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({});function Tt(t){for(var e in t)if(t[e]===Tt)return e;throw Error("Could not find renamed property on target object.")}function _t(t){return{providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Dt(t){return t&&t.hasOwnProperty(Ot)?t[Ot]:null}var Ot=Tt({ngInjectableDef:Tt});function Mt(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(Mt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var e=t.toString();if(null==e)return""+e;var n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}var Ft=Tt({__forward_ref__:Tt});function Pt(t){return t.__forward_ref__=Pt,t.toString=function(){return Mt(this())},t}function Lt(t){var e=t;return"function"==typeof e&&e.hasOwnProperty(Ft)&&e.__forward_ref__===Pt?e():t}function Bt(){var t="undefined"!=typeof globalThis&&globalThis,e="undefined"!=typeof window&&window,n="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,r="undefined"!=typeof global&&global;return t||r||e||n}var zt,Ut=Bt(),Vt=void 0;function Wt(t){var e=Vt;return Vt=t,e}function jt(t,e){return void 0===e&&(e=At.Default),(zt||function(t,e){if(void 0===e&&(e=At.Default),void 0===Vt)throw new Error("inject() must be called from an injection context");return null===Vt?function(t,e,n){var r=Dt(t);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&At.Optional)return null;throw new Error("Injector: NOT_FOUND ["+Mt(t)+"]")}(t,0,e):Vt.get(t,e&At.Optional?null:void 0,e)})(t,e)}var Ht=function(){function t(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.ngInjectableDef=_t({providedIn:e.providedIn||"root",factory:e.factory}))}return t.prototype.toString=function(){return"InjectionToken "+this._desc},t}(),Gt="__source",qt=new Object,Kt=new Ht("INJECTOR",-1),$t=function(){function t(){}return t.prototype.get=function(t,e){if(void 0===e&&(e=qt),e===qt){var n=new Error("NullInjectorError: No provider for "+Mt(t)+"!");throw n.name="NullInjectorError",n}return e},t}(),Xt=function(){function t(){}return t.create=function(t,e){return Array.isArray(t)?new re(t,e):new re(t.providers,t.parent,t.name||null)},t.THROW_IF_NOT_FOUND=qt,t.NULL=new $t,t.ngInjectableDef=_t({providedIn:"any",factory:function(){return jt(Kt)}}),t.__NG_ELEMENT_ID__=-1,t}(),Yt=function(t){return t},Qt=[],Zt=Yt,Jt=function(){return Array.prototype.slice.call(arguments)},te=Tt({provide:String,useValue:Tt}),ee=/\n/gm,ne="\u0275",re=function(){function t(t,e,n){void 0===e&&(e=Xt.NULL),void 0===n&&(n=null),this.parent=e,this.source=n;var r=this._records=new Map;r.set(Xt,{token:Xt,fn:Yt,deps:Qt,value:this,useNew:!1}),r.set(Kt,{token:Kt,fn:Yt,deps:Qt,value:this,useNew:!1}),function t(e,n){if(n)if((n=Lt(n))instanceof Array)for(var r=0;r<n.length;r++)t(e,n[r]);else{if("function"==typeof n)throw ae("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw ae("Unexpected provider",n);var o=Lt(n.provide),i=function(t){var e=function(t){var e=Qt,n=t.deps;if(n&&n.length){e=[];for(var r=0;r<n.length;r++){var o=6;if((u=Lt(n[r]))instanceof Array)for(var i=0,a=u;i<a.length;i++){var s=a[i];s instanceof Nt||s==Nt?o|=1:s instanceof Rt||s==Rt?o&=-3:s instanceof It||s==It?o&=-5:u=s instanceof kt?s.token:Lt(s)}e.push({token:u,options:o})}}else if(t.useExisting){var u;e=[{token:u=Lt(t.useExisting),options:6}]}else if(!(n||te in t))throw ae("'deps' required",t);return e}(t),n=Yt,r=Qt,o=!1,i=Lt(t.provide);if(te in t)r=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)o=!0,n=Lt(t.useClass);else{if("function"!=typeof i)throw ae("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);o=!0,n=i}return{deps:e,fn:n,useNew:o,value:r}}(n);if(!0===n.multi){var a=e.get(o);if(a){if(a.fn!==Jt)throw oe(o)}else e.set(o,a={token:n.provide,deps:[],useNew:!1,fn:Jt,value:Qt});a.deps.push({token:o=n,options:6})}var s=e.get(o);if(s&&s.fn==Jt)throw oe(o);e.set(o,i)}}(r,t)}return t.prototype.get=function(t,e,n){void 0===n&&(n=At.Default);var r=this._records.get(t);try{return function t(e,n,r,o,i,a){try{return function(e,n,r,o,i,a){var s,u;if(!n||a&At.SkipSelf)a&At.Self||(u=o.get(e,i,At.Default));else{if((u=n.value)==Zt)throw Error(ne+"Circular dependency");if(u===Qt){n.value=Zt;var l=n.useNew,c=n.fn,p=n.deps,h=Qt;if(p.length){h=[];for(var f=0;f<p.length;f++){var m=p[f],v=m.options,g=2&v?r.get(m.token):void 0;h.push(t(m.token,g,r,g||4&v?o:Xt.NULL,1&v?null:Xt.THROW_IF_NOT_FOUND,At.Default))}}n.value=u=l?new((s=c).bind.apply(s,d([void 0],h))):c.apply(void 0,h)}}return u}(e,n,r,o,i,a)}catch(Tz){throw Tz instanceof Error||(Tz=new Error(Tz)),(Tz.ngTempTokenPath=Tz.ngTempTokenPath||[]).unshift(e),n&&n.value==Zt&&(n.value=Qt),Tz}}(t,r,this._records,this.parent,e,n)}catch(Tz){return function(t,e,n,r){var o=t.ngTempTokenPath;throw e[Gt]&&o.unshift(e[Gt]),t.message=ie("\n"+t.message,o,"StaticInjectorError",r),t.ngTokenPath=o,t.ngTempTokenPath=null,t}(Tz,t,0,this.source)}},t.prototype.toString=function(){var t=[];return this._records.forEach(function(e,n){return t.push(Mt(n))}),"StaticInjector["+t.join(", ")+"]"},t}();function oe(t){return ae("Cannot mix multi providers and regular providers",t)}function ie(t,e,n,r){void 0===r&&(r=null),t=t&&"\n"===t.charAt(0)&&t.charAt(1)==ne?t.substr(2):t;var o=Mt(e);if(e instanceof Array)o=e.map(Mt).join(" -> ");else if("object"==typeof e){var i=[];for(var a in e)if(e.hasOwnProperty(a)){var s=e[a];i.push(a+":"+("string"==typeof s?JSON.stringify(s):Mt(s)))}o="{"+i.join(", ")+"}"}return n+(r?"("+r+")":"")+"["+o+"]: "+t.replace(ee,"\n  ")}function ae(t,e){return new Error(ie(t,e,"StaticInjectorError"))}var se="ngDebugContext",ue="ngOriginalError",le="ngErrorLogger",ce=new Ht("AnalyzeForEntryComponents"),pe=function(t){return t[t.Emulated=0]="Emulated",t[t.Native=1]="Native",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}({}),he=function(){return("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ut)}();function fe(t){return t[se]}function de(t){return t[ue]}function me(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.error.apply(t,d(e))}var ve=function(){function t(){this._console=console}return t.prototype.handleError=function(t){var e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t[le]||me}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)},t.prototype._findContext=function(t){return t?fe(t)?fe(t):this._findContext(de(t)):null},t.prototype._findOriginalError=function(t){for(var e=de(t);e&&de(e);)e=de(e);return e},t}(),ge=!0,ye=!1;function be(){return ye=!0,ge}var we=function(){function t(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e),this.inertBodyElement=this.inertDocument.createElement("body"),e.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return t.prototype.getInertBodyElement_XHR=function(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(r){return null}var e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(void 0);var n=e.response.body;return n.removeChild(n.firstChild),n},t.prototype.getInertBodyElement_DOMParser=function(t){t="<body><remove></remove>"+t+"</body>";try{var e=(new window.DOMParser).parseFromString(t,"text/html").body;return e.removeChild(e.firstChild),e}catch(n){return null}},t.prototype.getInertBodyElement_InertDocument=function(t){var e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)},t.prototype.stripCustomNsAttrs=function(t){for(var e=t.attributes,n=e.length-1;0<n;n--){var r=e.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||t.removeAttribute(r)}for(var o=t.firstChild;o;)o.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(o),o=o.nextSibling},t}(),xe=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi,Ce=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Ee(t){return(t=String(t)).match(xe)||t.match(Ce)?t:(be()&&console.warn("WARNING: sanitizing unsafe URL value "+t+" (see http://g.co/ng/security#xss)"),"unsafe:"+t)}function Se(t){var e,n,r={};try{for(var o=h(t.split(",")),i=o.next();!i.done;i=o.next())r[i.value]=!0}catch(a){e={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}function ke(){for(var t,e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o={};try{for(var i=h(n),a=i.next();!a.done;a=i.next()){var s=a.value;for(var u in s)s.hasOwnProperty(u)&&(o[u]=!0)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return o}var Ne,Ie=Se("area,br,col,hr,img,wbr"),Re=Se("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Ae=Se("rp,rt"),Te=ke(Ae,Re),_e=ke(Ie,ke(Re,Se("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ke(Ae,Se("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Te),De=Se("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Oe=Se("srcset"),Me=ke(De,Oe,Se("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Se("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Fe=Se("script,style,template"),Pe=function(){function t(){this.sanitizedSomething=!1,this.buf=[]}return t.prototype.sanitizeChildren=function(t){for(var e=t.firstChild,n=!0;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);var r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")},t.prototype.startElement=function(t){var e,n=t.nodeName.toLowerCase();if(!_e.hasOwnProperty(n))return this.sanitizedSomething=!0,!Fe.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);for(var r=t.attributes,o=0;o<r.length;o++){var i=r.item(o),a=i.name,s=a.toLowerCase();if(Me.hasOwnProperty(s)){var u=i.value;De[s]&&(u=Ee(u)),Oe[s]&&(e=u,u=(e=String(e)).split(",").map(function(t){return Ee(t.trim())}).join(", ")),this.buf.push(" ",a,'="',ze(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0},t.prototype.endElement=function(t){var e=t.nodeName.toLowerCase();_e.hasOwnProperty(e)&&!Ie.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))},t.prototype.chars=function(t){this.buf.push(ze(t))},t.prototype.checkClobberedElement=function(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: "+t.outerHTML);return e},t}(),Le=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Be=/([^\#-~ |!])/g;function ze(t){return t.replace(/&/g,"&amp;").replace(Le,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Be,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Ue(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var Ve=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}({}),We=function(){return function(){}}(),je=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),He=/^url\(([^)]+)\)$/,Ge=/([A-Z])/g;function qe(t){try{return null!=t?t.toString().slice(0,30):t}catch(Tz){return"[ERROR] Exception while trying to serialize the value"}}function Ke(t){return!!t&&"function"==typeof t.then}function $e(t){return!!t&&"function"==typeof t.subscribe}var Xe=null;function Ye(){if(!Xe){var t=Ut.Symbol;if(t&&t.iterator)Xe=t.iterator;else for(var e=Object.getOwnPropertyNames(Map.prototype),n=0;n<e.length;++n){var r=e[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Xe=r)}}return Xe}function Qe(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function Ze(t,e){var n=tn(t),r=tn(e);return n&&r?function(t,e,n){for(var r=t[Ye()](),o=e[Ye()]();;){var i=r.next(),a=o.next();if(i.done&&a.done)return!0;if(i.done||a.done)return!1;if(!n(i.value,a.value))return!1}}(t,e,Ze):!(n||!t||"object"!=typeof t&&"function"!=typeof t||r||!e||"object"!=typeof e&&"function"!=typeof e)||Qe(t,e)}var Je=function(){function t(t){this.wrapped=t}return t.wrap=function(e){return new t(e)},t.unwrap=function(e){return t.isWrapped(e)?e.wrapped:e},t.isWrapped=function(e){return e instanceof t},t}();function tn(t){return!!en(t)&&(Array.isArray(t)||!(t instanceof Map)&&Ye()in t)}function en(t){return null!==t&&("function"==typeof t||"object"==typeof t)}var nn=function(){function t(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}return t.prototype.isFirstChange=function(){return this.firstChange},t}(),rn=new Ht("The presence of this token marks an injector as being the root injector."),on=function(){return function(){}}(),an=function(){return function(){}}();function sn(t){var e=Error("No component factory found for "+Mt(t)+". Did you add it to @NgModule.entryComponents?");return e[un]=t,e}var un="ngComponent",ln=function(){function t(){}return t.prototype.resolveComponentFactory=function(t){throw sn(t)},t}(),cn=function(){function t(){}return t.NULL=new ln,t}(),pn=function(){function t(t,e,n){this._parent=e,this._ngModule=n,this._factories=new Map;for(var r=0;r<t.length;r++){var o=t[r];this._factories.set(o.componentType,o)}}return t.prototype.resolveComponentFactory=function(t){var e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw sn(t);return new hn(e,this._ngModule)},t}(),hn=function(t){function e(e,n){var r=t.call(this)||this;return r.factory=e,r.ngModule=n,r.selector=e.selector,r.componentType=e.componentType,r.ngContentSelectors=e.ngContentSelectors,r.inputs=e.inputs,r.outputs=e.outputs,r}return a(e,t),e.prototype.create=function(t,e,n,r){return this.factory.create(t,e,n,r||this.ngModule)},e}(an),fn=function(){return function(){}}(),dn=function(){return function(){}}();function mn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}var vn=function(){function t(t){this.nativeElement=t}return t.__NG_ELEMENT_ID__=function(){return gn(t)},t}(),gn=mn,yn=function(){return function(){}}(),bn=function(){return function(){}}(),wn=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}({}),xn=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return Cn()},t}(),Cn=mn,En=new(function(){return function(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}())("8.0.3"),Sn=function(){function t(){}return t.prototype.supports=function(t){return tn(t)},t.prototype.create=function(t){return new Nn(t)},t}(),kn=function(t,e){return e},Nn=function(){function t(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||kn}return t.prototype.forEachItem=function(t){var e;for(e=this._itHead;null!==e;e=e._next)t(e)},t.prototype.forEachOperation=function(t){for(var e=this._itHead,n=this._removalsHead,r=0,o=null;e||n;){var i=!n||e&&e.currentIndex<Tn(n,r,o)?e:n,a=Tn(i,r,o),s=i.currentIndex;if(i===n)r--,n=n._nextRemoved;else if(e=e._next,null==i.previousIndex)r++;else{o||(o=[]);var u=a-r,l=s-r;if(u!=l){for(var c=0;c<u;c++){var p=c<o.length?o[c]:o[c]=0,h=p+c;l<=h&&h<u&&(o[c]=p+1)}o[i.previousIndex]=l-u}}a!==s&&t(i,a,s)}},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachMovedItem=function(t){var e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.forEachIdentityChange=function(t){var e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)},t.prototype.diff=function(t){if(null==t&&(t=[]),!tn(t))throw new Error("Error trying to diff '"+Mt(t)+"'. Only arrays and iterables are allowed");return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n,r,o,i=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(var s=0;s<this.length;s++)o=this._trackByFn(s,r=t[s]),null!==i&&Qe(i.trackById,o)?(a&&(i=this._verifyReinsertion(i,r,o,s)),Qe(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,o,s),a=!0),i=i._next}else n=0,function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e(t[n]);else for(var r=t[Ye()](),o=void 0;!(o=r.next()).done;)e(o.value)}(t,function(t){o=e._trackByFn(n,t),null!==i&&Qe(i.trackById,o)?(a&&(i=e._verifyReinsertion(i,t,o,n)),Qe(i.item,t)||e._addIdentityChange(i,t)):(i=e._mismatch(i,t,o,n),a=!0),i=i._next,n++}),this.length=n;return this._truncate(i),this.collection=t,this.isDirty},Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead},enumerable:!0,configurable:!0}),t.prototype._reset=function(){if(this.isDirty){var t=void 0,e=void 0;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}},t.prototype._mismatch=function(t,e,n,r){var o;return null===t?o=this._itTail:(o=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Qe(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,o,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Qe(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,o,r)):t=this._addAfter(new In(e,n),o,r),t},t.prototype._verifyReinsertion=function(t,e,n,r){var o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==o?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t},t.prototype._truncate=function(t){for(;null!==t;){var e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)},t.prototype._reinsertAfter=function(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);var r=t._prevRemoved,o=t._nextRemoved;return null===r?this._removalsHead=o:r._nextRemoved=o,null===o?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._moveAfter=function(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t},t.prototype._addAfter=function(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t},t.prototype._insertAfter=function(t,e,n){var r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new An),this._linkedRecords.put(t),t.currentIndex=n,t},t.prototype._remove=function(t){return this._addToRemovals(this._unlink(t))},t.prototype._unlink=function(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);var e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t},t.prototype._addToMoves=function(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)},t.prototype._addToRemovals=function(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new An),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t},t.prototype._addIdentityChange=function(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t},t}(),In=function(){return function(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}(),Rn=function(){function t(){this._head=null,this._tail=null}return t.prototype.add=function(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)},t.prototype.get=function(t,e){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&Qe(n.trackById,t))return n;return null},t.prototype.remove=function(t){var e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head},t}(),An=function(){function t(){this.map=new Map}return t.prototype.put=function(t){var e=t.trackById,n=this.map.get(e);n||(n=new Rn,this.map.set(e,n)),n.add(t)},t.prototype.get=function(t,e){var n=this.map.get(t);return n?n.get(t,e):null},t.prototype.remove=function(t){var e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.map.size},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.map.clear()},t}();function Tn(t,e,n){var r=t.previousIndex;if(null===r)return r;var o=0;return n&&r<n.length&&(o=n[r]),r+e+o}var _n=function(){function t(){}return t.prototype.supports=function(t){return t instanceof Map||en(t)},t.prototype.create=function(){return new Dn},t}(),Dn=function(){function t(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead},enumerable:!0,configurable:!0}),t.prototype.forEachItem=function(t){var e;for(e=this._mapHead;null!==e;e=e._next)t(e)},t.prototype.forEachPreviousItem=function(t){var e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)},t.prototype.forEachChangedItem=function(t){var e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)},t.prototype.forEachAddedItem=function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)},t.prototype.forEachRemovedItem=function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)},t.prototype.diff=function(t){if(t){if(!(t instanceof Map||en(t)))throw new Error("Error trying to diff '"+Mt(t)+"'. Only maps and objects are allowed")}else t=new Map;return this.check(t)?this:null},t.prototype.onDestroy=function(){},t.prototype.check=function(t){var e=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(t,function(t,r){if(n&&n.key===r)e._maybeAddToChanges(n,t),e._appendAfter=n,n=n._next;else{var o=e._getOrCreateRecordForKey(r,t);n=e._insertBeforeOrAppend(n,o)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty},t.prototype._insertBeforeOrAppend=function(t,e){if(t){var n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null},t.prototype._getOrCreateRecordForKey=function(t,e){if(this._records.has(t)){var n=this._records.get(t);this._maybeAddToChanges(n,e);var r=n._prev,o=n._next;return r&&(r._next=o),o&&(o._prev=r),n._next=null,n._prev=null,n}var i=new On(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i},t.prototype._reset=function(){if(this.isDirty){var t=void 0;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}},t.prototype._maybeAddToChanges=function(t,e){Qe(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))},t.prototype._addToAdditions=function(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)},t.prototype._addToChanges=function(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)},t.prototype._forEach=function(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(function(n){return e(t[n],n)})},t}(),On=function(){return function(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}(),Mn=function(){function t(t){this.factories=t}return t.create=function(e,n){if(null!=n){var r=n.factories.slice();e=e.concat(r)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,n)},deps:[[t,new Rt,new Nt]]}},t.prototype.find=function(t){var e,n=this.factories.find(function(e){return e.supports(t)});if(null!=n)return n;throw new Error("Cannot find a differ supporting object '"+t+"' of type '"+((e=t).name||typeof e)+"'")},t.ngInjectableDef=_t({providedIn:"root",factory:function(){return new t([new Sn])}}),t}(),Fn=function(){function t(t){this.factories=t}return t.create=function(e,n){if(n){var r=n.factories.slice();e=e.concat(r)}return new t(e)},t.extend=function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,n)},deps:[[t,new Rt,new Nt]]}},t.prototype.find=function(t){var e=this.factories.find(function(e){return e.supports(t)});if(e)return e;throw new Error("Cannot find a differ supporting object '"+t+"'")},t.ngInjectableDef=_t({providedIn:"root",factory:function(){return new t([new _n])}}),t}(),Pn=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return Ln()},t}(),Ln=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Bn=[new _n],zn=new Mn([new Sn]),Un=new Fn(Bn),Vn=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return Wn(t,vn)},t}(),Wn=mn,jn=function(){function t(){}return t.__NG_ELEMENT_ID__=function(){return Hn(t,vn)},t}(),Hn=mn;function Gn(t,e,n,r){var o="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '"+e+"'. Current value: '"+n+"'.";return r&&(o+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){var n=new Error(t);return qn(n,e),n}(o,t)}function qn(t,e){t[se]=e,t[le]=e.logError.bind(e)}function Kn(t){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+t)}function $n(t,e,n){var r=t.state,o=1792&r;return o===e?(t.state=-1793&r|n,t.initIndex=-1,!0):o===n}function Xn(t,e,n){return(1792&t.state)===e&&t.initIndex<=n&&(t.initIndex=n+1,!0)}function Yn(t,e){return t.nodes[e]}function Qn(t,e){return t.nodes[e]}function Zn(t,e){return t.nodes[e]}function Jn(t,e){return t.nodes[e]}function tr(t,e){return t.nodes[e]}var er={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},nr=function(){},rr=new Map;function or(t){var e=rr.get(t);return e||(e=Mt(t)+"_"+rr.size,rr.set(t,e)),e}var ir="$$undefined",ar="$$empty";function sr(t){return{id:ir,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}var ur=0;function lr(t,e,n,r){return!(!(2&t.state)&&Qe(t.oldValues[e.bindingIndex+n],r))}function cr(t,e,n,r){return!!lr(t,e,n,r)&&(t.oldValues[e.bindingIndex+n]=r,!0)}function pr(t,e,n,r){var o=t.oldValues[e.bindingIndex+n];if(1&t.state||!Ze(o,r)){var i=e.bindings[n].name;throw Gn(er.createDebugContext(t,e.nodeIndex),i+": "+o,i+": "+r,0!=(1&t.state))}}function hr(t){for(var e=t;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function fr(t,e){for(var n=t;n&&n!==e;)n.state|=64,n=n.viewContainerParent||n.parent}function dr(t,e,n,r){try{return hr(33554432&t.def.nodes[e].flags?Qn(t,e).componentView:t),er.handleEvent(t,e,n,r)}catch(Tz){t.root.errorHandler.handleError(Tz)}}function mr(t){return t.parent?Qn(t.parent,t.parentNodeDef.nodeIndex):null}function vr(t){return t.parent?t.parentNodeDef.parent:null}function gr(t,e){switch(201347067&e.flags){case 1:return Qn(t,e.nodeIndex).renderElement;case 2:return Yn(t,e.nodeIndex).renderText}}function yr(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function br(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function wr(t){return 1<<t%32}function xr(t){var e={},n=0,r={};return t&&t.forEach(function(t){var o=f(t,2),i=o[0],a=o[1];"number"==typeof i?(e[i]=a,n|=wr(i)):r[i]=a}),{matchedQueries:e,references:r,matchedQueryIds:n}}function Cr(t,e){return t.map(function(t){var n,r,o;return Array.isArray(t)?(o=(n=f(t,2))[0],r=n[1]):(o=0,r=t),r&&("function"==typeof r||"object"==typeof r)&&e&&Object.defineProperty(r,Gt,{value:e,configurable:!0}),{flags:o,token:r,tokenKey:or(r)}})}function Er(t,e,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===pe.Native?Qn(t,n.renderParent.nodeIndex).renderElement:void 0:e}var Sr=new WeakMap;function kr(t){var e=Sr.get(t);return e||((e=t(function(){return nr})).factory=t,Sr.set(t,e)),e}function Nr(t,e,n,r,o){3===e&&(n=t.renderer.parentNode(gr(t,t.def.lastRenderRootNode))),Ir(t,e,0,t.def.nodes.length-1,n,r,o)}function Ir(t,e,n,r,o,i,a){for(var s=n;s<=r;s++){var u=t.def.nodes[s];11&u.flags&&Ar(t,u,e,o,i,a),s+=u.childCount}}function Rr(t,e,n,r,o,i){for(var a=t;a&&!yr(a);)a=a.parent;for(var s=a.parent,u=vr(a),l=u.nodeIndex+u.childCount,c=u.nodeIndex+1;c<=l;c++){var p=s.def.nodes[c];p.ngContentIndex===e&&Ar(s,p,n,r,o,i),c+=p.childCount}if(!s.parent){var h=t.root.projectableNodes[e];if(h)for(c=0;c<h.length;c++)Tr(t,h[c],n,r,o,i)}}function Ar(t,e,n,r,o,i){if(8&e.flags)Rr(t,e.ngContent.index,n,r,o,i);else{var a=gr(t,e);if(3===n&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&Tr(t,a,n,r,o,i),32&e.bindingFlags&&Tr(Qn(t,e.nodeIndex).componentView,a,n,r,o,i)):Tr(t,a,n,r,o,i),16777216&e.flags)for(var s=Qn(t,e.nodeIndex).viewContainer._embeddedViews,u=0;u<s.length;u++)Nr(s[u],n,r,o,i);1&e.flags&&!e.element.name&&Ir(t,n,e.nodeIndex+1,e.nodeIndex+e.childCount,r,o,i)}}function Tr(t,e,n,r,o,i){var a=t.renderer;switch(n){case 1:a.appendChild(r,e);break;case 2:a.insertBefore(r,e,o);break;case 3:a.removeChild(r,e);break;case 0:i.push(e)}}var _r=/^:([^:]+):(.+)$/;function Dr(t){if(":"===t[0]){var e=t.match(_r);return[e[1],e[2]]}return["",t]}function Or(t){for(var e=0,n=0;n<t.length;n++)e|=t[n].flags;return e}var Mr=new Object,Fr=or(Xt),Pr=or(Kt),Lr=or(fn);function Br(t,e,n,r){return n=Lt(n),{index:-1,deps:Cr(r,Mt(e)),flags:t,token:e,value:n}}function zr(t,e,n){void 0===n&&(n=Xt.THROW_IF_NOT_FOUND);var r,o,i=Wt(t);try{if(8&e.flags)return e.token;if(2&e.flags&&(n=null),1&e.flags)return t._parent.get(e.token,n);var a=e.tokenKey;switch(a){case Fr:case Pr:case Lr:return t}var s,u=t._def.providersByKey[a];if(u){var l=t._providers[u.index];return void 0===l&&(l=t._providers[u.index]=Ur(t,u)),l===Mr?void 0:l}if((s=Dt(e.token))&&(r=t,null!=(o=s).providedIn&&(function(t,e){return t._def.modules.indexOf(o.providedIn)>-1}(r)||"root"===o.providedIn&&r._def.isRoot))){var c=t._providers.length;return t._def.providers[c]=t._def.providersByKey[e.tokenKey]={flags:5120,value:s.factory,deps:[],index:c,token:e.token},t._providers[c]=Mr,t._providers[c]=Ur(t,t._def.providersByKey[e.tokenKey])}return 4&e.flags?n:t._parent.get(e.token,n)}finally{Wt(i)}}function Ur(t,e){var n;switch(201347067&e.flags){case 512:n=function(t,e,n){var r=n.length;switch(r){case 0:return new e;case 1:return new e(zr(t,n[0]));case 2:return new e(zr(t,n[0]),zr(t,n[1]));case 3:return new e(zr(t,n[0]),zr(t,n[1]),zr(t,n[2]));default:for(var o=new Array(r),i=0;i<r;i++)o[i]=zr(t,n[i]);return new(e.bind.apply(e,d([void 0],o)))}}(t,e.value,e.deps);break;case 1024:n=function(t,e,n){var r=n.length;switch(r){case 0:return e();case 1:return e(zr(t,n[0]));case 2:return e(zr(t,n[0]),zr(t,n[1]));case 3:return e(zr(t,n[0]),zr(t,n[1]),zr(t,n[2]));default:for(var o=Array(r),i=0;i<r;i++)o[i]=zr(t,n[i]);return e.apply(void 0,d(o))}}(t,e.value,e.deps);break;case 2048:n=zr(t,e.deps[0]);break;case 256:n=e.value}return n===Mr||null===n||"object"!=typeof n||131072&e.flags||"function"!=typeof n.ngOnDestroy||(e.flags|=131072),void 0===n?Mr:n}function Vr(t,e){var n=t.viewContainer._embeddedViews;if((null==e||e>=n.length)&&(e=n.length-1),e<0)return null;var r=n[e];return r.viewContainerParent=null,Gr(n,e),er.dirtyParentQueries(r),jr(r),r}function Wr(t,e,n){var r=e?gr(e,e.def.lastRenderRootNode):t.renderElement,o=n.renderer.parentNode(r),i=n.renderer.nextSibling(r);Nr(n,2,o,i,void 0)}function jr(t){Nr(t,3,null,null,void 0)}function Hr(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Gr(t,e){e>=t.length-1?t.pop():t.splice(e,1)}var qr=new Object;function Kr(t,e,n,r,o,i){return new $r(t,e,n,r,o,i)}var $r=function(t){function e(e,n,r,o,i,a){var s=t.call(this)||this;return s.selector=e,s.componentType=n,s._inputs=o,s._outputs=i,s.ngContentSelectors=a,s.viewDefFactory=r,s}return a(e,t),Object.defineProperty(e.prototype,"inputs",{get:function(){var t=[],e=this._inputs;for(var n in e)t.push({propName:n,templateName:e[n]});return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){var t=[];for(var e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t},enumerable:!0,configurable:!0}),e.prototype.create=function(t,e,n,r){if(!r)throw new Error("ngModule should be provided");var o=kr(this.viewDefFactory),i=o.nodes[0].element.componentProvider.nodeIndex,a=er.createRootView(t,e||[],n,o,r,qr),s=Zn(a,i).instance;return n&&a.renderer.setAttribute(Qn(a,0).renderElement,"ng-version",En.full),new Xr(a,new Jr(a),s)},e}(an),Xr=function(t){function e(e,n,r){var o=t.call(this)||this;return o._view=e,o._viewRef=n,o._component=r,o._elDef=o._view.def.nodes[0],o.hostView=n,o.changeDetectorRef=n,o.instance=r,o}return a(e,t),Object.defineProperty(e.prototype,"location",{get:function(){return new vn(Qn(this._view,this._elDef.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return new ro(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentType",{get:function(){return this._component.constructor},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._viewRef.destroy()},e.prototype.onDestroy=function(t){this._viewRef.onDestroy(t)},e}(on);function Yr(t,e,n){return new Qr(t,e,n)}var Qr=function(){function t(t,e,n){this._view=t,this._elDef=e,this._data=n,this._embeddedViews=[]}return Object.defineProperty(t.prototype,"element",{get:function(){return new vn(this._data.renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return new ro(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentInjector",{get:function(){for(var t=this._view,e=this._elDef.parent;!e&&t;)e=vr(t),t=t.parent;return t?new ro(t,e):new ro(this._view,null)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var t=this._embeddedViews.length-1;t>=0;t--){var e=Vr(this._data,t);er.destroyView(e)}},t.prototype.get=function(t){var e=this._embeddedViews[t];if(e){var n=new Jr(e);return n.attachToViewContainerRef(this),n}return null},Object.defineProperty(t.prototype,"length",{get:function(){return this._embeddedViews.length},enumerable:!0,configurable:!0}),t.prototype.createEmbeddedView=function(t,e,n){var r=t.createEmbeddedView(e||{});return this.insert(r,n),r},t.prototype.createComponent=function(t,e,n,r,o){var i=n||this.parentInjector;o||t instanceof hn||(o=i.get(fn));var a=t.create(i,r,void 0,o);return this.insert(a.hostView,e),a},t.prototype.insert=function(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,o,i,a=t;return i=(n=this._data).viewContainer._embeddedViews,null==(r=e)&&(r=i.length),(o=a._view).viewContainerParent=this._view,Hr(i,r,o),function(t,e){var n=mr(e);if(n&&n!==t&&!(16&e.state)){e.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(e),function(t,n){if(!(4&n.flags)){e.parent.def.nodeFlags|=4,n.flags|=4;for(var r=n.parent;r;)r.childFlags|=4,r=r.parent}}(0,e.parentNodeDef)}}(n,o),er.dirtyParentQueries(o),Wr(n,r>0?i[r-1]:null,o),a.attachToViewContainerRef(this),t},t.prototype.move=function(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,o,i,a,s=this._embeddedViews.indexOf(t._view);return o=e,a=(i=(n=this._data).viewContainer._embeddedViews)[r=s],Gr(i,r),null==o&&(o=i.length),Hr(i,o,a),er.dirtyParentQueries(a),jr(a),Wr(n,o>0?i[o-1]:null,a),t},t.prototype.indexOf=function(t){return this._embeddedViews.indexOf(t._view)},t.prototype.remove=function(t){var e=Vr(this._data,t);e&&er.destroyView(e)},t.prototype.detach=function(t){var e=Vr(this._data,t);return e?new Jr(e):null},t}();function Zr(t){return new Jr(t)}var Jr=function(){function t(t){this._view=t,this._viewContainerRef=null,this._appRef=null}return Object.defineProperty(t.prototype,"rootNodes",{get:function(){return Nr(this._view,0,void 0,void 0,t=[]),t;var t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._view.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return 0!=(128&this._view.state)},enumerable:!0,configurable:!0}),t.prototype.markForCheck=function(){hr(this._view)},t.prototype.detach=function(){this._view.state&=-5},t.prototype.detectChanges=function(){var t=this._view.root.rendererFactory;t.begin&&t.begin();try{er.checkAndUpdateView(this._view)}finally{t.end&&t.end()}},t.prototype.checkNoChanges=function(){er.checkNoChangesView(this._view)},t.prototype.reattach=function(){this._view.state|=4},t.prototype.onDestroy=function(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)},t.prototype.destroy=function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),er.destroyView(this._view)},t.prototype.detachFromAppRef=function(){this._appRef=null,jr(this._view),er.dirtyParentQueries(this._view)},t.prototype.attachToAppRef=function(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t},t.prototype.attachToViewContainerRef=function(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t},t}();function to(t,e){return new eo(t,e)}var eo=function(t){function e(e,n){var r=t.call(this)||this;return r._parentView=e,r._def=n,r}return a(e,t),e.prototype.createEmbeddedView=function(t){return new Jr(er.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))},Object.defineProperty(e.prototype,"elementRef",{get:function(){return new vn(Qn(this._parentView,this._def.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),e}(Vn);function no(t,e){return new ro(t,e)}var ro=function(){function t(t,e){this.view=t,this.elDef=e}return t.prototype.get=function(t,e){return void 0===e&&(e=Xt.THROW_IF_NOT_FOUND),er.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:or(t)},e)},t}();function oo(t,e){var n=t.def.nodes[e];if(1&n.flags){var r=Qn(t,n.nodeIndex);return n.element.template?r.template:r.renderElement}if(2&n.flags)return Yn(t,n.nodeIndex).renderText;if(20240&n.flags)return Zn(t,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index "+e)}function io(t){return new ao(t.renderer)}var ao=function(){function t(t){this.delegate=t}return t.prototype.selectRootElement=function(t){return this.delegate.selectRootElement(t)},t.prototype.createElement=function(t,e){var n=f(Dr(e),2),r=this.delegate.createElement(n[1],n[0]);return t&&this.delegate.appendChild(t,r),r},t.prototype.createViewRoot=function(t){return t},t.prototype.createTemplateAnchor=function(t){var e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e},t.prototype.createText=function(t,e){var n=this.delegate.createText(e);return t&&this.delegate.appendChild(t,n),n},t.prototype.projectNodes=function(t,e){for(var n=0;n<e.length;n++)this.delegate.appendChild(t,e[n])},t.prototype.attachViewAfter=function(t,e){for(var n=this.delegate.parentNode(t),r=this.delegate.nextSibling(t),o=0;o<e.length;o++)this.delegate.insertBefore(n,e[o],r)},t.prototype.detachView=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}},t.prototype.destroyView=function(t,e){for(var n=0;n<e.length;n++)this.delegate.destroyNode(e[n])},t.prototype.listen=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.listenGlobal=function(t,e,n){return this.delegate.listen(t,e,n)},t.prototype.setElementProperty=function(t,e,n){this.delegate.setProperty(t,e,n)},t.prototype.setElementAttribute=function(t,e,n){var r=f(Dr(e),2),o=r[0],i=r[1];null!=n?this.delegate.setAttribute(t,i,n,o):this.delegate.removeAttribute(t,i,o)},t.prototype.setBindingDebugInfo=function(t,e,n){},t.prototype.setElementClass=function(t,e,n){n?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)},t.prototype.setElementStyle=function(t,e,n){null!=n?this.delegate.setStyle(t,e,n):this.delegate.removeStyle(t,e)},t.prototype.invokeElementMethod=function(t,e,n){t[e].apply(t,n)},t.prototype.setText=function(t,e){this.delegate.setValue(t,e)},t.prototype.animate=function(){throw new Error("Renderer.animate is no longer supported!")},t}();function so(t,e,n,r){return new uo(t,e,n,r)}var uo=function(){function t(t,e,n,r){this._moduleType=t,this._parent=e,this._bootstrapComponents=n,this._def=r,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){for(var e=t._def,n=t._providers=new Array(e.providers.length),r=0;r<e.providers.length;r++){var o=e.providers[r];4096&o.flags||void 0===n[r]&&(n[r]=Ur(t,o))}}(this)}return t.prototype.get=function(t,e,n){void 0===e&&(e=Xt.THROW_IF_NOT_FOUND),void 0===n&&(n=At.Default);var r=0;return n&At.SkipSelf?r|=1:n&At.Self&&(r|=4),zr(this,{token:t,tokenKey:or(t),flags:r},e)},Object.defineProperty(t.prototype,"instance",{get:function(){return this.get(this._moduleType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentFactoryResolver",{get:function(){return this.get(cn)},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The ng module "+Mt(this.instance.constructor)+" has already been destroyed.");this._destroyed=!0,function(t,e){for(var n=t._def,r=new Set,o=0;o<n.providers.length;o++)if(131072&n.providers[o].flags){var i=t._providers[o];if(i&&i!==Mr){var a=i.ngOnDestroy;"function"!=typeof a||r.has(i)||(a.apply(i),r.add(i))}}}(this),this._destroyListeners.forEach(function(t){return t()})},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},t}(),lo=or(yn),co=or(xn),po=or(vn),ho=or(jn),fo=or(Vn),mo=or(Pn),vo=or(Xt),go=or(Kt);function yo(t,e,n,r,o,i,a,s){var u=[];if(a)for(var l in a){var c=f(a[l],2);u[c[0]]={flags:8,name:l,nonMinifiedName:c[1],ns:null,securityContext:null,suffix:null}}var p=[];if(s)for(var h in s)p.push({type:1,propName:h,target:null,eventName:s[h]});return function(t,e,n,r,o,i,a,s,u){var l=xr(n),c=l.matchedQueries,p=l.references,h=l.matchedQueryIds;u||(u=[]),s||(s=[]),i=Lt(i);var f=Cr(a,Mt(o));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:h,references:p,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:Or(s),outputs:u,element:null,provider:{token:o,value:i,deps:f},text:null,query:null,ngContent:null}}(t,e|=16384,n,r,o,o,i,u,p)}function bo(t,e){return Eo(t,e)}function wo(t,e){for(var n=t;n.parent&&!yr(n);)n=n.parent;return So(n.parent,vr(n),!0,e.provider.value,e.provider.deps)}function xo(t,e){var n=So(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(var r=0;r<e.outputs.length;r++){var o=e.outputs[r],i=n[o.propName];if(!$e(i))throw new Error("@Output "+o.propName+" not initialized in '"+n.constructor.name+"'.");var a=i.subscribe(Co(t,e.parent.nodeIndex,o.eventName));t.disposables[e.outputIndex+r]=a.unsubscribe.bind(a)}return n}function Co(t,e,n){return function(r){return dr(t,e,n,r)}}function Eo(t,e){var n=(8192&e.flags)>0,r=e.provider;switch(201347067&e.flags){case 512:return So(t,e.parent,n,r.value,r.deps);case 1024:return function(t,e,n,r,o){var i=o.length;switch(i){case 0:return r();case 1:return r(No(t,e,n,o[0]));case 2:return r(No(t,e,n,o[0]),No(t,e,n,o[1]));case 3:return r(No(t,e,n,o[0]),No(t,e,n,o[1]),No(t,e,n,o[2]));default:for(var a=Array(i),s=0;s<i;s++)a[s]=No(t,e,n,o[s]);return r.apply(void 0,d(a))}}(t,e.parent,n,r.value,r.deps);case 2048:return No(t,e.parent,n,r.deps[0]);case 256:return r.value}}function So(t,e,n,r,o){var i=o.length;switch(i){case 0:return new r;case 1:return new r(No(t,e,n,o[0]));case 2:return new r(No(t,e,n,o[0]),No(t,e,n,o[1]));case 3:return new r(No(t,e,n,o[0]),No(t,e,n,o[1]),No(t,e,n,o[2]));default:for(var a=new Array(i),s=0;s<i;s++)a[s]=No(t,e,n,o[s]);return new(r.bind.apply(r,d([void 0],a)))}}var ko={};function No(t,e,n,r,o){if(void 0===o&&(o=Xt.THROW_IF_NOT_FOUND),8&r.flags)return r.token;var i=t;2&r.flags&&(o=null);var a=r.tokenKey;a===mo&&(n=!(!e||!e.element.componentView)),e&&1&r.flags&&(n=!1,e=e.parent);for(var s=t;s;){if(e)switch(a){case lo:return io(Io(s,e,n));case co:return Io(s,e,n).renderer;case po:return new vn(Qn(s,e.nodeIndex).renderElement);case ho:return Qn(s,e.nodeIndex).viewContainer;case fo:if(e.element.template)return Qn(s,e.nodeIndex).template;break;case mo:return Zr(Io(s,e,n));case vo:case go:return no(s,e);default:var u=(n?e.element.allProviders:e.element.publicProviders)[a];if(u){var l=Zn(s,u.nodeIndex);return l||(l={instance:Eo(s,u)},s.nodes[u.nodeIndex]=l),l.instance}}n=yr(s),e=vr(s),s=s.parent,4&r.flags&&(s=null)}var c=i.root.injector.get(r.token,ko);return c!==ko||o===ko?c:i.root.ngModule.injector.get(r.token,o)}function Io(t,e,n){var r;if(n)r=Qn(t,e.nodeIndex).componentView;else for(r=t;r.parent&&!yr(r);)r=r.parent;return r}function Ro(t,e,n,r,o,i){if(32768&n.flags){var a=Qn(t,n.parent.nodeIndex).componentView;2&a.def.flags&&(a.state|=8)}if(e.instance[n.bindings[r].name]=o,524288&n.flags){i=i||{};var s=Je.unwrap(t.oldValues[n.bindingIndex+r]);i[n.bindings[r].nonMinifiedName]=new nn(s,o,0!=(2&t.state))}return t.oldValues[n.bindingIndex+r]=o,i}function Ao(t,e){if(t.def.nodeFlags&e)for(var n=t.def.nodes,r=0,o=0;o<n.length;o++){var i=n[o],a=i.parent;for(!a&&i.flags&e&&_o(t,o,i.flags&e,r++),0==(i.childFlags&e)&&(o+=i.childCount);a&&1&a.flags&&o===a.nodeIndex+a.childCount;)a.directChildFlags&e&&(r=To(t,a,e,r)),a=a.parent}}function To(t,e,n,r){for(var o=e.nodeIndex+1;o<=e.nodeIndex+e.childCount;o++){var i=t.def.nodes[o];i.flags&n&&_o(t,o,i.flags&n,r++),o+=i.childCount}return r}function _o(t,e,n,r){var o=Zn(t,e);if(o){var i=o.instance;i&&(er.setCurrentNode(t,e),1048576&n&&Xn(t,512,r)&&i.ngAfterContentInit(),2097152&n&&i.ngAfterContentChecked(),4194304&n&&Xn(t,768,r)&&i.ngAfterViewInit(),8388608&n&&i.ngAfterViewChecked(),131072&n&&i.ngOnDestroy())}}var Do=new Ht("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return he}}),Oo=function(t){function e(e){void 0===e&&(e=!1);var n=t.call(this)||this;return n.__isAsync=e,n}return a(e,t),e.prototype.emit=function(e){t.prototype.next.call(this,e)},e.prototype.subscribe=function(e,n,r){var o,i=function(t){return null},a=function(){return null};e&&"object"==typeof e?(o=this.__isAsync?function(t){setTimeout(function(){return e.next(t)})}:function(t){e.next(t)},e.error&&(i=this.__isAsync?function(t){setTimeout(function(){return e.error(t)})}:function(t){e.error(t)}),e.complete&&(a=this.__isAsync?function(){setTimeout(function(){return e.complete()})}:function(){e.complete()})):(o=this.__isAsync?function(t){setTimeout(function(){return e(t)})}:function(t){e(t)},n&&(i=this.__isAsync?function(t){setTimeout(function(){return n(t)})}:function(t){n(t)}),r&&(a=this.__isAsync?function(){setTimeout(function(){return r()})}:function(){r()}));var s=t.prototype.subscribe.call(this,o,i,a);return e instanceof w&&e.add(s),s},e}(z),Mo=function(){function t(){this.dirty=!0,this._results=[],this.changes=new Oo,this.length=0}return t.prototype.map=function(t){return this._results.map(t)},t.prototype.filter=function(t){return this._results.filter(t)},t.prototype.find=function(t){return this._results.find(t)},t.prototype.reduce=function(t,e){return this._results.reduce(t,e)},t.prototype.forEach=function(t){this._results.forEach(t)},t.prototype.some=function(t){return this._results.some(t)},t.prototype.toArray=function(){return this._results.slice()},t.prototype[Ye()]=function(){return this._results[Ye()]()},t.prototype.toString=function(){return this._results.toString()},t.prototype.reset=function(t){this._results=function t(e,n){void 0===n&&(n=e);for(var r=0;r<e.length;r++){var o=e[r];Array.isArray(o)?(n===e&&(n=e.slice(0,r)),t(o,n)):n!==e&&n.push(o)}return n}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]},t.prototype.notifyOnChanges=function(){this.changes.emit(this)},t.prototype.setDirty=function(){this.dirty=!0},t.prototype.destroy=function(){this.changes.complete(),this.changes.unsubscribe()},t}(),Fo=function(){return function(){}}(),Po=St("Input",function(t){return{bindingPropertyName:t}}),Lo=St("HostBinding",function(t){return{hostPropertyName:t}}),Bo=new Ht("Application Initializer"),zo=function(){function t(t){var e=this;this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return t.prototype.runInitializers=function(){var t=this;if(!this.initialized){var e=[],n=function(){t.done=!0,t.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var o=this.appInits[r]();Ke(o)&&e.push(o)}Promise.all(e).then(function(){n()}).catch(function(e){t.reject(e)}),0===e.length&&n(),this.initialized=!0}},t}(),Uo=new Ht("AppId");function Vo(){return""+Wo()+Wo()+Wo()}function Wo(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var jo=new Ht("Platform Initializer"),Ho=new Ht("Platform ID"),Go=new Ht("appBootstrapListener"),qo=function(){function t(){}return t.prototype.log=function(t){console.log(t)},t.prototype.warn=function(t){console.warn(t)},t}();function Ko(){throw new Error("Runtime compiler is not loaded")}var $o,Xo,Yo=Ko,Qo=Ko,Zo=Ko,Jo=Ko,ti=function(){function t(){this.compileModuleSync=Yo,this.compileModuleAsync=Qo,this.compileModuleAndAllComponentsSync=Zo,this.compileModuleAndAllComponentsAsync=Jo}return t.prototype.clearCache=function(){},t.prototype.clearCacheFor=function(t){},t.prototype.getModuleId=function(t){},t}(),ei=function(){return function(){}}();function ni(){var t=Ut.wtf;return!(!t||!($o=t.trace)||(Xo=$o.events,0))}var ri=ni();function oi(t,e){return null}var ii=ri?function(t,e){return void 0===e&&(e=null),Xo.createScope(t,e)}:function(t,e){return oi},ai=ri?function(t,e){return $o.leaveScope(t,e),e}:function(t,e){return e},si=function(){return Promise.resolve(0)}();function ui(t){"undefined"==typeof Zone?si.then(function(){t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}var li=function(){function t(t){var e,n=t.enableLongStackTrace,r=void 0!==n&&n;if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Oo(!1),this.onMicrotaskEmpty=new Oo(!1),this.onStable=new Oo(!1),this.onError=new Oo(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(e=this)._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(t,n,r,o,i,a){try{return fi(e),t.invokeTask(r,o,i,a)}finally{di(e)}},onInvoke:function(t,n,r,o,i,a,s){try{return fi(e),t.invoke(r,o,i,a,s)}finally{di(e)}},onHasTask:function(t,n,r,o){t.hasTask(r,o),n===r&&("microTask"==o.change?(e.hasPendingMicrotasks=o.microTask,hi(e)):"macroTask"==o.change&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:function(t,n,r,o){return t.handleError(r,o),e.runOutsideAngular(function(){return e.onError.emit(o)}),!1}})}return t.isInAngularZone=function(){return!0===Zone.current.get("isAngularZone")},t.assertInAngularZone=function(){if(!t.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")},t.assertNotInAngularZone=function(){if(t.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")},t.prototype.run=function(t,e,n){return this._inner.run(t,e,n)},t.prototype.runTask=function(t,e,n,r){var o=this._inner,i=o.scheduleEventTask("NgZoneEvent: "+r,t,pi,ci,ci);try{return o.runTask(i,e,n)}finally{o.cancelTask(i)}},t.prototype.runGuarded=function(t,e,n){return this._inner.runGuarded(t,e,n)},t.prototype.runOutsideAngular=function(t){return this._outer.run(t)},t}();function ci(){}var pi={};function hi(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(function(){return t.onStable.emit(null)})}finally{t.isStable=!0}}}function fi(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function di(t){t._nesting--,hi(t)}var mi,vi=function(){function t(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Oo,this.onMicrotaskEmpty=new Oo,this.onStable=new Oo,this.onError=new Oo}return t.prototype.run=function(t){return t()},t.prototype.runGuarded=function(t){return t()},t.prototype.runOutsideAngular=function(t){return t()},t.prototype.runTask=function(t){return t()},t}(),gi=function(){function t(t){var e=this;this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(function(){e.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}return t.prototype._watchAngularEvents=function(){var t=this;this._ngZone.onUnstable.subscribe({next:function(){t._didWork=!0,t._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){t._ngZone.onStable.subscribe({next:function(){li.assertNotInAngularZone(),ui(function(){t._isZoneStable=!0,t._runCallbacksIfReady()})}})})},t.prototype.increasePendingRequestCount=function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount},t.prototype.decreasePendingRequestCount=function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount},t.prototype.isStable=function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks},t.prototype._runCallbacksIfReady=function(){var t=this;if(this.isStable())ui(function(){for(;0!==t._callbacks.length;){var e=t._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(t._didWork)}t._didWork=!1});else{var e=this.getPendingTasks();this._callbacks=this._callbacks.filter(function(t){return!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)}),this._didWork=!0}},t.prototype.getPendingTasks=function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(function(t){return{source:t.source,creationLocation:t.creationLocation,data:t.data}}):[]},t.prototype.addCallback=function(t,e,n){var r=this,o=-1;e&&e>0&&(o=setTimeout(function(){r._callbacks=r._callbacks.filter(function(t){return t.timeoutId!==o}),t(r._didWork,r.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:n})},t.prototype.whenStable=function(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()},t.prototype.getPendingRequestCount=function(){return this._pendingCount},t.prototype.findProviders=function(t,e,n){return[]},t}(),yi=function(){function t(){this._applications=new Map,bi.addToWindow(this)}return t.prototype.registerApplication=function(t,e){this._applications.set(t,e)},t.prototype.unregisterApplication=function(t){this._applications.delete(t)},t.prototype.unregisterAllApplications=function(){this._applications.clear()},t.prototype.getTestability=function(t){return this._applications.get(t)||null},t.prototype.getAllTestabilities=function(){return Array.from(this._applications.values())},t.prototype.getAllRootElements=function(){return Array.from(this._applications.keys())},t.prototype.findTestabilityInTree=function(t,e){return void 0===e&&(e=!0),bi.findTestabilityInTree(this,t,e)},u([l("design:paramtypes",[])],t)}(),bi=new(function(){function t(){}return t.prototype.addToWindow=function(t){},t.prototype.findTestabilityInTree=function(t,e,n){return null},t}()),wi=new Ht("AllowMultipleToken"),xi=function(){return function(t,e){this.name=t,this.token=e}}();function Ci(t,e,n){void 0===n&&(n=[]);var r="Platform: "+e,o=new Ht(r);return function(e){void 0===e&&(e=[]);var i=Ei();if(!i||i.injector.get(wi,!1))if(t)t(n.concat(e).concat({provide:o,useValue:!0}));else{var a=n.concat(e).concat({provide:o,useValue:!0});!function(t){if(mi&&!mi.destroyed&&!mi.injector.get(wi,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");mi=t.get(Si);var e=t.get(jo,null);e&&e.forEach(function(t){return t()})}(Xt.create({providers:a,name:r}))}return function(t){var e=Ei();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(o)}}function Ei(){return mi&&!mi.destroyed?mi:null}var Si=function(){function t(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return t.prototype.bootstrapModuleFactory=function(t,e){var n,r=this,o="noop"===(n=e?e.ngZone:void 0)?new vi:("zone.js"===n?void 0:n)||new li({enableLongStackTrace:be()}),i=[{provide:li,useValue:o}];return o.run(function(){var e=Xt.create({providers:i,parent:r.injector,name:t.moduleType.name}),n=t.create(e),a=n.injector.get(ve,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy(function(){return Ii(r._modules,n)}),o.runOutsideAngular(function(){return o.onError.subscribe({next:function(t){a.handleError(t)}})}),function(t,e,o){try{var i=((a=n.injector.get(zo)).runInitializers(),a.donePromise.then(function(){return r._moduleDoBootstrap(n),n}));return Ke(i)?i.catch(function(n){throw e.runOutsideAngular(function(){return t.handleError(n)}),n}):i}catch(Tz){throw e.runOutsideAngular(function(){return t.handleError(Tz)}),Tz}var a}(a,o)})},t.prototype.bootstrapModule=function(t,e){var n=this;void 0===e&&(e=[]);var r=ki({},e);return function(t,e,n){return t.get(ei).createCompiler([e]).compileModuleAsync(n)}(this.injector,r,t).then(function(t){return n.bootstrapModuleFactory(t,r)})},t.prototype._moduleDoBootstrap=function(t){var e=t.injector.get(Ni);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(function(t){return e.bootstrap(t)});else{if(!t.instance.ngDoBootstrap)throw new Error("The module "+Mt(t.instance.constructor)+' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.');t.instance.ngDoBootstrap(e)}this._modules.push(t)},t.prototype.onDestroy=function(t){this._destroyListeners.push(t)},Object.defineProperty(t.prototype,"injector",{get:function(){return this._injector},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(t){return t.destroy()}),this._destroyListeners.forEach(function(t){return t()}),this._destroyed=!0},Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),t}();function ki(t,e){return Array.isArray(e)?e.reduce(ki,t):s({},t,e)}var Ni=function(){function t(t,e,n,r,o,i){var a=this;this._zone=t,this._console=e,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=o,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=be(),this._zone.onMicrotaskEmpty.subscribe({next:function(){a._zone.run(function(){a.tick()})}});var s=new O(function(t){a._stable=a._zone.isStable&&!a._zone.hasPendingMacrotasks&&!a._zone.hasPendingMicrotasks,a._zone.runOutsideAngular(function(){t.next(a._stable),t.complete()})}),u=new O(function(t){var e;a._zone.runOutsideAngular(function(){e=a._zone.onStable.subscribe(function(){li.assertNotInAngularZone(),ui(function(){a._stable||a._zone.hasPendingMacrotasks||a._zone.hasPendingMicrotasks||(a._stable=!0,t.next(!0))})})});var n=a._zone.onUnstable.subscribe(function(){li.assertInAngularZone(),a._stable&&(a._stable=!1,a._zone.runOutsideAngular(function(){t.next(!1)}))});return function(){e.unsubscribe(),n.unsubscribe()}});this.isStable=ct(s,u.pipe(function(t){return pt()(gt(bt)(t))}))}var e;return e=t,t.prototype.bootstrap=function(t,e){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=t instanceof an?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);var o=n instanceof hn?null:this._injector.get(fn),i=n.create(Xt.NULL,[],e||n.selector,o);i.onDestroy(function(){r._unloadComponent(i)});var a=i.injector.get(gi,null);return a&&i.injector.get(yi).registerApplication(i.location.nativeElement,a),this._loadComponent(i),be()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i},t.prototype.tick=function(){var t,n,r,o,i=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var a=e._tickScope();try{this._runningTick=!0;try{for(var s=h(this._views),u=s.next();!u.done;u=s.next())u.value.detectChanges()}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(this._enforceNoNewChanges)try{for(var l=h(this._views),c=l.next();!c.done;c=l.next())c.value.checkNoChanges()}catch(f){r={error:f}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}catch(Tz){this._zone.runOutsideAngular(function(){return i._exceptionHandler.handleError(Tz)})}finally{this._runningTick=!1,ai(a)}},t.prototype.attachView=function(t){var e=t;this._views.push(e),e.attachToAppRef(this)},t.prototype.detachView=function(t){var e=t;Ii(this._views,e),e.detachFromAppRef()},t.prototype._loadComponent=function(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Go,[]).concat(this._bootstrapListeners).forEach(function(e){return e(t)})},t.prototype._unloadComponent=function(t){this.detachView(t.hostView),Ii(this.components,t)},t.prototype.ngOnDestroy=function(){this._views.slice().forEach(function(t){return t.destroy()})},Object.defineProperty(t.prototype,"viewCount",{get:function(){return this._views.length},enumerable:!0,configurable:!0}),t._tickScope=ii("ApplicationRef#tick()"),t}();function Ii(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}var Ri=function(){return function(){}}(),Ai={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Ti=function(){function t(t,e){this._compiler=t,this._config=e||Ai}return t.prototype.load=function(t){return this._compiler instanceof ti?this.loadFactory(t):this.loadAndCompile(t)},t.prototype.loadAndCompile=function(t){var e=this,r=f(t.split("#"),2),o=r[0],i=r[1];return void 0===i&&(i="default"),n("zn8P")(o).then(function(t){return t[i]}).then(function(t){return _i(t,o,i)}).then(function(t){return e._compiler.compileModuleAsync(t)})},t.prototype.loadFactory=function(t){var e=f(t.split("#"),2),r=e[0],o=e[1],i="NgFactory";return void 0===o&&(o="default",i=""),n("zn8P")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(function(t){return t[o+i]}).then(function(t){return _i(t,r,o)})},t}();function _i(t,e,n){if(!t)throw new Error("Cannot find '"+n+"' in '"+e+"'");return t}var Di=function(){return function(t,e){this.name=t,this.callback=e}}(),Oi=function(){function t(t,e,n){this.listeners=[],this.parent=null,this._debugContext=n,this.nativeNode=t,e&&e instanceof Mi&&e.addChild(this)}return Object.defineProperty(t.prototype,"injector",{get:function(){return this._debugContext.injector},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentInstance",{get:function(){return this._debugContext.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._debugContext.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){return this._debugContext.references},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){return this._debugContext.providerTokens},enumerable:!0,configurable:!0}),t}(),Mi=function(t){function e(e,n,r){var o=t.call(this,e,n,r)||this;return o.properties={},o.attributes={},o.classes={},o.styles={},o.childNodes=[],o.nativeElement=e,o}return a(e,t),e.prototype.addChild=function(t){t&&(this.childNodes.push(t),t.parent=this)},e.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))},e.prototype.insertChildrenAfter=function(t,e){var n,r=this,o=this.childNodes.indexOf(t);-1!==o&&((n=this.childNodes).splice.apply(n,d([o+1,0],e)),e.forEach(function(e){e.parent&&e.parent.removeChild(e),t.parent=r}))},e.prototype.insertBefore=function(t,e){var n=this.childNodes.indexOf(t);-1===n?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(n,0,e))},e.prototype.query=function(t){return this.queryAll(t)[0]||null},e.prototype.queryAll=function(t){var e=[];return function t(e,n,r){e.childNodes.forEach(function(e){e instanceof Mi&&(n(e)&&r.push(e),t(e,n,r))})}(this,t,e),e},e.prototype.queryAllNodes=function(t){var e=[];return function t(e,n,r){e instanceof Mi&&e.childNodes.forEach(function(e){n(e)&&r.push(e),e instanceof Mi&&t(e,n,r)})}(this,t,e),e},Object.defineProperty(e.prototype,"children",{get:function(){return this.childNodes.filter(function(t){return t instanceof e})},enumerable:!0,configurable:!0}),e.prototype.triggerEventHandler=function(t,e){this.listeners.forEach(function(n){n.name==t&&n.callback(e)})},e}(Oi),Fi=new Map,Pi=function(t){return Fi.get(t)||null};function Li(t){Fi.set(t.nativeNode,t)}var Bi=Ci(null,"core",[{provide:Ho,useValue:"unknown"},{provide:Si,deps:[Xt]},{provide:yi,deps:[]},{provide:qo,deps:[]}]),zi=new Ht("LocaleId");function Ui(){return zn}function Vi(){return Un}function Wi(t){return t||"en-US"}function ji(t){var e=[];return t.onStable.subscribe(function(){for(;e.length;)e.pop()()}),function(t){e.push(t)}}var Hi=function(){return function(t){}}();function Gi(t,e,n,r,o,i){t|=1;var a=xr(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a.matchedQueries,matchedQueryIds:a.matchedQueryIds,references:a.references,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:i?kr(i):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:o||nr},provider:null,text:null,query:null,ngContent:null}}function qi(t,e,n,r,o,i,a,s,u,l,c,p){var h;void 0===a&&(a=[]),l||(l=nr);var d=xr(n),m=d.matchedQueries,v=d.references,g=d.matchedQueryIds,y=null,b=null;i&&(y=(h=f(Dr(i),2))[0],b=h[1]),s=s||[];for(var w=new Array(s.length),x=0;x<s.length;x++){var C=f(s[x],3),E=C[0],S=C[2],k=f(Dr(C[1]),2),N=k[0],I=k[1],R=void 0,A=void 0;switch(15&E){case 4:A=S;break;case 1:case 8:R=S}w[x]={flags:E,ns:N,name:I,nonMinifiedName:I,securityContext:R,suffix:A}}u=u||[];var T=new Array(u.length);for(x=0;x<u.length;x++){var _=f(u[x],2);T[x]={type:0,target:_[0],eventName:_[1],propName:null}}var D=(a=a||[]).map(function(t){var e=f(t,2),n=e[1],r=f(Dr(e[0]),2);return[r[0],r[1],n]});return p=function(t){if(t&&t.id===ir){var e=null!=t.encapsulation&&t.encapsulation!==pe.None||t.styles.length||Object.keys(t.data).length;t.id=e?"c"+ur++:ar}return t&&t.id===ar&&(t=null),t||null}(p),c&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:m,matchedQueryIds:g,references:v,ngContentIndex:r,childCount:o,bindings:w,bindingFlags:Or(w),outputs:T,element:{ns:y,name:b,attrs:D,template:null,componentProvider:null,componentView:c||null,componentRendererType:p,publicProviders:null,allProviders:null,handleEvent:l||nr},provider:null,text:null,query:null,ngContent:null}}function Ki(t,e,n){var r,o=n.element,i=t.root.selectorOrNode,a=t.renderer;if(t.parent||!i){r=o.name?a.createElement(o.name,o.ns):a.createComment("");var s=Er(t,e,n);s&&a.appendChild(s,r)}else r=a.selectRootElement(i,!!o.componentRendererType&&o.componentRendererType.encapsulation===pe.ShadowDom);if(o.attrs)for(var u=0;u<o.attrs.length;u++){var l=f(o.attrs[u],3);a.setAttribute(r,l[1],l[2],l[0])}return r}function $i(t,e,n,r){for(var o=0;o<n.outputs.length;o++){var i=n.outputs[o],a=Xi(t,n.nodeIndex,(p=i.eventName,(c=i.target)?c+":"+p:p)),s=i.target,u=t;"component"===i.target&&(s=null,u=e);var l=u.renderer.listen(s||r,i.eventName,a);t.disposables[n.outputIndex+o]=l}var c,p}function Xi(t,e,n){return function(r){return dr(t,e,n,r)}}function Yi(t,e,n,r){if(!cr(t,e,n,r))return!1;var o=e.bindings[n],i=Qn(t,e.nodeIndex),a=i.renderElement,s=o.name;switch(15&o.flags){case 1:!function(t,e,n,r,o,i){var a=e.securityContext,s=a?t.root.sanitizer.sanitize(a,i):i;s=null!=s?s.toString():null;var u=t.renderer;null!=i?u.setAttribute(n,o,s,r):u.removeAttribute(n,o,r)}(t,o,a,o.ns,s,r);break;case 2:!function(t,e,n,r){var o=t.renderer;r?o.addClass(e,n):o.removeClass(e,n)}(t,a,s,r);break;case 4:!function(t,e,n,r,o){var i=t.root.sanitizer.sanitize(Ve.STYLE,o);if(null!=i){i=i.toString();var a=e.suffix;null!=a&&(i+=a)}else i=null;var s=t.renderer;null!=i?s.setStyle(n,r,i):s.removeStyle(n,r)}(t,o,a,s,r);break;case 8:!function(t,e,n,r,o){var i=e.securityContext,a=i?t.root.sanitizer.sanitize(i,o):o;t.renderer.setProperty(n,r,a)}(33554432&e.flags&&32&o.flags?i.componentView:t,o,a,s,r)}return!0}function Qi(t,e,n){var r=[];for(var o in n)r.push({propName:o,bindingType:n[o]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:wr(e),bindings:r},ngContent:null}}function Zi(t){for(var e=t.def.nodeMatchedQueries;t.parent&&br(t);){var n=t.parentNodeDef;t=t.parent;for(var r=n.nodeIndex+n.childCount,o=0;o<=r;o++)67108864&(i=t.def.nodes[o]).flags&&536870912&i.flags&&(i.query.filterId&e)===i.query.filterId&&tr(t,o).setDirty(),!(1&i.flags&&o+i.childCount<n.nodeIndex)&&67108864&i.childFlags&&536870912&i.childFlags||(o+=i.childCount)}if(134217728&t.def.nodeFlags)for(o=0;o<t.def.nodes.length;o++){var i;134217728&(i=t.def.nodes[o]).flags&&536870912&i.flags&&tr(t,o).setDirty(),o+=i.childCount}}function Ji(t,e){var n=tr(t,e.nodeIndex);if(n.dirty){var r,o=void 0;if(67108864&e.flags){var i=e.parent.parent;o=ta(t,i.nodeIndex,i.nodeIndex+i.childCount,e.query,[]),r=Zn(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(o=ta(t,0,t.def.nodes.length-1,e.query,[]),r=t.component);n.reset(o);for(var a=e.query.bindings,s=!1,u=0;u<a.length;u++){var l=a[u],c=void 0;switch(l.bindingType){case 0:c=n.first;break;case 1:c=n,s=!0}r[l.propName]=c}s&&n.notifyOnChanges()}}function ta(t,e,n,r,o){for(var i=e;i<=n;i++){var a=t.def.nodes[i],s=a.matchedQueries[r.id];if(null!=s&&o.push(ea(t,a,s)),1&a.flags&&a.element.template&&(a.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var u=Qn(t,i);if((a.childMatchedQueries&r.filterId)===r.filterId&&(ta(t,i+1,i+a.childCount,r,o),i+=a.childCount),16777216&a.flags)for(var l=u.viewContainer._embeddedViews,c=0;c<l.length;c++){var p=l[c],h=mr(p);h&&h===u&&ta(p,0,p.def.nodes.length-1,r,o)}var f=u.template._projectedViews;if(f)for(c=0;c<f.length;c++){var d=f[c];ta(d,0,d.def.nodes.length-1,r,o)}}(a.childMatchedQueries&r.filterId)!==r.filterId&&(i+=a.childCount)}return o}function ea(t,e,n){if(null!=n)switch(n){case 1:return Qn(t,e.nodeIndex).renderElement;case 0:return new vn(Qn(t,e.nodeIndex).renderElement);case 2:return Qn(t,e.nodeIndex).template;case 3:return Qn(t,e.nodeIndex).viewContainer;case 4:return Zn(t,e.nodeIndex).instance}}function na(t,e,n){var r=Er(t,e,n);r&&Rr(t,n.ngContent.index,1,r,null,void 0)}function ra(t,e,n){for(var r=new Array(n.length-1),o=1;o<n.length;o++)r[o-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[o]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function oa(t,e,n){var r,o=t.renderer;r=o.createText(n.text.prefix);var i=Er(t,e,n);return i&&o.appendChild(i,r),{renderText:r}}function ia(t,e){return(null!=t?t.toString():"")+e.suffix}function aa(t,e,n,r){for(var o=0,i=0,a=0,s=0,u=0,l=null,c=null,p=!1,h=!1,f=null,d=0;d<e.length;d++){var m=e[d];if(m.nodeIndex=d,m.parent=l,m.bindingIndex=o,m.outputIndex=i,m.renderParent=c,a|=m.flags,u|=m.matchedQueryIds,m.element){var v=m.element;v.publicProviders=l?l.element.publicProviders:Object.create(null),v.allProviders=v.publicProviders,p=!1,h=!1,m.element.template&&(u|=m.element.template.nodeMatchedQueries)}if(ua(l,m,e.length),o+=m.bindings.length,i+=m.outputs.length,!c&&3&m.flags&&(f=m),20224&m.flags){p||(p=!0,l.element.publicProviders=Object.create(l.element.publicProviders),l.element.allProviders=l.element.publicProviders);var g=0!=(32768&m.flags);0==(8192&m.flags)||g?l.element.publicProviders[or(m.provider.token)]=m:(h||(h=!0,l.element.allProviders=Object.create(l.element.publicProviders)),l.element.allProviders[or(m.provider.token)]=m),g&&(l.element.componentProvider=m)}if(l?(l.childFlags|=m.flags,l.directChildFlags|=m.flags,l.childMatchedQueries|=m.matchedQueryIds,m.element&&m.element.template&&(l.childMatchedQueries|=m.element.template.nodeMatchedQueries)):s|=m.flags,m.childCount>0)l=m,sa(m)||(c=m);else for(;l&&d===l.nodeIndex+l.childCount;){var y=l.parent;y&&(y.childFlags|=l.childFlags,y.childMatchedQueries|=l.childMatchedQueries),c=(l=y)&&sa(l)?l.renderParent:l}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:u,flags:t,nodes:e,updateDirectives:n||nr,updateRenderer:r||nr,handleEvent:function(t,n,r,o){return e[n].element.handleEvent(t,r,o)},bindingCount:o,outputCount:i,lastRenderRootNode:f}}function sa(t){return 0!=(1&t.flags)&&null===t.element.name}function ua(t,e,n){var r=e.element&&e.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index "+e.nodeIndex+"!")}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index "+e.nodeIndex+"!");if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index "+e.nodeIndex+"!");if(134217728&e.flags&&t)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index "+e.nodeIndex+"!")}if(e.childCount){var o=t?t.nodeIndex+t.childCount:n-1;if(e.nodeIndex<=o&&e.nodeIndex+e.childCount>o)throw new Error("Illegal State: childCount of node leads outside of parent, at index "+e.nodeIndex+"!")}}function la(t,e,n,r){var o=ha(t.root,t.renderer,t,e,n);return fa(o,t.component,r),da(o),o}function ca(t,e,n){var r=ha(t,t.renderer,null,null,e);return fa(r,n,n),da(r),r}function pa(t,e,n,r){var o,i=e.element.componentRendererType;return o=i?t.root.rendererFactory.createRenderer(r,i):t.root.renderer,ha(t.root,o,t,e.element.componentProvider,n)}function ha(t,e,n,r,o){var i=new Array(o.nodes.length),a=o.outputCount?new Array(o.outputCount):null;return{def:o,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:i,state:13,root:t,renderer:e,oldValues:new Array(o.bindingCount),disposables:a,initIndex:-1}}function fa(t,e,n){t.component=e,t.context=n}function da(t){var e;yr(t)&&(e=Qn(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);for(var n=t.def,r=t.nodes,o=0;o<n.nodes.length;o++){var i=n.nodes[o];er.setCurrentNode(t,o);var a=void 0;switch(201347067&i.flags){case 1:var s=Ki(t,e,i),u=void 0;if(33554432&i.flags){var l=kr(i.element.componentView);u=er.createComponentView(t,i,l,s)}$i(t,u,i,s),a={renderElement:s,componentView:u,viewContainer:null,template:i.element.template?to(t,i):void 0},16777216&i.flags&&(a.viewContainer=Yr(t,i,a));break;case 2:a=oa(t,e,i);break;case 512:case 1024:case 2048:case 256:(a=r[o])||4096&i.flags||(a={instance:bo(t,i)});break;case 16:a={instance:wo(t,i)};break;case 16384:(a=r[o])||(a={instance:xo(t,i)}),32768&i.flags&&fa(Qn(t,i.parent.nodeIndex).componentView,a.instance,a.instance);break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=new Mo;break;case 8:na(t,e,i),a=void 0}r[o]=a}Ea(t,Ca.CreateViewNodes),Ia(t,201326592,268435456,0)}function ma(t){ya(t),er.updateDirectives(t,1),Sa(t,Ca.CheckNoChanges),er.updateRenderer(t,1),Ea(t,Ca.CheckNoChanges),t.state&=-97}function va(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,$n(t,0,256),ya(t),er.updateDirectives(t,0),Sa(t,Ca.CheckAndUpdate),Ia(t,67108864,536870912,0);var e=$n(t,256,512);Ao(t,2097152|(e?1048576:0)),er.updateRenderer(t,0),Ea(t,Ca.CheckAndUpdate),Ia(t,134217728,536870912,0),Ao(t,8388608|((e=$n(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,$n(t,768,1024)}function ga(t,e,n,r,o,i,a,s,u,l,c,p,h){return 0===n?function(t,e,n,r,o,i,a,s,u,l,c,p){switch(201347067&e.flags){case 1:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=e.bindings.length,f=!1;return h>0&&Yi(t,e,0,n)&&(f=!0),h>1&&Yi(t,e,1,r)&&(f=!0),h>2&&Yi(t,e,2,o)&&(f=!0),h>3&&Yi(t,e,3,i)&&(f=!0),h>4&&Yi(t,e,4,a)&&(f=!0),h>5&&Yi(t,e,5,s)&&(f=!0),h>6&&Yi(t,e,6,u)&&(f=!0),h>7&&Yi(t,e,7,l)&&(f=!0),h>8&&Yi(t,e,8,c)&&(f=!0),h>9&&Yi(t,e,9,p)&&(f=!0),f}(t,e,n,r,o,i,a,s,u,l,c,p);case 2:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=!1,f=e.bindings,d=f.length;if(d>0&&cr(t,e,0,n)&&(h=!0),d>1&&cr(t,e,1,r)&&(h=!0),d>2&&cr(t,e,2,o)&&(h=!0),d>3&&cr(t,e,3,i)&&(h=!0),d>4&&cr(t,e,4,a)&&(h=!0),d>5&&cr(t,e,5,s)&&(h=!0),d>6&&cr(t,e,6,u)&&(h=!0),d>7&&cr(t,e,7,l)&&(h=!0),d>8&&cr(t,e,8,c)&&(h=!0),d>9&&cr(t,e,9,p)&&(h=!0),h){var m=e.text.prefix;d>0&&(m+=ia(n,f[0])),d>1&&(m+=ia(r,f[1])),d>2&&(m+=ia(o,f[2])),d>3&&(m+=ia(i,f[3])),d>4&&(m+=ia(a,f[4])),d>5&&(m+=ia(s,f[5])),d>6&&(m+=ia(u,f[6])),d>7&&(m+=ia(l,f[7])),d>8&&(m+=ia(c,f[8])),d>9&&(m+=ia(p,f[9]));var v=Yn(t,e.nodeIndex).renderText;t.renderer.setValue(v,m)}return h}(t,e,n,r,o,i,a,s,u,l,c,p);case 16384:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=Zn(t,e.nodeIndex),f=h.instance,d=!1,m=void 0,v=e.bindings.length;return v>0&&lr(t,e,0,n)&&(d=!0,m=Ro(t,h,e,0,n,m)),v>1&&lr(t,e,1,r)&&(d=!0,m=Ro(t,h,e,1,r,m)),v>2&&lr(t,e,2,o)&&(d=!0,m=Ro(t,h,e,2,o,m)),v>3&&lr(t,e,3,i)&&(d=!0,m=Ro(t,h,e,3,i,m)),v>4&&lr(t,e,4,a)&&(d=!0,m=Ro(t,h,e,4,a,m)),v>5&&lr(t,e,5,s)&&(d=!0,m=Ro(t,h,e,5,s,m)),v>6&&lr(t,e,6,u)&&(d=!0,m=Ro(t,h,e,6,u,m)),v>7&&lr(t,e,7,l)&&(d=!0,m=Ro(t,h,e,7,l,m)),v>8&&lr(t,e,8,c)&&(d=!0,m=Ro(t,h,e,8,c,m)),v>9&&lr(t,e,9,p)&&(d=!0,m=Ro(t,h,e,9,p,m)),m&&f.ngOnChanges(m),65536&e.flags&&Xn(t,256,e.nodeIndex)&&f.ngOnInit(),262144&e.flags&&f.ngDoCheck(),d}(t,e,n,r,o,i,a,s,u,l,c,p);case 32:case 64:case 128:return function(t,e,n,r,o,i,a,s,u,l,c,p){var h=e.bindings,f=!1,d=h.length;if(d>0&&cr(t,e,0,n)&&(f=!0),d>1&&cr(t,e,1,r)&&(f=!0),d>2&&cr(t,e,2,o)&&(f=!0),d>3&&cr(t,e,3,i)&&(f=!0),d>4&&cr(t,e,4,a)&&(f=!0),d>5&&cr(t,e,5,s)&&(f=!0),d>6&&cr(t,e,6,u)&&(f=!0),d>7&&cr(t,e,7,l)&&(f=!0),d>8&&cr(t,e,8,c)&&(f=!0),d>9&&cr(t,e,9,p)&&(f=!0),f){var m=Jn(t,e.nodeIndex),v=void 0;switch(201347067&e.flags){case 32:v=new Array(h.length),d>0&&(v[0]=n),d>1&&(v[1]=r),d>2&&(v[2]=o),d>3&&(v[3]=i),d>4&&(v[4]=a),d>5&&(v[5]=s),d>6&&(v[6]=u),d>7&&(v[7]=l),d>8&&(v[8]=c),d>9&&(v[9]=p);break;case 64:v={},d>0&&(v[h[0].name]=n),d>1&&(v[h[1].name]=r),d>2&&(v[h[2].name]=o),d>3&&(v[h[3].name]=i),d>4&&(v[h[4].name]=a),d>5&&(v[h[5].name]=s),d>6&&(v[h[6].name]=u),d>7&&(v[h[7].name]=l),d>8&&(v[h[8].name]=c),d>9&&(v[h[9].name]=p);break;case 128:var g=n;switch(d){case 1:v=g.transform(n);break;case 2:v=g.transform(r);break;case 3:v=g.transform(r,o);break;case 4:v=g.transform(r,o,i);break;case 5:v=g.transform(r,o,i,a);break;case 6:v=g.transform(r,o,i,a,s);break;case 7:v=g.transform(r,o,i,a,s,u);break;case 8:v=g.transform(r,o,i,a,s,u,l);break;case 9:v=g.transform(r,o,i,a,s,u,l,c);break;case 10:v=g.transform(r,o,i,a,s,u,l,c,p)}}m.value=v}return f}(t,e,n,r,o,i,a,s,u,l,c,p);default:throw"unreachable"}}(t,e,r,o,i,a,s,u,l,c,p,h):function(t,e,n){switch(201347067&e.flags){case 1:return function(t,e,n){for(var r=!1,o=0;o<n.length;o++)Yi(t,e,o,n[o])&&(r=!0);return r}(t,e,n);case 2:return function(t,e,n){for(var r=e.bindings,o=!1,i=0;i<n.length;i++)cr(t,e,i,n[i])&&(o=!0);if(o){var a="";for(i=0;i<n.length;i++)a+=ia(n[i],r[i]);a=e.text.prefix+a;var s=Yn(t,e.nodeIndex).renderText;t.renderer.setValue(s,a)}return o}(t,e,n);case 16384:return function(t,e,n){for(var r=Zn(t,e.nodeIndex),o=r.instance,i=!1,a=void 0,s=0;s<n.length;s++)lr(t,e,s,n[s])&&(i=!0,a=Ro(t,r,e,s,n[s],a));return a&&o.ngOnChanges(a),65536&e.flags&&Xn(t,256,e.nodeIndex)&&o.ngOnInit(),262144&e.flags&&o.ngDoCheck(),i}(t,e,n);case 32:case 64:case 128:return function(t,e,n){for(var r=e.bindings,o=!1,i=0;i<n.length;i++)cr(t,e,i,n[i])&&(o=!0);if(o){var a=Jn(t,e.nodeIndex),s=void 0;switch(201347067&e.flags){case 32:s=n;break;case 64:for(s={},i=0;i<n.length;i++)s[r[i].name]=n[i];break;case 128:var u=n[0],l=n.slice(1);s=u.transform.apply(u,d(l))}a.value=s}return o}(t,e,n);default:throw"unreachable"}}(t,e,r)}function ya(t){var e=t.def;if(4&e.nodeFlags)for(var n=0;n<e.nodes.length;n++){var r=e.nodes[n];if(4&r.flags){var o=Qn(t,n).template._projectedViews;if(o)for(var i=0;i<o.length;i++){var a=o[i];a.state|=32,fr(a,t)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function ba(t,e,n,r,o,i,a,s,u,l,c,p,h){return 0===n?function(t,e,n,r,o,i,a,s,u,l,c,p){var h=e.bindings.length;h>0&&pr(t,e,0,n),h>1&&pr(t,e,1,r),h>2&&pr(t,e,2,o),h>3&&pr(t,e,3,i),h>4&&pr(t,e,4,a),h>5&&pr(t,e,5,s),h>6&&pr(t,e,6,u),h>7&&pr(t,e,7,l),h>8&&pr(t,e,8,c),h>9&&pr(t,e,9,p)}(t,e,r,o,i,a,s,u,l,c,p,h):function(t,e,n){for(var r=0;r<n.length;r++)pr(t,e,r,n[r])}(t,e,r),!1}function wa(t,e){if(tr(t,e.nodeIndex).dirty)throw Gn(er.createDebugContext(t,e.nodeIndex),"Query "+e.query.id+" not dirty","Query "+e.query.id+" dirty",0!=(1&t.state))}function xa(t){if(!(128&t.state)){if(Sa(t,Ca.Destroy),Ea(t,Ca.Destroy),Ao(t,131072),t.disposables)for(var e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(16&t.state){var e=mr(t);if(e){var n=e.template._projectedViews;n&&(Gr(n,n.indexOf(t)),er.dirtyParentQueries(t))}}}(t),t.renderer.destroyNode&&function(t){for(var e=t.def.nodes.length,n=0;n<e;n++){var r=t.def.nodes[n];1&r.flags?t.renderer.destroyNode(Qn(t,n).renderElement):2&r.flags?t.renderer.destroyNode(Yn(t,n).renderText):(67108864&r.flags||134217728&r.flags)&&tr(t,n).destroy()}}(t),yr(t)&&t.renderer.destroy(),t.state|=128}}var Ca=function(t){return t[t.CreateViewNodes=0]="CreateViewNodes",t[t.CheckNoChanges=1]="CheckNoChanges",t[t.CheckNoChangesProjectedViews=2]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate=3]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews=4]="CheckAndUpdateProjectedViews",t[t.Destroy=5]="Destroy",t}({});function Ea(t,e){var n=t.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var o=n.nodes[r];33554432&o.flags?ka(Qn(t,r).componentView,e):0==(33554432&o.childFlags)&&(r+=o.childCount)}}function Sa(t,e){var n=t.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var o=n.nodes[r];if(16777216&o.flags)for(var i=Qn(t,r).viewContainer._embeddedViews,a=0;a<i.length;a++)ka(i[a],e);else 0==(16777216&o.childFlags)&&(r+=o.childCount)}}function ka(t,e){var n=t.state;switch(e){case Ca.CheckNoChanges:0==(128&n)&&(12==(12&n)?ma(t):64&n&&Na(t,Ca.CheckNoChangesProjectedViews));break;case Ca.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?ma(t):64&n&&Na(t,e));break;case Ca.CheckAndUpdate:0==(128&n)&&(12==(12&n)?va(t):64&n&&Na(t,Ca.CheckAndUpdateProjectedViews));break;case Ca.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?va(t):64&n&&Na(t,e));break;case Ca.Destroy:xa(t);break;case Ca.CreateViewNodes:da(t)}}function Na(t,e){Sa(t,e),Ea(t,e)}function Ia(t,e,n,r){if(t.def.nodeFlags&e&&t.def.nodeFlags&n)for(var o=t.def.nodes.length,i=0;i<o;i++){var a=t.def.nodes[i];if(a.flags&e&&a.flags&n)switch(er.setCurrentNode(t,a.nodeIndex),r){case 0:Ji(t,a);break;case 1:wa(t,a)}a.childFlags&e&&a.childFlags&n||(i+=a.childCount)}}var Ra=!1;function Aa(t,e,n,r,o,i){var a=o.injector.get(bn);return ca(_a(t,o,a,e,n),r,i)}function Ta(t,e,n,r,o,i){var a=o.injector.get(bn),s=_a(t,o,new ls(a),e,n),u=Va(r);return ss(Ya.create,ca,null,[s,u,i])}function _a(t,e,n,r,o){var i=e.injector.get(We),a=e.injector.get(ve),s=n.createRenderer(null,null);return{ngModule:e,injector:t,projectableNodes:r,selectorOrNode:o,sanitizer:i,rendererFactory:n,renderer:s,errorHandler:a}}function Da(t,e,n,r){var o=Va(n);return ss(Ya.create,la,null,[t,e,o,r])}function Oa(t,e,n,r){return n=La.get(e.element.componentProvider.provider.token)||Va(n),ss(Ya.create,pa,null,[t,e,n,r])}function Ma(t,e,n,r){return so(t,e,n,function(t){var e=function(t){var e=!1,n=!1;return 0===Fa.size?{hasOverrides:e,hasDeprecatedOverrides:n}:(t.providers.forEach(function(t){var r=Fa.get(t.token);3840&t.flags&&r&&(e=!0,n=n||r.deprecatedBehavior)}),t.modules.forEach(function(t){Pa.forEach(function(r,o){Dt(o).providedIn===t&&(e=!0,n=n||r.deprecatedBehavior)})}),{hasOverrides:e,hasDeprecatedOverrides:n})}(t),n=e.hasDeprecatedOverrides;return e.hasOverrides?(function(t){for(var e=0;e<t.providers.length;e++){var r=t.providers[e];n&&(r.flags|=4096);var o=Fa.get(r.token);o&&(r.flags=-3841&r.flags|o.flags,r.deps=Cr(o.deps),r.value=o.value)}if(Pa.size>0){var i=new Set(t.modules);Pa.forEach(function(e,r){if(i.has(Dt(r).providedIn)){var o={token:r,flags:e.flags|(n?4096:0),deps:Cr(e.deps),value:e.value,index:t.providers.length};t.providers.push(o),t.providersByKey[or(r)]=o}})}}(t=t.factory(function(){return nr})),t):t}(r))}var Fa=new Map,Pa=new Map,La=new Map;function Ba(t){var e;Fa.set(t.token,t),"function"==typeof t.token&&(e=Dt(t.token))&&"function"==typeof e.providedIn&&Pa.set(t.token,t)}function za(t,e){var n=kr(e.viewDefFactory),r=kr(n.nodes[0].element.componentView);La.set(t,r)}function Ua(){Fa.clear(),Pa.clear(),La.clear()}function Va(t){if(0===Fa.size)return t;var e=function(t){for(var e=[],n=null,r=0;r<t.nodes.length;r++){var o=t.nodes[r];1&o.flags&&(n=o),n&&3840&o.flags&&Fa.has(o.provider.token)&&(e.push(n.nodeIndex),n=null)}return e}(t);if(0===e.length)return t;t=t.factory(function(){return nr});for(var n=0;n<e.length;n++)r(t,e[n]);return t;function r(t,e){for(var n=e+1;n<t.nodes.length;n++){var r=t.nodes[n];if(1&r.flags)return;if(3840&r.flags){var o=r.provider,i=Fa.get(o.token);i&&(r.flags=-3841&r.flags|i.flags,o.deps=Cr(i.deps),o.value=i.value)}}}}function Wa(t,e,n,r,o,i,a,s,u,l,c,p,h){var f=t.def.nodes[e];return ga(t,f,n,r,o,i,a,s,u,l,c,p,h),224&f.flags?Jn(t,e).value:void 0}function ja(t,e,n,r,o,i,a,s,u,l,c,p,h){var f=t.def.nodes[e];return ba(t,f,n,r,o,i,a,s,u,l,c,p,h),224&f.flags?Jn(t,e).value:void 0}function Ha(t){return ss(Ya.detectChanges,va,null,[t])}function Ga(t){return ss(Ya.checkNoChanges,ma,null,[t])}function qa(t){return ss(Ya.destroy,xa,null,[t])}var Ka,$a,Xa,Ya=function(t){return t[t.create=0]="create",t[t.detectChanges=1]="detectChanges",t[t.checkNoChanges=2]="checkNoChanges",t[t.destroy=3]="destroy",t[t.handleEvent=4]="handleEvent",t}({});function Qa(t,e){$a=t,Xa=e}function Za(t,e,n,r){return Qa(t,e),ss(Ya.handleEvent,t.def.handleEvent,null,[t,e,n,r])}function Ja(t,e){if(128&t.state)throw Kn(Ya[Ka]);return Qa(t,rs(t,0)),t.def.updateDirectives(function(t,n,r){for(var o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];var a=t.def.nodes[n];return 0===e?es(t,a,r,o):ns(t,a,r,o),16384&a.flags&&Qa(t,rs(t,n)),224&a.flags?Jn(t,a.nodeIndex).value:void 0},t)}function ts(t,e){if(128&t.state)throw Kn(Ya[Ka]);return Qa(t,os(t,0)),t.def.updateRenderer(function(t,n,r){for(var o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];var a=t.def.nodes[n];return 0===e?es(t,a,r,o):ns(t,a,r,o),3&a.flags&&Qa(t,os(t,n)),224&a.flags?Jn(t,a.nodeIndex).value:void 0},t)}function es(t,e,n,r){if(ga.apply(void 0,d([t,e,n],r))){var o=1===n?r[0]:r;if(16384&e.flags){for(var i={},a=0;a<e.bindings.length;a++){var s=e.bindings[a],u=o[a];8&s.flags&&(i[(h=s.nonMinifiedName,"ng-reflect-"+h.replace(/[$@]/g,"_").replace(Ge,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"-"+t[1].toLowerCase()}))]=qe(u))}var l=e.parent,c=Qn(t,l.nodeIndex).renderElement;if(l.element.name)for(var p in i)null!=(u=i[p])?t.renderer.setAttribute(c,p,u):t.renderer.removeAttribute(c,p);else t.renderer.setValue(c,"bindings="+JSON.stringify(i,null,2))}}var h}function ns(t,e,n,r){ba.apply(void 0,d([t,e,n],r))}function rs(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function os(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var is=function(){function t(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];for(var n=this.nodeDef,r=t;n&&0==(1&n.flags);)n=n.parent;if(!n)for(;!n&&r;)n=vr(r),r=r.parent;this.elDef=n,this.elView=r}return Object.defineProperty(t.prototype,"elOrCompView",{get:function(){return Qn(this.elView,this.elDef.nodeIndex).componentView||this.view},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return no(this.elView,this.elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.elOrCompView.component},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.elOrCompView.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerTokens",{get:function(){var t=[];if(this.elDef)for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&t.push(n.provider.token),e+=n.childCount}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"references",{get:function(){var t={};if(this.elDef){as(this.elView,this.elDef,t);for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&as(this.elView,n,t),e+=n.childCount}}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentRenderElement",{get:function(){var t=function(t){for(;t&&!yr(t);)t=t.parent;return t.parent?Qn(t.parent,vr(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderNode",{get:function(){return 2&this.nodeDef.flags?gr(this.view,this.nodeDef):gr(this.elView,this.elDef)},enumerable:!0,configurable:!0}),t.prototype.logError=function(t){for(var e,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];2&this.nodeDef.flags?(e=this.view.def,n=this.nodeDef.nodeIndex):(e=this.elView.def,n=this.elDef.nodeIndex);var i=function(t,e){for(var n=-1,r=0;r<=e;r++)3&t.nodes[r].flags&&n++;return n}(e,n),a=-1;e.factory(function(){var e;return++a===i?(e=t.error).bind.apply(e,d([t],r)):nr}),a<i&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error.apply(t,d(r)))},t}();function as(t,e,n){for(var r in e.references)n[r]=ea(t,e,e.references[r])}function ss(t,e,n,r){var o=Ka,i=$a,a=Xa;try{Ka=t;var s=e.apply(n,r);return $a=i,Xa=a,Ka=o,s}catch(Tz){if(fe(Tz)||!$a)throw Tz;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),qn(t,e),t}(Tz,us())}}function us(){return $a?new is($a,Xa):null}var ls=function(){function t(t){this.delegate=t}return t.prototype.createRenderer=function(t,e){return new cs(this.delegate.createRenderer(t,e))},t.prototype.begin=function(){this.delegate.begin&&this.delegate.begin()},t.prototype.end=function(){this.delegate.end&&this.delegate.end()},t.prototype.whenRenderingDone=function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)},t}(),cs=function(){function t(t){this.delegate=t,this.debugContextFactory=us,this.data=this.delegate.data}return t.prototype.createDebugContext=function(t){return this.debugContextFactory(t)},t.prototype.destroyNode=function(t){!function(t){Fi.delete(t.nativeNode)}(Pi(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)},t.prototype.destroy=function(){this.delegate.destroy()},t.prototype.createElement=function(t,e){var n=this.delegate.createElement(t,e),r=this.createDebugContext(n);if(r){var o=new Mi(n,null,r);o.name=t,Li(o)}return n},t.prototype.createComment=function(t){var e=this.delegate.createComment(t),n=this.createDebugContext(e);return n&&Li(new Oi(e,null,n)),e},t.prototype.createText=function(t){var e=this.delegate.createText(t),n=this.createDebugContext(e);return n&&Li(new Oi(e,null,n)),e},t.prototype.appendChild=function(t,e){var n=Pi(t),r=Pi(e);n&&r&&n instanceof Mi&&n.addChild(r),this.delegate.appendChild(t,e)},t.prototype.insertBefore=function(t,e,n){var r=Pi(t),o=Pi(e),i=Pi(n);r&&o&&r instanceof Mi&&r.insertBefore(i,o),this.delegate.insertBefore(t,e,n)},t.prototype.removeChild=function(t,e){var n=Pi(t),r=Pi(e);n&&r&&n instanceof Mi&&n.removeChild(r),this.delegate.removeChild(t,e)},t.prototype.selectRootElement=function(t,e){var n=this.delegate.selectRootElement(t,e),r=us();return r&&Li(new Mi(n,null,r)),n},t.prototype.setAttribute=function(t,e,n,r){var o=Pi(t);o&&o instanceof Mi&&(o.attributes[r?r+":"+e:e]=n),this.delegate.setAttribute(t,e,n,r)},t.prototype.removeAttribute=function(t,e,n){var r=Pi(t);r&&r instanceof Mi&&(r.attributes[n?n+":"+e:e]=null),this.delegate.removeAttribute(t,e,n)},t.prototype.addClass=function(t,e){var n=Pi(t);n&&n instanceof Mi&&(n.classes[e]=!0),this.delegate.addClass(t,e)},t.prototype.removeClass=function(t,e){var n=Pi(t);n&&n instanceof Mi&&(n.classes[e]=!1),this.delegate.removeClass(t,e)},t.prototype.setStyle=function(t,e,n,r){var o=Pi(t);o&&o instanceof Mi&&(o.styles[e]=n),this.delegate.setStyle(t,e,n,r)},t.prototype.removeStyle=function(t,e,n){var r=Pi(t);r&&r instanceof Mi&&(r.styles[e]=null),this.delegate.removeStyle(t,e,n)},t.prototype.setProperty=function(t,e,n){var r=Pi(t);r&&r instanceof Mi&&(r.properties[e]=n),this.delegate.setProperty(t,e,n)},t.prototype.listen=function(t,e,n){if("string"!=typeof t){var r=Pi(t);r&&r.listeners.push(new Di(e,n))}return this.delegate.listen(t,e,n)},t.prototype.parentNode=function(t){return this.delegate.parentNode(t)},t.prototype.nextSibling=function(t){return this.delegate.nextSibling(t)},t.prototype.setValue=function(t,e){return this.delegate.setValue(t,e)},t}();function ps(t,e,n){return new hs(t,e,n)}var hs=function(t){function e(e,n,r){var o=t.call(this)||this;return o.moduleType=e,o._bootstrapComponents=n,o._ngModuleDefFactory=r,o}return a(e,t),e.prototype.create=function(t){!function(){if(!Ra){Ra=!0;var t=be()?{setCurrentNode:Qa,createRootView:Ta,createEmbeddedView:Da,createComponentView:Oa,createNgModuleRef:Ma,overrideProvider:Ba,overrideComponentView:za,clearOverrides:Ua,checkAndUpdateView:Ha,checkNoChangesView:Ga,destroyView:qa,createDebugContext:function(t,e){return new is(t,e)},handleEvent:Za,updateDirectives:Ja,updateRenderer:ts}:{setCurrentNode:function(){},createRootView:Aa,createEmbeddedView:la,createComponentView:pa,createNgModuleRef:so,overrideProvider:nr,overrideComponentView:nr,clearOverrides:nr,checkAndUpdateView:va,checkNoChangesView:ma,destroyView:xa,createDebugContext:function(t,e){return new is(t,e)},handleEvent:function(t,e,n,r){return t.def.handleEvent(t,e,n,r)},updateDirectives:function(t,e){return t.def.updateDirectives(0===e?Wa:ja,t)},updateRenderer:function(t,e){return t.def.updateRenderer(0===e?Wa:ja,t)}};er.setCurrentNode=t.setCurrentNode,er.createRootView=t.createRootView,er.createEmbeddedView=t.createEmbeddedView,er.createComponentView=t.createComponentView,er.createNgModuleRef=t.createNgModuleRef,er.overrideProvider=t.overrideProvider,er.overrideComponentView=t.overrideComponentView,er.clearOverrides=t.clearOverrides,er.checkAndUpdateView=t.checkAndUpdateView,er.checkNoChangesView=t.checkNoChangesView,er.destroyView=t.destroyView,er.resolveDep=No,er.createDebugContext=t.createDebugContext,er.handleEvent=t.handleEvent,er.updateDirectives=t.updateDirectives,er.updateRenderer=t.updateRenderer,er.dirtyParentQueries=Zi}}();var e=function(t){var e=Array.from(t.providers),n=Array.from(t.modules),r={};for(var o in t.providersByKey)r[o]=t.providersByKey[o];return{factory:t.factory,isRoot:t.isRoot,providers:e,modules:n,providersByKey:r}}(kr(this._ngModuleDefFactory));return er.createNgModuleRef(this.moduleType,t||Xt.NULL,this._bootstrapComponents,e)},e}(dn),fs=function(){return function(){}}(),ds=function(){return function(){}}(),ms=function(){return function(){}}(),vs=new Ht("Location Initialized"),gs=function(){return function(){}}(),ys=new Ht("appBaseHref"),bs=function(){function t(t,n){var r=this;this._subject=new Oo,this._urlChangeListeners=[],this._platformStrategy=t;var o=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=e.stripTrailingSlash(ws(o)),this._platformStrategy.onPopState(function(t){r._subject.emit({url:r.path(!0),pop:!0,state:t.state,type:t.type})})}var e;return e=t,t.prototype.path=function(t){return void 0===t&&(t=!1),this.normalize(this._platformStrategy.path(t))},t.prototype.getState=function(){return this._platformLocation.getState()},t.prototype.isCurrentPathEqualTo=function(t,n){return void 0===n&&(n=""),this.path()==this.normalize(t+e.normalizeQueryParams(n))},t.prototype.normalize=function(t){return e.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,ws(t)))},t.prototype.prepareExternalUrl=function(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)},t.prototype.go=function(t,n,r){void 0===n&&(n=""),void 0===r&&(r=null),this._platformStrategy.pushState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+e.normalizeQueryParams(n)),r)},t.prototype.replaceState=function(t,n,r){void 0===n&&(n=""),void 0===r&&(r=null),this._platformStrategy.replaceState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+e.normalizeQueryParams(n)),r)},t.prototype.forward=function(){this._platformStrategy.forward()},t.prototype.back=function(){this._platformStrategy.back()},t.prototype.onUrlChange=function(t){var e=this;this._urlChangeListeners.push(t),this.subscribe(function(t){e._notifyUrlChangeListeners(t.url,t.state)})},t.prototype._notifyUrlChangeListeners=function(t,e){void 0===t&&(t=""),this._urlChangeListeners.forEach(function(n){return n(t,e)})},t.prototype.subscribe=function(t,e,n){return this._subject.subscribe({next:t,error:e,complete:n})},t.normalizeQueryParams=function(t){return t&&"?"!==t[0]?"?"+t:t},t.joinWithSlash=function(t,e){if(0==t.length)return e;if(0==e.length)return t;var n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e},t.stripTrailingSlash=function(t){var e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)},t}();function ws(t){return t.replace(/\/index.html$/,"")}var xs=function(t){function e(e,n){var r=t.call(this)||this;return r._platformLocation=e,r._baseHref="",null!=n&&(r._baseHref=n),r}return a(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e},e.prototype.prepareExternalUrl=function(t){var e=bs.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e},e.prototype.pushState=function(t,e,n,r){var o=this.prepareExternalUrl(n+bs.normalizeQueryParams(r));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,e,o)},e.prototype.replaceState=function(t,e,n,r){var o=this.prepareExternalUrl(n+bs.normalizeQueryParams(r));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,o)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(gs),Cs=function(t){function e(e,n){var r=t.call(this)||this;if(r._platformLocation=e,null==n&&(n=r._platformLocation.getBaseHrefFromDOM()),null==n)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return r._baseHref=n,r}return a(e,t),e.prototype.onPopState=function(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)},e.prototype.getBaseHref=function(){return this._baseHref},e.prototype.prepareExternalUrl=function(t){return bs.joinWithSlash(this._baseHref,t)},e.prototype.path=function(t){void 0===t&&(t=!1);var e=this._platformLocation.pathname+bs.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&t?""+e+n:e},e.prototype.pushState=function(t,e,n,r){var o=this.prepareExternalUrl(n+bs.normalizeQueryParams(r));this._platformLocation.pushState(t,e,o)},e.prototype.replaceState=function(t,e,n,r){var o=this.prepareExternalUrl(n+bs.normalizeQueryParams(r));this._platformLocation.replaceState(t,e,o)},e.prototype.forward=function(){this._platformLocation.forward()},e.prototype.back=function(){this._platformLocation.back()},e}(gs),Es=["en",[["a","p"],["AM","PM"],void 0],[["AM","PM"],void 0,void 0],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],void 0,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],void 0,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",void 0,"{1} 'at' {0}",void 0],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){var e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}],Ss={},ks=function(t){return t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Few=3]="Few",t[t.Many=4]="Many",t[t.Other=5]="Other",t}({}),Ns=new Ht("UseV4Plurals"),Is=function(){return function(){}}(),Rs=function(t){function e(e,n){var r=t.call(this)||this;return r.locale=e,r.deprecatedPluralFn=n,r}return a(e,t),e.prototype.getPluralCategory=function(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){var e=t.toLowerCase().replace(/_/g,"-"),n=Ss[e];if(n)return n;var r=e.split("-")[0];if(n=Ss[r])return n;if("en"===r)return Es;throw new Error('Missing locale data for the locale "'+t+'".')}(t)[18]}(e||this.locale)(t)){case ks.Zero:return"zero";case ks.One:return"one";case ks.Two:return"two";case ks.Few:return"few";case ks.Many:return"many";default:return"other"}},e}(Is),As=function(){function t(t,e,n,r){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=r}return Object.defineProperty(t.prototype,"first",{get:function(){return 0===this.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this.index===this.count-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"even",{get:function(){return this.index%2==0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"odd",{get:function(){return!this.even},enumerable:!0,configurable:!0}),t}(),Ts=function(){function t(t,e,n){this._viewContainer=t,this._template=e,this._differs=n,this._ngForOfDirty=!0,this._differ=null}return Object.defineProperty(t.prototype,"ngForOf",{set:function(t){this._ngForOf=t,this._ngForOfDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngForTrackBy",{get:function(){return this._trackByFn},set:function(t){be()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(t)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngForTemplate",{set:function(t){t&&(this._template=t)},enumerable:!0,configurable:!0}),t.prototype.ngDoCheck=function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(r){throw new Error("Cannot find a differ supporting object '"+t+"' of type '"+((e=t).name||typeof e)+"'. NgFor only supports binding to Iterables such as Arrays.")}}var e;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}},t.prototype._applyChanges=function(t){var e=this,n=[];t.forEachOperation(function(t,r,o){if(null==t.previousIndex){var i=e._viewContainer.createEmbeddedView(e._template,new As(null,e._ngForOf,-1,-1),o),a=new _s(t,i);n.push(a)}else null==o?e._viewContainer.remove(r):(i=e._viewContainer.get(r),e._viewContainer.move(i,o),a=new _s(t,i),n.push(a))});for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);r=0;for(var o=this._viewContainer.length;r<o;r++){var i=this._viewContainer.get(r);i.context.index=r,i.context.count=o,i.context.ngForOf=this._ngForOf}t.forEachIdentityChange(function(t){e._viewContainer.get(t.currentIndex).context.$implicit=t.item})},t.prototype._perViewChange=function(t,e){t.context.$implicit=e.item},t.ngTemplateContextGuard=function(t,e){return!0},t}(),_s=function(){return function(t,e){this.record=t,this.view=e}}(),Ds=function(){function t(t,e){this._viewContainer=t,this._context=new Os,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}return Object.defineProperty(t.prototype,"ngIf",{set:function(t){this._context.$implicit=this._context.ngIf=t,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfThen",{set:function(t){Ms("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngIfElse",{set:function(t){Ms("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),t.prototype._updateView=function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))},t.ngTemplateGuard_ngIf=function(t,e){return!0},t}(),Os=function(){return function(){this.$implicit=null,this.ngIf=null}}();function Ms(t,e){if(e&&!e.createEmbeddedView)throw new Error(t+" must be a TemplateRef, but received '"+Mt(e)+"'.")}var Fs=function(){return function(){}}(),Ps=new Ht("DocumentToken"),Ls="browser",Bs="server";function zs(t){return t===Ls}var Us=function(){function t(){}return t.ngInjectableDef=_t({providedIn:"root",factory:function(){return new Vs(jt(Ps),window,jt(ve))}}),t}(),Vs=function(){function t(t,e,n){this.document=t,this.window=e,this.errorHandler=n,this.offset=function(){return[0,0]}}return t.prototype.setOffset=function(t){this.offset=Array.isArray(t)?function(){return t}:t},t.prototype.getScrollPosition=function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]},t.prototype.scrollToPosition=function(t){this.supportScrollRestoration()&&this.window.scrollTo(t[0],t[1])},t.prototype.scrollToAnchor=function(t){if(this.supportScrollRestoration()){t=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(t):t.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{var e=this.document.querySelector("#"+t);if(e)return void this.scrollToElement(e);var n=this.document.querySelector("[name='"+t+"']");if(n)return void this.scrollToElement(n)}catch(Tz){this.errorHandler.handleError(Tz)}}},t.prototype.setHistoryScrollRestoration=function(t){if(this.supportScrollRestoration()){var e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}},t.prototype.scrollToElement=function(t){var e=t.getBoundingClientRect(),n=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(n-o[0],r-o[1])},t.prototype.supportScrollRestoration=function(){try{return!!this.window&&!!this.window.scrollTo}catch(t){return!1}},t}(),Ws=new O(function(t){return t.complete()});function js(t){return t?function(t){return new O(function(e){return t.schedule(function(){return e.complete()})})}(t):Ws}function Hs(t){var e=new O(function(e){e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}function Gs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];switch(V(n)?t.pop():n=void 0,t.length){case 0:return js(n);case 1:return n?rt(t,n):Hs(t[0]);default:return rt(t,n)}}var qs=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return a(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new P;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(z);function Ks(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}Ks.prototype=Object.create(Error.prototype);var $s=Ks,Xs={},Ys=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Qs(t,this.resultSelector))},t}(),Qs=function(t){function e(e,n){var r=t.call(this,e)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return a(e,t),e.prototype._next=function(t){this.values.push(Xs),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(Z(this,r,r,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,o){var i=this.values,a=this.toRespond?i[n]===Xs?--this.toRespond:this.toRespond:0;i[n]=e,0===a&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)},e}(J);function Zs(t){return new O(function(e){var n;try{n=t()}catch(r){return void e.error(r)}return(n?ot(n):js()).subscribe(e)})}function Js(){return lt(1)}function tu(t,e){return function(n){return n.lift(new eu(t,e))}}var eu=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new nu(t,this.predicate,this.thisArg))},t}(),nu=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.predicate=n,o.thisArg=r,o.count=0,o}return a(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)},e}(I);function ru(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}ru.prototype=Object.create(Error.prototype);var ou=ru;function iu(t){return function(e){return 0===t?js():e.lift(new au(t))}}var au=function(){function t(t){if(this.total=t,this.total<0)throw new ou}return t.prototype.call=function(t,e){return e.subscribe(new su(t,this.total))},t}(),su=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.ring=new Array,r.count=0,r}return a(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,o=0;o<n;o++){var i=e++%n;t.next(r[i])}t.complete()},e}(I);function uu(t,e,n){return function(r){return r.lift(new lu(t,e,n))}}var lu=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new cu(t,this.nextOrObserver,this.error,this.complete))},t}(),cu=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i._tapNext=T,i._tapError=T,i._tapComplete=T,i._tapError=r||T,i._tapComplete=o||T,g(n)?(i._context=i,i._tapNext=n):n&&(i._context=n,i._tapNext=n.next||T,i._tapError=n.error||T,i._tapComplete=n.complete||T),i}return a(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(I),pu=function(t){return void 0===t&&(t=hu),uu({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw t()}})};function hu(){return new $s}function fu(t){return void 0===t&&(t=null),function(e){return e.lift(new du(t))}}var du=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new mu(t,this.defaultValue))},t}(),mu=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return a(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(I);function vu(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?tu(function(e,n){return t(e,n,r)}):ut,iu(1),n?fu(e):pu(function(){return new $s}))}}function gu(t){return function(e){var n=new yu(t),r=e.lift(n);return n.caught=r}}var yu=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new bu(t,this.selector,this.caught))},t}(),bu=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.selector=n,o.caught=r,o}return a(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(o){return void t.prototype.error.call(this,o)}this._unsubscribeAndRecycle();var r=new W(this,void 0,void 0);this.add(r),Z(this,n,void 0,void 0,r)}},e}(J);function wu(t){return function(e){return 0===t?js():e.lift(new xu(t))}}var xu=function(){function t(t){if(this.total=t,this.total<0)throw new ou}return t.prototype.call=function(t,e){return e.subscribe(new Cu(t,this.total))},t}(),Cu=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return a(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(I);function Eu(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?tu(function(e,n){return t(e,n,r)}):ut,wu(1),n?fu(e):pu(function(){return new $s}))}}var Su=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new ku(t,this.predicate,this.thisArg,this.source))},t}(),ku=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.predicate=n,i.thisArg=r,i.source=o,i.index=0,i.thisArg=r||i,i}return a(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(n){return void this.destination.error(n)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(I);function Nu(t,e){return"function"==typeof e?function(n){return n.pipe(Nu(function(n,r){return ot(t(n,r)).pipe(tt(function(t,o){return e(n,t,r,o)}))}))}:function(e){return e.lift(new Iu(t))}}var Iu=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Ru(t,this.project))},t}(),Ru=function(t){function e(e,n){var r=t.call(this,e)||this;return r.project=n,r.index=0,r}return a(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=this.innerSubscription;r&&r.unsubscribe();var o=new W(this,void 0,void 0);this.destination.add(o),this.innerSubscription=Z(this,t,e,n,o)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=null},e.prototype.notifyComplete=function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e,n,r,o){this.destination.next(e)},e}(J);function Au(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Js()(Gs.apply(void 0,t))}function Tu(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new _u(t,e,n))}}var _u=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new Du(t,this.accumulator,this.seed,this.hasSeed))},t}(),Du=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.accumulator=n,i._seed=r,i.hasSeed=o,i.index=0,i}return a(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(r){this.destination.error(r)}this.seed=e,this.destination.next(e)},e}(I);function Ou(t,e){return it(t,e,1)}var Mu=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new Fu(t,this.callback))},t}(),Fu=function(t){function e(e,n){var r=t.call(this,e)||this;return r.add(new w(n)),r}return a(e,t),e}(I),Pu=null;function Lu(){return Pu}var Bu,zu=function(t){function e(){var e=t.call(this)||this;e._animationPrefix=null,e._transitionEnd=null;try{var n=e.createElement("div",document);if(null!=e.getStyle(n,"animationName"))e._animationPrefix="";else for(var r=["Webkit","Moz","O","ms"],o=0;o<r.length;o++)if(null!=e.getStyle(n,r[o]+"AnimationName")){e._animationPrefix="-"+r[o].toLowerCase()+"-";break}var i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(i).forEach(function(t){null!=e.getStyle(n,t)&&(e._transitionEnd=i[t])})}catch(a){e._animationPrefix=null,e._transitionEnd=null}return e}return a(e,t),e.prototype.getDistributedNodes=function(t){return t.getDistributedNodes()},e.prototype.resolveAndSetHref=function(t,e,n){t.href=null==n?e:e+"/../"+n},e.prototype.supportsDOMEvents=function(){return!0},e.prototype.supportsNativeShadowDOM=function(){return"function"==typeof document.body.createShadowRoot},e.prototype.getAnimationPrefix=function(){return this._animationPrefix?this._animationPrefix:""},e.prototype.getTransitionEnd=function(){return this._transitionEnd?this._transitionEnd:""},e.prototype.supportsAnimation=function(){return null!=this._animationPrefix&&null!=this._transitionEnd},e}(function(){function t(){this.resourceLoaderType=null}return Object.defineProperty(t.prototype,"attrToPropMap",{get:function(){return this._attrToPropMap},set:function(t){this._attrToPropMap=t},enumerable:!0,configurable:!0}),t}()),Uu={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},Vu={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Wu={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},ju=function(){if(Ut.Node)return Ut.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))}}(),Hu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.parse=function(t){throw new Error("parse not implemented")},e.makeCurrent=function(){var t;t=new e,Pu||(Pu=t)},e.prototype.hasProperty=function(t,e){return e in t},e.prototype.setProperty=function(t,e,n){t[e]=n},e.prototype.getProperty=function(t,e){return t[e]},e.prototype.invoke=function(t,e,n){var r;(r=t)[e].apply(r,d(n))},e.prototype.logError=function(t){window.console&&(console.error?console.error(t):console.log(t))},e.prototype.log=function(t){window.console&&window.console.log&&window.console.log(t)},e.prototype.logGroup=function(t){window.console&&window.console.group&&window.console.group(t)},e.prototype.logGroupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},Object.defineProperty(e.prototype,"attrToPropMap",{get:function(){return Uu},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,e){return ju.call(t,e)},e.prototype.querySelector=function(t,e){return t.querySelector(e)},e.prototype.querySelectorAll=function(t,e){return t.querySelectorAll(e)},e.prototype.on=function(t,e,n){t.addEventListener(e,n,!1)},e.prototype.onAndCancel=function(t,e,n){return t.addEventListener(e,n,!1),function(){t.removeEventListener(e,n,!1)}},e.prototype.dispatchEvent=function(t,e){t.dispatchEvent(e)},e.prototype.createMouseEvent=function(t){var e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e},e.prototype.createEvent=function(t){var e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e},e.prototype.preventDefault=function(t){t.preventDefault(),t.returnValue=!1},e.prototype.isPrevented=function(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue},e.prototype.getInnerHTML=function(t){return t.innerHTML},e.prototype.getTemplateContent=function(t){return"content"in t&&this.isTemplateElement(t)?t.content:null},e.prototype.getOuterHTML=function(t){return t.outerHTML},e.prototype.nodeName=function(t){return t.nodeName},e.prototype.nodeValue=function(t){return t.nodeValue},e.prototype.type=function(t){return t.type},e.prototype.content=function(t){return this.hasProperty(t,"content")?t.content:t},e.prototype.firstChild=function(t){return t.firstChild},e.prototype.nextSibling=function(t){return t.nextSibling},e.prototype.parentElement=function(t){return t.parentNode},e.prototype.childNodes=function(t){return t.childNodes},e.prototype.childNodesAsList=function(t){for(var e=t.childNodes,n=new Array(e.length),r=0;r<e.length;r++)n[r]=e[r];return n},e.prototype.clearNodes=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},e.prototype.appendChild=function(t,e){t.appendChild(e)},e.prototype.removeChild=function(t,e){t.removeChild(e)},e.prototype.replaceChild=function(t,e,n){t.replaceChild(e,n)},e.prototype.remove=function(t){return t.parentNode&&t.parentNode.removeChild(t),t},e.prototype.insertBefore=function(t,e,n){t.insertBefore(n,e)},e.prototype.insertAllBefore=function(t,e,n){n.forEach(function(n){return t.insertBefore(n,e)})},e.prototype.insertAfter=function(t,e,n){t.insertBefore(n,e.nextSibling)},e.prototype.setInnerHTML=function(t,e){t.innerHTML=e},e.prototype.getText=function(t){return t.textContent},e.prototype.setText=function(t,e){t.textContent=e},e.prototype.getValue=function(t){return t.value},e.prototype.setValue=function(t,e){t.value=e},e.prototype.getChecked=function(t){return t.checked},e.prototype.setChecked=function(t,e){t.checked=e},e.prototype.createComment=function(t){return this.getDefaultDocument().createComment(t)},e.prototype.createTemplate=function(t){var e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e},e.prototype.createElement=function(t,e){return(e=e||this.getDefaultDocument()).createElement(t)},e.prototype.createElementNS=function(t,e,n){return(n=n||this.getDefaultDocument()).createElementNS(t,e)},e.prototype.createTextNode=function(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)},e.prototype.createScriptTag=function(t,e,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(t,e),r},e.prototype.createStyleElement=function(t,e){var n=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(t,e)),n},e.prototype.createShadowRoot=function(t){return t.createShadowRoot()},e.prototype.getShadowRoot=function(t){return t.shadowRoot},e.prototype.getHost=function(t){return t.host},e.prototype.clone=function(t){return t.cloneNode(!0)},e.prototype.getElementsByClassName=function(t,e){return t.getElementsByClassName(e)},e.prototype.getElementsByTagName=function(t,e){return t.getElementsByTagName(e)},e.prototype.classList=function(t){return Array.prototype.slice.call(t.classList,0)},e.prototype.addClass=function(t,e){t.classList.add(e)},e.prototype.removeClass=function(t,e){t.classList.remove(e)},e.prototype.hasClass=function(t,e){return t.classList.contains(e)},e.prototype.setStyle=function(t,e,n){t.style[e]=n},e.prototype.removeStyle=function(t,e){t.style[e]=""},e.prototype.getStyle=function(t,e){return t.style[e]},e.prototype.hasStyle=function(t,e,n){var r=this.getStyle(t,e)||"";return n?r==n:r.length>0},e.prototype.tagName=function(t){return t.tagName},e.prototype.attributeMap=function(t){for(var e=new Map,n=t.attributes,r=0;r<n.length;r++){var o=n.item(r);e.set(o.name,o.value)}return e},e.prototype.hasAttribute=function(t,e){return t.hasAttribute(e)},e.prototype.hasAttributeNS=function(t,e,n){return t.hasAttributeNS(e,n)},e.prototype.getAttribute=function(t,e){return t.getAttribute(e)},e.prototype.getAttributeNS=function(t,e,n){return t.getAttributeNS(e,n)},e.prototype.setAttribute=function(t,e,n){t.setAttribute(e,n)},e.prototype.setAttributeNS=function(t,e,n,r){t.setAttributeNS(e,n,r)},e.prototype.removeAttribute=function(t,e){t.removeAttribute(e)},e.prototype.removeAttributeNS=function(t,e,n){t.removeAttributeNS(e,n)},e.prototype.templateAwareRoot=function(t){return this.isTemplateElement(t)?this.content(t):t},e.prototype.createHtmlDocument=function(){return document.implementation.createHTMLDocument("fakeTitle")},e.prototype.getDefaultDocument=function(){return document},e.prototype.getBoundingClientRect=function(t){try{return t.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}},e.prototype.getTitle=function(t){return t.title},e.prototype.setTitle=function(t,e){t.title=e||""},e.prototype.elementMatches=function(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))},e.prototype.isTemplateElement=function(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName},e.prototype.isTextNode=function(t){return t.nodeType===Node.TEXT_NODE},e.prototype.isCommentNode=function(t){return t.nodeType===Node.COMMENT_NODE},e.prototype.isElementNode=function(t){return t.nodeType===Node.ELEMENT_NODE},e.prototype.hasShadowRoot=function(t){return null!=t.shadowRoot&&t instanceof HTMLElement},e.prototype.isShadowRoot=function(t){return t instanceof DocumentFragment},e.prototype.importIntoDoc=function(t){return document.importNode(this.templateAwareRoot(t),!0)},e.prototype.adoptNode=function(t){return document.adoptNode(t)},e.prototype.getHref=function(t){return t.getAttribute("href")},e.prototype.getEventKey=function(t){var e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&Wu.hasOwnProperty(e)&&(e=Wu[e]))}return Vu[e]||e},e.prototype.getGlobalEventTarget=function(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null},e.prototype.getHistory=function(){return window.history},e.prototype.getLocation=function(){return window.location},e.prototype.getBaseHref=function(t){var e,n=Gu||(Gu=document.querySelector("base"))?Gu.getAttribute("href"):null;return null==n?null:(e=n,Bu||(Bu=document.createElement("a")),Bu.setAttribute("href",e),"/"===Bu.pathname.charAt(0)?Bu.pathname:"/"+Bu.pathname)},e.prototype.resetBaseElement=function(){Gu=null},e.prototype.getUserAgent=function(){return window.navigator.userAgent},e.prototype.setData=function(t,e,n){this.setAttribute(t,"data-"+e,n)},e.prototype.getData=function(t,e){return this.getAttribute(t,"data-"+e)},e.prototype.getComputedStyle=function(t){return getComputedStyle(t)},e.prototype.supportsWebAnimation=function(){return"function"==typeof Element.prototype.animate},e.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},e.prototype.supportsCookies=function(){return!0},e.prototype.getCookie=function(t){return function(t,e){var n,r;e=encodeURIComponent(e);try{for(var o=h(t.split(";")),i=o.next();!i.done;i=o.next()){var a=i.value,s=a.indexOf("="),u=f(-1==s?[a,""]:[a.slice(0,s),a.slice(s+1)],2),l=u[1];if(u[0].trim()===e)return decodeURIComponent(l)}}catch(c){n={error:c}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return null}(document.cookie,t)},e.prototype.setCookie=function(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)},e}(zu),Gu=null;function qu(){return!!window.history.pushState}var Ku=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._init(),n}var n;return a(e,t),e.prototype._init=function(){this.location=Lu().getLocation(),this._history=Lu().getHistory()},e.prototype.getBaseHrefFromDOM=function(){return Lu().getBaseHref(this._doc)},e.prototype.onPopState=function(t){Lu().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)},e.prototype.onHashChange=function(t){Lu().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)},Object.defineProperty(e.prototype,"href",{get:function(){return this.location.href},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this.location.protocol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hostname",{get:function(){return this.location.hostname},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"port",{get:function(){return this.location.port},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathname",{get:function(){return this.location.pathname},set:function(t){this.location.pathname=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return this.location.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this.location.hash},enumerable:!0,configurable:!0}),e.prototype.pushState=function(t,e,n){qu()?this._history.pushState(t,e,n):this.location.hash=n},e.prototype.replaceState=function(t,e,n){qu()?this._history.replaceState(t,e,n):this.location.hash=n},e.prototype.forward=function(){this._history.forward()},e.prototype.back=function(){this._history.back()},e.prototype.getState=function(){return this._history.state},u([(n=kt(Ps),function(t,e){n(t,e,0)}),l("design:paramtypes",[Object])],e)}(ms),$u=new Ht("TRANSITION_ID"),Xu=[{provide:Bo,useFactory:function(t,e,n){return function(){n.get(zo).donePromise.then(function(){var n=Lu();Array.prototype.slice.apply(n.querySelectorAll(e,"style[ng-transition]")).filter(function(e){return n.getAttribute(e,"ng-transition")===t}).forEach(function(t){return n.remove(t)})})}},deps:[$u,Ps,Xt],multi:!0}],Yu=function(){function t(){}return t.init=function(){var e;e=new t,bi=e},t.prototype.addToWindow=function(t){Ut.getAngularTestability=function(e,n){void 0===n&&(n=!0);var r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},Ut.getAllAngularTestabilities=function(){return t.getAllTestabilities()},Ut.getAllAngularRootElements=function(){return t.getAllRootElements()},Ut.frameworkStabilizers||(Ut.frameworkStabilizers=[]),Ut.frameworkStabilizers.push(function(t){var e=Ut.getAllAngularTestabilities(),n=e.length,r=!1,o=function(e){r=r||e,0==--n&&t(r)};e.forEach(function(t){t.whenStable(o)})})},t.prototype.findTestabilityInTree=function(t,e,n){if(null==e)return null;var r=t.getTestability(e);return null!=r?r:n?Lu().isShadowRoot(e)?this.findTestabilityInTree(t,Lu().getHost(e),!0):this.findTestabilityInTree(t,Lu().parentElement(e),!0):null},t}();function Qu(t,e){"undefined"!=typeof COMPILED&&COMPILED||((Ut.ng=Ut.ng||{})[t]=e)}var Zu=function(){return{ApplicationRef:Ni,NgZone:li}}();function Ju(t){return Pi(t)}var tl=new Ht("EventManagerPlugins"),el=function(){function t(t,e){var n=this;this._zone=e,this._eventNameToPlugin=new Map,t.forEach(function(t){return t.manager=n}),this._plugins=t.slice().reverse()}return t.prototype.addEventListener=function(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)},t.prototype.addGlobalEventListener=function(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)},t.prototype.getZone=function(){return this._zone},t.prototype._findPluginFor=function(t){var e=this._eventNameToPlugin.get(t);if(e)return e;for(var n=this._plugins,r=0;r<n.length;r++){var o=n[r];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error("No event manager plugin found for event "+t)},t}(),nl=function(){function t(t){this._doc=t}return t.prototype.addGlobalEventListener=function(t,e,n){var r=Lu().getGlobalEventTarget(this._doc,t);if(!r)throw new Error("Unsupported event target "+r+" for event "+e);return this.addEventListener(r,e,n)},t}(),rl=function(){function t(){this._stylesSet=new Set}return t.prototype.addStyles=function(t){var e=this,n=new Set;t.forEach(function(t){e._stylesSet.has(t)||(e._stylesSet.add(t),n.add(t))}),this.onStylesAdded(n)},t.prototype.onStylesAdded=function(t){},t.prototype.getAllStyles=function(){return Array.from(this._stylesSet)},t}(),ol=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n._hostNodes=new Set,n._styleNodes=new Set,n._hostNodes.add(e.head),n}return a(e,t),e.prototype._addStylesToHost=function(t,e){var n=this;t.forEach(function(t){var r=n._doc.createElement("style");r.textContent=t,n._styleNodes.add(e.appendChild(r))})},e.prototype.addHost=function(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)},e.prototype.removeHost=function(t){this._hostNodes.delete(t)},e.prototype.onStylesAdded=function(t){var e=this;this._hostNodes.forEach(function(n){return e._addStylesToHost(t,n)})},e.prototype.ngOnDestroy=function(){this._styleNodes.forEach(function(t){return Lu().remove(t)})},e}(rl),il={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},al=/%COMP%/g,sl="_nghost-%COMP%",ul="_ngcontent-%COMP%";function ll(t,e,n){for(var r=0;r<e.length;r++){var o=e[r];Array.isArray(o)?ll(t,o,n):(o=o.replace(al,t),n.push(o))}return n}function cl(t){return function(e){!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}var pl=function(){function t(t,e,n){this.eventManager=t,this.sharedStylesHost=e,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new hl(t)}return t.prototype.createRenderer=function(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case pe.Emulated:var n=this.rendererByCompId.get(e.id);return n||(n=new ml(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n;case pe.Native:case pe.ShadowDom:return new vl(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){var r=ll(e.id,e.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}},t.prototype.begin=function(){},t.prototype.end=function(){},t}(),hl=function(){function t(t){this.eventManager=t,this.data=Object.create(null)}return t.prototype.destroy=function(){},t.prototype.createElement=function(t,e){return e?document.createElementNS(il[e]||e,t):document.createElement(t)},t.prototype.createComment=function(t){return document.createComment(t)},t.prototype.createText=function(t){return document.createTextNode(t)},t.prototype.appendChild=function(t,e){t.appendChild(e)},t.prototype.insertBefore=function(t,e,n){t&&t.insertBefore(e,n)},t.prototype.removeChild=function(t,e){t&&t.removeChild(e)},t.prototype.selectRootElement=function(t,e){var n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error('The selector "'+t+'" did not match any elements');return e||(n.textContent=""),n},t.prototype.parentNode=function(t){return t.parentNode},t.prototype.nextSibling=function(t){return t.nextSibling},t.prototype.setAttribute=function(t,e,n,r){if(r){e=r+":"+e;var o=il[r];o?t.setAttributeNS(o,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)},t.prototype.removeAttribute=function(t,e,n){if(n){var r=il[n];r?t.removeAttributeNS(r,e):t.removeAttribute(n+":"+e)}else t.removeAttribute(e)},t.prototype.addClass=function(t,e){t.classList.add(e)},t.prototype.removeClass=function(t,e){t.classList.remove(e)},t.prototype.setStyle=function(t,e,n,r){r&wn.DashCase?t.style.setProperty(e,n,r&wn.Important?"important":""):t.style[e]=n},t.prototype.removeStyle=function(t,e,n){n&wn.DashCase?t.style.removeProperty(e):t.style[e]=""},t.prototype.setProperty=function(t,e,n){dl(e,"property"),t[e]=n},t.prototype.setValue=function(t,e){t.nodeValue=e},t.prototype.listen=function(t,e,n){return dl(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,cl(n)):this.eventManager.addEventListener(t,e,cl(n))},t}(),fl=function(){return"@".charCodeAt(0)}();function dl(t,e){if(t.charCodeAt(0)===fl)throw new Error("Found the synthetic "+e+" "+t+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}var ml=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;i.component=r;var a=ll(o+"-"+r.id,r.styles,[]);return n.addStyles(a),i.contentAttr=ul.replace(al,o+"-"+r.id),i.hostAttr=sl.replace(al,o+"-"+r.id),i}return a(e,t),e.prototype.applyToHost=function(e){t.prototype.setAttribute.call(this,e,this.hostAttr,"")},e.prototype.createElement=function(e,n){var r=t.prototype.createElement.call(this,e,n);return t.prototype.setAttribute.call(this,r,this.contentAttr,""),r},e}(hl),vl=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;i.sharedStylesHost=n,i.hostEl=r,i.component=o,i.shadowRoot=o.encapsulation===pe.ShadowDom?r.attachShadow({mode:"open"}):r.createShadowRoot(),i.sharedStylesHost.addHost(i.shadowRoot);for(var a=ll(o.id,o.styles,[]),s=0;s<a.length;s++){var u=document.createElement("style");u.textContent=a[s],i.shadowRoot.appendChild(u)}return i}return a(e,t),e.prototype.nodeOrShadowRoot=function(t){return t===this.hostEl?this.shadowRoot:t},e.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},e.prototype.appendChild=function(e,n){return t.prototype.appendChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.insertBefore=function(e,n,r){return t.prototype.insertBefore.call(this,this.nodeOrShadowRoot(e),n,r)},e.prototype.removeChild=function(e,n){return t.prototype.removeChild.call(this,this.nodeOrShadowRoot(e),n)},e.prototype.parentNode=function(e){return this.nodeOrShadowRoot(t.prototype.parentNode.call(this,this.nodeOrShadowRoot(e)))},e}(hl),gl=function(){return"undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t}}(),yl=gl("addEventListener"),bl=gl("removeEventListener"),wl={},xl="__zone_symbol__propagationStopped",Cl=function(){var t="undefined"!=typeof Zone&&Zone[gl("BLACK_LISTED_EVENTS")];if(t){var e={};return t.forEach(function(t){e[t]=t}),e}}(),El=function(t){return!!Cl&&Cl.hasOwnProperty(t)},Sl=function(t){var e=wl[t.type];if(e){var n=this[e];if(n){var r=[t];if(1===n.length)return(a=n[0]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r);for(var o=n.slice(),i=0;i<o.length&&!0!==t[xl];i++){var a;(a=o[i]).zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r)}}}},kl=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.ngZone=n,r&&function(t){return t===Bs}(r)||o.patchEvent(),o}return a(e,t),e.prototype.patchEvent=function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[xl]=!0),t&&t.apply(this,arguments)}}},e.prototype.supports=function(t){return!0},e.prototype.addEventListener=function(t,e,n){var r=this,o=n;if(!t[yl]||li.isInAngularZone()&&!El(e))t.addEventListener(e,o,!1);else{var i=wl[e];i||(i=wl[e]=gl("ANGULAR"+e+"FALSE"));var a=t[i],s=a&&a.length>0;a||(a=t[i]=[]);var u=El(e)?Zone.root:Zone.current;if(0===a.length)a.push({zone:u,handler:o});else{for(var l=!1,c=0;c<a.length;c++)if(a[c].handler===o){l=!0;break}l||a.push({zone:u,handler:o})}s||t[yl](e,Sl,!1)}return function(){return r.removeEventListener(t,e,o)}},e.prototype.removeEventListener=function(t,e,n){var r=t[bl];if(!r)return t.removeEventListener.apply(t,[e,n,!1]);var o=wl[e],i=o&&t[o];if(!i)return t.removeEventListener.apply(t,[e,n,!1]);for(var a=!1,s=0;s<i.length;s++)if(i[s].handler===n){a=!0,i.splice(s,1);break}a?0===i.length&&r.apply(t,[e,Sl,!1]):t.removeEventListener.apply(t,[e,n,!1])},e}(nl),Nl={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Il=new Ht("HammerGestureConfig"),Rl=new Ht("HammerLoader"),Al=function(){function t(){this.events=[],this.overrides={}}return t.prototype.buildHammer=function(t){var e=new Hammer(t,this.options);for(var n in e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0}),this.overrides)e.get(n).set(this.overrides[n]);return e},t}(),Tl=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i._config=n,i.console=r,i.loader=o,i}return a(e,t),e.prototype.supports=function(t){return!(!Nl.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer&&!this.loader&&(this.console.warn('The "'+t+'" event cannot be bound because Hammer.JS is not loaded and no custom loader has been specified.'),1))},e.prototype.addEventListener=function(t,e,n){var r=this,o=this.manager.getZone();if(e=e.toLowerCase(),!window.Hammer&&this.loader){var i=!1,a=function(){i=!0};return this.loader().then(function(){if(!window.Hammer)return r.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(a=function(){});i||(a=r.addEventListener(t,e,n))}).catch(function(){r.console.warn('The "'+e+'" event cannot be bound because the custom Hammer.JS loader failed.'),a=function(){}}),function(){a()}}return o.runOutsideAngular(function(){var i=r._config.buildHammer(t),a=function(t){o.runGuarded(function(){n(t)})};return i.on(e,a),function(){i.off(e,a),"function"==typeof i.destroy&&i.destroy()}})},e.prototype.isCustomEvent=function(t){return this._config.events.indexOf(t)>-1},e}(nl),_l=["alt","control","meta","shift"],Dl={alt:function(t){return t.altKey},control:function(t){return t.ctrlKey},meta:function(t){return t.metaKey},shift:function(t){return t.shiftKey}},Ol=function(t){function e(e){return t.call(this,e)||this}var n;return a(e,t),n=e,e.prototype.supports=function(t){return null!=n.parseEventName(t)},e.prototype.addEventListener=function(t,e,r){var o=n.parseEventName(e),i=n.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return Lu().onAndCancel(t,o.domEventName,i)})},e.parseEventName=function(t){var e=t.toLowerCase().split("."),r=e.shift();if(0===e.length||"keydown"!==r&&"keyup"!==r)return null;var o=n._normalizeKey(e.pop()),i="";if(_l.forEach(function(t){var n=e.indexOf(t);n>-1&&(e.splice(n,1),i+=t+".")}),i+=o,0!=e.length||0===o.length)return null;var a={};return a.domEventName=r,a.fullKey=i,a},e.getEventFullKey=function(t){var e="",n=Lu().getEventKey(t);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),_l.forEach(function(r){r!=n&&(0,Dl[r])(t)&&(e+=r+".")}),e+=n},e.eventCallback=function(t,e,r){return function(o){n.getEventFullKey(o)===t&&r.runGuarded(function(){return e(o)})}},e._normalizeKey=function(t){switch(t){case"esc":return"escape";default:return t}},e}(nl),Ml=function(){return function(){}}(),Fl=function(t){function e(e){var n=t.call(this)||this;return n._doc=e,n}return a(e,t),e.prototype.sanitize=function(t,e){if(null==e)return null;switch(t){case Ve.NONE:return e;case Ve.HTML:return e instanceof Ll?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){var n=null;try{Ne=Ne||new we(t);var r=e?String(e):"";n=Ne.getInertBodyElement(r);var o=5,i=r;do{if(0===o)throw new Error("Failed to sanitize html because the input is unstable");o--,r=i,i=n.innerHTML,n=Ne.getInertBodyElement(r)}while(r!==i);var a=new Pe,s=a.sanitizeChildren(Ue(n)||n);return be()&&a.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var u=Ue(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(e)));case Ve.STYLE:return e instanceof Bl?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";var e=t.match(He);return e&&Ee(e[1])===e[1]||t.match(je)&&function(t){for(var e=!0,n=!0,r=0;r<t.length;r++){var o=t.charAt(r);"'"===o&&n?e=!e:'"'===o&&e&&(n=!n)}return e&&n}(t)?t:(be()&&console.warn("WARNING: sanitizing unsafe style value "+t+" (see http://g.co/ng/security#xss)."),"unsafe")}(e));case Ve.SCRIPT:if(e instanceof zl)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case Ve.URL:return e instanceof Vl||e instanceof Ul?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),Ee(String(e)));case Ve.RESOURCE_URL:if(e instanceof Vl)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext "+t+" (see http://g.co/ng/security#xss)")}},e.prototype.checkNotSafeValue=function(t,e){if(t instanceof Pl)throw new Error("Required a safe "+e+", got a "+t.getTypeName()+" (see http://g.co/ng/security#xss)")},e.prototype.bypassSecurityTrustHtml=function(t){return new Ll(t)},e.prototype.bypassSecurityTrustStyle=function(t){return new Bl(t)},e.prototype.bypassSecurityTrustScript=function(t){return new zl(t)},e.prototype.bypassSecurityTrustUrl=function(t){return new Ul(t)},e.prototype.bypassSecurityTrustResourceUrl=function(t){return new Vl(t)},e}(Ml),Pl=function(){function t(t){this.changingThisBreaksApplicationSecurity=t}return t.prototype.toString=function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"},t}(),Ll=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getTypeName=function(){return"HTML"},e}(Pl),Bl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getTypeName=function(){return"Style"},e}(Pl),zl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getTypeName=function(){return"Script"},e}(Pl),Ul=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getTypeName=function(){return"URL"},e}(Pl),Vl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getTypeName=function(){return"ResourceURL"},e}(Pl),Wl=Ci(Bi,"browser",[{provide:Ho,useValue:Ls},{provide:jo,useValue:function(){Hu.makeCurrent(),Yu.init()},multi:!0},{provide:ms,useClass:Ku,deps:[Ps]},{provide:Ps,useFactory:function(){return document},deps:[]}]);function jl(){return new ve}var Hl=function(){function t(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}var e;return e=t,t.withServerTransition=function(t){return{ngModule:e,providers:[{provide:Uo,useValue:t.appId},{provide:$u,useExisting:Uo},Xu]}},t}();"undefined"!=typeof window&&window;var Gl=function(){return function(t,e){this.id=t,this.url=e}}(),ql=function(t){function e(e,n,r,o){void 0===r&&(r="imperative"),void 0===o&&(o=null);var i=t.call(this,e,n)||this;return i.navigationTrigger=r,i.restoredState=o,i}return a(e,t),e.prototype.toString=function(){return"NavigationStart(id: "+this.id+", url: '"+this.url+"')"},e}(Gl),Kl=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.urlAfterRedirects=r,o}return a(e,t),e.prototype.toString=function(){return"NavigationEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"')"},e}(Gl),$l=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.reason=r,o}return a(e,t),e.prototype.toString=function(){return"NavigationCancel(id: "+this.id+", url: '"+this.url+"')"},e}(Gl),Xl=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.error=r,o}return a(e,t),e.prototype.toString=function(){return"NavigationError(id: "+this.id+", url: '"+this.url+"', error: "+this.error+")"},e}(Gl),Yl=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return a(e,t),e.prototype.toString=function(){return"RoutesRecognized(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Gl),Ql=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return a(e,t),e.prototype.toString=function(){return"GuardsCheckStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Gl),Zl=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n)||this;return a.urlAfterRedirects=r,a.state=o,a.shouldActivate=i,a}return a(e,t),e.prototype.toString=function(){return"GuardsCheckEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+", shouldActivate: "+this.shouldActivate+")"},e}(Gl),Jl=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return a(e,t),e.prototype.toString=function(){return"ResolveStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Gl),tc=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i.urlAfterRedirects=r,i.state=o,i}return a(e,t),e.prototype.toString=function(){return"ResolveEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},e}(Gl),ec=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadStart(path: "+this.route.path+")"},t}(),nc=function(){function t(t){this.route=t}return t.prototype.toString=function(){return"RouteConfigLoadEnd(path: "+this.route.path+")"},t}(),rc=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),oc=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ChildActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),ic=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),ac=function(){function t(t){this.snapshot=t}return t.prototype.toString=function(){return"ActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},t}(),sc=function(){function t(t,e,n){this.routerEvent=t,this.position=e,this.anchor=n}return t.prototype.toString=function(){return"Scroll(anchor: '"+this.anchor+"', position: '"+(this.position?this.position[0]+", "+this.position[1]:null)+"')"},t}(),uc=function(){return function(){}}(),lc="primary",cc=function(){function t(t){this.params=t||{}}return t.prototype.has=function(t){return this.params.hasOwnProperty(t)},t.prototype.get=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e[0]:e}return null},t.prototype.getAll=function(t){if(this.has(t)){var e=this.params[t];return Array.isArray(e)?e:[e]}return[]},Object.defineProperty(t.prototype,"keys",{get:function(){return Object.keys(this.params)},enumerable:!0,configurable:!0}),t}();function pc(t){return new cc(t)}var hc="ngNavigationCancelingError";function fc(t){var e=Error("NavigationCancelingError: "+t);return e[hc]=!0,e}function dc(t,e,n){var r=n.path.split("/");if(r.length>t.length)return null;if("full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;for(var o={},i=0;i<r.length;i++){var a=r[i],s=t[i];if(a.startsWith(":"))o[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}var mc=function(){return function(t,e){this.routes=t,this.module=e}}();function vc(t,e){void 0===e&&(e="");for(var n=0;n<t.length;n++){var r=t[n];gc(r,yc(e,r))}}function gc(t,e){if(!t)throw new Error("\n      Invalid configuration of route '"+e+"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    ");if(Array.isArray(t))throw new Error("Invalid configuration of route '"+e+"': Array cannot be specified");if(!t.component&&!t.children&&!t.loadChildren&&t.outlet&&t.outlet!==lc)throw new Error("Invalid configuration of route '"+e+"': a componentless route without children or loadChildren cannot have a named outlet set");if(t.redirectTo&&t.children)throw new Error("Invalid configuration of route '"+e+"': redirectTo and children cannot be used together");if(t.redirectTo&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': redirectTo and loadChildren cannot be used together");if(t.children&&t.loadChildren)throw new Error("Invalid configuration of route '"+e+"': children and loadChildren cannot be used together");if(t.redirectTo&&t.component)throw new Error("Invalid configuration of route '"+e+"': redirectTo and component cannot be used together");if(t.path&&t.matcher)throw new Error("Invalid configuration of route '"+e+"': path and matcher cannot be used together");if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error("Invalid configuration of route '"+e+"'. One of the following must be provided: component, redirectTo, children or loadChildren");if(void 0===t.path&&void 0===t.matcher)throw new Error("Invalid configuration of route '"+e+"': routes must have either a path or a matcher specified");if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error("Invalid configuration of route '"+e+"': path cannot start with a slash");if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch)throw new Error("Invalid configuration of route '{path: \""+e+'", redirectTo: "'+t.redirectTo+"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.");if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error("Invalid configuration of route '"+e+"': pathMatch can only be set to 'prefix' or 'full'");t.children&&vc(t.children,e)}function yc(t,e){return e?t||e.path?t&&!e.path?t+"/":!t&&e.path?e.path:t+"/"+e.path:"":t}function bc(t){var e=t.children&&t.children.map(bc),n=e?s({},t,{children:e}):s({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==lc&&(n.component=uc),n}function wc(t,e){var n,r=Object.keys(t),o=Object.keys(e);if(!r||!o||r.length!=o.length)return!1;for(var i=0;i<r.length;i++)if(t[n=r[i]]!==e[n])return!1;return!0}function xc(t){return Array.prototype.concat.apply([],t)}function Cc(t){return t.length>0?t[t.length-1]:null}function Ec(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Sc(t){return $e(t)?t:Ke(t)?ot(Promise.resolve(t)):Gs(t)}function kc(t,e,n){return n?function(t,e){return wc(t,e)}(t.queryParams,e.queryParams)&&function t(e,n){if(!Ac(e.segments,n.segments))return!1;if(e.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!e.children[r])return!1;if(!t(e.children[r],n.children[r]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(function(n){return e[n]===t[n]})}(t.queryParams,e.queryParams)&&function t(e,n){return function e(n,r,o){if(n.segments.length>o.length)return!!Ac(a=n.segments.slice(0,o.length),o)&&!r.hasChildren();if(n.segments.length===o.length){if(!Ac(n.segments,o))return!1;for(var i in r.children){if(!n.children[i])return!1;if(!t(n.children[i],r.children[i]))return!1}return!0}var a=o.slice(0,n.segments.length),s=o.slice(n.segments.length);return!!Ac(n.segments,a)&&!!n.children[lc]&&e(n.children[lc],r,s)}(e,n,n.segments)}(t.root,e.root)}var Nc=function(){function t(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}return Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=pc(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return Oc.serialize(this)},t}(),Ic=function(){function t(t,e){var n=this;this.segments=t,this.children=e,this.parent=null,Ec(e,function(t,e){return t.parent=n})}return t.prototype.hasChildren=function(){return this.numberOfChildren>0},Object.defineProperty(t.prototype,"numberOfChildren",{get:function(){return Object.keys(this.children).length},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return Mc(this)},t}(),Rc=function(){function t(t,e){this.path=t,this.parameters=e}return Object.defineProperty(t.prototype,"parameterMap",{get:function(){return this._parameterMap||(this._parameterMap=pc(this.parameters)),this._parameterMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return Uc(this)},t}();function Ac(t,e){return t.length===e.length&&t.every(function(t,n){return t.path===e[n].path})}function Tc(t,e){var n=[];return Ec(t.children,function(t,r){r===lc&&(n=n.concat(e(t,r)))}),Ec(t.children,function(t,r){r!==lc&&(n=n.concat(e(t,r)))}),n}var _c=function(){return function(){}}(),Dc=function(){function t(){}return t.prototype.parse=function(t){var e=new Gc(t);return new Nc(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())},t.prototype.serialize=function(t){var e,n;return"/"+function t(e,n){if(!e.hasChildren())return Mc(e);if(n){var r=e.children[lc]?t(e.children[lc],!1):"",o=[];return Ec(e.children,function(e,n){n!==lc&&o.push(n+":"+t(e,!1))}),o.length>0?r+"("+o.join("//")+")":r}var i=Tc(e,function(n,r){return r===lc?[t(e.children[lc],!1)]:[r+":"+t(n,!1)]});return Mc(e)+"/("+i.join("//")+")"}(t.root,!0)+(e=t.queryParams,(n=Object.keys(e).map(function(t){var n=e[t];return Array.isArray(n)?n.map(function(e){return Pc(t)+"="+Pc(e)}).join("&"):Pc(t)+"="+Pc(n)})).length?"?"+n.join("&"):"")+("string"==typeof t.fragment?"#"+encodeURI(t.fragment):"")},t}(),Oc=new Dc;function Mc(t){return t.segments.map(function(t){return Uc(t)}).join("/")}function Fc(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Pc(t){return Fc(t).replace(/%3B/gi,";")}function Lc(t){return Fc(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Bc(t){return decodeURIComponent(t)}function zc(t){return Bc(t.replace(/\+/g,"%20"))}function Uc(t){return""+Lc(t.path)+(e=t.parameters,Object.keys(e).map(function(t){return";"+Lc(t)+"="+Lc(e[t])}).join(""));var e}var Vc=/^[^\/()?;=#]+/;function Wc(t){var e=t.match(Vc);return e?e[0]:""}var jc=/^[^=?&#]+/,Hc=/^[^?&#]+/,Gc=function(){function t(t){this.url=t,this.remaining=t}return t.prototype.parseRootSegment=function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ic([],{}):new Ic([],this.parseChildren())},t.prototype.parseQueryParams=function(){var t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t},t.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},t.prototype.parseChildren=function(){if(""===this.remaining)return{};this.consumeOptional("/");var t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());var e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n[lc]=new Ic(t,e)),n},t.prototype.parseSegment=function(){var t=Wc(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(t),new Rc(Bc(t),this.parseMatrixParams())},t.prototype.parseMatrixParams=function(){for(var t={};this.consumeOptional(";");)this.parseParam(t);return t},t.prototype.parseParam=function(t){var e=Wc(this.remaining);if(e){this.capture(e);var n="";if(this.consumeOptional("=")){var r=Wc(this.remaining);r&&this.capture(n=r)}t[Bc(e)]=Bc(n)}},t.prototype.parseQueryParam=function(t){var e,n=(e=this.remaining.match(jc))?e[0]:"";if(n){this.capture(n);var r="";if(this.consumeOptional("=")){var o=function(t){var e=t.match(Hc);return e?e[0]:""}(this.remaining);o&&this.capture(r=o)}var i=zc(n),a=zc(r);if(t.hasOwnProperty(i)){var s=t[i];Array.isArray(s)||(t[i]=s=[s]),s.push(a)}else t[i]=a}},t.prototype.parseParens=function(t){var e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Wc(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '"+this.url+"'");var o=void 0;n.indexOf(":")>-1?(o=n.substr(0,n.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=lc);var i=this.parseChildren();e[o]=1===Object.keys(i).length?i[lc]:new Ic([],i),this.consumeOptional("//")}return e},t.prototype.peekStartsWith=function(t){return this.remaining.startsWith(t)},t.prototype.consumeOptional=function(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)},t.prototype.capture=function(t){if(!this.consumeOptional(t))throw new Error('Expected "'+t+'".')},t}(),qc=function(){function t(t){this._root=t}return Object.defineProperty(t.prototype,"root",{get:function(){return this._root.value},enumerable:!0,configurable:!0}),t.prototype.parent=function(t){var e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null},t.prototype.children=function(t){var e=Kc(t,this._root);return e?e.children.map(function(t){return t.value}):[]},t.prototype.firstChild=function(t){var e=Kc(t,this._root);return e&&e.children.length>0?e.children[0].value:null},t.prototype.siblings=function(t){var e=$c(t,this._root);return e.length<2?[]:e[e.length-2].children.map(function(t){return t.value}).filter(function(e){return e!==t})},t.prototype.pathFromRoot=function(t){return $c(t,this._root).map(function(t){return t.value})},t}();function Kc(t,e){var n,r;if(t===e.value)return e;try{for(var o=h(e.children),i=o.next();!i.done;i=o.next()){var a=Kc(t,i.value);if(a)return a}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return null}function $c(t,e){var n,r;if(t===e.value)return[e];try{for(var o=h(e.children),i=o.next();!i.done;i=o.next()){var a=$c(t,i.value);if(a.length)return a.unshift(e),a}}catch(s){n={error:s}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return[]}var Xc=function(){function t(t,e){this.value=t,this.children=e}return t.prototype.toString=function(){return"TreeNode("+this.value+")"},t}();function Yc(t){var e={};return t&&t.children.forEach(function(t){return e[t.value.outlet]=t}),e}var Qc=function(t){function e(e,n){var r=t.call(this,e)||this;return r.snapshot=n,rp(r,e),r}return a(e,t),e.prototype.toString=function(){return this.snapshot.toString()},e}(qc);function Zc(t,e){var n=function(t,e){var n=new ep([],{},{},"",{},lc,e,null,t.root,-1,{});return new np("",new Xc(n,[]))}(t,e),r=new qs([new Rc("",{})]),o=new qs({}),i=new qs({}),a=new qs({}),s=new qs(""),u=new Jc(r,o,a,s,i,lc,e,n.root);return u.snapshot=n.root,new Qc(new Xc(u,[]),n)}var Jc=function(){function t(t,e,n,r,o,i,a,s){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=i,this.component=a,this._futureSnapshot=s}return Object.defineProperty(t.prototype,"routeConfig",{get:function(){return this._futureSnapshot.routeConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=this.params.pipe(tt(function(t){return pc(t)}))),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(tt(function(t){return pc(t)}))),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.snapshot?this.snapshot.toString():"Future("+this._futureSnapshot+")"},t}();function tp(t,e){void 0===e&&(e="emptyOnly");var n=t.pathFromRoot,r=0;if("always"!==e)for(r=n.length-1;r>=1;){var o=n[r],i=n[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(i.component)break;r--}}return function(t){return t.reduce(function(t,e){return{params:s({},t.params,e.params),data:s({},t.data,e.data),resolve:s({},t.resolve,e._resolvedData)}},{params:{},data:{},resolve:{}})}(n.slice(r))}var ep=function(){function t(t,e,n,r,o,i,a,s,u,l,c){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=o,this.outlet=i,this.component=a,this.routeConfig=s,this._urlSegment=u,this._lastPathIndex=l,this._resolve=c}return Object.defineProperty(t.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=pc(this.params)),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=pc(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"Route(url:'"+this.url.map(function(t){return t.toString()}).join("/")+"', path:'"+(this.routeConfig?this.routeConfig.path:"")+"')"},t}(),np=function(t){function e(e,n){var r=t.call(this,n)||this;return r.url=e,rp(r,n),r}return a(e,t),e.prototype.toString=function(){return op(this._root)},e}(qc);function rp(t,e){e.value._routerState=t,e.children.forEach(function(e){return rp(t,e)})}function op(t){var e=t.children.length>0?" { "+t.children.map(op).join(", ")+" } ":"";return""+t.value+e}function ip(t){if(t.snapshot){var e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,wc(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),wc(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!wc(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),wc(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function ap(t,e){var n,r;return wc(t.params,e.params)&&Ac(n=t.url,r=e.url)&&n.every(function(t,e){return wc(t.parameters,r[e].parameters)})&&!(!t.parent!=!e.parent)&&(!t.parent||ap(t.parent,e.parent))}function sp(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function up(t,e,n,r,o){var i={};return r&&Ec(r,function(t,e){i[e]=Array.isArray(t)?t.map(function(t){return""+t}):""+t}),new Nc(n.root===t?e:function t(e,n,r){var o={};return Ec(e.children,function(e,i){o[i]=e===n?r:t(e,n,r)}),new Ic(e.segments,o)}(n.root,t,e),i,o)}var lp=function(){function t(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&sp(n[0]))throw new Error("Root segment cannot have matrix parameters");var r=n.find(function(t){return"object"==typeof t&&null!=t&&t.outlets});if(r&&r!==Cc(n))throw new Error("{outlets:{}} has to be the last command")}return t.prototype.toRoot=function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]},t}(),cp=function(){return function(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}}();function pp(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets[lc]:""+t}function hp(t,e,n){if(t||(t=new Ic([],{})),0===t.segments.length&&t.hasChildren())return fp(t,e,n);var r=function(t,e,n){for(var r=0,o=e,i={match:!1,pathIndex:0,commandIndex:0};o<t.segments.length;){if(r>=n.length)return i;var a=t.segments[o],s=pp(n[r]),u=r<n.length-1?n[r+1]:null;if(o>0&&void 0===s)break;if(s&&u&&"object"==typeof u&&void 0===u.outlets){if(!gp(s,u,a))return i;r+=2}else{if(!gp(s,{},a))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(t,e,n),o=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){var i=new Ic(t.segments.slice(0,r.pathIndex),{});return i.children[lc]=new Ic(t.segments.slice(r.pathIndex),t.children),fp(i,0,o)}return r.match&&0===o.length?new Ic(t.segments,{}):r.match&&!t.hasChildren()?dp(t,e,n):r.match?fp(t,0,o):dp(t,e,n)}function fp(t,e,n){if(0===n.length)return new Ic(t.segments,{});var r=function(t){var e,n;return"object"!=typeof t[0]?((e={})[lc]=t,e):void 0===t[0].outlets?((n={})[lc]=t,n):t[0].outlets}(n),o={};return Ec(r,function(n,r){null!==n&&(o[r]=hp(t.children[r],e,n))}),Ec(t.children,function(t,e){void 0===r[e]&&(o[e]=t)}),new Ic(t.segments,o)}function dp(t,e,n){for(var r=t.segments.slice(0,e),o=0;o<n.length;){if("object"==typeof n[o]&&void 0!==n[o].outlets){var i=mp(n[o].outlets);return new Ic(r,i)}if(0===o&&sp(n[0]))r.push(new Rc(t.segments[e].path,n[0])),o++;else{var a=pp(n[o]),s=o<n.length-1?n[o+1]:null;a&&s&&sp(s)?(r.push(new Rc(a,vp(s))),o+=2):(r.push(new Rc(a,{})),o++)}}return new Ic(r,{})}function mp(t){var e={};return Ec(t,function(t,n){null!==t&&(e[n]=dp(new Ic([],{}),0,t))}),e}function vp(t){var e={};return Ec(t,function(t,n){return e[n]=""+t}),e}function gp(t,e,n){return t==n.path&&wc(e,n.parameters)}var yp=function(){function t(t,e,n,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=r}return t.prototype.activate=function(t){var e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),ip(this.futureState.root),this.activateChildRoutes(e,n,t)},t.prototype.deactivateChildRoutes=function(t,e,n){var r=this,o=Yc(e);t.children.forEach(function(t){var e=t.value.outlet;r.deactivateRoutes(t,o[e],n),delete o[e]}),Ec(o,function(t,e){r.deactivateRouteAndItsChildren(t,n)})},t.prototype.deactivateRoutes=function(t,e,n){var r=t.value,o=e?e.value:null;if(r===o)if(r.component){var i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,n);else o&&this.deactivateRouteAndItsChildren(e,n)},t.prototype.deactivateRouteAndItsChildren=function(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)},t.prototype.detachAndStoreRouteSubtree=function(t,e){var n=e.getContext(t.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),o=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:r,route:t,contexts:o})}},t.prototype.deactivateRouteAndOutlet=function(t,e){var n=this,r=e.getContext(t.value.outlet);if(r){var o=Yc(t),i=t.value.component?r.children:e;Ec(o,function(t,e){return n.deactivateRouteAndItsChildren(t,i)}),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}},t.prototype.activateChildRoutes=function(t,e,n){var r=this,o=Yc(e);t.children.forEach(function(t){r.activateRoutes(t,o[t.value.outlet],n),r.forwardEvent(new ac(t.value.snapshot))}),t.children.length&&this.forwardEvent(new oc(t.value.snapshot))},t.prototype.activateRoutes=function(t,e,n){var r=t.value,o=e?e.value:null;if(ip(r),r===o)if(r.component){var i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,n);else if(r.component)if(i=n.getOrCreateContext(r.outlet),this.routeReuseStrategy.shouldAttach(r.snapshot)){var a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),i.children.onOutletReAttached(a.contexts),i.attachRef=a.componentRef,i.route=a.route.value,i.outlet&&i.outlet.attach(a.componentRef,a.route.value),bp(a.route)}else{var s=function(t){for(var e=r.snapshot.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(),u=s?s.module.componentFactoryResolver:null;i.attachRef=null,i.route=r,i.resolver=u,i.outlet&&i.outlet.activateWith(r,u),this.activateChildRoutes(t,null,i.children)}else this.activateChildRoutes(t,null,n)},t}();function bp(t){ip(t.value),t.children.forEach(bp)}function wp(t){return"function"==typeof t}function xp(t){return t instanceof Nc}var Cp=function(){return function(t){this.segmentGroup=t||null}}(),Ep=function(){return function(t){this.urlTree=t}}();function Sp(t){return new O(function(e){return e.error(new Cp(t))})}function kp(t){return new O(function(e){return e.error(new Ep(t))})}function Np(t){return new O(function(e){return e.error(new Error("Only absolute redirects can have named outlets. redirectTo: '"+t+"'"))})}var Ip=function(){function t(t,e,n,r,o){this.configLoader=e,this.urlSerializer=n,this.urlTree=r,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(fn)}return t.prototype.apply=function(){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,lc).pipe(tt(function(e){return t.createUrlTree(e,t.urlTree.queryParams,t.urlTree.fragment)})).pipe(gu(function(e){if(e instanceof Ep)return t.allowRedirects=!1,t.match(e.urlTree);if(e instanceof Cp)throw t.noMatchError(e);throw e}))},t.prototype.match=function(t){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,t.root,lc).pipe(tt(function(n){return e.createUrlTree(n,t.queryParams,t.fragment)})).pipe(gu(function(t){if(t instanceof Cp)throw e.noMatchError(t);throw t}))},t.prototype.noMatchError=function(t){return new Error("Cannot match any routes. URL Segment: '"+t.segmentGroup+"'")},t.prototype.createUrlTree=function(t,e,n){var r,o=t.segments.length>0?new Ic([],((r={})[lc]=t,r)):t;return new Nc(o,e,n)},t.prototype.expandSegmentGroup=function(t,e,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,e,n).pipe(tt(function(t){return new Ic([],t)})):this.expandSegment(t,n,e,n.segments,r,!0)},t.prototype.expandChildren=function(t,e,n){var r=this;return function(n,o){if(0===Object.keys(n).length)return Gs({});var i=[],a=[],s={};return Ec(n,function(n,o){var u,l,c=(u=o,l=n,r.expandSegmentGroup(t,e,l,u)).pipe(tt(function(t){return s[o]=t}));o===lc?i.push(c):a.push(c)}),Gs.apply(null,i.concat(a)).pipe(Js(),vu(),tt(function(){return s}))}(n.children)},t.prototype.expandSegment=function(t,e,n,r,o,i){var a=this;return Gs.apply(void 0,d(n)).pipe(tt(function(s){return a.expandSegmentAgainstRoute(t,e,n,s,r,o,i).pipe(gu(function(t){if(t instanceof Cp)return Gs(null);throw t}))}),Js(),Eu(function(t){return!!t}),gu(function(t,n){if(t instanceof $s||"EmptyError"===t.name){if(a.noLeftoversInUrl(e,r,o))return Gs(new Ic([],{}));throw new Cp(e)}throw t}))},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.expandSegmentAgainstRoute=function(t,e,n,r,o,i,a){return _p(r)!==i?Sp(e):void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,r,o,i):Sp(e)},t.prototype.expandSegmentAgainstRouteUsingRedirect=function(t,e,n,r,o,i){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,i):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,o,i)},t.prototype.expandWildCardWithParamsAgainstRouteUsingRedirect=function(t,e,n,r){var o=this,i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?kp(i):this.lineralizeSegments(n,i).pipe(it(function(n){var i=new Ic(n,{});return o.expandSegment(t,i,e,n,r,!1)}))},t.prototype.expandRegularSegmentAgainstRouteUsingRedirect=function(t,e,n,r,o,i){var a=this,s=Rp(e,r,o),u=s.consumedSegments,l=s.lastChild,c=s.positionalParamSegments;if(!s.matched)return Sp(e);var p=this.applyRedirectCommands(u,r.redirectTo,c);return r.redirectTo.startsWith("/")?kp(p):this.lineralizeSegments(r,p).pipe(it(function(r){return a.expandSegment(t,e,n,r.concat(o.slice(l)),i,!1)}))},t.prototype.matchSegmentAgainstRoute=function(t,e,n,r){var o=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(t.injector,n).pipe(tt(function(t){return n._loadedConfig=t,new Ic(r,{})})):Gs(new Ic(r,{}));var i=Rp(e,n,r),a=i.consumedSegments,u=i.lastChild;if(!i.matched)return Sp(e);var l=r.slice(u);return this.getChildConfig(t,n,r).pipe(it(function(t){var n=t.module,r=t.routes,i=function(t,e,n,r){return n.length>0&&function(t,e,n){return r.some(function(n){return Tp(t,e,n)&&_p(n)!==lc})}(t,n)?{segmentGroup:Ap(new Ic(e,function(t,e){var n,r,o={};o[lc]=e;try{for(var i=h(t),a=i.next();!a.done;a=i.next()){var s=a.value;""===s.path&&_p(s)!==lc&&(o[_p(s)]=new Ic([],{}))}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}(r,new Ic(n,t.children)))),slicedSegments:[]}:0===n.length&&function(t,e,n){return r.some(function(n){return Tp(t,e,n)})}(t,n)?{segmentGroup:Ap(new Ic(t.segments,function(t,e,n,r){var o,i,a={};try{for(var u=h(n),l=u.next();!l.done;l=u.next()){var c=l.value;Tp(t,e,c)&&!r[_p(c)]&&(a[_p(c)]=new Ic([],{}))}}catch(p){o={error:p}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}return s({},r,a)}(t,n,r,t.children))),slicedSegments:n}:{segmentGroup:t,slicedSegments:n}}(e,a,l,r),u=i.segmentGroup,c=i.slicedSegments;return 0===c.length&&u.hasChildren()?o.expandChildren(n,r,u).pipe(tt(function(t){return new Ic(a,t)})):0===r.length&&0===c.length?Gs(new Ic(a,{})):o.expandSegment(n,u,r,c,lc,!0).pipe(tt(function(t){return new Ic(a.concat(t.segments),t.children)}))}))},t.prototype.getChildConfig=function(t,e,n){var r=this;return e.children?Gs(new mc(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?Gs(e._loadedConfig):function(t,e,n){var r,o=e.canLoad;return o&&0!==o.length?ot(o).pipe(tt(function(r){var o,i=t.get(r);if(function(t){return t&&wp(t.canLoad)}(i))o=i.canLoad(e,n);else{if(!wp(i))throw new Error("Invalid CanLoad guard");o=i(e,n)}return Sc(o)})).pipe(Js(),(r=function(t){return!0===t},function(t){return t.lift(new Su(r,void 0,t))})):Gs(!0)}(t.injector,e,n).pipe(it(function(n){return n?r.configLoader.load(t.injector,e).pipe(tt(function(t){return e._loadedConfig=t,t})):function(t){return new O(function(e){return e.error(fc("Cannot load children because the guard of the route \"path: '"+t.path+"'\" returned false"))})}(e)})):Gs(new mc([],t))},t.prototype.lineralizeSegments=function(t,e){for(var n=[],r=e.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Gs(n);if(r.numberOfChildren>1||!r.children[lc])return Np(t.redirectTo);r=r.children[lc]}},t.prototype.applyRedirectCommands=function(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)},t.prototype.applyRedirectCreatreUrlTree=function(t,e,n,r){var o=this.createSegmentGroup(t,e.root,n,r);return new Nc(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)},t.prototype.createQueryParams=function(t,e){var n={};return Ec(t,function(t,r){if("string"==typeof t&&t.startsWith(":")){var o=t.substring(1);n[r]=e[o]}else n[r]=t}),n},t.prototype.createSegmentGroup=function(t,e,n,r){var o=this,i=this.createSegments(t,e.segments,n,r),a={};return Ec(e.children,function(e,i){a[i]=o.createSegmentGroup(t,e,n,r)}),new Ic(i,a)},t.prototype.createSegments=function(t,e,n,r){var o=this;return e.map(function(e){return e.path.startsWith(":")?o.findPosParam(t,e,r):o.findOrReturn(e,n)})},t.prototype.findPosParam=function(t,e,n){var r=n[e.path.substring(1)];if(!r)throw new Error("Cannot redirect to '"+t+"'. Cannot find '"+e.path+"'.");return r},t.prototype.findOrReturn=function(t,e){var n,r,o=0;try{for(var i=h(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.path===t.path)return e.splice(o),s;o++}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},t}();function Rp(t,e,n){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(e.matcher||dc)(n,t,e);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Ap(t){if(1===t.numberOfChildren&&t.children[lc]){var e=t.children[lc];return new Ic(t.segments.concat(e.segments),e.children)}return t}function Tp(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function _p(t){return t.outlet||lc}var Dp=function(){return function(t){this.path=t,this.route=this.path[this.path.length-1]}}(),Op=function(){return function(t,e){this.component=t,this.route=e}}();function Mp(t,e,n){var r=function(t){if(!t)return null;for(var e=t.parent;e;e=e.parent){var n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(r?r.module.injector:n).get(t)}function Fp(t,e,n,r,o){void 0===o&&(o={canDeactivateChecks:[],canActivateChecks:[]});var i=Yc(e);return t.children.forEach(function(t){!function(t,e,n,r,o){void 0===o&&(o={canDeactivateChecks:[],canActivateChecks:[]});var i=t.value,a=e?e.value:null,s=n?n.getContext(t.value.outlet):null;if(a&&i.routeConfig===a.routeConfig){var u=function(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!Ac(t.url,e.url);case"pathParamsOrQueryParamsChange":return!Ac(t.url,e.url)||!wc(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ap(t,e)||!wc(t.queryParams,e.queryParams);case"paramsChange":default:return!ap(t,e)}}(a,i,i.routeConfig.runGuardsAndResolvers);u?o.canActivateChecks.push(new Dp(r)):(i.data=a.data,i._resolvedData=a._resolvedData),Fp(t,e,i.component?s?s.children:null:n,r,o),u&&o.canDeactivateChecks.push(new Op(s&&s.outlet&&s.outlet.component||null,a))}else a&&Pp(e,s,o),o.canActivateChecks.push(new Dp(r)),Fp(t,null,i.component?s?s.children:null:n,r,o)}(t,i[t.value.outlet],n,r.concat([t.value]),o),delete i[t.value.outlet]}),Ec(i,function(t,e){return Pp(t,n.getContext(e),o)}),o}function Pp(t,e,n){var r=Yc(t),o=t.value;Ec(r,function(t,r){Pp(t,o.component?e?e.children.getContext(r):null:e,n)}),n.canDeactivateChecks.push(new Op(o.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,o))}var Lp=Symbol("INITIAL_VALUE");function Bp(){return Nu(function(t){return(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null,r=null;return V(t[t.length-1])&&(r=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&m(t[0])&&(t=t[0]),rt(t,r).lift(new Ys(n))}).apply(void 0,d(t.map(function(t){return t.pipe(wu(1),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n=t[t.length-1];V(n)?t.pop():n=null;var r=t.length;return Au(1!==r||n?r>0?rt(t,n):js(n):Hs(t[0]),e)}}(Lp))}))).pipe(Tu(function(t,e){var n=!1;return e.reduce(function(t,r,o){if(t!==Lp)return t;if(r===Lp&&(n=!0),!n){if(!1===r)return r;if(o===e.length-1||xp(r))return r}return t},t)},Lp),tu(function(t){return t!==Lp}),tt(function(t){return xp(t)?t:!0===t}),wu(1))})}function zp(t,e){return null!==t&&e&&e(new ic(t)),Gs(!0)}function Up(t,e){return null!==t&&e&&e(new rc(t)),Gs(!0)}function Vp(t,e,n){var r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?Gs(r.map(function(r){return Zs(function(){var o,i=Mp(r,e,n);if(function(t){return t&&wp(t.canActivate)}(i))o=Sc(i.canActivate(e,t));else{if(!wp(i))throw new Error("Invalid CanActivate guard");o=Sc(i(e,t))}return o.pipe(Eu())})})).pipe(Bp()):Gs(!0)}function Wp(t,e,n){var r=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(function(t){return function(t){var e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(t)}).filter(function(t){return null!==t}).map(function(e){return Zs(function(){return Gs(e.guards.map(function(o){var i,a=Mp(o,e.node,n);if(function(t){return t&&wp(t.canActivateChild)}(a))i=Sc(a.canActivateChild(r,t));else{if(!wp(a))throw new Error("Invalid CanActivateChild guard");i=Sc(a(r,t))}return i.pipe(Eu())})).pipe(Bp())})});return Gs(o).pipe(Bp())}var jp=function(){return function(){}}(),Hp=function(){function t(t,e,n,r,o,i){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=i}return t.prototype.recognize=function(){try{var t=Kp(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,lc),n=new ep([],Object.freeze({}),Object.freeze(s({},this.urlTree.queryParams)),this.urlTree.fragment,{},lc,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Xc(n,e),o=new np(this.url,r);return this.inheritParamsAndData(o._root),Gs(o)}catch(Tz){return new O(function(e){return e.error(Tz)})}},t.prototype.inheritParamsAndData=function(t){var e=this,n=t.value,r=tp(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(function(t){return e.inheritParamsAndData(t)})},t.prototype.processSegmentGroup=function(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)},t.prototype.processChildren=function(t,e){var n,r=this,o=Tc(e,function(e,n){return r.processSegmentGroup(t,e,n)});return n={},o.forEach(function(t){var e=n[t.value.outlet];if(e){var r=e.url.map(function(t){return t.toString()}).join("/"),o=t.value.url.map(function(t){return t.toString()}).join("/");throw new Error("Two segments cannot have the same outlet name: '"+r+"' and '"+o+"'.")}n[t.value.outlet]=t.value}),o.sort(function(t,e){return t.value.outlet===lc?-1:e.value.outlet===lc?1:t.value.outlet.localeCompare(e.value.outlet)}),o},t.prototype.processSegment=function(t,e,n,r){var o,i;try{for(var a=h(t),s=a.next();!s.done;s=a.next()){var u=s.value;try{return this.processSegmentAgainstRoute(u,e,n,r)}catch(Tz){if(!(Tz instanceof jp))throw Tz}}}catch(l){o={error:l}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}if(this.noLeftoversInUrl(e,n,r))return[];throw new jp},t.prototype.noLeftoversInUrl=function(t,e,n){return 0===e.length&&!t.children[n]},t.prototype.processSegmentAgainstRoute=function(t,e,n,r){if(t.redirectTo)throw new jp;if((t.outlet||lc)!==r)throw new jp;var o,i=[],a=[];if("**"===t.path){var u=n.length>0?Cc(n).parameters:{};o=new ep(n,u,Object.freeze(s({},this.urlTree.queryParams)),this.urlTree.fragment,Yp(t),r,t.component,t,Gp(e),qp(e)+n.length,Qp(t))}else{var l=function(t,e,n){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||n.length>0))throw new jp;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(e.matcher||dc)(n,t,e);if(!r)throw new jp;var o={};Ec(r.posParams,function(t,e){o[e]=t.path});var i=r.consumed.length>0?s({},o,r.consumed[r.consumed.length-1].parameters):o;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:i}}(e,t,n);i=l.consumedSegments,a=n.slice(l.lastChild),o=new ep(i,l.parameters,Object.freeze(s({},this.urlTree.queryParams)),this.urlTree.fragment,Yp(t),r,t.component,t,Gp(e),qp(e)+i.length,Qp(t))}var c=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),p=Kp(e,i,a,c,this.relativeLinkResolution),h=p.segmentGroup,f=p.slicedSegments;if(0===f.length&&h.hasChildren()){var d=this.processChildren(c,h);return[new Xc(o,d)]}if(0===c.length&&0===f.length)return[new Xc(o,[])];var m=this.processSegment(c,h,f,lc);return[new Xc(o,m)]},t}();function Gp(t){for(var e=t;e._sourceSegment;)e=e._sourceSegment;return e}function qp(t){for(var e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;e._sourceSegment;)n+=(e=e._sourceSegment)._segmentIndexShift?e._segmentIndexShift:0;return n-1}function Kp(t,e,n,r,o){if(n.length>0&&function(t,e,n){return r.some(function(n){return $p(t,e,n)&&Xp(n)!==lc})}(t,n)){var i=new Ic(e,function(t,e,n,r){var o,i,a={};a[lc]=r,r._sourceSegment=t,r._segmentIndexShift=e.length;try{for(var s=h(n),u=s.next();!u.done;u=s.next()){var l=u.value;if(""===l.path&&Xp(l)!==lc){var c=new Ic([],{});c._sourceSegment=t,c._segmentIndexShift=e.length,a[Xp(l)]=c}}}catch(p){o={error:p}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return a}(t,e,r,new Ic(n,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return r.some(function(n){return $p(t,e,n)})}(t,n)){var a=new Ic(t.segments,function(t,e,n,r,o,i){var a,u,l={};try{for(var c=h(r),p=c.next();!p.done;p=c.next()){var f=p.value;if($p(t,n,f)&&!o[Xp(f)]){var d=new Ic([],{});d._sourceSegment=t,d._segmentIndexShift="legacy"===i?t.segments.length:e.length,l[Xp(f)]=d}}}catch(m){a={error:m}}finally{try{p&&!p.done&&(u=c.return)&&u.call(c)}finally{if(a)throw a.error}}return s({},o,l)}(t,e,n,r,t.children,o));return a._sourceSegment=t,a._segmentIndexShift=e.length,{segmentGroup:a,slicedSegments:n}}var u=new Ic(t.segments,t.children);return u._sourceSegment=t,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:n}}function $p(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function Xp(t){return t.outlet||lc}function Yp(t){return t.data||{}}function Qp(t){return t.resolve||{}}function Zp(t,e,n,r){var o=Mp(t,e,r);return Sc(o.resolve?o.resolve(e,n):o(e,n))}function Jp(t){return function(e){return e.pipe(Nu(function(e){var n=t(e);return n?ot(n).pipe(tt(function(){return e})):ot([e])}))}}var th=function(){return function(){}}(),eh=function(){function t(){}return t.prototype.shouldDetach=function(t){return!1},t.prototype.store=function(t,e){},t.prototype.shouldAttach=function(t){return!1},t.prototype.retrieve=function(t){return null},t.prototype.shouldReuseRoute=function(t,e){return t.routeConfig===e.routeConfig},t}(),nh=new Ht("ROUTES"),rh=function(){function t(t,e,n,r){this.loader=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=r}return t.prototype.load=function(t,e){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(e),this.loadModuleFactory(e.loadChildren).pipe(tt(function(r){n.onLoadEndListener&&n.onLoadEndListener(e);var o=r.create(t);return new mc(xc(o.injector.get(nh)).map(bc),o)}))},t.prototype.loadModuleFactory=function(t){var e=this;return"string"==typeof t?ot(this.loader.load(t)):Sc(t()).pipe(it(function(t){return t instanceof dn?Gs(t):ot(e.compiler.compileModuleAsync(t))}))},t}(),oh=function(){return function(){}}(),ih=function(){function t(){}return t.prototype.shouldProcessUrl=function(t){return!0},t.prototype.extract=function(t){return t},t.prototype.merge=function(t,e){return t},t}();function ah(t){throw t}function sh(t,e,n){return e.parse("/")}function uh(t,e){return Gs(null)}var lh=function(){function t(t,e,n,r,o,i,a,s){var u=this;this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=n,this.location=r,this.config=s,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new z,this.errorHandler=ah,this.malformedUriErrorHandler=sh,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:uh,afterPreactivation:uh},this.urlHandlingStrategy=new ih,this.routeReuseStrategy=new eh,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=o.get(fn),this.console=o.get(qo);var l=o.get(li);this.isNgZoneEnabled=l instanceof li,this.resetConfig(s),this.currentUrlTree=new Nc(new Ic([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new rh(i,a,function(t){return u.triggerEvent(new ec(t))},function(t){return u.triggerEvent(new nc(t))}),this.routerState=Zc(this.currentUrlTree,this.rootComponentType),this.transitions=new qs({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return t.prototype.setupNavigations=function(t){var e=this,n=this.events;return t.pipe(tu(function(t){return 0!==t.id}),tt(function(t){return s({},t,{extractedUrl:e.urlHandlingStrategy.extract(t.rawUrl)})}),Nu(function(t){var r,o,i,a,u=!1,l=!1;return Gs(t).pipe(uu(function(t){e.currentNavigation={id:t.id,initialUrl:t.currentRawUrl,extractedUrl:t.extractedUrl,trigger:t.source,extras:t.extras,previousNavigation:e.lastSuccessfulNavigation?s({},e.lastSuccessfulNavigation,{previousNavigation:null}):null}}),Nu(function(t){var r,o,i,a,u=!e.navigated||t.extractedUrl.toString()!==e.browserUrlTree.toString();if(("reload"===e.onSameUrlNavigation||u)&&e.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return Gs(t).pipe(Nu(function(t){var r=e.transitions.getValue();return n.next(new ql(t.id,e.serializeUrl(t.extractedUrl),t.source,t.restoredState)),r!==e.transitions.getValue()?Ws:[t]}),Nu(function(t){return Promise.resolve(t)}),(r=e.ngModule.injector,o=e.configLoader,i=e.urlSerializer,a=e.config,function(t){return t.pipe(Nu(function(t){return function(e,n,r,o,i){return new Ip(e,n,r,t.extractedUrl,i).apply()}(r,o,i,0,a).pipe(tt(function(e){return s({},t,{urlAfterRedirects:e})}))}))}),uu(function(t){e.currentNavigation=s({},e.currentNavigation,{finalUrl:t.urlAfterRedirects})}),function(t,n,r,o,i){return function(r){return r.pipe(it(function(r){return function(t,e,n,r,o,i){return void 0===o&&(o="emptyOnly"),void 0===i&&(i="legacy"),new Hp(t,e,n,r,o,i).recognize()}(t,n,r.urlAfterRedirects,(a=r.urlAfterRedirects,e.serializeUrl(a)),o,i).pipe(tt(function(t){return s({},r,{targetSnapshot:t})}));var a}))}}(e.rootComponentType,e.config,0,e.paramsInheritanceStrategy,e.relativeLinkResolution),uu(function(t){"eager"===e.urlUpdateStrategy&&(t.extras.skipLocationChange||e.setBrowserUrl(t.urlAfterRedirects,!!t.extras.replaceUrl,t.id,t.extras.state),e.browserUrlTree=t.urlAfterRedirects)}),uu(function(t){var r=new Yl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);n.next(r)}));if(u&&e.rawUrlTree&&e.urlHandlingStrategy.shouldProcessUrl(e.rawUrlTree)){var l=t.extractedUrl,c=t.source,p=t.restoredState,h=t.extras,f=new ql(t.id,e.serializeUrl(l),c,p);n.next(f);var d=Zc(l,e.rootComponentType).snapshot;return Gs(s({},t,{targetSnapshot:d,urlAfterRedirects:l,extras:s({},h,{skipLocationChange:!1,replaceUrl:!1})}))}return e.rawUrlTree=t.rawUrl,e.browserUrlTree=t.urlAfterRedirects,t.resolve(null),Ws}),Jp(function(t){var n=t.extras;return e.hooks.beforePreactivation(t.targetSnapshot,{navigationId:t.id,appliedUrlTree:t.extractedUrl,rawUrlTree:t.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),uu(function(t){var n=new Ql(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}),tt(function(t){return s({},t,{guards:(n=t.targetSnapshot,r=t.currentSnapshot,o=e.rootContexts,i=n._root,Fp(i,r?r._root:null,o,[i.value]))});var n,r,o,i}),function(t,e){return function(n){return n.pipe(it(function(n){var r=n.targetSnapshot,o=n.currentSnapshot,i=n.guards,a=i.canActivateChecks,u=i.canDeactivateChecks;return 0===u.length&&0===a.length?Gs(s({},n,{guardsResult:!0})):function(t,e,n,r){return ot(u).pipe(it(function(t){return function(t,e,n,r,o){var i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return i&&0!==i.length?Gs(i.map(function(i){var a,s=Mp(i,e,o);if(function(t){return t&&wp(t.canDeactivate)}(s))a=Sc(s.canDeactivate(t,e,n,r));else{if(!wp(s))throw new Error("Invalid CanDeactivate guard");a=Sc(s(t,e,n,r))}return a.pipe(Eu())})).pipe(Bp()):Gs(!0)}(t.component,t.route,n,e,r)}),Eu(function(t){return!0!==t},!0))}(0,r,o,t).pipe(it(function(n){return n&&"boolean"==typeof n?function(t,e,n,r){return ot(a).pipe(Ou(function(e){return ot([Up(e.route.parent,r),zp(e.route,r),Wp(t,e.path,n),Vp(t,e.route,n)]).pipe(Js(),Eu(function(t){return!0!==t},!0))}),Eu(function(t){return!0!==t},!0))}(r,0,t,e):Gs(n)}),tt(function(t){return s({},n,{guardsResult:t})}))}))}}(e.ngModule.injector,function(t){return e.triggerEvent(t)}),uu(function(t){if(xp(t.guardsResult)){var n=fc('Redirecting to "'+e.serializeUrl(t.guardsResult)+'"');throw n.url=t.guardsResult,n}}),uu(function(t){var n=new Zl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);e.triggerEvent(n)}),tu(function(t){if(!t.guardsResult){e.resetUrlToCurrentUrlTree();var r=new $l(t.id,e.serializeUrl(t.extractedUrl),"");return n.next(r),t.resolve(!1),!1}return!0}),Jp(function(t){if(t.guards.canActivateChecks.length)return Gs(t).pipe(uu(function(t){var n=new Jl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}),(n=e.paramsInheritanceStrategy,r=e.ngModule.injector,function(t){return t.pipe(it(function(t){var e=t.targetSnapshot,o=t.guards.canActivateChecks;return o.length?ot(o).pipe(Ou(function(t){return function(t,n,r,o){return function(t,e,n,r){var o=Object.keys(t);if(0===o.length)return Gs({});if(1===o.length){var i=o[0];return Zp(t[i],e,n,r).pipe(tt(function(t){var e;return(e={})[i]=t,e}))}var a={};return ot(o).pipe(it(function(o){return Zp(t[o],e,n,r).pipe(tt(function(t){return a[o]=t,t}))})).pipe(vu(),tt(function(){return a}))}(t._resolve,t,e,o).pipe(tt(function(e){return t._resolvedData=e,t.data=s({},t.data,tp(t,r).resolve),null}))}(t.route,0,n,r)}),function(t,e){return arguments.length>=2?function(e){return _(Tu(t,void 0),iu(1),fu(void 0))(e)}:function(e){return _(Tu(function(e,n,r){return t(e)}),iu(1))(e)}}(function(t,e){return t}),tt(function(e){return t})):Gs(t)}))}),uu(function(t){var n=new tc(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.triggerEvent(n)}));var n,r}),Jp(function(t){var n=t.extras;return e.hooks.afterPreactivation(t.targetSnapshot,{navigationId:t.id,appliedUrlTree:t.extractedUrl,rawUrlTree:t.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),tt(function(t){var n,r,o,i=(o=function t(e,n,r){if(r&&e.shouldReuseRoute(n.value,r.value.snapshot)){(u=r.value)._futureSnapshot=n.value;var o=function(e,n,r){return n.children.map(function(n){var o,i;try{for(var a=h(r.children),s=a.next();!s.done;s=a.next()){var u=s.value;if(e.shouldReuseRoute(u.value.snapshot,n.value))return t(e,n,u)}}catch(l){o={error:l}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}return t(e,n)})}(e,n,r);return new Xc(u,o)}var i=e.retrieve(n.value);if(i){var a=i.route;return function t(e,n){if(e.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=e.value;for(var r=0;r<e.children.length;++r)t(e.children[r],n.children[r])}(n,a),a}var s,u=new Jc(new qs((s=n.value).url),new qs(s.params),new qs(s.queryParams),new qs(s.fragment),new qs(s.data),s.outlet,s.component,s);return o=n.children.map(function(n){return t(e,n)}),new Xc(u,o)}(e.routeReuseStrategy,(n=t.targetSnapshot)._root,(r=t.currentRouterState)?r._root:void 0),new Qc(o,n));return s({},t,{targetRouterState:i})}),uu(function(t){e.currentUrlTree=t.urlAfterRedirects,e.rawUrlTree=e.urlHandlingStrategy.merge(e.currentUrlTree,t.rawUrl),e.routerState=t.targetRouterState,"deferred"===e.urlUpdateStrategy&&(t.extras.skipLocationChange||e.setBrowserUrl(e.rawUrlTree,!!t.extras.replaceUrl,t.id,t.extras.state),e.browserUrlTree=t.urlAfterRedirects)}),(o=e.rootContexts,i=e.routeReuseStrategy,a=function(t){return e.triggerEvent(t)},tt(function(t){return new yp(i,t.targetRouterState,t.currentRouterState,a).activate(o),t})),uu({next:function(){u=!0},complete:function(){u=!0}}),(r=function(){if(!u&&!l){e.resetUrlToCurrentUrlTree();var r=new $l(t.id,e.serializeUrl(t.extractedUrl),"Navigation ID "+t.id+" is not equal to the current navigation id "+e.navigationId);n.next(r),t.resolve(!1)}e.currentNavigation=null},function(t){return t.lift(new Mu(r))}),gu(function(r){if(l=!0,(s=r)&&s[hc]){var o=xp(r.url);o||(e.navigated=!0,e.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl));var i=new $l(t.id,e.serializeUrl(t.extractedUrl),r.message);n.next(i),t.resolve(!1),o&&e.navigateByUrl(r.url)}else{e.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl);var a=new Xl(t.id,e.serializeUrl(t.extractedUrl),r);n.next(a);try{t.resolve(e.errorHandler(r))}catch(Ud){t.reject(Ud)}}var s;return Ws}))}))},t.prototype.resetRootComponentType=function(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType},t.prototype.getTransition=function(){var t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t},t.prototype.setTransition=function(t){this.transitions.next(s({},this.getTransition(),t))},t.prototype.initialNavigation=function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})},t.prototype.setUpLocationChangeListener=function(){var t=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(function(e){var n=t.parseUrl(e.url),r="popstate"===e.type?"popstate":"hashchange",o=e.state&&e.state.navigationId?e.state:null;setTimeout(function(){t.scheduleNavigation(n,r,o,{replaceUrl:!0})},0)}))},Object.defineProperty(t.prototype,"url",{get:function(){return this.serializeUrl(this.currentUrlTree)},enumerable:!0,configurable:!0}),t.prototype.getCurrentNavigation=function(){return this.currentNavigation},t.prototype.triggerEvent=function(t){this.events.next(t)},t.prototype.resetConfig=function(t){vc(t),this.config=t.map(bc),this.navigated=!1,this.lastSuccessfulId=-1},t.prototype.ngOnDestroy=function(){this.dispose()},t.prototype.dispose=function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)},t.prototype.createUrlTree=function(t,e){void 0===e&&(e={});var n=e.relativeTo,r=e.queryParams,o=e.fragment,i=e.preserveQueryParams,a=e.queryParamsHandling,u=e.preserveFragment;be()&&i&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var l=n||this.routerState.root,c=u?this.currentUrlTree.fragment:o,p=null;if(a)switch(a){case"merge":p=s({},this.currentUrlTree.queryParams,r);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=r||null}else p=i?this.currentUrlTree.queryParams:r||null;return null!==p&&(p=this.removeEmptyProps(p)),function(t,e,n,r,o){if(0===n.length)return up(e.root,e.root,e,r,o);var i=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new lp(!0,0,t);var e=0,n=!1,r=t.reduce(function(t,r,o){if("object"==typeof r&&null!=r){if(r.outlets){var i={};return Ec(r.outlets,function(t,e){i[e]="string"==typeof t?t.split("/"):t}),d(t,[{outlets:i}])}if(r.segmentPath)return d(t,[r.segmentPath])}return"string"!=typeof r?d(t,[r]):0===o?(r.split("/").forEach(function(r,o){0==o&&"."===r||(0==o&&""===r?n=!0:".."===r?e++:""!=r&&t.push(r))}),t):d(t,[r])},[]);return new lp(n,e,r)}(n);if(i.toRoot())return up(e.root,new Ic([],{}),e,r,o);var a=function(t,n,r){if(t.isAbsolute)return new cp(e.root,!0,0);if(-1===r.snapshot._lastPathIndex)return new cp(r.snapshot._urlSegment,!0,0);var o=sp(t.commands[0])?0:1;return function(e,n,i){for(var a=r.snapshot._urlSegment,s=r.snapshot._lastPathIndex+o,u=t.numberOfDoubleDots;u>s;){if(u-=s,!(a=a.parent))throw new Error("Invalid number of '../'");s=a.segments.length}return new cp(a,!1,s-u)}()}(i,0,t),s=a.processChildren?fp(a.segmentGroup,a.index,i.commands):hp(a.segmentGroup,a.index,i.commands);return up(a.segmentGroup,s,e,r,o)}(l,this.currentUrlTree,t,p,c)},t.prototype.navigateByUrl=function(t,e){void 0===e&&(e={skipLocationChange:!1}),be()&&this.isNgZoneEnabled&&!li.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=xp(t)?t:this.parseUrl(t),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,e)},t.prototype.navigate=function(t,e){return void 0===e&&(e={skipLocationChange:!1}),function(t){for(var e=0;e<t.length;e++){var n=t[e];if(null==n)throw new Error("The requested path contains "+n+" segment at index "+e)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)},t.prototype.serializeUrl=function(t){return this.urlSerializer.serialize(t)},t.prototype.parseUrl=function(t){var e;try{e=this.urlSerializer.parse(t)}catch(Tz){e=this.malformedUriErrorHandler(Tz,this.urlSerializer,t)}return e},t.prototype.isActive=function(t,e){if(xp(t))return kc(this.currentUrlTree,t,e);var n=this.parseUrl(t);return kc(this.currentUrlTree,n,e)},t.prototype.removeEmptyProps=function(t){return Object.keys(t).reduce(function(e,n){var r=t[n];return null!=r&&(e[n]=r),e},{})},t.prototype.processNavigations=function(){var t=this;this.navigations.subscribe(function(e){t.navigated=!0,t.lastSuccessfulId=e.id,t.events.next(new Kl(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(t.currentUrlTree))),t.lastSuccessfulNavigation=t.currentNavigation,t.currentNavigation=null,e.resolve(!0)},function(e){t.console.warn("Unhandled Navigation Error: ")})},t.prototype.scheduleNavigation=function(t,e,n,r){var o=this.getTransition();if(o&&"imperative"!==e&&"imperative"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(o&&"hashchange"==e&&"popstate"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(o&&"popstate"==e&&"hashchange"===o.source&&o.rawUrl.toString()===t.toString())return Promise.resolve(!0);var i=null,a=null,s=new Promise(function(t,e){i=t,a=e}),u=++this.navigationId;return this.setTransition({id:u,source:e,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:r,resolve:i,reject:a,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch(function(t){return Promise.reject(t)})},t.prototype.setBrowserUrl=function(t,e,n,r){var o=this.urlSerializer.serialize(t);r=r||{},this.location.isCurrentPathEqualTo(o)||e?this.location.replaceState(o,"",s({},r,{navigationId:n})):this.location.go(o,"",s({},r,{navigationId:n}))},t.prototype.resetStateAndUrl=function(t,e,n){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()},t.prototype.resetUrlToCurrentUrlTree=function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})},t}(),ch=function(){function t(t,e,n){var r=this;this.router=t,this.route=e,this.locationStrategy=n,this.commands=[],this.subscription=t.events.subscribe(function(t){t instanceof Kl&&r.updateTargetUrlAndHref()})}return Object.defineProperty(t.prototype,"routerLink",{set:function(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveQueryParams",{set:function(t){be()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead."),this.preserve=t},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){this.updateTargetUrlAndHref()},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.onClick=function(t,e,n,r){if(0!==t||e||n||r)return!0;if("string"==typeof this.target&&"_self"!=this.target)return!0;var o={skipLocationChange:ph(this.skipLocationChange),replaceUrl:ph(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,o),!1},t.prototype.updateTargetUrlAndHref=function(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))},Object.defineProperty(t.prototype,"urlTree",{get:function(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:ph(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:ph(this.preserveFragment)})},enumerable:!0,configurable:!0}),u([Lo("attr.target"),Po(),l("design:type",String)],t.prototype,"target",void 0),t}();function ph(t){return""===t||!!t}var hh=function(){return function(){this.outlet=null,this.route=null,this.resolver=null,this.children=new fh,this.attachRef=null}}(),fh=function(){function t(){this.contexts=new Map}return t.prototype.onChildOutletCreated=function(t,e){var n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)},t.prototype.onChildOutletDestroyed=function(t){var e=this.getContext(t);e&&(e.outlet=null)},t.prototype.onOutletDeactivated=function(){var t=this.contexts;return this.contexts=new Map,t},t.prototype.onOutletReAttached=function(t){this.contexts=t},t.prototype.getOrCreateContext=function(t){var e=this.getContext(t);return e||(e=new hh,this.contexts.set(t,e)),e},t.prototype.getContext=function(t){return this.contexts.get(t)||null},t}(),dh=function(){function t(t,e,n,r,o){this.parentContexts=t,this.location=e,this.resolver=n,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new Oo,this.deactivateEvents=new Oo,this.name=r||lc,t.onChildOutletCreated(this.name,this)}return t.prototype.ngOnDestroy=function(){this.parentContexts.onChildOutletDestroyed(this.name)},t.prototype.ngOnInit=function(){if(!this.activated){var t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}},Object.defineProperty(t.prototype,"isActivated",{get:function(){return!!this.activated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRoute",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activatedRouteData",{get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}},enumerable:!0,configurable:!0}),t.prototype.detach=function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var t=this.activated;return this.activated=null,this._activatedRoute=null,t},t.prototype.attach=function(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)},t.prototype.deactivate=function(){if(this.activated){var t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}},t.prototype.activateWith=function(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;var n=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,o=new mh(t,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,o),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)},t}(),mh=function(){function t(t,e,n){this.route=t,this.childContexts=e,this.parent=n}return t.prototype.get=function(t,e){return t===Jc?this.route:t===fh?this.childContexts:this.parent.get(t,e)},t}(),vh=function(){return function(){}}(),gh=function(){function t(){}return t.prototype.preload=function(t,e){return e().pipe(gu(function(){return Gs(null)}))},t}(),yh=function(){function t(){}return t.prototype.preload=function(t,e){return Gs(null)},t}(),bh=function(){function t(t,e,n,r,o){this.router=t,this.injector=r,this.preloadingStrategy=o,this.loader=new rh(e,n,function(e){return t.triggerEvent(new ec(e))},function(e){return t.triggerEvent(new nc(e))})}return t.prototype.setUpPreloading=function(){var t=this;this.subscription=this.router.events.pipe(tu(function(t){return t instanceof Kl}),Ou(function(){return t.preload()})).subscribe(function(){})},t.prototype.preload=function(){var t=this.injector.get(fn);return this.processRoutes(t,this.router.config)},t.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},t.prototype.processRoutes=function(t,e){var n,r,o=[];try{for(var i=h(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.loadChildren&&!s.canLoad&&s._loadedConfig){var u=s._loadedConfig;o.push(this.processRoutes(u.module,u.routes))}else s.loadChildren&&!s.canLoad?o.push(this.preloadConfig(t,s)):s.children&&o.push(this.processRoutes(t,s.children))}}catch(l){n={error:l}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return ot(o).pipe(lt(),tt(function(t){}))},t.prototype.preloadConfig=function(t,e){var n=this;return this.preloadingStrategy.preload(e,function(){return n.loader.load(t.injector,e).pipe(it(function(t){return e._loadedConfig=t,n.processRoutes(t.module,t.routes)}))})},t}(),wh=function(){function t(t,e,n){void 0===n&&(n={}),this.router=t,this.viewportScroller=e,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}return t.prototype.init=function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()},t.prototype.createScrollEvents=function(){var t=this;return this.router.events.subscribe(function(e){e instanceof ql?(t.store[t.lastId]=t.viewportScroller.getScrollPosition(),t.lastSource=e.navigationTrigger,t.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Kl&&(t.lastId=e.id,t.scheduleScrollEvent(e,t.router.parseUrl(e.urlAfterRedirects).fragment))})},t.prototype.consumeScrollEvents=function(){var t=this;return this.router.events.subscribe(function(e){e instanceof sc&&(e.position?"top"===t.options.scrollPositionRestoration?t.viewportScroller.scrollToPosition([0,0]):"enabled"===t.options.scrollPositionRestoration&&t.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===t.options.anchorScrolling?t.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==t.options.scrollPositionRestoration&&t.viewportScroller.scrollToPosition([0,0]))})},t.prototype.scheduleScrollEvent=function(t,e){this.router.triggerEvent(new sc(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,e))},t.prototype.ngOnDestroy=function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()},t}(),xh=new Ht("ROUTER_CONFIGURATION"),Ch=new Ht("ROUTER_FORROOT_GUARD"),Eh=[bs,{provide:_c,useClass:Dc},{provide:lh,useFactory:Th,deps:[Ni,_c,fh,bs,Xt,Fo,ti,nh,xh,[oh,new Nt],[th,new Nt]]},fh,{provide:Jc,useFactory:_h,deps:[lh]},{provide:Fo,useClass:Ti},bh,yh,gh,{provide:xh,useValue:{enableTracing:!1}}];function Sh(){return new xi("Router",lh)}var kh=function(){function t(t,e){}var e;return e=t,t.forRoot=function(t,n){return{ngModule:e,providers:[Eh,Ah(t),{provide:Ch,useFactory:Rh,deps:[[lh,new Nt,new Rt]]},{provide:xh,useValue:n||{}},{provide:gs,useFactory:Ih,deps:[ms,[new kt(ys),new Nt],xh]},{provide:wh,useFactory:Nh,deps:[lh,Us,xh]},{provide:vh,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:yh},{provide:xi,multi:!0,useFactory:Sh},[Dh,{provide:Bo,multi:!0,useFactory:Oh,deps:[Dh]},{provide:Fh,useFactory:Mh,deps:[Dh]},{provide:Go,multi:!0,useExisting:Fh}]]}},t.forChild=function(t){return{ngModule:e,providers:[Ah(t)]}},t}();function Nh(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new wh(t,e,n)}function Ih(t,e,n){return void 0===n&&(n={}),n.useHash?new xs(t,e):new Cs(t,e)}function Rh(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Ah(t){return[{provide:ce,multi:!0,useValue:t},{provide:nh,multi:!0,useValue:t}]}function Th(t,e,n,r,o,i,a,s,u,l,c){void 0===u&&(u={});var p=new lh(null,e,n,r,o,i,a,xc(s));if(l&&(p.urlHandlingStrategy=l),c&&(p.routeReuseStrategy=c),u.errorHandler&&(p.errorHandler=u.errorHandler),u.malformedUriErrorHandler&&(p.malformedUriErrorHandler=u.malformedUriErrorHandler),u.enableTracing){var h=Lu();p.events.subscribe(function(t){h.logGroup("Router Event: "+t.constructor.name),h.log(t.toString()),h.log(t),h.logGroupEnd()})}return u.onSameUrlNavigation&&(p.onSameUrlNavigation=u.onSameUrlNavigation),u.paramsInheritanceStrategy&&(p.paramsInheritanceStrategy=u.paramsInheritanceStrategy),u.urlUpdateStrategy&&(p.urlUpdateStrategy=u.urlUpdateStrategy),u.relativeLinkResolution&&(p.relativeLinkResolution=u.relativeLinkResolution),p}function _h(t){return t.routerState.root}var Dh=function(){function t(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new z}return t.prototype.appInitializer=function(){var t=this;return this.injector.get(vs,Promise.resolve(null)).then(function(){var e=null,n=new Promise(function(t){return e=t}),r=t.injector.get(lh),o=t.injector.get(xh);if(t.isLegacyDisabled(o)||t.isLegacyEnabled(o))e(!0);else if("disabled"===o.initialNavigation)r.setUpLocationChangeListener(),e(!0);else{if("enabled"!==o.initialNavigation)throw new Error("Invalid initialNavigation options: '"+o.initialNavigation+"'");r.hooks.afterPreactivation=function(){return t.initNavigation?Gs(null):(t.initNavigation=!0,e(!0),t.resultOfPreactivationDone)},r.initialNavigation()}return n})},t.prototype.bootstrapListener=function(t){var e=this.injector.get(xh),n=this.injector.get(bh),r=this.injector.get(wh),o=this.injector.get(lh),i=this.injector.get(Ni);t===i.components[0]&&(this.isLegacyEnabled(e)?o.initialNavigation():this.isLegacyDisabled(e)&&o.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),o.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())},t.prototype.isLegacyEnabled=function(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation},t.prototype.isLegacyDisabled=function(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation},t}();function Oh(t){return t.appInitializer.bind(t)}function Mh(t){return t.bootstrapListener.bind(t)}var Fh=new Ht("Router Initializer"),Ph=sr({encapsulation:2,styles:[],data:{}});function Lh(t){return aa(0,[(t()(),qi(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),yo(1,212992,null,0,dh,[fh,jn,cn,[8,null],Pn],null,null)],function(t,e){t(e,1,0)},null)}function Bh(t){return aa(0,[(t()(),qi(0,0,null,null,1,"ng-component",[],null,null,null,Lh,Ph)),yo(1,49152,null,0,uc,[],null,null)],null,null)}var zh=Kr("ng-component",uc,Bh,{},{},[]),Uh=function(t,e){return(Uh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Vh(t,e){function n(){this.constructor=t}Uh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Wh=function(){return(Wh=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function jh(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function Hh(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var Gh=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e=qh(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach(function(e){var n=e.split(":"),r=n[0];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,n[1])})}},t}();function qh(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")}),e}var Kh=null;function $h(t){Kh=t}var Xh=Object.freeze({Environment:Gh,getQueryParams:qh,get ENV(){return Kh},setEnvironmentGlobal:$h});function Yh(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function Qh(t,e,n){return Math.max(t,Math.min(e,n))}function Zh(t){return t%2==0?t:t+1}function Jh(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function tf(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function ef(t,e,n){void 0===n&&(n=""),tf(af(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function nf(t){tf(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function rf(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||xf(t)&&!n)for(var r=0;r<t.length;++r)rf(t[r],e,n);else e.push(t);return e}function of(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function af(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function sf(t){return t%1==0}function uf(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function lf(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function cf(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function pf(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{var s=e(++i);null!=n&&i>=n?o():setTimeout(a,s)}};a()})}function hf(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var i=t.slice();return i[r]=e/n,i}function ff(t,e){var n=e.length;return tf((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),tf(t.every(function(t){return sf(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?n+t:t})}function df(t,e){for(var n=[],r=[],o=null==e?null:ff(e,t).sort(),i=0,a=0;a<t.length;++a){if(null!=o){if(o[i]===a&&1!==t[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+t[a]+"' is not 1");(null==o[i]||o[i]>a)&&1===t[a]&&(n.push(t[a]),r.push(a)),o[i]<=a&&i++}1!==t[a]&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function mf(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function vf(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function gf(t,e,n){if("float32"===e)for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+n+"' is "+o+".")}}function yf(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function bf(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function wf(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function xf(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Cf(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function Ef(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=t.length}),e}function Sf(t){return"string"==typeof t||t instanceof String}function kf(t){return"boolean"==typeof t}function Nf(t){return"number"==typeof t}function If(t){return Array.isArray(t)?If(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":Nf(t)?"float32":Sf(t)?"string":kf(t)?"bool":"float32"}function Rf(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Af(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function Tf(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function _f(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=rf(t)),n&&yf(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function Df(t,e){if(0===t.length)return e[0];var n=t.reduce(function(t,e){return t*e});if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var i=n[0],a=0;a<i;a++)o[a]=r[e+a];else{i=n[0];var s=n.slice(1),u=s.reduce(function(t,e){return t*e});for(a=0;a<i;a++)o[a]=t(e+a*u,s,r)}return o}(0,t,e)}function Of(t,e){for(var n=Mf(t,e),r=0;r<n.length;r++)n[r]=1;return n}function Mf(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function Ff(){return Kh.platform.now()}function Pf(t){t.forEach(function(e){tf(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function Lf(t,e){return Kh.platform.fetch(t,e)}function Bf(t,e){return void 0===e&&(e="utf-8"),Kh.platform.encode(t,e=e||"utf-8")}function zf(t,e){return void 0===e&&(e="utf-8"),Kh.platform.decode(t,e=e||"utf-8")}var Uf=Object.freeze({shuffle:Yh,clamp:Qh,nearestLargerEven:Zh,sum:Jh,randUniform:function(t,e){var n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:tf,assertShapesMatch:ef,assertNonNull:nf,flatten:rf,sizeFromShape:of,isScalarShape:function(t){return 0===t.length},arraysEqual:af,isInt:sf,tanh:uf,sizeToSquarishShape:lf,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return Yh(e),e},rightPad:cf,repeatedTry:pf,inferFromImplicitShape:hf,parseAxisParam:ff,squeezeShape:df,getTypedArrayFromDType:mf,getArrayFromDType:vf,checkComputationForErrors:gf,checkConversionForErrors:yf,isValidDtype:bf,hasEncodingLoss:wf,isTypedArray:xf,bytesPerElement:Cf,bytesFromStringArray:Ef,isString:Sf,isBoolean:kf,isNumber:Nf,inferDtype:If,isFunction:Rf,nearestDivisor:Af,computeStrides:Tf,toTypedArray:_f,toNestedArray:Df,makeOnesTypedArray:Of,makeZerosTypedArray:Mf,now:Ff,assertNonNegativeIntegerDimensions:Pf,fetch:Lf,encodeString:Bf,decodeString:zf}),Vf=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new Wf)}return t.prototype.profileKernel=function(t,e){var n,r=this,o=this.backendTimer.time(function(){n=e()});return(Array.isArray(n)?n:[n]).forEach(function(e){var n=e.dataSync();gf(n,e.dtype,t),o.then(function(o){var i="";null!=o.getExtraProfileInfo&&(i=o.getExtraProfileInfo()),r.logger.logKernelProfile(t,e,n,o.kernelMs,i)})}),n},t}(),Wf=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o){var i=cf(r+"ms",9),a=cf(t,25),s=e.rank,u=e.size,l=cf(e.shape.toString(),14);console.log("%c"+a+"\t%c"+i+"\t%c"+s+"D "+l+"\t%c"+u+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},t}(),jf=7;function Hf(t,e,n){return cf(Array.isArray(t)?parseFloat(t[0].toFixed(jf))+" + "+parseFloat(t[1].toFixed(jf))+"j":Sf(t)?"'"+t+"'":"bool"===n?Gf(t):parseFloat(t.toFixed(jf)).toString(),e)}function Gf(t){return 0===t?"false":"true"}function qf(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var Kf=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=of(t),null!=n){var o=n.length;tf(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||vf(e,this.size),this.strides=Tf(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),tf(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,o=t;r<o.length;r++){var i=o[r];if(i<0||i>=this.shape[n])throw new Error("Requested out of range element at "+t+".   Buffer shape="+this.shape);n++}for(var a=t[t.length-1],s=0;s<t.length-1;++s)a+=this.strides[s]*t[s];return this.values[a]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return Qf.make(this.shape,{values:this.values},this.dtype)},t}(),$f=null,Xf=null,Yf=null,Qf=function(){function t(t,e,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=of(t),this.strides=Tf(t),this.dataId=null!=r?r:{},this.id=$f().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",$f().registerTensor(this,o),null!=n&&$f().write(o,this.dataId,n)}return t.make=function(e,n,r,o){var i=n.values;return null!=n.values&&"string"===r&&Sf(n.values[0])&&(i=n.values.map(function(t){return Bf(t)})),new t(e,r,i,n.dataId,o)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),tf(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),Xf.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return jh(this,void 0,void 0,function(){var t;return Hh(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Xf.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return Xf.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return jh(this,void 0,void 0,function(){var t;return Hh(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Df(this.shape,t)]}})})},t.prototype.arraySync=function(){return Df(this.shape,this.dataSync())},t.prototype.data=function(){return jh(this,void 0,void 0,function(){var t,e;return Hh(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=$f().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map(function(t){return zf(t)})]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var t=$f().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(t){return zf(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return jh(this,void 0,void 0,function(){var t;return Hh(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,$f().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||($f().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),Xf.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),Xf.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),Xf.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),Xf.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),Xf.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),Xf.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),Xf.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=Tf(e),i=function(t,e,n,r){var o=of(e),i=r[r.length-1],a=new Array(i).fill(0),s=e.length,u="complex64"===n?qf(t):t;if(s>1)for(var l=0;l<o/i;l++)for(var c=l*i,p=0;p<i;p++)a[p]=Math.max(a[p],Hf(u[c+p],0,n).length);return a}(t,e,n,o),a=e.length,s=function t(e,n,r,o,i,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[Hf(qf(e)[0],0,r)]:"bool"===r?[Gf(e[0])]:[e[0].toString()];if(1===l){if(u>20){var c=Array.from(e.slice(0,3*s)),p=Array.from(e.slice(u-3*s,u));return"complex64"===r&&(c=qf(c),p=qf(p)),["["+c.map(function(t,e){return Hf(t,i[e],r)}).join(", ")+", ..., "+p.map(function(t,e){return Hf(t,i[u-3+e],r)}).join(", ")+"]"]}return["["+("complex64"===r?qf(e):Array.from(e)).map(function(t,e){return Hf(t,i[e],r)}).join(", ")+"]"]}var h=n.slice(1),f=o.slice(1),d=o[0]*s,m=[];if(u>20){for(var v=0;v<3;v++)m.push.apply(m,t(e.slice(g=v*d,g+d),h,r,f,i,!1));for(m.push("..."),v=u-3;v<u;v++)m.push.apply(m,t(e.slice(g=v*d,g+d),h,r,f,i,v===u-1))}else for(v=0;v<u;v++){var g;m.push.apply(m,t(e.slice(g=v*d,g+d),h,r,f,i,v===u-1))}var y=2===l?",":"";for(m[0]="["+m[0]+y,v=1;v<m.length-1;v++)m[v]=" "+m[v]+y;var b=",\n";for(v=2;v<l;v++)b+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":b),m}(t,e,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),Xf.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),Xf.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),Xf.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),Xf.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),Xf.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),Xf.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),Xf.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),Xf.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),Xf.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),Xf.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),Xf.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),Xf.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),Yf("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.batchNorm=function(t,e,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),Xf.batchNorm(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Xf.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Xf.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Xf.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),Xf.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),Xf.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),Xf.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),Xf.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),Xf.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),Xf.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),Xf.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),Xf.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),Xf.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),Xf.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),Xf.div(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),Xf.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),Xf.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),Xf.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Xf.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),Xf.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Xf.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),Xf.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),Xf.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),Xf.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Xf.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),Xf.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),Xf.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Xf.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),Xf.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),Xf.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),Xf.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),Xf.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),Xf.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Xf.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),Xf.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Xf.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Xf.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Xf.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Xf.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),Xf.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),Xf.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),Xf.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),Xf.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),Xf.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),Xf.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),Xf.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),Xf.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),Xf.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),Xf.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),Xf.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),Xf.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),Xf.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),Xf.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),Xf.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),Xf.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),Xf.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),Xf.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),Xf.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),Xf.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Xf.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),Xf.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),Xf.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),Xf.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),Xf.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),Xf.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),Xf.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),Xf.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),Xf.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),Xf.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),Xf.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),Xf.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),Xf.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),Xf.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),Xf.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),Xf.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),Xf.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),Xf.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),Xf.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),Xf.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),Xf.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),Xf.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),Xf.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),Xf.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),Xf.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),Xf.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Xf.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Xf.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Xf.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Xf.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),Xf.conv1d(this,t,e,n,r,o,i)},t.prototype.conv2d=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Xf.conv2d(this,t,e,n,r,o,i)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),Xf.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Xf.depthwiseConv2d(this,t,e,n,r,o,i)},t.prototype.separableConv2d=function(t,e,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),Xf.separableConv2d(this,t,e,n,r,o,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),Xf.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),Xf.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),Xf.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),Xf.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),Zf.variable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Xf.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Xf.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Xf.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),Xf.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),Xf.stridedSlice(this,t,e,n,r,o,i,a,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),Xf.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),Xf.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),Xf.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),Xf.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),Xf.spectral.irfft(this)},t}();Object.defineProperty(Qf,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Zf=function(t){function e(e,n,r){void 0===n&&(n=!0);var o=t.call(this,e.shape,e.dtype,null,e.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=$f().nextVariableId().toString());try{$f().registerVariable(o)}catch(t){throw $f().disposeTensor(o),t}return o}return Vh(e,t),e.variable=function(t,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==t.dtype&&(t=t.asType(o)),new e(t,n,r)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!af(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");$f().disposeTensor(this),this.dataId=t.dataId,$f().registerTensor(this)},e.prototype.dispose=function(){$f().disposeVariable(this),this.isDisposedInternal=!0},e}(Qf);Object.defineProperty(Zf,Symbol.hasInstance,{value:function(t){return t instanceof Qf&&null!=t.assign&&t.assign instanceof Function}});var Jf,td,ed,nd,rd,od,id=Zf.variable;(od=Jf||(Jf={})).R0="R0",od.R1="R1",od.R2="R2",od.R3="R3",od.R4="R4",od.R5="R5",od.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(td||(td={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(ed||(ed={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(nd||(nd={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(rd||(rd={}));var ad={float32:nd,int32:td,bool:ed,complex64:rd};function sd(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return ad[t][e]}function ud(t){return sd(t,"int32")}function ld(t,e){if(t.dtype===e.dtype)return[t,e];var n=sd(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function cd(t,e){tf(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function pd(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof Qf)n.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,i=e;for(var a in i){var s=i[a];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}var hd,fd=Object.freeze({makeTypesMatch:ld,assertTypesMatch:cd,isTensorInList:function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1},getTensorsInContainer:pd}),dd=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),md=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new dd}return t.prototype.ready=function(){return jh(this,void 0,void 0,function(){var t,e,n;return Hh(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?[4,this.initializeBackend(n=t[e]).success]:[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return jh(this,void 0,void 0,function(){var e,n,r;return Hh(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.profiler=new Vf(this.backendInstance),[2,!0]}})})},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,i=r.then(function(n){return!(o<e.pendingBackendInitId||(e.registry[t]=n,e.pendingBackendInit=null,0))}).catch(function(n){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),1))});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),o=r.asyncInit;if(o||r.success)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){this.write(t,e,this.readSync(e))},t.prototype.tidy=function(t,e){var n,r=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=Qf.make(t.shape,{dataId:t.dataId},t.dtype);return this.addTapeNode([t],e,function(t){return[t.toFloat()]}),e},t.prototype.runKernel=function(t,e,n){var r,o=this,i=[],a=this.isTapeOn(),s=null!=this.state.activeScope?this.state.activeScope.name:"",u=function(t){a&&(i=t.map(function(t){return o.keep(o.clone(t))}))},l=this.state.numBytes,c=this.state.numTensors;if(this.scopedRun(function(){return o.state.kernelDepth++},function(){return o.state.kernelDepth--},function(){r=o.ENV.getBool("DEBUG")?o.profiler.profileKernel(s,function(){return t(o.backend,u)}):t(o.backend,u)}),a){var p={id:this.state.nextTapeNodeId++,name:s,inputs:e,outputs:Array.isArray(r)?r:[r],saved:i};null!=n&&(p.gradient=function(t){return n(t,i)}),this.state.activeTape.push(p)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-l,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-c,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShape:Array.isArray(r)?r.map(function(t){return t.shape}):r.shape}),r},t.prototype.registerTensor=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*Cf(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:null!=e?e:this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r,null!=e?e.register(t.dataId,t.shape,t.dtype):this.backend.register(t.dataId,t.shape,t.dtype)}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Zf||this.track(t)},t.prototype.registerVariable=function(t){if(null!=this.state.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.state.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[t])},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return jh(this,void 0,void 0,function(){var e,n;return Hh(this,function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n){var r={};t.forEach(function(t,e){r[e]=t});var o={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:r,outputs:[e],gradient:function(t){var e=n(t),r={};return e.forEach(function(t,e){r[e]=function(){return t}}),r}};this.state.activeTape.push(o)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=pd(t),r=new Set(n.map(function(t){return t.id})),o=0;o<this.state.activeScope.track.length;o++){var i=this.state.activeScope.track[o];i.kept||r.has(i.id)||i.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(t){t.kept||t.scopeId!==a.id||e.track(t)})},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),tf(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",t)});tf(i instanceof Qf,function(){return"The result y returned by f() must be a tensor."});var a=function(t,e,n){for(var r={},o={},i=0;i<e.length;i++)r[e[i].id]=!0;for(i=0;i<t.length;i++){var a=(d=t[i]).inputs;for(var s in a){for(var u=a[s],l=!1,c=0;c<e.length;c++)if(r[u.id]){d.outputs.forEach(function(t){return r[t.id]=!0}),l=!0,o[d.id]=!0;break}if(l)break}}var p={};p[n.id]=!0;var h={};for(i=t.length-1;i>=0;i--)for(a=(d=t[i]).inputs,c=0;c<d.outputs.length;c++)if(p[d.outputs[c].id]){for(var s in a)p[a[s].id]=!0,h[d.id]=!0;break}var f=[];for(i=0;i<t.length;i++){var d;if(o[(d=t[i]).id]&&h[d.id]){var m={};for(var s in d.inputs){var v=d.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},d);g.inputs=m,g.outputs=d.outputs,f.push(g)}}return f}(this.state.activeTape,e,i);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var t,r,s={};s[i.id]=null==n?(r=Of(of(t=i.shape),"float32"),Qf.make(t,{values:r})):n,function(t,e,n){for(var r=function(r){var o=e[r],i=[];if(o.outputs.forEach(function(e){var n=t[e.id];if(null!=n)i.push(n);else{var r=Qf.make(e.shape,{values:Mf(e.size,e.dtype)},e.dtype);i.push(r)}}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var a=o.gradient(1===o.outputs.length?i[0]:i),s=function(e){if(!(e in a))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(a)+".");var r=n(function(){return a[e]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.name+". The gradient of input "+e+" must have 'float32' dtype, but has '"+r.dtype+"'");var i=o.inputs[e];if(!af(r.shape,i.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+e+"' has shape '"+r.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==t[i.id])t[i.id]=r;else{var s=t[i.id];t[i.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=e.length-1;o>=0;o--)r(o)}(s,a,function(t){return o.tidy(t)});var u=e.map(function(t){return s[t.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(t){for(var e in t.saved)t.saved[e].dispose()}),o.state.activeTape=null),{value:i,grads:u}})},t.prototype.customGrad=function(t){var e=this;return tf(Rf(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];tf(r.every(function(t){return t instanceof Qf}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return r.forEach(function(t,e){i[e]=t}),e.runKernel(function(e,o){return tf((n=t.apply(void 0,r.concat([o]))).value instanceof Qf,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),tf(Rf(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},i,function(t,e){var o=n.gradFunc(t,e),i=Array.isArray(o)?o:[o];tf(i.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),tf(i.every(function(t){return t instanceof Qf}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return i.forEach(function(t,e){a[e]=function(){return t}}),a})}},t.prototype.write=function(t,e,n){var r=this.state.tensorInfo.get(e),o=r.backend;if(t=t||this.backend,"string"===r.dtype){var i=Ef(n);this.state.numBytes+=i-r.bytes,r.bytes=i}t!==o&&(o.disposeData(e),r.backend=t,t.register(e,r.shape,r.dtype)),t.write(e,n)},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return jh(this,void 0,void 0,function(){var e,n;return Hh(this,function(r){switch(r.label){case 0:return e=Ff(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=Ff()-e,[2,n]}})})},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new dd,this.registry)this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),vd=function(){var t=function(){if(null==hd){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}hd=t}return hd}();if(null==t._tfengine){var e=new Gh(t);t._tfengine=new md(e)}return $h(t._tfengine.ENV),$f=function(){return t._tfengine},t._tfengine}();function gd(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}Kh.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Kh.registerFlag("IS_BROWSER",function(){return gd()}),Kh.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Kh.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Kh.registerFlag("PROD",function(){return!1}),Kh.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Kh.getBool("DEBUG")}),Kh.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Kh.registerFlag("IS_TEST",function(){return!1});var yd={},bd={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function wd(t,e){yd[t]=e}function xd(t){t in yd||(yd[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=Cd(t);return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete yd[t]},!1),1===t?e.getContext("webgl",bd)||e.getContext("experimental-webgl",bd):e.getContext("webgl2",bd)}(t));var e=yd[t];return e.isContextLost()?(delete yd[t],xd(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),yd[t])}function Cd(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Ed(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Id(t,e))}(t),r}var Sd=5.96e-8,kd=65504;function Nd(t){return!!(Kh.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||Sd<Math.abs(t)&&Math.abs(t)<kd)}function Id(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Rd(t,e,n){return Qd(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Ad(t,e,n){var r=Qd(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Ed(t,e,function(){return t.shaderSource(r,n)}),Ed(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Td(t,e,n){var r=Qd(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Ed(t,e,function(){return t.shaderSource(r,n)}),Ed(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=Od.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),i=o.length.toString().length+2,a=o.map(function(t,e){return cf((e+1).toString(),i)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var l=a.slice(0,r-1),c=a.slice(r-1,r),p=a.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+cf(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var _d,Dd,Od=/ERROR: [0-9]+:([0-9]+):/g;function Md(t,e){return Qd(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function Fd(t,e,n){if(Ed(t,e,function(){return t.linkProgram(n)}),!1===t.getProgramParameter(n,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Pd(t,e,n){if(Ed(t,e,function(){return t.validateProgram(n)}),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function Ld(t,e,n){var r=Qd(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Ed(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Ed(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function Bd(t,e,n){var r=Qd(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Ed(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),Ed(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function zd(t,e){return Qd(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function Ud(t,e){var n=Kh.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Vd(t,e){return Qd(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Wd(t,e,n,r,o,i,a,s){var u=t.getAttribLocation(n,r);return-1!==u&&(Ed(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),Ed(t,e,function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)}),Ed(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function jd(t,e,n,r){Zd(t,r),Ed(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),Ed(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function Hd(t,e,n,r){return Qd(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function Gd(t,e,n){return t.getUniformLocation(e,n)}function qd(t,e,n,r,o,i){Ed(t,e,function(){return jd(t,e,r,i)}),Ed(t,e,function(){return t.uniform1i(o,i)})}function Kd(t,e,n,r){Ed(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),Ed(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function $d(t,e,n){Ed(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),Ed(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function Xd(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Yd(t,e))}function Yd(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Qd(t,e,n,r){var o=Ed(t,e,function(){return n()});if(null==o)throw new Error(r);return o}function Zd(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Jd(t,e){return void 0===e&&(e=2),of(t.slice(0,t.length-e))}function tm(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function em(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[Jd(t)].concat(tm(t))),e}function nm(t,e){var n;void 0===e&&(e=!1);var r=Kh.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map(function(e,n){return n>=t.length-2?Zh(t[n]):t[n]})).length&&(t=[2,t[0]])),2!==t.length){var o=df(t);t=o.newShape}var i=of(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=Jd(t),s=2,u=2;return t.length&&(s=(n=tm(t))[0],u=n[1]),lf(i=a*(s/2)*(u/2)).map(function(t){return 2*t})}return lf(i)}function rm(t){return t%2==0}function om(t,e){if(af(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(rm(n)&&rm(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&rm(t[0])&&rm(e[0])}function im(t){if(null==_d){var e=xd(t);_d=e.getParameter(e.MAX_TEXTURE_SIZE)}return _d}function am(t){if(null==Dd){var e=xd(t);Dd=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Dd)}function sm(t){if(0===t)return 0;var e=xd(t);return um(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:um(e,"EXT_disjoint_timer_query")?1:0}function um(t,e){return null!=t.getExtension(e)}function lm(t){try{if(null!=xd(t))return!0}catch(t){return!1}return!1}function cm(t){if(0===t)return!1;var e=xd(t);if(1===t){if(!um(e,"OES_texture_float"))return!1}else if(!um(e,"EXT_color_buffer_float"))return!1;return hm(e,t)}function pm(t){if(0===t)return!1;var e=xd(t);if(1===t){if(!um(e,"OES_texture_float"))return!1;if(!um(e,"WEBGL_color_buffer_float"))return!1}else if(!um(e,"EXT_color_buffer_float"))return!1;return hm(e,t)}function hm(t,e){var n=t.createFramebuffer(),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,2===e?t.RGBA32F:t.RGBA,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(n),o}function fm(t){return 2===t&&null!=xd(t).fenceSync}var dm=Object.freeze({callAndCheck:Ed,canBeRepresented:Nd,getWebGLErrorMessage:Id,getExtensionOrThrow:Rd,createVertexShader:Ad,createFragmentShader:Td,createProgram:Md,linkProgram:Fd,validateProgram:Pd,createStaticVertexBuffer:Ld,createStaticIndexBuffer:Bd,getNumChannels:function(){return 2===Kh.getNumber("WEBGL_VERSION")?1:4},createTexture:zd,validateTextureSize:Ud,createFramebuffer:Vd,bindVertexBufferToProgramAttribute:Wd,bindTextureUnit:jd,unbindTextureUnit:function(t,e,n){Zd(t,n),Ed(t,e,function(){return t.activeTexture(t.TEXTURE0+n)}),Ed(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Hd,getProgramUniformLocation:Gd,bindTextureToProgramUniformSampler:qd,bindCanvasToFramebuffer:function(t,e){Ed(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Ed(t,e,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),Ed(t,e,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:Kd,unbindColorTextureFromFramebuffer:$d,validateFramebuffer:Xd,getFramebufferErrorMessage:Yd,getBatchDim:Jd,getRowsCols:tm,getShapeAs3D:em,getTextureShapeFromLogicalShape:nm,isReshapeFree:om,get MAX_TEXTURE_SIZE(){return _d},get MAX_TEXTURES_IN_SHADER(){return Dd},getWebGLMaxTextureSize:im,getMaxTexturesInShader:am,getWebGLDisjointQueryTimerVersion:sm,isWebGLVersionEnabled:lm,isRenderToFloatTextureEnabled:cm,isDownloadFloatTextureEnabled:pm,isWebGLFenceEnabled:fm});function mm(){Kh.set("PROD",!0)}function vm(){Kh.set("DEBUG",!0)}function gm(){Kh.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function ym(t){Kh.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function bm(){vd.disposeVariables()}function wm(){return vd.memory()}function xm(t){return vd.profile(t)}function Cm(t,e){return vd.tidy(t,e)}function Em(t){pd(t).forEach(function(t){return t.dispose()})}function Sm(t){return vd.keep(t)}function km(t){return vd.time(t)}function Nm(t){return vd.setBackend(t)}function Im(){return vd.ready()}function Rm(){return vd.backendName}function Am(t){vd.removeBackend(t)}function Tm(t){return vd.findBackend(t)}function _m(t){return vd.findBackendFactory(t)}function Dm(t,e,n){return void 0===n&&(n=1),vd.registerBackend(t,e,n)}function Om(){return vd.backend}function Mm(t,e){Kh.setPlatform(t,e)}function Fm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Kh.getBool("IS_TEST")||console.warn.apply(console,t)}function Pm(t,e){var n=t;if(xf(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||xf(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&Kh.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||xf(e)){tf(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),tf(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var o=n.slice(1),i=0;i<e.length;++i)t(e[i],o,r.concat(i))}else tf(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(t,r,[]),r}function Lm(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function Bm(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof Qf)return Lm(r,t.dtype,e,n),t;var o=If(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Lm(r,o,e,n),null==t||!xf(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+(null==t?"null":t.constructor.name)+"'");var i=Pm(t,o);xf(t)||Array.isArray(t)||(t=[t]);var a="string"!==o?_f(t,o,Kh.getBool("DEBUG")):rf(t,[],!0);return Qf.make(i,{values:a},o)}function zm(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return Bm(t,e+"["+r+"]",n)},r)}function Um(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Vm(t,e,n){for(var r=t.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[i++]):o.push(e[a++]);return o}function Wm(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map(function(e){return t[e]})]}function jm(t,e){return Vm(t,e.map(function(t){return 1}),e)}function Hm(t,e,n){tf(Um(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function Gm(t,e){if(Um(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function qm(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Km(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function $m(t,e){var n=t[0].length;t.forEach(function(t,e){tf(t.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"})}),tf(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(t,o){for(var i=0;i<n;i++)tf(i===e||t[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Xm(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function Ym(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];vd.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),vd.endScope(o),o}catch(t){throw vd.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Kh.registerFlag("HAS_WEBGL",function(){return Kh.getNumber("WEBGL_VERSION")>0}),Kh.registerFlag("WEBGL_VERSION",function(){return lm(2)?2:lm(1)?1:0}),Kh.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Kh.get("WEBGL_VERSION")}),Kh.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Kh.registerFlag("WEBGL_PACK",function(){return Kh.getBool("HAS_WEBGL")}),Kh.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_PACK_CLIP",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Kh.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_PACK_REDUCE",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_CONV_IM2COL",function(){return Kh.getBool("WEBGL_PACK")}),Kh.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return im(Kh.getNumber("WEBGL_VERSION"))}),Kh.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return am(Kh.getNumber("WEBGL_VERSION"))}),Kh.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=Kh.getNumber("WEBGL_VERSION");return 0===t?0:sm(t)}),Kh.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),Kh.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return cm(Kh.getNumber("WEBGL_VERSION"))}),Kh.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return pm(Kh.getNumber("WEBGL_VERSION"))}),Kh.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return fm(Kh.getNumber("WEBGL_VERSION"))}),Kh.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Kh.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Yf=ym;var Qm=Ym({complex_:function(t,e){var n=Bm(t,"real","complex"),r=Bm(e,"imag","complex");return ef(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),vd.runKernel(function(t){return t.complex(n,r)},{$real:n,$imag:r})}}),Zm=Ym({real_:function(t){var e=Bm(t,"input","real");return vd.runKernel(function(t){return t.real(e)},{$input:e})}}),Jm=Ym({imag_:function(t){var e=Bm(t,"input","imag");return vd.runKernel(function(t){return t.imag(e)},{$input:e})}});function tv(t,e,n){return ev(t,e,Pm(t,n),n)}function ev(t,e,n,r){if(null==r&&(r=If(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!xf(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Pf(e);var o=of(e),i=of(n);tf(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<n.length;++a){var s=a!==n.length-1||n[a]!==of(e.slice(a));tf(n[a]===e[a]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return xf(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?_f(t,r,Kh.getBool("DEBUG")):rf(t,[],!0),Qf.make(e,{values:t},r)}function nv(t,e){if((xf(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&xf(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ev(t,[],[],e)}function rv(t,e){nf(t);var n=Pm(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ev(t,null,n,e)}function ov(t,e,n){if(nf(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Pm(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ev(t,e,r,n)}function iv(t,e,n){if(nf(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Pm(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ev(t,e,r,n)}function av(t,e,n){if(nf(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Pm(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ev(t,e,r,n)}function sv(t,e,n){if(nf(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Pm(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ev(t,e,r,n)}function uv(t,e,n){if(nf(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Pm(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ev(t,e=e||r,r,n)}function lv(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=lv(t,"float32"),r=cv(t,"float32");return Qm(n,r)}var o=Of(of(t),e);return Qf.make(t,{values:o},e)}function cv(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=cv(t,"float32"),r=cv(t,"float32");return Qm(n,r)}var o=Mf(of(t),e);return Qf.make(t,{values:o},e)}function pv(t,e,n){return vd.runKernel(function(r){return r.fill(t,e,n)},{})}function hv(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return vd.runKernel(function(r){return r.linspace(t,e,n)},{})}function fv(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return cv([0],r);var o=Mf(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return rv(o,r)}var dv=Ym({onesLike_:function(t){var e=Bm(t,"x","onesLike");if("complex64"===e.dtype){var n=dv(Zm(e)),r=mv(Jm(e));return Qm(n,r)}return vd.runKernel(function(t){return t.onesLike(e)},{$x:e},function(t,e){return{$x:function(){return mv(t)}}})}}),mv=Ym({zerosLike_:function(t){var e=Bm(t,"x","zerosLike");return vd.runKernel(function(t){return t.zerosLike(e)},{$x:e},function(t,e){return{$x:function(){return mv(t)}}})}}),vv=Ym({concat_:function(t,e){void 0===e&&(e=0),tf(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=zm(t,"tensors","concat");e=ff(e,n[0].shape)[0];var r=Xm(n.map(function(t){return t.shape}),e);if(0===of(r))return tv([],r);if(1===(n=n.filter(function(t){return t.size>0})).length)return n[0];var o=n.map(function(t){return t.shape});return $m(o,e),vd.runKernel(function(t){return t.concat(n,e)},n,function(t){var n=o.map(function(t){return t[e]});return xv(t,n,e).map(function(t){return function(){return t}})})}}),gv=Ym({concat1d_:function(t){return vv(t,0)}}),yv=Ym({concat2d_:function(t,e){return vv(t,e)}}),bv=Ym({concat3d_:function(t,e){return vv(t,e)}}),wv=Ym({concat4d_:function(t,e){return vv(t,e)}}),xv=Ym({split_:function(t,e,n){void 0===n&&(n=0);var r,o=Bm(t,"x","split");return n=ff(n,o.shape)[0],"number"==typeof e?(tf(o.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(o.shape[n]/e)):(tf(o.shape[n]===e.reduce(function(t,e){return t+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),vd.runKernel(function(t){return t.split(o,r,n)},{$x:o},function(t){return{$x:function(){return vv(t,n)}}})}});function Cv(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Ev=Cv(function(t){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function i(t,e){var n=new r(t),i=e&&e.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+1.1102230246251565e-16*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.alea=i}(0,t)}),Sv=Cv(function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xor128=i}(0,t)}),kv=Cv(function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xorwow=i}(0,t)}),Nv=Cv(function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function i(t,e){null==t&&(t=+new Date);var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&(i.x&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xorshift7=i}(0,t)}),Iv=Cv(function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n=o[i]=(n^=n>>>15)^(t^=t>>>12),e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=0==(n=s[127&i]^=r+(a=a+1640531527|0))?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,s[o]=(r^=r>>>15)^(n^=n>>>12);t.w=a,t.X=s,t.i=o}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function i(t,e){null==t&&(t=+new Date);var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&(i.X&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xor4096=i}(0,t)}),Rv=Cv(function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.tychei=i}(0,t)}),Av=Cv(function(t){!function(e,r){var o,i=this,a=256,s=6,u="random",l=r.pow(a,s),c=r.pow(2,52),p=2*c,h=a-1;function f(t,n,h){var f=[],y=v(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,g(e)]}}():t,3),f),b=new d(f),w=function(){for(var t=b.g(s),e=l,n=0;t<c;)t=(t+n)*a,e*=a,n=b.g(1);for(;t>=p;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,v(g(b.S),e),(n.pass||h||function(t,e,n,o){return o&&(o.S&&m(o,b),t.state=function(){return m(b,{})}),n?(r[u]=t,e):t})(w,y,"global"in n?n.global:this==r,n.state)}function d(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=h&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=h&o+1],n=n*a+s[h&(s[o]=s[i=h&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}function m(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){for(var n,r=t+"",o=0;o<r.length;)e[h&o]=h&(n^=19*e[h&o])+r.charCodeAt(o++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(r["seed"+u]=f,v(r.random(),e),t.exports){t.exports=f;try{o=n(1)}catch(t){}}}([],Math)});Av.alea=Ev,Av.xor128=Sv,Av.xorwow=kv,Av.xorshift7=Nv,Av.xor4096=Iv,Av.tychei=Rv;var Tv=Av.alea,_v=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=Tv(i.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,i=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),Dv=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=1);var o=this;if(this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Tv(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Ov(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",Pf(t),new Kf(t,e,n)}function Mv(t,e){void 0===e&&(e=!1),console.log(t.toString(e))}var Fv=Ym({batchToSpaceND_:function(t,e,n){var r=Bm(t,"x","batchToSpaceND"),o=e.reduce(function(t,e){return t*e});return tf(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),tf(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),tf(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),vd.runKernel(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}})}}),Pv=Ym({cast_:function(t,e){var n=Bm(t,"x","cast");if(!bf(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return vd.runKernel(function(t){return t.cast(n,e)},{$x:n},function(t){return{$x:function(){return t.clone()}}})}}),Lv=Ym({clone_:function(t){var e=Bm(t,"x","clone",null);return vd.runKernel(function(t){return Qf.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),Bv=Ym({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=Bm(t,"x","cumsum"),i=Gm([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Km(1,o.rank)[0],u=vd.runKernel(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),zv=Ym({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=Bm(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return tf(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),tf(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),tf(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),vd.runKernel(function(t){return t.depthToSpace(r,e,n)},{$x:r})}}),Uv=Ym({expandDims_:function(t,e){void 0===e&&(e=0);var n=Bm(t,"x","expandDims",null);tf(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(tf(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),Zv(n,r)}}),Vv=Ym({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=Ov([t,e],r),i=t<=e?t:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return ng(Uv(s,0),[n[0],1,1]);if(2===n.length)return ng(Uv(Uv(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return ng(Uv(Uv(Uv(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Wv=Ym({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=Bm(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?o.as2D(1,-1):o,u=vd.runKernel(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u}}),jv=Ym({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=Bm(t,"indices","oneHot","int32"),i=o.shape.concat([e]);return o=o.flatten(),vd.runKernel(function(t){return t.oneHot(o,e,n,r)},{$indices:o},function(t){return{$indices:function(){return cv(o.shape,"float32")}}}).reshape(i)}}),Hv=Ym({pad_:function(t,e,n){void 0===n&&(n=0);var r=Bm(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=e.map(function(t){return t[0]});return vd.runKernel(function(t){return t.pad(r,e,n)},{$x:r},function(t){return{$x:function(){return t.slice(o,r.shape)}}})}}),Gv=Ym({pad1d_:function(t,e,n){return void 0===n&&(n=0),tf(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),Hv(t,[e],n)}}),qv=Ym({pad2d_:function(t,e,n){return void 0===n&&(n=0),tf(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hv(t,e,n)}}),Kv=Ym({pad3d_:function(t,e,n){return void 0===n&&(n=0),tf(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hv(t,e,n)}}),$v=Ym({pad4d_:function(t,e,n){return void 0===n&&(n=0),tf(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hv(t,e,n)}}),Xv=Ym({rand_:function(t,e,n){var r=of(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return Qf.make(t,{values:o},n)}}),Yv=Ym({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new _v(e,n,r,!1,o),a=Ov(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Qv=Ym({randomUniform_:function(t,e,n,r,o){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=Ov(t,r),a=new Dv(e,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Zv=Ym({reshape_:function(t,e){var n=Bm(t,"x","reshape",null);return e=hf(e,n.size),tf(n.size===of(e),function(){return"new shape and old shape must have the same number of elements."}),vd.runKernel(function(t){return t.reshape(n,e)},{$x:n},function(t){return{$x:function(){return t.reshape(n.shape)}}})}}),Jv=Ym({spaceToBatchND_:function(t,e,n){var r=Bm(t,"x","spaceToBatchND");return tf(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),tf(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),tf(r.shape.reduce(function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),vd.runKernel(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}})}}),tg=Ym({squeeze_:function(t,e){var n=Bm(t,"x","squeeze");return Zv(n,df(n.shape,e).newShape)}}),eg=Ym({stack_:function(t,e){void 0===e&&(e=0);var n=zm(t,"tensors","stack");if(tf(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(e);var r=n[0].shape,o=n[0].dtype;tf(e<=n[0].rank,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(t){ef(r,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){tf(o===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(t){return t.expandDims(e)});return vv(i,e)}}),ng=Ym({tile_:function(t,e){var n=Bm(t,"x","tile",null);return tf(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."}),vd.runKernel(function(t,r){var o=t.tile(n,e);return r([n]),o},{$x:n},function(t,n){var r=n[0];return{$x:function(){var n=mv(r);if(1===r.rank)for(var o=0;o<e[0];++o)n=n.add(t.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<e[0];++o)for(var i=0;i<e[1];++i)n=n.add(t.slice([o*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(var a=0;a<e[2];++a)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}})}}),rg=Ym({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new _v(e,n,r,!0,o),a=Ov(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),og=Ym({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=Bm(t,"x","unstack");return tf(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length),vd.runKernel(function(t){return t.unstack(n,e)},{$x:n},function(t){return{$x:function(){return eg(t,e)}}})}}),ig=function(t,e){return jh(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,p;return Hh(this,function(h){switch(h.label){case 0:return n=Bm(t,"x","setdiff1d"),r=Bm(e,"y","setdiff1d"),tf(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),tf(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),tf(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(i=h.sent(),a=new Set(i),s=0,c=0;c<o.length;c++)a.has(o[c])||s++;for(u=new Kf([s],n.dtype),l=new Kf([s],"int32"),c=0,p=0;c<o.length;c++)a.has(o[c])||(u.values[p]=o[c],l.values[p]=c,p++);return[2,[u.toTensor(),l.toTensor()]]}})})};function ag(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([t[a+1]/e[a],e[a]]);o=o.concat(t.slice(i+1))}return o}function sg(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function ug(t,e,n,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/n:t[0]*n);for(var i=1;i<t.length;++i)o.push(i<=e.length?r?e[i-1]*t[i]:t[i]/e[i-1]:t[i]);return o}function lg(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function cg(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}function pg(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=t.shape,s=n.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var l=Tf(t.shape).map(function(t){return t/u}).concat([1]).slice(0,r);return[s,o,u,l]}var hg=30;function fg(t){return t<=hg?t:Af(t,Math.floor(Math.sqrt(t)))}function dg(t,e,n){for(var r=e.rank>1?e.shape[e.rank-1]:1,o=n.length,i=1,a=r;a<o;++a)i*=n[a];return{sliceRank:r,numUpdates:e.size/(r<1?1:r),sliceSize:i,strides:Tf(n.slice(0,r)).concat([1]),outputSize:of(n)}}function mg(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],p=[],h=0;h<t.length;h++)l[h]=vg(o,e,r,t,h),c[h]=gg(i,n,r,t,h),u&1<<h&&(c[h]=l[h]+1,p.push(h));var f=new Array(t.length).fill(0);return f=f.map(function(t,e){for(var n=0,o=r[e]||1,i=l[e];!(o>0?i>=c[e]:i<=c[e]);i+=o)n+=1;return n}),[l,f,p]}function vg(t,e,n,r,o){var i=e[o];(t&1<<o||null==i)&&(i=(n[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[o];return i<0&&(i+=a),Qh(0,i,a-1)}function gg(t,e,n,r,o){var i=e[o],a=n[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?Qh(0,i,s):Qh(-1,i,s-1)}function yg(t,e,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function bg(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function wg(t){return tf(Rf(t),function(){return"The f passed in grad(f) must be a function"}),function(e,n){var r=Bm(e,"x","tf.grad",null),o=null!=n?Bm(n,"dy","tf.grad"):null;return vd.tidy(function(){var e=vd.gradients(function(){return t(r)},[r],o),n=e.grads;return null!=o&&ef(e.value.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Ng(n),n[0]})}}function xg(t){return tf(Rf(t),function(){return"The f passed in grads(f) must be a function"}),function(e,n){tf(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var r=zm(e,"args","tf.grads",null),o=null!=n?Bm(n,"dy","tf.grads"):null;return vd.tidy(function(){var e=vd.gradients(function(){return t.apply(void 0,r)},r,o),n=e.grads;return null!=o&&ef(e.value.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ng(n),n})}}function Cg(t){return tf(Rf(t),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,n){tf(e instanceof Qf,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),tf(null==n||n instanceof Qf,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var r=vd.gradients(function(){return t(e)},[e],n),o=r.grads,i=r.value;return Ng(o),{grad:o[0],value:i}}}function Eg(t){return tf(Rf(t),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,n){tf(Array.isArray(e)&&e.every(function(t){return t instanceof Qf}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),tf(null==n||n instanceof Qf,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var r=vd.gradients(function(){return t.apply(void 0,e)},e,n);return null!=n&&ef(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ng(r.grads),r}}function Sg(t,e){tf(Rf(t),function(){return"The f passed in variableGrads(f) must be a function"}),tf(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof Zf}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=e;if(!n)for(var r in e=[],vd.registeredVariables)e.push(vd.registeredVariables[r]);var o=n?e.filter(function(t){return!t.trainable}):null,i=e.length;tf((e=e.filter(function(t){return t.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=vd.gradients(t,e,null,!0),s=a.value,u=a.grads;tf(u.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),tf(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(t,e){null!=u[e]&&(l[t.name]=u[e])}),null!=o&&o.forEach(function(t){return l[t.name]=null}),{value:s,grads:l}}function kg(t){return vd.customGrad(t)}function Ng(t){if(t.filter(function(t){return null==t}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var Ig=Ym({softmax_:function(t,e){void 0===e&&(e=-1);var n=Bm(t,"logits","softmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return kg(function(t,n){var r=t.logSumExp([e],!0),o=t.toFloat().sub(r).exp();return n([o]),{value:o,gradFunc:function(t,n){var r=n[0],o=t.mul(r);return o.sub(o.sum([e],!0).mul(r))}}})(n)}}),Rg=Ym({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=Bm(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return kg(function(t,n){var r=t.max(e,!0),o=t.sub(r),i=o.toFloat().sub(o.exp().sum(e,!0).log());return n([i]),{value:i,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}})(n)}}),Ag=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.data.delete(t)},t}(),Tg=function(){function t(){}return t.prototype.time=function(t){throw new Error("Not yet implemented.")},t.prototype.read=function(t){throw new Error("Not yet implemented.")},t.prototype.readSync=function(t){throw new Error("Not yet implemented.")},t.prototype.disposeData=function(t){throw new Error("Not yet implemented.")},t.prototype.write=function(t,e){throw new Error("Not yet implemented.")},t.prototype.fromPixels=function(t,e){throw new Error("Not yet implemented.")},t.prototype.register=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.memory=function(){throw new Error("Not yet implemented.")},t.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.fusedBatchMatMul=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.slice=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){throw new Error("Not yet implemented")},t.prototype.unstack=function(t,e){throw new Error("Not yet implemented")},t.prototype.reverse=function(t,e){throw new Error("Not yet implemented")},t.prototype.concat=function(t,e){throw new Error("Not yet implemented")},t.prototype.neg=function(t){throw new Error("Not yet implemented")},t.prototype.add=function(t,e){throw new Error("Not yet implemented")},t.prototype.addN=function(t){throw new Error("Not yet implemented")},t.prototype.subtract=function(t,e){throw new Error("Not yet implemented")},t.prototype.multiply=function(t,e){throw new Error("Not yet implemented")},t.prototype.realDivide=function(t,e){throw new Error("Not yet implemented")},t.prototype.floorDiv=function(t,e){throw new Error("Not yet implemented")},t.prototype.sum=function(t,e){throw new Error("Not yet implemented")},t.prototype.prod=function(t,e){throw new Error("Not yet implemented")},t.prototype.unsortedSegmentSum=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.argMin=function(t,e){throw new Error("Not yet implemented")},t.prototype.argMax=function(t,e){throw new Error("Not yet implemented")},t.prototype.equal=function(t,e){throw new Error("Not yet implemented")},t.prototype.notEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.less=function(t,e){throw new Error("Not yet implemented")},t.prototype.lessEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.greater=function(t,e){throw new Error("Not yet implemented")},t.prototype.greaterEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalNot=function(t){throw new Error("Not yet implemented")},t.prototype.logicalAnd=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalOr=function(t,e){throw new Error("Not yet implemented")},t.prototype.where=function(t){throw new Error("Not yet implemented")},t.prototype.select=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.topk=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.min=function(t,e){throw new Error("Not yet implemented")},t.prototype.minimum=function(t,e){throw new Error("Not yet implemented")},t.prototype.mod=function(t,e){throw new Error("Not yet implemented")},t.prototype.max=function(t,e){throw new Error("Not yet implemented")},t.prototype.maximum=function(t,e){throw new Error("Not yet implemented")},t.prototype.all=function(t,e){throw new Error("Not yet implemented")},t.prototype.any=function(t,e){throw new Error("Not yet implemented")},t.prototype.squaredDifference=function(t,e){throw new Error("Not yet implemented")},t.prototype.ceil=function(t){throw new Error("Not yet implemented")},t.prototype.floor=function(t){throw new Error("Not yet implemented")},t.prototype.round=function(t){throw new Error("Not yet implemented")},t.prototype.sign=function(t){throw new Error("Not yet implemented")},t.prototype.isNaN=function(t){throw new Error("Not yet implemented")},t.prototype.isInf=function(t){throw new Error("Not yet implemented")},t.prototype.isFinite=function(t){throw new Error("Not yet implemented")},t.prototype.pow=function(t,e){throw new Error("Not yet implemented")},t.prototype.exp=function(t){throw new Error("Not yet implemented")},t.prototype.expm1=function(t){throw new Error("Not yet implemented")},t.prototype.log=function(t){throw new Error("Not yet implemented")},t.prototype.log1p=function(t){throw new Error("Not yet implemented")},t.prototype.sqrt=function(t){throw new Error("Not yet implemented")},t.prototype.rsqrt=function(t){throw new Error("Not yet implemented")},t.prototype.square=function(t){throw new Error("Not yet implemented")},t.prototype.reciprocal=function(t){throw new Error("Not yet implemented")},t.prototype.relu=function(t){throw new Error("Not yet implemented")},t.prototype.prelu=function(t,e){throw new Error("Not yet implemented")},t.prototype.elu=function(t){throw new Error("Not yet implemented")},t.prototype.eluDer=function(t,e){throw new Error("Not yet implemented")},t.prototype.selu=function(t){throw new Error("Not yet implemented")},t.prototype.int=function(t){throw new Error("Not yet implemented")},t.prototype.clip=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.abs=function(t){throw new Error("Not yet implemented")},t.prototype.complexAbs=function(t){throw new Error("Not yet implemented")},t.prototype.sigmoid=function(t){throw new Error("Not yet implemented")},t.prototype.softplus=function(t){throw new Error("Not yet implemented")},t.prototype.sin=function(t){throw new Error("Not yet implemented")},t.prototype.cos=function(t){throw new Error("Not yet implemented")},t.prototype.tan=function(t){throw new Error("Not yet implemented")},t.prototype.asin=function(t){throw new Error("Not yet implemented")},t.prototype.acos=function(t){throw new Error("Not yet implemented")},t.prototype.atan=function(t){throw new Error("Not yet implemented")},t.prototype.atan2=function(t,e){throw new Error("Not yet implemented")},t.prototype.sinh=function(t){throw new Error("Not yet implemented")},t.prototype.cosh=function(t){throw new Error("Not yet implemented")},t.prototype.tanh=function(t){throw new Error("Not yet implemented")},t.prototype.asinh=function(t){throw new Error("Not yet implemented")},t.prototype.acosh=function(t){throw new Error("Not yet implemented")},t.prototype.atanh=function(t){throw new Error("Not yet implemented")},t.prototype.erf=function(t){throw new Error("Not yet implemented")},t.prototype.step=function(t,e){throw new Error("Not yet implemented")},t.prototype.conv2d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2D=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.maxPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.maxPoolBackprop=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.avgPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.avgPoolBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.reshape=function(t,e){throw new Error("Not yet implemented")},t.prototype.cast=function(t,e){throw new Error("Not yet implemented")},t.prototype.tile=function(t,e){throw new Error("Not yet implemented")},t.prototype.pad=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.transpose=function(t,e){throw new Error("Not yet implemented")},t.prototype.gather=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.gatherND=function(t,e){throw new Error("Not yet implemented")},t.prototype.scatterND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchToSpaceND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.spaceToBatchND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeBilinear=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeBilinearBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchNormalization=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){throw new Error("Not yet implemented")},t.prototype.multinomial=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.oneHot=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.cumsum=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.fft=function(t){throw new Error("Not yet implemented")},t.prototype.ifft=function(t){throw new Error("Not yet implemented")},t.prototype.complex=function(t,e){throw new Error("Not yet implemented")},t.prototype.real=function(t){throw new Error("Not yet implemented")},t.prototype.imag=function(t){throw new Error("Not yet implemented")},t.prototype.cropAndResize=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.depthToSpace=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.split=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.sparseToDense=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.fill=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.onesLike=function(t){throw new Error("Not yet implemented")},t.prototype.zerosLike=function(t){throw new Error("Not yet implemented")},t.prototype.linspace=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.dispose=function(){throw new Error("Not yet implemented")},t}();function _g(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var i=n-1-o;(e[e.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function Dg(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],i=e.length-r-1;(null==o||1===o&&e[i]>1)&&n.unshift(i)}return n}function Og(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)n.unshift(a);else if(1===a)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(i)}}return n}function Mg(t,e,n,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=Bg(e),l=u[0],c=u[1];if("channelsLast"===a)s=[l,c,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[l,c,t[1],t[1]]}return Fg(t,s,n,r,o,i,!1,a)}function Fg(t,e,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],h=u[3];if("channelsLast"===s)l=t[0],c=t[1],p=t[2],h=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=t[0],h=t[1],c=t[2],p=t[3]}var f,d=e[0],m=e[1],v=e[3],g=Bg(n),y=g[0],b=g[1],w=Bg(r),x=w[0],C=w[1],E=Ug(d,x),S=Ug(m,C),k=function(t,e,n,r,o,i,a,s){var u,l,c;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var p=function(t,e,n,r,o){null==r&&(r=Lg(t,e,n));var i=t[1],a=Vg((t[0]-e+2*r)/n+1,o);tf(sf(a),function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"});var s=Vg((i-e+2*r)/n+1,o);return tf(sf(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[a,s]}([e,n],i,r,t,s);l=p[0],c=p[1]}else if("same"===t){l=Math.ceil(e/r),c=Math.ceil(n/o);var h=Math.max(0,(l-1)*r+i-e),f=Math.max(0,(c-1)*o+a-n),d=Math.floor(h/2),m=h-d,v=Math.floor(f/2);u={top:d,bottom:m,left:v,right:f-v,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),c=Math.ceil((n-a+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,p,y,b,E,S,i),N=k.outHeight,I=k.outWidth,R=a?v*h:v;return"channelsFirst"===s?f=[l,R,N,I]:"channelsLast"===s&&(f=[l,N,I,R]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:p,inChannels:h,outHeight:N,outWidth:I,outChannels:R,padInfo:k.padInfo,strideHeight:y,strideWidth:b,filterHeight:d,filterWidth:m,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationHeight:x,dilationWidth:C,inShape:t,outShape:f,filterShape:e}}function Pg(t,e,n,r,o,i,a){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],p=s[3],h=s[4];if("channelsLast"===a)u=t[0],l=t[1],c=t[2],p=t[3],h=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);u=t[0],h=t[1],l=t[2],c=t[3],p=t[4]}var f,d=e[0],m=e[1],v=e[2],g=e[4],y=zg(n),b=y[0],w=y[1],x=y[2],C=zg(r),E=C[0],S=C[1],k=C[2],N=function(t,e,n,r,o,i,a,s,u,l){var c,p,h,f;if("same"===t){var d=((p=Math.ceil(e/o))-1)*o+s-e,m=((h=Math.ceil(n/i))-1)*i+u-n,v=((f=Math.ceil(r/a))-1)*a+l-r,g=Math.floor(d/2),y=d-g,b=Math.floor(m/2),w=m-b,x=Math.floor(v/2);c={top:b,bottom:w,left:x,right:v-x,front:g,back:y,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((e-s+1)/o),h=Math.ceil((n-u+1)/i),f=Math.ceil((r-l+1)/a)}return{padInfo:c,outDepth:p,outHeight:h,outWidth:f}}(o,l,c,p,b,w,x,Ug(d,E),Ug(m,S),Ug(v,k)),I=N.outDepth,R=N.outHeight,A=N.outWidth,T=i?g*h:g;return"channelsFirst"===a?f=[u,T,I,R,A]:"channelsLast"===a&&(f=[u,I,R,A,T]),{batchSize:u,dataFormat:a,inDepth:l,inHeight:c,inWidth:p,inChannels:h,outDepth:I,outHeight:R,outWidth:A,outChannels:T,padInfo:N.padInfo,strideDepth:b,strideHeight:w,strideWidth:x,filterDepth:d,filterHeight:m,filterWidth:v,dilationDepth:E,dilationHeight:S,dilationWidth:k,inShape:t,outShape:f,filterShape:e}}function Lg(t,e,n,r){void 0===r&&(r=1);var o=Ug(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}function Bg(t){return"number"==typeof t?[t,t]:t}function zg(t){return"number"==typeof t?[t,t,t]:t}function Ug(t,e){return e<=1?t:t+(t-1)*(e-1)}function Vg(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function Wg(t){var e=Bg(t);return 1===e[0]&&1===e[1]}function jg(t,e){return Wg(t)||Wg(e)}function Hg(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=cv(t.shape),o=t.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!wf(t.dtype,e))return Qf.make(t.shape,{dataId:t.dataId},e);if("complex64"===t.dtype){var a=n.real(t);return i=a.cast(e),a.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){var s=nv(0,t.dtype);return i=n.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function Gg(t,e){return Qf.make(e,{dataId:t.dataId},t.dtype)}function qg(t,e,n){var r=(e-t)/(n-1),o=Mf(n,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return rv(o,"float32")}var Kg=Object.freeze({castTensor:Hg,reshapeTensor:Gg,linspaceImpl:qg,upcastType:sd,axesAreInnerMostDims:Um,combineLocations:Vm,computeOutAndReduceShapes:Wm,expandShapeToKeepDim:jm,assertAxesAreInnerMostDims:Hm,getAxesPermutation:Gm,getUndoAxesPermutation:qm,getInnerMostAxes:Km,getBroadcastDims:_g,getReductionAxes:Dg,assertAndGetBroadcastShape:Og,assertParamsConsistent:$m,computeOutShape:Xm,computePool2DInfo:Mg,computeConv2DInfo:Fg,computeConv3DInfo:Pg,computeDefaultPad:Lg,tupleValuesAreOne:Wg,eitherStridesOrDilationsAreOne:jg});function $g(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function Xg(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Yg(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Qg(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function Zg(t,e,n,r,o){for(var i=Array.from(e).map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>o}).sort(function(t,e){return e.score-t.score}),a=[],s=0;s<i.length;s++){var u=i[s],l=u.boxIndex;if(u.score<o)break;for(var c=!1,p=a.length-1;p>=0;--p)if(Jg(t,l,a[p])>=r){c=!0;break}if(!c&&(a.push(l),a.length>=n))break}return rv(a,"int32")}function Jg(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),f=(s-i)*(u-a),d=(p-l)*(h-c);if(f<=0||d<=0)return 0;var m=Math.max(i,l),v=Math.max(a,c),g=Math.min(s,p),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(f+d-b)}function ty(t,e,n){var r=new Array(t.rank).fill(0),o=t.shape.slice();return e.map(function(e){o[n]=e;var i=t.slice(r,o);return r[n]+=e,i})}function ey(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=Ov(n,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function ny(t,e,n,r,o){for(var i=e[e.length-1],a=[t.length/i,i],s=a[0],u=a[1],l=mf(n,s*r),c=mf("int32",s*r),p=0;p<s;p++){for(var h=p*u,f=t.subarray(h,h+u),d=[],m=0;m<f.length;m++)d.push({value:f[m],index:m});d.sort(function(t,e){return e.value-t.value});var v=p*r,g=l.subarray(v,v+r),y=c.subarray(v,v+r);for(m=0;m<r;m++)g[m]=d[m].value,y[m]=d[m].index}var b=e.slice();return b[b.length-1]=r,[tv(l,b,n),tv(c,b,"int32")]}function ry(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=Ov(t,"int32"),i=Ov([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]);i.values.set(a,r*t.length)}return i.toTensor()}var oy=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},iy=function(t,e){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},ay=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,i=Math.ceil(t.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function sy(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function uy(t,e){return 1===e?[t]:sy(t,e)}function ly(){var t,e,n,r,o,i,a,s,u,l;return 2===Kh.getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 0. || val == 0.) ? false : true;\n      }\n    ",u="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function cy(t,e,n){void 0===n&&(n="index");var r=Tf(e);return r.map(function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"}).join("")}function py(t){var e=Tf(t).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var hy="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function fy(t){return"offset"+t}function dy(t){var e=t.name,n=of(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function my(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function vy(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function gy(t,e){return e.map(function(e){return t[e]}).join(", ")}var yy=function(t,e,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,tf(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=Math.ceil(t[t.length-1]/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var i,a,s=this.outputShape,u=s.length,l=my(u),c=uy("coords",u);if(1===o){var p=my(a=u+1);i="\n        "+p+" sourceLocR = "+p+"("+c.join()+", 0);\n        ++"+c[u-1]+";\n        "+p+" sourceLocG = "+p+"("+c.join()+", 0);\n        ++"+c[u-2]+";\n        "+p+" sourceLocA = "+p+"("+c.join()+", 0);\n        --"+c[u-1]+";\n        "+p+" sourceLocB = "+p+"("+c.join()+", 0);\n        --"+c[u-2]+";"}else a=u,i="\n        "+l+" sourceLocR = coords;\n        ++"+c[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+c[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+c[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+c[u-2]+";";var h=["x","y","z","w","u","v"].slice(0,a),f="."+h[a-1],d=h.map(function(t){return"int "+t}),m=uy("sourceLocR",a-1).concat("inIdx.r"),v=uy("sourceLocG",a-1).concat("inIdx.g"),g=uy("sourceLocB",a-1).concat("inIdx.b"),y=uy("sourceLocA",a-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",x="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+g.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+d.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+d.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+c[u-1]+" < "+(s[u-1]-1)+";\n        bool hasNextRow = "+c[u-2]+" < "+(s[u-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+x+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+x+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},by=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},wy=function(t,e,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Og(t,e),Og(t,n);var a="0.0";null!=r&&(Og(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Og(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},xy=function(t,e,n,r,o,i){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],Og(t,e),Og(t,n);var a="vec4(0.0)";null!=r&&(Og(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Og(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Cy=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Og(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Ey="return a + b;",Sy="return a - b;",ky="return a * b;",Ny=function(t,e,n){this.variableNames=["A","B"],this.outputShape=Og(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Iy=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=Og(e,n);var o=this.outputShape.length,i="";if(r)if(0===o||1===of(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+my(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=uy("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},Ry=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Ay=function(){function t(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"min"),n.maxLoc=r.getUniformLocationNoThrow(o,"max")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Ty=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},_y=function(t){this.outputShape=[],this.outputShape=Xm(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++)r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+e[n-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Dy=function(t,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Xm(t,e);var n=this.outputShape,r=n.length,o=my(r),i=uy("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(t,e){return"T"+e});var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var l=a[e],c="vec2("+a.slice(-2).join()+")",p=a.join(),h="if ("+l+" < "+s[0]+")\n          return getChannel(getT0("+p+"), "+c+");";for(u=1;u<s.length;u++)h+="\n        else if ("+l+" < "+s[u]+") {\n          "+l+" -= "+s[u-1]+";\n          return getChannel(getT"+u+"("+p+"), "+c+");\n        }";h+="\n        else {\n          "+l+" -= "+s[s.length-1]+";\n          return getChannel(getT"+s.length+"("+p+"), "+c+");\n        }",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n        if (++"+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n        if (++"+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            --"+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "},Oy=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},My=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Fy=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Py=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ly=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},By=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+r+"; dm++) {\n              int d2 = d1 * "+r+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},zy=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.top,n=t.padInfo.left,r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,s=t.filterHeight,u=t.filterWidth,l=4*Math.floor(t.inChannels/4),c=t.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+e+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+i+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Uy=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterDepth,p=t.filterHeight,h=t.filterWidth,f=4*Math.floor(t.inChannels/4),d=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Vy=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+t.strideHeight+", "+t.strideWidth+");\n      const ivec2 pads = ivec2("+t.padInfo.top+", "+t.padInfo.left+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+e+";\n        int q = d2 - d1 * "+e+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+t.filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+t.dilationHeight+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+t.filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+t.dilationWidth+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wy=function(t){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=t.outShape;for(var e=t.inHeight,n=t.inWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.strideHeight,a=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,p=c,h="int xR; int xC; int xCOffset;",f=0;f<l;f++)for(var d=0;d<c;d++)h+="\n          vec4 xTexelR"+f+"C"+2*d+" = vec4(0.);\n          vec4 wR"+f+"C"+d+" = vec4(0.);\n          vec4 xR"+f+"C"+d+" = vec4(0.);";for(f=0;f<l;f++)for(var m=0;m<p;m++){if(h+="\n          xR = xRCorner + "+f*s+";\n          xC = xCCorner + "+(d=2*m)*u+";\n        ",1===a){if(d<c&&(h+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+f+"C"+d+" = vec4(previous.zw, xTexelR"+f+"C"+d+".xy);\n                } else {\n                  xR"+f+"C"+d+" = vec4(0, 0, xTexelR"+f+"C"+d+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = xTexelR"+f+"C"+d+";\n              ",d+1<c)){var v=o%2==0?Zh(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(h+="\n                  xCOffset = xC + "+o%2+" + "+v+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",u>1&&(h+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+e+" &&\n                      xCOffset >= 0 && xCOffset < "+n+") {\n                      xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+f+"C"+d+" = vec4(0.);\n                    }\n                  "),h+="\n                  xR"+f+"C"+(d+1)+" = vec4(\n                    xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".xy);\n                "):h+="\n                  xCOffset = xC + "+v+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+f+"C"+(d+1)+" = xTexelR"+f+"C"+(d+2)+";\n                "}}else d<c&&(h+="\n              if(xR >= 0 && xR < "+e+") {\n            ",o%2==1?(h+="\n                xCOffset = xC + 1 - "+a+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+n+") {\n                  xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+f+"C"+(d+2)+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = vec4(\n                  xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".zw);\n              ",d+1<c&&(h+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+a+";\n                  if(xCOffset >= 0 && xCOffset < "+n+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+f+"C"+(d+1)+" = vec4(xTexelR"+f+"C"+(d+2)+".xy, final.xy);\n                ")):(h+="\n                if(xC >= 0 && xC < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+a+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+(d+2)+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = vec4(\n                  xTexelR"+f+"C"+d+".xy, xTexelR"+f+"C"+(d+2)+".xy);\n              ",d+1<c&&(h+="\n                  xR"+f+"C"+(d+1)+" = vec4(\n                    xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".zw);\n                ")),h+="}");d<c&&(h+="\n            vec4 wTexelR"+f+"C"+d+" = getW("+f+", "+d+", d1, q);\n            wR"+f+"C"+d+" = vec4(wTexelR"+f+"C"+d+".xz, wTexelR"+f+"C"+d+".xz);\n          ",d+1<c&&(h+="\n              vec4 wTexelR"+f+"C"+(d+1)+" = getW("+f+", "+(d+1)+", d1, q);\n              wR"+f+"C"+(d+1)+" =\n                vec4(wTexelR"+f+"C"+(d+1)+".xz, wTexelR"+f+"C"+(d+1)+".xz);"))}for(f=0;f<l;f++)for(d=0;d<c;d++)h+="result += xR"+f+"C"+d+" * wR"+f+"C"+d+";";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},jy=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],u=n[0],l=n[1];this.outputShape=[e[0],u,l,t[3]];var c=[a-1+".0",s-1+".0"],p=c[0],h=c[1],f=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],d=l>1?[""+(s-1)/(l-1),"(x2-x1) * width_ratio","x1*"+h+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+h];this.userCode="\n      const float height_ratio = float("+f[0]+");\n      const float width_ratio = float("+d[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+f[1]+";\n        float width_scale = "+d[1]+";\n\n        float in_y = "+f[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+d[2]+";\n        if( in_x < 0.0 || in_x > "+h+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Hy=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+my(r)+" coords = getOutputCoords();\n        int end = "+Gy(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+Gy(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===r)return""+e;if(2===r)return e+".x, "+e+".y";if(3===r)return e+".x, "+e+".y, "+e+".z";if(4===r)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}(0,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Gy(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var qy,Ky,$y=function(t,e){this.variableNames=["A"];var n=ly();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+cy(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Xy=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0;var n=ly();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+cy(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Yy=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Qy=function(t){this.variableNames=["A"];var e=ly();this.outputShape=t,this.userCode="\n      "+hy+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},Zy=function(t){this.variableNames=["A"],this.usesPackedTextures=!0;var e=ly();this.outputShape=t,this.userCode="\n      "+hy+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},Jy=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=ly(),o=e[0],i=e[1];this.outputShape=t;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+py(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex /= 4;\n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},tb=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=ly(),o=e[0],i=e[1];this.outputShape=t;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+t[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n    \n              flatIndex /= 4;\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+py(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n        \n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},eb=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(n?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},nb=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),rb=function(t){this.variableNames=["A"];var e=ly(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},ob=function(t){this.variableNames=["A"];var e=ly(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},ib=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=my(this.rank),i=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<t.length;i++)o.push(i===e?"int(getIndices("+r[i]+"))":""+r[i]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},ab=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=my(e.length),o=my(n.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function sb(t,e){return[e,t]}function ub(t){var e=of(t);return lf(Math.ceil(e/4))}function lb(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function cb(t,e){var n=ly();return Ad(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function pb(t,e){return Ld(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function hb(t,e){return Bd(t,e,new Uint16Array([0,1,2,2,1,3]))}function fb(t,e){var n,r,o,i,a,s,u,l,c=t;return 2===Kh.getNumber("WEBGL_VERSION")?(n=c.R32F,r=c.R16F,o=c.RGBA16F,i=c.RGBA32F,a=c.RED,s=4,u=1,l=c.HALF_FLOAT):(n=t.RGBA,r=t.RGBA,o=t.RGBA,i=c.RGBA,a=t.RGBA,s=4,u=4,l=null!=e?e.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function db(t,e,n,r,o,i,a){Ud(n,r);var s=zd(t,e),u=t.TEXTURE_2D;return Ed(t,e,function(){return t.bindTexture(u,s)}),Ed(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Ed(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Ed(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Ed(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Ed(t,e,function(){return t.texImage2D(u,0,o,n,r,0,i,a,null)}),Ed(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function mb(t,e,n,r,o){var i=sb(n,r);return db(t,e,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function vb(t,e,n,r,o){var i=sb(n,r);return db(t,e,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function gb(t,e,n,r,o){var i=sb(n,r);return db(t,e,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function yb(t,e,n,r,o){var i=lb(n,r);return db(t,e,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function bb(t,e,n,r,o){var i=lb(n,r);return db(t,e,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function wb(t,e,n,r){return Ed(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Wd(t,e,n,"clipSpacePos",r,3,20,0)&&Wd(t,e,n,"uv",r,2,20,12)}function xb(t,e,n,r,o,i,a){var s,u,l;Ed(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,l=a.internalFormatPackedFloat),s.set(i),Ed(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,l,r,o,0,t.RGBA,u,s)}),Ed(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Cb(t,e,n,r){Ed(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Ed(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):Ed(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),Ed(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function Eb(t,e,n,r,o){var i=t.createBuffer();Ed(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var a=16*n*r;return Ed(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),Ed(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),Ed(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}function Sb(t,e,n){var r=t,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function kb(t,e,n,r,o){var i=sb(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return Ed(t,e,function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Nb(t,e,n,r,o,i,a,s){var u=t,l=new Float32Array(function(t,e){var n=lb(i,a);return n[0]*n[1]*4}());return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function Ib(t,e,n,r){var o=new Float32Array(n*r*4);return Ed(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,o)}),o}!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(qy||(qy={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Ky||(Ky={}));var Rb=Object.freeze({createVertexShader:cb,createVertexBuffer:pb,createIndexBuffer:hb,getTextureConfig:fb,createFloat32MatrixTexture:mb,createFloat16MatrixTexture:vb,createUnsignedBytesMatrixTexture:gb,createPackedMatrixTexture:yb,createFloat16PackedMatrixTexture:bb,bindVertexProgramAttributeStreams:wb,uploadDenseMatrixToTexture:xb,uploadPixelDataToTexture:Cb,createBufferFromOutputTexture:Eb,downloadFloat32MatrixFromBuffer:Sb,downloadByteEncodedFloatMatrixFromOutputTexture:kb,downloadPackedMatrixFromBuffer:Nb,downloadMatrixFromPackedOutputTexture:Ib}),Ab=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=Kh.getNumber("WEBGL_VERSION");null!=t?(this.gl=t,wd(e,t)):this.gl=xd(e),1===Kh.getNumber("WEBGL_VERSION")?(this.textureFloatExtension=Rd(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),Kh.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Rd(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Rd(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=pb(this.gl,this.debug),this.indexBuffer=hb(this.gl,this.debug),this.framebuffer=Vd(this.gl,this.debug),this.textureConfig=fb(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return Kh.getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Ed(e,this.debug,function(){return e.finish()}),Ed(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Ed(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Ed(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Ed(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Ed(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),mb(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),vb(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),gb(this.gl,this.debug,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Cb(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),xb(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),bb(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),yb(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&($d(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ed(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return kb(r.gl,r.debug,e,n,r.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,i){return Nb(this.gl,t,0,0,0,o,i)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return Sb(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=Eb(this.gl,this.debug,e,n);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(Kh.getBool("WEBGL_FENCE_API_ENABLED")){var o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(i,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=i}else Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return Ib(r.gl,r.debug,e,n)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=Td(e,this.debug,t),r=cb(e,this.debug),o=Md(e,this.debug);return Ed(e,this.debug,function(){return e.attachShader(o,r)}),Ed(e,this.debug,function(){return e.attachShader(o,n)}),Fd(e,this.debug,o),this.debug&&Pd(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=wb(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Ed(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&Pd(this.gl,this.debug,this.program),Ed(this.gl,this.debug,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Hd(this.gl,this.debug,t,e):Gd(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Ed(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),qd(this.gl,this.debug,0,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=lb(e,n);this.setOutputMatrixTextureDriver(t,r[0],r[1])},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Pd(this.gl,this.debug,this.program),Xd(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Ed(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Ed(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Rd(this.gl,this.debug,2===Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return jh(this,void 0,void 0,function(){var e=this;return Hh(this,function(n){switch(n.label){case 0:return[4,pf(function(){return e.disposed||e.isQueryAvailable(t,Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||pf(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Kd(this.gl,this.debug,t,this.framebuffer),this.debug&&Xd(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Kd(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Xd(this.gl)):$d(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;Kd(r,this.debug,t,this.framebuffer),this.debug&&Xd(r),this.outputTexture=t,Ed(r,this.debug,function(){return r.viewport(0,0,e,n)}),Ed(r,this.debug,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),Ed(this.gl,this.debug,function(){return o.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function Tb(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,o=e[n],i=o.shape;if(!af(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!af(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var _b=function(t,e,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;for(var r=n.inChannels,o=n.strideWidth,i=n.strideHeight,a=n.padInfo,s=n.outWidth,u=n.dilationWidth,l=n.dilationHeight,c=a.left,p=a.top,h=r*n.filterWidth,f=ly(),d="",m=0;m<=1;m++)for(var v=0;v<=1;v++)d+="\n          blockIndex = rc.y + "+v+";\n          pos = rc.x + "+m+";\n          \n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+s+")) * "+i+" - "+p+";\n            d0 = offsetY + "+l+" * (pos / "+h+");\n  \n            if(d0 < "+e[0]+" && d0 >= 0) {\n              offsetX = int(mod(float(blockIndex), "+s+".) * "+o+". - "+c+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+h+".) / "+r+".));\n    \n              if(d1 < "+e[1]+" && d1 >= 0) {\n                innerDims = vec2(d1, int(mod(float(pos), "+r+".)));\n                result["+(2*m+v)+"] = getChannel(getA(d0, int(innerDims.x),\n                                                  int(innerDims.y)), innerDims);\n              }\n            }\n  \n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1;\n        vec2 innerDims;\n\n        "+d+"\n\n        "+f.output+" = result;\n      }\n    "},Db=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},Ob=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Mb=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},Fb=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(e*n-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Pb=function(t,e,n,r,o,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var a=Math.ceil((n?t[1]:t[2])/2),s=n?"i * 2, rc.y":"rc.y, i * 2",u=r?"rc.z, i * 2":"i * 2, rc.z",l=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],c=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",h="";i&&(p="vec4 activation(vec4 x) {\n        "+i+"\n      }",h="result = activation(result);");var f=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+a+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+a+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+s+");\n          vec4 b = getMatrixB(rc.x, "+u+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+l[0]+" * "+c[0]+");\n          result += ("+l[1]+" * "+c[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+f+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},Lb=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),Bb=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},zb=function(t){this.variableNames=["A"],this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=uy("rc",e),r=my(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),i=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<t;a++)i=e[e.length-1-a]+","+i;n.push(i)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},Ub=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,o=my(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Vb=function(t,e,n){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});for(var r=t.length,o=my(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=uy("rc",r),u=uy("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",p=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",d=0,m=1===r?2:4;d<m;d++)f+="\n        "+p[d]+"\n        if ("+h+") {\n          result["+d+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+d+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(f+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Wb=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var h="avg"===e,f="0.0";if(h||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+c+", "+p+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(d="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+c+", "+p+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}},jb=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,p="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===e?(a="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(a="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "},Hb=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+cy(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+py(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Gb=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},qb=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Kb=function(t,e,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var o=t[1],i=t[2],a=t[3];this.outputShape=[t[0],e,n,a];var s=[r&&e>1?o-1:o,r&&n>1?i-1:i],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/u[0]+",\n          "+s[1]/u[1]+",\n          "+s[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+"; \n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},$b=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Xb=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Yb=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=my(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},Qb=function(t,e){this.variableNames=["x"],this.usesPackedTextures=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=uy("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=my(n);function s(n){var r=t.map(function(r,o){return function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",s(t)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Zb=function(t,e,n,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=my(o.length),u=my(i.length),l="";1===n?l="i":2===n&&(l="i, j");var c="";1===r?c="i":2===r&&(c="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+l+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+c+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Jb=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var p="";o%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+p+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},tw=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var l=my(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},ew=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=my(this.rank),r="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return nw.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map(function(t,e){return"sourceLoc."+nw[e]+" = start["+e+"] + coords."+nw[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),nw=["x","y","z","w","u","v"],rw=function(){function t(t){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=t,this.rank=t.length;var e=my(this.rank),n=uy("coords",this.rank),r=uy("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+o+")",a="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(t,e){return"start["+e+"]"}).join()+");":t.map(function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+" \n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),ow=function(t,e,n,r){this.variableNames=["x"];var o=n.filter(function(t,e){return-1===r.indexOf(e)});this.outputShape=o;var i=n.length,a=my(n.length),s=my(o.length),u="";if(1===i)u="coords * strides + begin";else{var l=0;u=n.map(function(t,e){return-1===r.indexOf(e)?(l++,1===o.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(l-1)+"] * strides["+e+"] + begin["+e+"]"):"begin["+e+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+t+");\n      "+a+" strides = "+a+"("+e+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},iw=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=aw(e,n),i=sw(t,o,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===Ky.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===Ky.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===Ky.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===Ky.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===Ky.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=sw(e,aw(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function aw(t,e){if(t===qy.UPLOAD)return Ky.PACKED_2X2_FLOAT32;if(t===qy.RENDER||null==t)return e?Kh.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Ky.PACKED_2X2_FLOAT32:Ky.PACKED_2X2_FLOAT16:Kh.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Ky.UNPACKED_FLOAT32:Ky.UNPACKED_FLOAT16;if(t===qy.DOWNLOAD||t===qy.PIXELS)return Ky.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function sw(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var uw=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=my(this.rank),i=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},lw=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=my(this.rank),i=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},cw=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=my(this.rank),i=sy("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},pw=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},hw="if (isnan(x)) return x;",fw=hw+"\n  return (x < 0.0) ? 0.0 : x;\n",dw="return exp(x);",mw="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",vw=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},gw=function(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;var e=t.length,n=uy("rc",e),r=my(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),i=n.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},yw={},bw=600,ww=function(){function t(t){if(this.gpgpu=t,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!Kh.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var e=xd(Kh.getNumber("WEBGL_VERSION"));this.binaryCache=(n=Kh.getNumber("WEBGL_VERSION"))in yw?yw[n]:(yw[n]={},yw[n]),this.gpgpu=new Ab(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;var n;this.textureManager=new iw(this.gpgpu),this.numMBBeforeWarning=null==Kh.global.screen?1024:Kh.global.screen.height*Kh.global.screen.width*window.devicePixelRatio*bw/1024/1024,this.texData=new Ag(this,vd)}return t.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n})},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[t.height,t.width],r=[t.height,t.width,e],o="undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement,i=t.data instanceof Uint8Array,a="undefined"!=typeof ImageData&&t instanceof ImageData,s="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement;if(!(o||i||a||s||u))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);if(u||s){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=Cd(Kh.getNumber("WEBGL_VERSION")).getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}var l,c,p=this.makeTensorHandle(n,"int32");if(this.texData.get(p.dataId).usage=qy.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(p.dataId),t),Kh.getBool("WEBGL_PACK")){l=new ob(r);var h=this.makePackedTensor(l.outputShape,p.dtype);c=this.compileAndRun(l,[p],h)}else l=new rb(r),c=this.compileAndRun(l,[p]);return this.disposeData(p.dataId),c},t.prototype.makeTensorHandle=function(t,e){var n={};return this.register(n,t,e),{dataId:n,shape:t,dtype:e}},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");if(Kh.getBool("DEBUG"))for(var n=0;n<e.length;n++){var r=e[n];if(!Nd(r))throw Error("The value "+r+" cannot be represented on this device.")}var o=this.texData.get(t);if("complex64"===o.dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(t),o.usage=qy.UPLOAD,o.values=e},t.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors,i=e.shape;if(null!=e.slice){var a=new pw(i,"return x;"),s=this.compileAndRun(a,[{dataId:t,shape:i,dtype:r}]),u=this.readSync(s.dataId);return s.dispose(),u}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var l,c,p=null!=this.activeTimers;return p&&(l=Ff()),c="complex64"===r?$g(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),p&&(this.downloadWaitMs+=Ff()-l),this.convertAndCacheOnCPU(t,c)},t.prototype.read=function(t){return jh(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,l,c,p,h,f,d,m,v,g,y;return Hh(this,function(b){switch(b.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(t){return n.push(t)})];if(r=this.texData.get(t),o=r.values,i=r.shape,a=r.dtype,s=r.complexTensors,null!=r.slice)return u=new pw(i,"return x;"),l=this.compileAndRun(u,[{dataId:t,shape:i,dtype:a}]),c=this.read(l.dataId),l.dispose(),[2,c];if(null!=o)return[2,this.convertAndCacheOnCPU(t)];if(!Kh.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Kh.getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==a&&Kh.get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(t),t=h.dataId,f=this.texData.get(h.dataId),p=(e=this.gpgpu).createBufferFromTexture.apply(e,[f.texture].concat(ub(i)))),this.pendingRead.set(t,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:b.sent(),b.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return m=b.sent(),d=$g(m[0],m[1]),[3,5];case 4:null==p?d=this.getValuesFromTexture(t):(v=of(i),d=this.gpgpu.downloadFloat32MatrixFromBuffer(p,v),this.disposeData(t)),b.label=5;case 5:return g=this.convertAndCacheOnCPU(t,d),y=this.pendingRead.get(t),this.pendingRead.delete(t),y.forEach(function(t){return t(g)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,g]}})})},t.prototype.getValuesFromTexture=function(t){var e,n=this,r=this.texData.get(t),o=r.shape,i=r.dtype,a=r.isPacked,s=of(o);if(Kh.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),l=this.texData.get(u.dataId),c=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[l.texture].concat(ub(o))).subarray(0,s);return this.disposeData(u.dataId),c}var p=Kh.getBool("WEBGL_PACK")&&!0===a,h=p?em(o):o,f=this.makeTensorHandle(h,"float32");f.size=of(o),this.texData.get(f.dataId).usage=qy.DOWNLOAD;var d=Cm(function(){var e=p?new Zy(h):new Qy(h);return n.compileAndRun(e,[{shape:h,dtype:i,dataId:t}],f,null)}),m=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,s);return this.disposeData(f.dataId),v},t.prototype.time=function(t){return jh(this,void 0,void 0,function(){var e,n,r,o,i,a,s;return Hh(this,function(u){switch(u.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),o=rf(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),i=rf(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return a=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:Jh(a),getExtraProfileInfo:function(){return a.map(function(t,e){return{name:i[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:Ff(),endMs:null}},t.prototype.endTimer=function(t){return Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=Ff(),t)},t.prototype.getQueryTime=function(t){return jh(this,void 0,void 0,function(){var e;return Hh(this,function(n){return Kh.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},t.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t))if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}},t.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,o=e.texShape,i=e.usage,a=e.isPacked,s=e.slice,u=s&&s.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,i,a)));var c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getCPUBackend=function(){return Kh.getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=vd.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(t,e){var n=this.makeOutputArray(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:vd.keep(t.clone()),imag:vd.keep(e.clone())},n},t.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},t.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===of(n))return tv([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,o=yg(t.shape,e,n);if(r||!o){var i=Kh.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rw(n):new ew(n),a=i.getCustomSetupFunc(e);return this.compileAndRun(i,[t],null,a)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},t.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),o=Qf.make(n,{},t.dtype,this),i=this.texData.get(o.dataId);Object.assign(i,r),i.shape=n,i.dtype=t.dtype;var a=bg(e,t.strides);r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r,o,i,a,s,u);var l=mg(t.shape,e,n,r,o,i,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return-1===h.indexOf(e)});if(f.some(function(t){return 0===t}))return tv([],f);var d=new ow(c,r,p,h);return this.compileAndRun(d,[t])},t.prototype.reverse=function(t,e){var n=Kh.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qb(t.shape,e):new Yb(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.concat=function(t,e){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>Kh.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),r=this.concat(t.slice(0,n),e),o=this.concat(t.slice(n),e);return this.concat([r,o],e)}if(Kh.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var i=new Dy(t.map(function(t){return t.shape}),e);return this.compileAndRun(i,t)}var a=Xm(t.map(function(t){return t.shape}),e),s=t.map(function(t){return t.as2D(-1,of(t.shape.slice(e)))}),u=new _y(s.map(function(t){return t.shape}));return this.compileAndRun(u,s).reshape(a)},t.prototype.neg=function(t){var e=new pw(t.shape,"return -x;");return this.compileAndRun(e,[t])},t.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===i)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===i?t:t.as3D(s,a,1),l=1===i?2:1,c=1===i?e.as3D(s,1,a):e;return this.multiply(u,c).sum(l,!0)}var p=sd(t.dtype,e.dtype),h=new Pb(t.shape,[s,o,i],n,r),f=this.makePackedTensor(h.outputShape,p);return this.compileAndRun(h,[t,e],f)},t.prototype.fusedBatchMatMul=function(t,e,n,r,o,i){var a=n?t.shape[2]:t.shape[1],s=r?e.shape[1]:e.shape[2],u=t.shape[0],l=sd(t.dtype,e.dtype),c=new Pb(t.shape,[u,a,s],n,r,!!o,i?function(t,e){if(void 0===e&&(e=!1),"linear"===i)return"return x;";if("relu"===i)return e?mw:fw;throw new Error("Activation "+i+" has not been implemented for the WebGL backend.")}(0,!0):null),p=this.makePackedTensor(c.outputShape,l),h=[t,e];return o&&h.push(o),this.compileAndRun(c,h,p)},t.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new Cy("return areal * breal - aimag * bimag;",t.shape,e.shape),i=new Cy("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag),this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(o,a),u=this.compileAndRun(i,a),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,ky,t.dtype);var c=new Ny(ky,t.shape,e.shape),p=this.makeOutputArray(c.outputShape,t.dtype);return this.compileAndRun(c,[t,e],p)},t.prototype.batchNormalization=function(t,e,n,r,o,i){var a=[t,e,n],s=null;null!=i&&(s=i.shape,a.push(i));var u=null;if(null!=o&&(u=o.shape,a.push(o)),Kh.getBool("WEBGL_PACK_NORMALIZATION")){var l=new xy(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(l,a)}var c=new wy(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(c,a)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){var i=Kh.getBool("WEBGL_PACK_NORMALIZATION")?new Mb(t.shape,e,n,r,o):new Db(t.shape,e,n,r,o);return this.compileAndRun(i,[t])},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){var s=new Ob(e.shape,r,o,i,a);return this.compileAndRun(s,[e,n,t])},t.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map(function(t){return zf(t)});return ey(Ov(t.shape,t.dtype,n),e)}var r=new uw(t.shape,e);return this.compileAndRun(r,[t])},t.prototype.pad=function(t,e,n){var r=Kh.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vb(t.shape,e,n):new Ub(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=Kh.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cw(t.shape,e):new lw(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new ib(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},t.prototype.batchToSpaceND=function(t,e,n){tf(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=ag(t.shape,e,r),i=sg(o.length,e.length),a=ug(t.shape,e,r),s=lg(n,e.length),u=cg(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){tf(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=ag(a.shape,e,r,!1),u=sg(s.length,e.length,!1),l=ug(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(l)},t.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],i=fg(o),a=new jb({windowSize:i,inSize:o,batchSize:r},e),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],n);return this.compileAndRun(a,[t],u),1===u.shape[1]?u:this.reduce(u,e,n)},t.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var i=fg(o),a=new ay({windowSize:i,inSize:o,batchSize:r},e,null==n),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],"int32"),l=[t];return null!=n&&l.push(n),this.compileAndRun(a,l,u),1===u.shape[1]?u:this.argReduce(t,e,u)},t.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,o=fg(r[r.length-1]),i=new yy(r,o,e,null==n),a=this.makePackedTensor(i.outputShape,"int32");return this.compileAndRun(i,null==n?[t]:[t,n],a),a.rank===t.rank?this.argReducePacked(t,e,a):a},t.prototype.sum=function(t,e){Hm("sum",e,t.rank);var n=Wm(t.shape,e),r=n[0],o=of(n[1]),i=t.as2D(-1,o),a=ud(t.dtype);return this.reduce(i,"sum",a).reshape(r)},t.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=Wm(t.shape,e),r=n[0],o=of(n[1]),i=t.as2D(-1,o),a=ud(t.dtype);return this.reduce(i,"prod",a).reshape(r)},t.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=Gm([r],t.rank),i=t;null!=o&&(i=t.transpose(o),r=Km(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],o=t.length,i=0;i<o;i++)r.push(i!==e?t[i]:n);return r}(i.shape,r,n),s=of([i.shape[r]]),u=i.as2D(-1,s),l=ud(t.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",e,l,n).reshape(a);return null!=o&&(c=c.transpose(qm(o))),c},t.prototype.segOpCompute=function(t,e,n,r,o){var i=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=hg?(n=t,r=!0):n=Af(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Af(t,n+1);return n}(a,o),u=new Jb({windowSize:s,inSize:a,batchSize:i,numSegments:o},e),l=u.outputShape,c=this.makeOutputArray([l[0],l[1]],r);return this.compileAndRun(u,[t,n],c),c.shape[1]===o?c:(n=fv(0,o).tile([a/s]),this.segOpCompute(c,e,n,r,o))},t.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(Hm("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!Kh.getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=Wm(t.shape,r),i=o[0],a=of(o[1]),s=t.as2D(-1,a);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(t,n)},t.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},t.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},t.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new Hy(t.shape,n,r);return this.compileAndRun(o,[t])},t.prototype.equal=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new Ny("return float(a == b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.notEqual=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Ny("return float(a != b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Ny("return float(a < b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.lessEqual=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Ny("return float(a <= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Ny("return float(a > b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greaterEqual=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Ny("return float(a >= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalNot=function(t){var e=new pw(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},t.prototype.logicalAnd=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Ny("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalOr=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Ny("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.select=function(t,e,n){var r=new tw(t.rank,e.shape,e.rank),o=this.makeOutputArray(r.outputShape,sd(e.dtype,n.dtype));return this.compileAndRun(r,[t,e,n],o)},t.prototype.where=function(t){Fm("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return ry(t.shape,e)},t.prototype.topk=function(t,e,n){return ny(t.dataSync(),t.shape,t.dtype,e)},t.prototype.min=function(t,e){Hm("min",e,t.rank);var n=Wm(t.shape,e),r=n[0],o=of(n[1]),i=t.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Iy("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Ny("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.mod=function(t,e){var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Iy("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Ny("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);Hm("max",e,t.rank);var n=Wm(t.shape,e),r=n[0],o=of(n[1]),i=t.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Iy("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Ny("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.all=function(t,e){Hm("all",e,t.rank);var n=Wm(t.shape,e),r=n[0],o=of(n[1]),i=t.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(t,e){Hm("any",e,t.rank);var n=Wm(t.shape,e),r=n[0],o=of(n[1]),i=t.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.squaredDifference=function(t,e){var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Iy("return (a - b) * (a - b);",t.shape,e.shape):new Ny("return (a - b) * (a - b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.realDivide=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(b.x == 0.0) {\n    result.x = NAN;\n  } else if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(b.y == 0.0) {\n    result.y = NAN;\n  } else if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(b.z == 0.0) {\n    result.z = NAN;\n  } else if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(b.w == 0.0) {\n    result.w = NAN;\n  } else if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Ny("\nif (b == 0.0) {\n  return NAN;\n}\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t,e],r)},t.prototype.floorDiv=function(t,e){if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Ny("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[t,e],r)},t.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Ey);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=sd(t.dtype,e.dtype);if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Ey,n);var r=new Ny(Ey,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[t,e],o)},t.prototype.packedBinaryOp=function(t,e,n,r,o){void 0===o&&(o=!1);var i=new Iy(n,t.shape,e.shape,o),a=this.makePackedTensor(i.outputShape,r);return this.compileAndRun(i,[t,e],a)},t.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),i=this.texData.get(e.dataId),a=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map(function(o){var i=o[0],a=o[1],s=r.makeComplexComponentTensorHandle(t,i),u=r.makeComplexComponentTensorHandle(e,a),l=new Ny(n,t.shape,e.shape),c=r.makeOutputArray(l.outputShape,sd(i.dtype,a.dtype));return r.compileAndRun(l,[s,u],c)}),s=a[0],u=a[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorHandle=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},t.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>Kh.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var o=t.map(function(t){return t.dtype}).reduce(function(t,e){return sd(t,e)}),i=t.map(function(t){return t.shape}),a=Kh.getBool("WEBGL_PACK"),s=a?new iy(t[0].shape,i):new oy(t[0].shape,i),u=a?this.makePackedTensor(s.outputShape,o):this.makeOutputArray(s.outputShape,o);return this.compileAndRun(s,t,u)},t.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Sy);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=sd(t.dtype,e.dtype);if(Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Sy,t.dtype);var r=new Ny(Sy,t.shape,e.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[t,e],o)},t.prototype.pow=function(t,e){var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS"),r=n?new Iy("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Ny("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),o=sd(t.dtype,e.dtype),i=n?this.makePackedTensor(r.outputShape,o):this.makeOutputArray(r.outputShape,o);return this.compileAndRun(r,[t,e],i)},t.prototype.ceil=function(t){var e=new pw(t.shape,"return ceil(x);");return this.compileAndRun(e,[t])},t.prototype.floor=function(t){var e=new pw(t.shape,"return floor(x);");return this.compileAndRun(e,[t])},t.prototype.sign=function(t){var e=new pw(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},t.prototype.isNaN=function(t){var e=new pw(t.shape,"return float(isnan(x));"),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},t.prototype.isInf=function(t){var e=new pw(t.shape,"return float(isinf(x));"),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},t.prototype.isFinite=function(t){var e=new pw(t.shape,"return float(!isnan(x) && !isinf(x));"),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},t.prototype.round=function(t){var e=new pw(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},t.prototype.exp=function(t){var e;return e=Kh.getBool("WEBGL_PACK")?new vw(t.shape,dw):new pw(t.shape,dw),this.compileAndRun(e,[t])},t.prototype.expm1=function(t){var e=new pw(t.shape,"return exp(x) - 1.0;");return this.compileAndRun(e,[t])},t.prototype.log=function(t){var e;return e=Kh.getBool("WEBGL_PACK")?new vw(t.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new pw(t.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(e,[t])},t.prototype.log1p=function(t){var e=new pw(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},t.prototype.sqrt=function(t){var e=new pw(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},t.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new pw(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},t.prototype.square=function(t){var e=new pw(t.shape,"return x * x;");return this.compileAndRun(e,[t])},t.prototype.reciprocal=function(t){var e=new pw(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},t.prototype.relu=function(t){var e;return e=Kh.getBool("WEBGL_PACK")?new vw(t.shape,mw):new pw(t.shape,fw),this.compileAndRun(e,[t])},t.prototype.prelu=function(t,e){var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Iy("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",t.shape,e.shape):new Ny("return (a < 0.) ? b * a : a;",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.elu=function(t){var e=new pw(t.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[t])},t.prototype.eluDer=function(t,e){var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Iy("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new Ny("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.selu=function(t){var e=new pw(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},t.prototype.int=function(t){var e=new pw(t.shape,"return float(int(x));"),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},t.prototype.clip=function(t,e,n){var r,o=(r=Kh.getBool("WEBGL_PACK_CLIP")?new Ay(t.shape):new Ry(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,o)},t.prototype.abs=function(t){var e=new pw(t.shape,"return abs(x);");return this.compileAndRun(e,[t])},t.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new Ty(t.shape),r=[this.makeComplexComponentTensorHandle(t,e.complexTensors.real),this.makeComplexComponentTensorHandle(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(t){var e=new pw(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},t.prototype.softplus=function(t){var e=new pw(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},t.prototype.sin=function(t){var e=new pw(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},t.prototype.cos=function(t){var e=new pw(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},t.prototype.tan=function(t){var e=new pw(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},t.prototype.asin=function(t){var e=new pw(t.shape,"return asin(x);");return this.compileAndRun(e,[t])},t.prototype.acos=function(t){var e=new pw(t.shape,"return acos(x);");return this.compileAndRun(e,[t])},t.prototype.atan=function(t){var e=new pw(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},t.prototype.atan2=function(t,e){var n=Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Iy("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Ny("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.sinh=function(t){var e=new pw(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.cosh=function(t){var e=new pw(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.tanh=function(t){var e=new pw(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},t.prototype.asinh=function(t){var e=new pw(t.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},t.prototype.acosh=function(t){var e=new pw(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])},t.prototype.atanh=function(t){var e=new pw(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])},t.prototype.erf=function(t){var e=new pw(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(e,[t])},t.prototype.step=function(t,e){var n=new pw(t.shape,function(t){return void 0===t&&(t=0),hw+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},t.prototype.conv2dByMatMul=function(t,e,n){var r=t.shape,o=this.texData.get(t.dataId),i=r[2]%2!=0&&!!o.isPacked;if((1==r[0]*r[1]*r[2]||1===n.outChannels)&&n.inChannels>1e3||!Kh.getBool("WEBGL_LAZILY_UNPACK")||!Kh.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!i){var a=this.reshape(t,[1,r[0]*r[1]*r[2],n.inChannels]),s=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(a,s,!1,!1),n.outShape)}var u=Qf.make([1,r[0]*r[1]*(r[2]+1),n.inChannels],{dataId:t.dataId},t.dtype,this),l=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,tf(om(o.shape,u.shape),function(){return"packed reshape "+o.shape+" to "+u.shape+" isn't free"});var c=this.reshape(e,[1,n.inChannels,n.outChannels]),p=this.batchMatMul(u,c,!1,!1),h=this.texData.get(p.dataId);return tf(h.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=l,h.shape=n.outShape,Qf.make(n.outShape,{dataId:p.dataId},p.dtype,this)},t.prototype.conv2dWithIm2Row=function(t,e,n){var r=n.outWidth,o=n.outHeight,i=n.filterWidth*n.filterHeight*n.inChannels,a=o*r,s=[i,a],u=t.squeeze([0]),l=e.reshape([1,i,-1]),c=new _b(s,u.shape,n),p=this.compileAndRun(c,[u]).reshape([1,s[0],s[1]]),h=new Pb(p.shape,[1,a,n.outChannels],!0,!1);return this.compileAndRun(h,[p,l]).reshape([1,o,r,n.outChannels])},t.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(Kh.getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new zy(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerInput=function(t,e,n){var r=new My(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerFilter=function(t,e,n){var r=new Oy(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2D=function(t,e,n){var r;return Kh.getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Wy(n),this.compileAndRun(r,[t,e],this.makePackedTensor(n.outShape,t.dtype))):(r=new Vy(n),this.compileAndRun(r,[t,e]))},t.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new By(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new Ly(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3d=function(t,e,n){var r=new Uy(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerInput=function(t,e,n){var r=new Py(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerFilter=function(t,e,n){var r=new Fy(n);return this.compileAndRun(r,[t,e])},t.prototype.maxPool=function(t,e){var n=new Wb(e,"max",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.avgPool=function(t,e){var n=new Wb(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPoolBackprop=function(t,e,n,r){var o=new Wb(r,"max",!0),i=this.compileAndRun(o,[e]),a=new Fb(r),s=this.makeOutputArray(a.outputShape,e.dtype),u=this.compileAndRun(a,[t,i],s);return i.dispose(),u},t.prototype.avgPoolBackprop=function(t,e,n){var r=new by(n),o=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],o)},t.prototype.cast=function(t,e){return Hg(t,e,this)},t.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},t.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);return!n.isPacked||om(t.shape,e)||null!==n.texture&&om(n.shape,e)?Gg(t,e):this.packedReshape(t,e)},t.prototype.resizeBilinear=function(t,e,n,r){var o=Kh.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Kb(t.shape,e,n,r):new qb(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Gb(t,e,n);return this.compileAndRun(r,[t])},t.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new Xb(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new $b(t,e,n);return this.compileAndRun(r,[t])},t.prototype.multinomial=function(t,e,n,r){var o=e?t:Ig(t),i=new Lb(o.shape[0],o.shape[1],n),a=this.makeOutputArray(i.outputShape,"int32"),s=i.getCustomSetupFunc(r);return this.compileAndRun(i,[o],a,s)},t.prototype.oneHot=function(t,e,n,r){var o=new Bb(t.size,e,n,r);return this.compileAndRun(o,[t])},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return Fm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Zg(t.dataSync(),e.dataSync(),n,r,o)},t.prototype.cropAndResize=function(t,e,n,r,o,i){var a=new jy(t.shape,e.shape,r,o,i);return this.compileAndRun(a,[t,e,n])},t.prototype.depthToSpace=function(t,e,n){tf(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var r=t.shape[0],o=("NHWC"===n?t.shape[1]:t.shape[2])*e,i=("NHWC"===n?t.shape[2]:t.shape[3])*e,a=("NHWC"===n?t.shape[3]:t.shape[1])/(e*e),s=new Yy("NHWC"===n?[r,o,i,a]:[r,a,o,i],e,n);return this.compileAndRun(s,[t])},t.prototype.split=function(t,e,n){return ty(t,e,n)},t.prototype.scatterND=function(t,e,n){var r=dg(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/a,a],c=t.reshape([i,o]),p=e.reshape([i,a]);if(0===u)return Gg(tv([]),n);var h=nv(0),f=new Zb(i,o,c.rank,p.rank,s,l);return this.compileAndRun(f,[p,c,h]).reshape(n)},t.prototype.sparseToDense=function(t,e,n,r){var o=dg(0,t,n),i=new Zb(o.numUpdates,o.sliceRank,t.rank,e.rank,o.strides,[o.outputSize,1],!1);return this.compileAndRun(i,[e,t,r]).reshape(n)},t.prototype.fft=function(t){return this.fftImpl(t,!1)},t.prototype.ifft=function(t){return this.fftImpl(t,!0)},t.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new eb("return real * expR - imag * expI;",t.shape,e),o=new eb("return real * expI + imag * expR;",t.shape,e),i=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)],a=this.compileAndRun(r,i),s=this.compileAndRun(o,i),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=pg(t,e),i=o[0],a=o[1],s=o[2],u=o[3],l=e.reshape([a,r]),c=t.reshape([t.size/s,s]),p=new ab(r,u,[a,s]);return this.compileAndRun(p,[c,l]).reshape(i)},t.prototype.fill=function(t,e,n){if("string"===(n=n||If(e))){var r=vf(n,of(t));return r.fill(e),Qf.make(t,{values:r},n)}var o=new nb(t,e),i=o.getCustomSetupFunc(e),a=this.makeOutputArray(t,n);return this.compileAndRun(o,[],a,i)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},t.prototype.linspace=function(t,e,n){return qg(t,e,n)},t.prototype.makeOutputArray=function(t,e){return Qf.make(t,{},e,this)},t.prototype.makePackedTensor=function(t,e){var n=Qf.make(t,{},e,this);return this.texData.get(n.dataId).isPacked=!0,n},t.prototype.unpackTensor=function(t){var e=new gw(t.shape);return this.compileAndRun(e,[t],Qf.make(e.outputShape,{},t.dtype,this))},t.prototype.packTensor=function(t){var e=new zb(t.shape);return this.compileAndRun(e,[t],this.makePackedTensor(t.shape,t.dtype),null,!0)},t.prototype.packedReshape=function(t,e){var n=t.reshape([Jd(t.shape)].concat(tm(t.shape))),r=[Jd(e)].concat(tm(e)),o=new Hb(r,n.shape);return this.compileAndRun(o,[n]).reshape(e)},t.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,o=n.shape,i=n.dtype,a=em(o),s=ub(o),u=this.makeTensorHandle(o,"float32");return this.texData.get(u.dataId).isPacked=!0,this.texData.get(u.dataId).dtype=i,this.texData.get(u.dataId).texShape=s.map(function(t){return 2*t}),e=r?new Xy(a,s):new $y(a,s),this.compileAndRun(e,[{shape:a,dtype:i,dataId:t}],u,null,!0),u},t.prototype.compileAndRun=function(t,e,n,r,o){var i=this;if(void 0===o&&(o=!1),null==n&&(n=t.usesPackedTextures?this.makePackedTensor(t.outputShape,e[0].dtype):this.makeOutputArray(t.outputShape,e[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=mf(n.dtype,0),n;var a=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(e.dataId);if(null==n.texture){if(!t.usesPackedTextures&&of(e.shape)<=Kh.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.usesPackedTextures&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.usesPackedTextures)e=n.isPacked?i.unpackTensor(e):i.packTensor(e),n=i.texData.get(e.dataId);else if(n.isPacked&&!om(n.shape,e.shape)){var r=e,o=e.shape;e.shape=n.shape,e=i.packedReshape(e,o),n=i.texData.get(e.dataId),r.shape=o}return i.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,u={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},l=function(t,e,n){var r="";return a.concat(u).forEach(function(t){r+=t.shape+"_"+(t.isUniform?"uniform":t.texData.texShape)+"_"+(null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0)}),t.constructor.name+"_"+r+"_"+t.userCode}(t),c=this.getAndSaveBinary(l,function(){return function(t,e,n,r){var o=e.userCode,i=n.map(function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}}),a=i.map(function(t){return t.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=function(t,e,n,r){var o=[];t.forEach(function(t){var e=of(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))});var i,a,s=o.join("\n"),u=t.map(function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";return r+=n?function t(e){var n;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=e.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+ly().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=ly();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],s=ly();if(null!=o&&af(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=vy(e,n.slice(1));return"\n        "+t(s)+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+gy(["b","row","col"],[1,2])+");\n        }\n      "}var u=a[0],l=a[1],c=Math.ceil(n[2]/2);return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+l+", "+c*Math.ceil(n[1]/2)+", "+c+", b, row, col);\n      return "+ly().texture2D+"("+r+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=a[0],u=a[1],l=Math.ceil(e[n-1]/2),c=l*Math.ceil(e[n-2]/2),p="int b, int row, int col",h="b * "+c+" + (row / 2) * "+l+" + (col / 2)",f=2;f<n-1;f++)p="int b"+f+", "+p,h="b"+f+" * "+(c*=e[n-f-1])+" + "+h;return"\n    vec4 "+o+"("+p+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+ly().texture2D+"("+r+", uv);\n    }\n  "}(e)}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape;if(1===r[0]&&1===r[1])return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var o=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+fy(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+dy(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=fy(e);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&af(n,i))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+i[0]+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var a=df(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var l=vy(e,s);return"\n      "+t(l)+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+gy(["row","col"],u)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+dy(e)+"\n      }\n    ";var c=i[0],p=i[1],h=fy(r);return 1===p?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===c?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+p+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+h+";\n    vec2 uv = uvFromFlat("+c+", "+p+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],a=n[2],s=df(n),u=s.newShape,l=s.keptDims;if(u.length<n.length){var c=vy(e,u);return"\n        "+t(c)+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+gy(["row","col","depth"],l)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+dy(e)+"\n      }\n    ";var p=e.shapeInfo.texShape,h=p[0],f=p[1],d=e.shapeInfo.flatOffset;return f===i&&null==d?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+f+".0, "+h+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":f===a&&null==d?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+".0, "+h+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+fy(r)+";\n        vec2 uv = uvFromFlat("+h+", "+f+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],a=n[2]*i,s=n[1]*a,u=df(n),l=u.newShape,c=u.keptDims;if(l.length<n.length){var p=vy(e,l);return"\n      "+t(p)+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+gy(["row","col","depth","depth2"],c)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+a+", "+i+", 1)));\n        "+dy(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],m=f[1];return m===s&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===i&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+m+", index + "+fy(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[4],a=n[3]*i,s=n[2]*a,u=n[1]*s,l=df(n),c=l.newShape,p=l.keptDims;if(c.length<n.length){var h=vy(e,c);return"\n      "+t(h)+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+gy(["row","col","depth","depth2","depth3"],p)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+a+", "+i+")) +\n          depth3;\n        "+dy(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,m=d[0],v=d[1];return v===u&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===i&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+fy(r)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=df(n),a=i.newShape,s=i.keptDims;if(a.length<n.length){var u=vy(e,a);return"\n      "+t(u)+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+gy(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var l=n[5],c=n[4]*l,p=n[3]*c,h=n[2]*p,f=n[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+h+", "+p+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+dy(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];return g===f&&null==d?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+p+", "+c+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===l&&null==d?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+h+" + depth * "+p+" +\n          depth2 * "+c+" + depth3 * "+l+" + depth4 + "+fy(r)+";\n      vec2 uv = uvFromFlat("+v+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t),t.shapeInfo.logicalShape.length<=e.logicalShape.length&&(r+=n?function(t,e){var n,r,o=t.name,i=o.charAt(0).toUpperCase()+o.slice(1),a="get"+i+"AtOutCoords",s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length,l=_g(t.shapeInfo.logicalShape,e.logicalShape),c=my(u),p=u-s,h=["x","y","z","w","u","v"];n=0===s?"":u<2&&l.length>=1?"coords = 0;":l.map(function(t){return"coords."+h[t+p]+" = 0;"}).join("\n"),r=u<2&&s>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+h[e+p]}).join(", ");var f="return outputValue;",d=1===of(t.shapeInfo.logicalShape),m=1===of(e.logicalShape);if(1!==s||d||m){if(d&&!m)f=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){var v=s-2,g=s-1;l.indexOf(v)>-1&&l.indexOf(g)>-1?f="return vec4(outputValue.x);":l.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+r+");\n      "+f+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,a=e.logicalShape.length;if(!t.shapeInfo.isUniform&&i===a&&null==t.shapeInfo.flatOffset&&af(t.shapeInfo.texShape,e.texShape))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var s=my(a),u=_g(t.shapeInfo.logicalShape,e.logicalShape),l=a-i,c=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+s+" coords = getOutputCoords();\n      "+(0===i?"":a<2&&u.length>=1?"coords = 0;":u.map(function(t){return"coords."+c[t+l]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(a<2&&i>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+c[e+l]}).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)}).join("\n"),l=e.texShape,c=ly(),p="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+c.texture2D+"(textureSampler, uv).r;\n    }\n  ",h=c.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+c.varyingFs+" vec2 resultUV;\n    "+c.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    #define isnan(value) isnan_custom(value)\n    "+c.defineSpecialNaN+"\n    bvec4 isnan_custom(vec4 val) {\n      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n    }\n\n    "+c.defineSpecialInf+"\n    "+c.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    \nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  ";return e.isPacked?(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(af(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=t,r=e,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=(i=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+i+");\n      int c = imod(index, "+i+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,a="",s="b, r, c",u=2;u<t.length-1;u++)a="\n      int b"+u+" = index / "+(i*=t[t.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var n,r,o,i,a}(e.logicalShape,l),a="\n    void setOutput(vec4 val) {\n      "+c.output+" = val;\n    }\n  "):(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return af(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=e,r=cy(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=cy(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=cy(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=cy(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r}(e.logicalShape,l),a="\n    void setOutput(float val) {\n      "+c.output+" = vec4(val, 0, 0, 0);\n    }\n  "),r&&(h+="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n"),[h,p,a,s,i,u,n].join("\n")}(i,s,o,e.usesPackedTextures),l=t.createProgram(u),c=null,p=t.getUniformLocation(l,"NAN",!1);1===Kh.getNumber("WEBGL_VERSION")&&(c=t.getUniformLocation(l,"INFINITY",!1));for(var h={},f=0;f<e.variableNames.length;f++){var d=e.variableNames[f];h[d]=t.getUniformLocation(l,d,!1),h["offset"+d]=t.getUniformLocation(l,"offset"+d,!1)}return{program:e,source:u,webGLProgram:l,uniformLocations:h,inShapeInfos:a,outShapeInfo:s,infLoc:c,nanLoc:p}}(i.gpgpu,t,a,u)}),p=null!=this.activeTimers;return p&&(s=this.startTimer()),function(t,e,n,r,o){Tb(e.inShapeInfos,n),Tb([e.outShapeInfo],[r]);var i=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,a[0],a[1]):t.setOutputMatrixTexture(i,a[0],a[1]),t.setProgram(e.webGLProgram),1===Kh.getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(function(n,r){var o=e.program.variableNames[r],i=e.uniformLocations[o],a=e.uniformLocations["offset"+o];if(null!=i)if(n.isUniform)if(of(n.shape)<2)t.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,i,r)}),null!=o&&o(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,c,a,u,r),p&&(s=this.endTimer(s),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(s)})),!Kh.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(n.dataId).isPacked&&!1===o?this.unpackTensor(n):n},t.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),null!=this.canvas&&null!=this.canvas.remove?this.canvas.remove():this.canvas=null,null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Cm(function(){var e=Kh.getBool("DEBUG");Kh.set("DEBUG",!1);var n=t.abs(nv(1e-8)).dataSync()[0];return Kh.set("DEBUG",e),n>0?32:16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.values,a=n.usage,s=n.isPacked;if(null==n.texture){var u,l=null!=this.activeTimers;l&&(u=Ff());var c=n.texShape;if(null==c&&(c=nm(r,s),n.texShape=c),null!=i){var p=em(r),h=void 0,f=c[1],d=c[0],m=i instanceof Uint8Array;s?(f=(e=lb(c[0],c[1]))[0],h=new tb(p,[d=e[1],f],m)):h=new Jy(p,[d,f],m);var v=this.makeTensorHandle([d,f],o);this.texData.get(v.dataId).usage=m?qy.PIXELS:qy.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),f,d,i);var g=this.makeTensorHandle(h.outputShape,v.dtype);g.size=of(h.outputShape),this.texData.get(g.dataId).isPacked=s,this.compileAndRun(h,[v],g);var y=this.texData.get(g.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(v.dataId),this.texData.delete(g.dataId),n.values=null,l&&(this.uploadWaitMs+=Ff()-u)}else{var b=this.acquireTexture(c,a,o,s);n.texture=b}}},t.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},t.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,r)},t.prototype.computeBytes=function(t,e){return t[0]*t[1]*Cf(e)},t}();gd()&&vd.registerBackend("webgl",function(){return new ww},2);var xw=Ym({abs_:function(t){var e=Bm(t,"x","abs");return"complex64"===e.dtype?vd.runKernel(function(t){return t.complexAbs(e)},{$x:e}):vd.runKernel(function(t,n){var r=t.abs(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.toFloat().step(-1))}}})}}),Cw=Ym({acos_:function(t){var e=Bm(t,"x","acos");return vd.runKernel(function(t,n){var r=t.acos(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(nv(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Ew=Ym({acosh_:function(t){var e=Bm(t,"x","acosh");return vd.runKernel(function(t,n){var r=t.acosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Sw=Ym({asin_:function(t){var e=Bm(t,"x","asin");return vd.runKernel(function(t,n){var r=t.asin(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(nv(1).sub(n.toFloat().square()).sqrt())}}})}}),kw=Ym({asinh_:function(t){var e=Bm(t,"x","asinh");return vd.runKernel(function(t,n){var r=t.asinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(nv(1).add(n.toFloat().square()).sqrt())}}})}}),Nw=Ym({atan_:function(t){var e=Bm(t,"x","atan");return vd.runKernel(function(t,n){var r=t.atan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}})}}),Iw=Ym({atanh_:function(t){var e=Bm(t,"x","atanh");return vd.runKernel(function(t,n){var r=t.atanh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(nv(1).sub(n.toFloat().square()))}}})}}),Rw=Ym({ceil_:function(t){var e=Bm(t,"x","ceil");return vd.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return mv(t)}}})}}),Aw=Ym({clipByValue_:function(t,e,n){var r=Bm(t,"x","clipByValue");return tf(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."}),vd.runKernel(function(t,o){var i=t.clip(r,e,n);return o([r]),i},{$x:r},function(t,r){var o=r[0];return{$x:function(){return t.where(o.greaterEqual(e).logicalAnd(o.lessEqual(n)),mv(t))}}})}}),Tw=Ym({cos_:function(t){var e=Bm(t,"x","cos");return vd.runKernel(function(t,n){var r=t.cos(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sin().neg().mul(t)}}})}}),_w=Ym({cosh_:function(t){var e=Bm(t,"x","cosh");return vd.runKernel(function(t,n){var r=t.cosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}})}}),Dw=Ym({erf_:function(t){var e=Bm(t,"x","erf");return tf("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),vd.runKernel(function(t,n){var r=t.erf(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Ow=Ym({exp_:function(t){var e=Bm(t,"x","exp");return vd.runKernel(function(t,n){var r=t.exp(e);return n([r]),r},{$x:e},function(t,e){return{$x:function(){return t.mulStrict(e[0])}}})}}),Mw=Ym({expm1_:function(t){var e=Bm(t,"x","expm1");return vd.runKernel(function(t,n){var r=t.expm1(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}})}}),Fw=Ym({floor_:function(t){var e=Bm(t,"x","floor");return vd.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return mv(t)}}})}}),Pw=Ym({log_:function(t){var e=Bm(t,"x","log");return vd.runKernel(function(t,n){var r=t.log(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat())}}})}}),Lw=Ym({log1p_:function(t){var e=Bm(t,"x","log1p");return vd.runKernel(function(t,n){var r=t.log1p(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}})}}),Bw=Ym({logSigmoid_:function(t){var e=Bm(t,"x","logSigmoid");return vd.runKernel(function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}})}}),zw=Ym({neg_:function(t){var e=Bm(t,"x","neg");return vd.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),Uw=Ym({reciprocal_:function(t){var e=Bm(t,"x","reciprocal");return vd.runKernel(function(t,n){var r=t.reciprocal(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}})}}),Vw=Ym({round_:function(t){var e=Bm(t,"x","round");return vd.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return mv(t)}}})}}),Ww=Ym({rsqrt_:function(t){var e=Bm(t,"x","rsqrt");return vd.runKernel(function(t,n){var r=t.rsqrt(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}})}}),jw=Ym({sigmoid_:function(t){var e=Bm(t,"x","sigmoid");return vd.runKernel(function(t,n){var r=t.sigmoid(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.mul(nv(1).sub(n)))}}})}}),Hw=Ym({sign_:function(t){var e=Bm(t,"x","sign");return vd.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return mv(t)}}})}}),Gw=Ym({isNaN_:function(t){var e=Bm(t,"x","isNaN");return vd.runKernel(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return mv(t)}}})}}),qw=Ym({isInf_:function(t){var e=Bm(t,"x","isInf");return vd.runKernel(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return mv(t)}}})}}),Kw=Ym({isFinite_:function(t){var e=Bm(t,"x","isFinite");return vd.runKernel(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return mv(t)}}})}}),$w=Ym({sin_:function(t){var e=Bm(t,"x","sin");return vd.runKernel(function(t,n){var r=t.sin(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cos().mul(t)}}})}}),Xw=Ym({sinh_:function(t){var e=Bm(t,"x","sinh");return vd.runKernel(function(t,n){var r=t.sinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}})}}),Yw=Ym({softplus_:function(t){var e=Bm(t,"x","softplus");return vd.runKernel(function(t,n){var r=t.softplus(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}})}}),Qw=Ym({sqrt_:function(t){var e=Bm(t,"x","sqrt");return vd.runKernel(function(t,n){var r=t.sqrt(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}})}}),Zw=Ym({square_:function(t){var e=Bm(t,"x","square");return vd.runKernel(function(t,n){return n([e]),t.square(e)},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.toFloat().mul(2))}}})}}),Jw=Ym({step_:function(t,e){void 0===e&&(e=0);var n=Bm(t,"x","step");return vd.runKernel(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return mv(t)}}})}}),tx=Ym({tan_:function(t){var e=Bm(t,"x","tan");return vd.runKernel(function(t,n){var r=t.tan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}})}}),ex=Ym({tanh_:function(t){var e=Bm(t,"x","tanh");return vd.runKernel(function(t,n){var r=t.tanh(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return nv(1).sub(n.square()).mulStrict(t)}}})}});function nx(t,e,n,r,o,i){var a,s,u=Bm(t,"x","batchNorm"),l=Bm(e,"mean","batchNorm"),c=Bm(n,"variance","batchNorm");return null!=o&&(a=Bm(o,"scale","batchNorm")),null!=r&&(s=Bm(r,"offset","batchNorm")),tf(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),tf(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),tf(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=a&&tf(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&tf(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),ix(u,l,c,s,a,i)}function rx(t,e,n,r,o,i){var a,s,u=Bm(t,"x","batchNorm"),l=Bm(e,"mean","batchNorm"),c=Bm(n,"variance","batchNorm");return null!=o&&(a=Bm(o,"scale","batchNorm")),null!=r&&(s=Bm(r,"offset","batchNorm")),tf(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),tf(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),tf(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=a&&tf(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&tf(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),ix(u,l,c,s,a,i)}function ox(t,e,n,r,o,i){var a,s,u=Bm(t,"x","batchNorm"),l=Bm(e,"mean","batchNorm"),c=Bm(n,"variance","batchNorm");return null!=o&&(a=Bm(o,"scale","batchNorm")),null!=r&&(s=Bm(r,"offset","batchNorm")),tf(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),tf(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),tf(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=a&&tf(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&tf(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),ix(u,l,c,s,a,i)}function ix(t,e,n,r,o,i){null==i&&(i=.001);var a,s,u,l=Bm(t,"x","batchNorm"),c=Bm(e,"mean","batchNorm"),p=Bm(n,"variance","batchNorm");return null!=o&&(a=Bm(o,"scale","batchNorm")),null!=r&&(s=Bm(r,"offset","batchNorm")),tf(c.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),tf(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),tf(null==a||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,vd.runKernel(function(t,e){var n=t.batchNormalization(u,ax(c),ax(p),i,ax(a),ax(s));return e([l,c,p,a]),n},{$x:l,$mean:c,$variance:p,$scale:a,$offset:s},function(t,e){var n=e[0],r=e[1],o=e[2],a=e[3],s=null==a?nv(1):a,l=Dg(r.shape,u.shape),c=[];if(1===r.rank){for(var p=0;p<u.shape.length-1;++p)c.push(u.shape[p]);c.push(1)}var h=n.sub(r),f=t.mul(s),d=Ww(o.add(nv(i))),m=d.mul(d).mul(d).mul(nv(-.5));return{$x:function(){return 1===r.rank?t.mul(ng(d.as4D(1,1,1,r.shape[0]),c)).mul(s).reshape(n.shape):t.mul(d).mul(s).reshape(n.shape)},$mean:function(){var t=d.mul(nv(-1)).mul(f);return 1===r.rank&&(t=t.sum(l)),t.reshape(r.shape)},$variance:function(){var t=m.mul(h).mul(f);return 1===r.rank&&(t=t.sum(l)),t.reshape(r.shape)},$scale:function(){var e=h.mul(d),n=t.mul(e);return 1===r.rank&&(n=n.sum(l)),n.reshape(r.shape)},$offset:function(){var e=t;return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)}}}).reshape(l.shape)}function ax(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function sx(){ym("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var ux=Ym({batchNormalization2d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),sx(),nx(t,e,n,i,o,r)}}),lx=Ym({batchNormalization3d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),sx(),rx(t,e,n,i,o,r)}}),cx=Ym({batchNormalization4d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),sx(),ox(t,e,n,i,o,r)}}),px=Ym({batchNormalization_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),sx(),ix(t,e,n,i,o,r)}}),hx=Ym({batchNorm_:ix}),fx=Ym({batchNorm2d_:nx}),dx=Ym({batchNorm3d_:rx}),mx=Ym({batchNorm4d_:ox});function vx(t,e,n,r,o,i){tf(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var a=t,s=e,u=!1;3===e.rank&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,t[0],t[1],t[2]]);var l=a[3],c=s.shape[3];tf(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),tf(4===s.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),tf(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}),tf(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),tf(c===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[3]+"."}),null!=i&&tf(sf(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var p=Fg(a,n.shape,r,1,o,i),h=vd.runKernel(function(t,e){var r=t.conv2dDerInput(s,n,p);return e([n,s]),r},{dy4D:s,filter:n},function(t,e){var n=e[0],a=e[1];return{dy4D:function(){return wx(t,n,r,o,"NHWC",1,i)},filter:function(){return Cx(t,a,n.shape,r,o,i)}}});return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function gx(t,e,n,r,o,i){var a=t;3===t.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=e;3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),tf(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),tf(4===s.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),tf(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}),tf(a.shape[3]===n[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+n[2]+"."}),tf(s.shape[3]===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."}),null!=i&&tf(sf(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var u=Fg(a.shape,n,r,1,o,i);return vd.runKernel(function(t){return t.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}function yx(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t);return 1===e[0]&&1===e[1]&&1===e[2]}var bx=Ym({conv1d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=Bm(t,"x","conv1d"),u=Bm(e,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),tf(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),tf(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&tf(sf(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),tf(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),tf(jg(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),tf("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=wx(h,p,[1,n],r,"NHWC",[1,i],a);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),wx=Ym({conv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=Bm(t,"x","conv2d"),u=Bm(e,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),tf(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),tf(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&tf(sf(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),tf(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),tf(jg(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),tf("NHWC"===o,function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var p=Fg(l.shape,u.shape,n,i,r,a),h=vd.runKernel(function(t,e){var n=t.conv2d(l,u,p);return e([u,l]),n},{x:l,$filter:u},function(t,e){var o=e[0],a=e[1];return tf(Wg(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return vx(a.shape,t,o,n,r)},$filter:function(){return gx(a,t,o.shape,n,r)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),xx=Ym({conv3d_:function(t,e,n,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var a=Bm(t,"x","conv3d"),s=Bm(e,"filter","conv3d"),u=a,l=!1;4===a.rank&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),tf(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),tf(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),tf(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),tf(function(t,e){return yx(n)||yx(e)}(0,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),tf("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=Pg(u.shape,s.shape,n,i,r),p=vd.runKernel(function(t,e){var n=t.conv3d(u,s,c);return e([u,s]),n},{x:u,$filter:s},function(t,e){tf(yx(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var o=e[0],a=e[1];return{x:function(){return function(t,e,n,r,o){tf(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var i=t,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],l=a.shape[4];tf(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),tf(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),tf(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),tf(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),tf(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Pg(i,n.shape,r,1,o),p=vd.runKernel(function(t){return t.conv3dDerInput(a,n,c)},{dy5D:a});return s?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}(o.shape,t,a,n,r)},$filter:function(){return function(t,e,n,r,o){var i=t;4===t.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),tf(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),tf(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),tf(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),tf(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."}),tf(a.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=Pg(i.shape,n,r,1,o);return vd.runKernel(function(t){return t.conv3dDerFilter(i,a,s)},{x5D:i,dy5D:a})}(o,t,a.shape,n,r)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Cx=Ym({conv2dDerFilter_:gx}),Ex=Ym({depthwiseConv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=Bm(t,"x","depthwiseConv2d"),u=Bm(e,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),tf(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),tf(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),tf(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),tf(jg(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=a&&tf(sf(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var p=Fg(l.shape,u.shape,n,i,r,a,!0),h=vd.runKernel(function(t,e){var n=t.depthwiseConv2D(l,u,p);return e([l,u]),n},{x:l,$filter:u},function(t,e){tf(Wg(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var n=e[0],r=e[1];return{x:function(){return function(t,e,n,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=vd.runKernel(function(t){return t.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}(0,t,r,p)},$filter:function(){return function(t,e,n,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),vd.runKernel(function(t){return t.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}(n,t,0,p)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Sx=Ym({separableConv2d_:function(t,e,n,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=Bm(t,"x","separableConv2d"),u=Bm(e,"depthwiseFilter","separableConv2d"),l=Bm(n,"pointwiseFilter","separableConv2d"),c=s,p=!1;if(3===s.rank&&(p=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");tf(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),tf(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),tf(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),tf(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),tf(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],f=u.shape[3];tf(l.shape[2]===h*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+l.shape[2]+"."});var d=Ex(c,u,r,o,a,i),m=wx(d,l,1,"valid",a);return p?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),kx=Ym({conv2dTranspose_:function(t,e,n,r,o,i){return vx(n,Bm(t,"x","conv2dTranspose"),Bm(e,"filter","conv2dTranspose"),r,o,i)}}),Nx=Ym({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=Bm(t,"a","matMul"),a=Bm(e,"b","matMul");o=ld(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],p=i.shape.slice(0,-2),h=a.shape.slice(0,-2),f=of(p),d=of(h);tf(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),tf(af(p,h),function(){return"Error in matMul: outer dimensions ("+p+") and ("+h+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),tf(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([l,c]),v=n?i.as3D(f,s,l):i.as3D(f,l,s),g=r?a.as3D(d,c,u):a.as3D(d,u,c);return vd.runKernel(function(t,e){var o=t.batchMatMul(v,g,n,r);return e([v,g]),o},{$a:v,$b:g},function(t,e){var o=e[0],i=e[1];return n||r?!n&&r?{$a:function(){return t.matMul(i,!1,!1)},$b:function(){return t.matMul(o,!0,!1)}}:n&&!r?{$a:function(){return i.matMul(t,!1,!0)},$b:function(){return o.matMul(t,!1,!1)}}:{$a:function(){return i.matMul(t,!0,!0)},$b:function(){return t.matMul(o,!0,!0)}}:{$a:function(){return t.matMul(i,!1,!0)},$b:function(){return o.matMul(t,!0,!1)}}}).reshape(m)}}),Ix=Ym({dot_:function(t,e){var n=Bm(t,"t1","dot"),r=Bm(e,"t2","dot");tf(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return tf(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Rx=Ym({outerProduct_:function(t,e){var n=Bm(t,"v1","outerProduct"),r=Bm(e,"v2","outerProduct");return tf(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Ax=Ym({reverse_:function(t,e){var n=Bm(t,"x","reverse");if(0===n.rank)return n.clone();var r=ff(e,n.shape);return vd.runKernel(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)}}),Tx=Ym({reverse1d_:function(t){var e=Bm(t,"x","reverse");return tf(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Ax(e,0)}}),_x=Ym({reverse2d_:function(t,e){var n=Bm(t,"x","reverse");return tf(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Ax(n,e)}}),Dx=Ym({reverse3d_:function(t,e){var n=Bm(t,"x","reverse");return tf(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Ax(n,e)}}),Ox=Ym({reverse4d_:function(t,e){var n=Bm(t,"x","reverse");return tf(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Ax(n,e)}});function Mx(t,e,n,r,o,i){var a=Bm(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),tf(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),tf(jg(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=i&&tf(sf(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=Mg(s.shape,e,n,r,o,i),c=vd.runKernel(function(t,e){var n=t.maxPool(s,l);return e([s,n]),n},{x:s},function(t,i){var a=i[0],s=i[1];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=Bm(t,"dy","maxPoolBackprop"),l=Bm(e,"input","maxPoolBackprop"),c=Bm(n,"output","maxPoolBackprop");tf(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==i&&(i=[1,1]),tf(jg(o,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),tf(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),tf(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var p=Mg(l.shape,r,o,i,a,void 0);return vd.runKernel(function(t){return t.maxPoolBackprop(u,l,c,p)},{$dy:u,$input:l})}(t,a,s,e,n,r,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Fx(t,e,n,r,o,i){var a=Bm(t,"x","avgPool","float32");null==r&&(r=[1,1]),tf(jg(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),tf(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&tf(sf(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=Mg(s.shape,e,n,r,o,i),c=vd.runKernel(function(t){return t.avgPool(s,l)},{x:s},function(t){return{x:function(){return function(t,e,n,r,o,i){var a=Bm(t,"dy","avgPoolBackprop"),s=Bm(e,"input","avgPoolBackprop");tf(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),null==o&&(o=[1,1]),tf(jg(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=a,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),tf(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),tf(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var p=Mg(u.shape,n,r,o,i),h=vd.runKernel(function(t){return t.avgPoolBackprop(l,u,p)},{dy4D:l,input4D:u});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(t,s,e,n,r,o)}}});return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Px=Ym({maxPool_:function(t,e,n,r,o){return Mx(t,e,n,1,r,o)}}),Lx=Ym({avgPool_:function(t,e,n,r,o){return Fx(t,e,n,1,r,o)}}),Bx=Ym({pool_:function(t,e,n,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=Bm(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),tf(jg(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var l,c=Mg(s.shape,e,i,o,r),p=[c.dilationHeight,c.dilationWidth];l="same"===r?function(t,e){var n=[c.filterHeight,c.filterWidth].map(function(t,n){return t+(t-1)*(e[n]-1)}).map(function(t){return t-1}),r=n.map(function(t){return Math.floor(t/2)}),o=n.map(function(t,e){return t-r[e]});return n.map(function(t,e){return[r[e],o[e]]})}(0,p):[[0,0],[0,0]];var h=1===p[0]&&1===p[1],f=function(t,e,n){var r=n.map(function(t){return t[0]}),o=n.map(function(t){return t[1]}),i=t.concat(r,o),a=e.map(function(t,e){return(t-i[e]%t)%t}),s=o.map(function(t,e){return t+a[e]});return[e.map(function(t,e){return[r[e],s[e]]}),e.map(function(t,e){return[0,a[e]]})]}([c.inHeight,c.inWidth],p,l),d=f[1],m=h?r:"valid",v=h?s:Jv(s,p,f[0]),g=("avg"===n?function(){return Fx(v,e,i,1,m)}:function(){return Mx(v,e,i,1,m)})(),y=h?g:Fv(g,p,d);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),zx=Ym({slice_:function(t,e,n){var r,o,i=Bm(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice(),o=(o=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(tf(-1===t,function(){return"Bad value in size"}),i.shape[e]-r[e])}),function(t,e,n){tf(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),tf(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(r){tf(e[r]+n[r]<=t.shape[r],function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"})},o=0;o<t.rank;++o)r(o)}(i,r,o);var a=i.shape;return vd.runKernel(function(t){return t.slice(i,r,o)},{$x:i},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-o[n]]);return{$x:function(){return t.pad(e)}}})}}),Ux=Ym({slice1d_:function(t,e,n){var r=Bm(t,"x","slice1d");return tf(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),zx(r,[e],[n])}}),Vx=Ym({slice2d_:function(t,e,n){var r=Bm(t,"x","slice2d");return tf(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),zx(r,e,n)}}),Wx=Ym({slice3d_:function(t,e,n){var r=Bm(t,"x","slice3d");return tf(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),zx(r,e,n)}}),jx=Ym({slice4d_:function(t,e,n){var r=Bm(t,"x","slice4d");return tf(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),zx(r,e,n)}});function Hx(t,e,n,r,o){return e.rank<n.rank&&(e=e.reshape(jm(e.shape,r))),t.rank<n.rank&&(t=t.reshape(jm(t.shape,r))),{$x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==o?r:r.transpose(o)}}}var Gx=Ym({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","all","bool"),o=ff(e,r.shape),i=o,a=Gm(i,r.rank);null!=a&&(r=r.transpose(a),i=Km(i.length,r.rank));var s=vd.runKernel(function(t){return t.all(r,i)},{$x:r});if(n){var u=jm(s.shape,o);return s.reshape(u)}return s}}),qx=Ym({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","any","bool"),o=ff(e,r.shape),i=o,a=Gm(i,r.rank);null!=a&&(r=r.transpose(a),i=Km(i.length,r.rank));var s=vd.runKernel(function(t){return t.any(r,i)},{$x:r});if(n){var u=jm(s.shape,o);return s.reshape(u)}return s}}),Kx=Ym({argMax_:function(t,e){void 0===e&&(e=0);var n=Bm(t,"x","argMax");null==e&&(e=0);var r=ff(e,n.shape),o=Gm(r,n.rank);return null!=o&&(n=n.transpose(o),r=Km(r.length,n.rank)),vd.runKernel(function(t,e){var o=t.argMax(n,r[0]);return e([n]),o},{$x:n},function(t,e){var n=e[0];return{$x:function(){return mv(n)}}})}}),$x=Ym({argMin_:function(t,e){void 0===e&&(e=0);var n=Bm(t,"x","argMin");null==e&&(e=0);var r=ff(e,n.shape),o=Gm(r,n.rank);return null!=o&&(n=n.transpose(o),r=Km(r.length,n.rank)),vd.runKernel(function(t,e){var o=t.argMin(n,r[0]);return e([n]),o},{$x:n},function(t,e){var n=e[0];return{$x:function(){return mv(n)}}})}}),Xx=Ym({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","logSumExp"),o=ff(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=jm(s.shape,o);return s.reshape(u)}return s}}),Yx=Ym({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","max"),o=r,i=ff(e,r.shape),a=i,s=Gm(a,r.rank);null!=s&&(r=r.transpose(s),a=Km(a.length,r.rank));var u=vd.runKernel(function(t,e){var n=t.max(r,a);return e([o,n]),n},{$x:r},function(t,e){return Hx(t,e[1],e[0],i,s)});if(n){var l=jm(u.shape,i);u=u.reshape(l)}return u}}),Qx=Ym({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","mean"),o=ff(e,r.shape),i=of(Wm(r.shape,o)[1]);return kg(function(t){var r=nv(i);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(lv(t.shape,"float32")).div(i)}}})(r)}}),Zx=Ym({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","min"),o=r,i=ff(e,r.shape),a=i,s=Gm(a,r.rank);null!=s&&(r=r.transpose(s),a=Km(a.length,r.rank));var u=vd.runKernel(function(t,e){var n=t.min(r,a);return e([o,n]),n},{$x:r},function(t,e){return Hx(t,e[1],e[0],i,s)});if(n){var l=jm(u.shape,i);u=u.reshape(l)}return u}}),Jx=Ym({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=ff(e,(t=Bm(t,"x","moments")).shape),o=t.mean(r,n),i=o.shape;n||(i=jm(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),tC=Ym({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=ff(e,r.shape);return kg(function(t){var e=Gm(o,t.rank),r=o,i=t;null!=e&&(i=t.transpose(e),r=Km(r.length,t.rank));var a=vd.runKernel(function(t){return t.sum(i,r)},{permutedX:i});if(n){var s=jm(a.shape,o);a=a.reshape(s)}return{value:a,gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(lv(t.shape,"float32"))}}})(r)}}),eC=Ym({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=Bm(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=ff(e,r.shape),i=Gm(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Km(a.length,r.rank));var u=vd.runKernel(function(t){return t.prod(s,a)},{permutedX:s});if(n){var l=jm(u.shape,o);u=u.reshape(l)}return u}}),nC=Ym({equal_:function(t,e){var n,r=Bm(t,"a","equal"),o=Bm(e,"b","equal");return n=ld(r,o),Og((r=n[0]).shape,(o=n[1]).shape),vd.runKernel(function(t){return t.equal(r,o)},{$a:r,$b:o})}}),rC=Ym({equalStrict_:function(t,e){var n=Bm(t,"a","equalStrict"),r=Bm(e,"b","equalStrict");return ef(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),oC=Ym({greater_:function(t,e){var n,r=Bm(t,"a","greater"),o=Bm(e,"b","greater");return n=ld(r,o),Og((r=n[0]).shape,(o=n[1]).shape),vd.runKernel(function(t){return t.greater(r,o)},{$a:r,$b:o})}}),iC=Ym({greaterEqual_:function(t,e){var n,r=Bm(t,"a","greaterEqual"),o=Bm(e,"b","greaterEqual");return n=ld(r,o),Og((r=n[0]).shape,(o=n[1]).shape),vd.runKernel(function(t,e){var n=t.greaterEqual(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){return mv(n)},$b:function(){return mv(r)}}})}}),aC=Ym({greaterEqualStrict_:function(t,e){var n=Bm(t,"a","greaterEqualStrict"),r=Bm(e,"b","greaterEqualStrict");return ef(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),sC=Ym({greaterStrict_:function(t,e){var n=Bm(t,"a","greaterStrict"),r=Bm(e,"b","greaterStrict");return ef(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),uC=Ym({less_:function(t,e){var n,r=Bm(t,"a","less"),o=Bm(e,"b","less");return n=ld(r,o),Og((r=n[0]).shape,(o=n[1]).shape),vd.runKernel(function(t){return t.less(r,o)},{$a:r,$b:o})}}),lC=Ym({lessEqual_:function(t,e){var n,r=Bm(t,"a","lessEqual"),o=Bm(e,"b","lessEqual");return n=ld(r,o),Og((r=n[0]).shape,(o=n[1]).shape),vd.runKernel(function(t){return t.lessEqual(r,o)},{$a:r,$b:o})}}),cC=Ym({lessEqualStrict_:function(t,e){var n=Bm(t,"a","lessEqualStrict"),r=Bm(e,"b","lessEqualStrict");return ef(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),pC=Ym({lessStrict_:function(t,e){var n=Bm(t,"a","lessStrict"),r=Bm(e,"b","lessStrict");return ef(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),hC=Ym({notEqual_:function(t,e){var n,r=Bm(t,"a","notEqual"),o=Bm(e,"b","notEqual");return n=ld(r,o),Og((r=n[0]).shape,(o=n[1]).shape),vd.runKernel(function(t){return t.notEqual(r,o)},{$a:r,$b:o})}}),fC=Ym({notEqualStrict_:function(t,e){var n=Bm(t,"a","notEqualStrict"),r=Bm(e,"b","notEqualStrict");return ef(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}}),dC=Ym({add_:function(t,e){var n,r=Bm(t,"a","add"),o=Bm(e,"b","add");n=ld(r,o);var i=Og((r=n[0]).shape,(o=n[1]).shape);return vd.runKernel(function(t){return t.add(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=Dg(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=Dg(o.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(o.shape)}}})}}),mC=Ym({addN_:function(t){tf(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),tf(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return Bm(t,"tensors"+e,"addN")}),n=e[0];return e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!af(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),vd.runKernel(function(t){return t.addN(e)},e,function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n})}}),vC=Ym({addStrict_:function(t,e){var n=Bm(t,"a","addStrict"),r=Bm(e,"b","addStrict");return ef(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),gC=Ym({atan2_:function(t,e){var n,r=Bm(t,"a","atan2"),o=Bm(e,"b","atan2");n=ld(r,o);var i=Og((r=n[0]).shape,(o=n[1]).shape);return vd.runKernel(function(t,e){var n=t.atan2(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=dC(n.square(),r.square()),o=t.mul(r.div(e)),a=Dg(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},$b:function(){var e=dC(n.square(),r.square()),o=zw(t.mul(n.div(e))),a=Dg(r.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(r.shape)}}})}}),yC=Ym({div_:function(t,e){var n,r=Bm(t,"a","div"),o=Bm(e,"b","div");if(n=ld(r,o),o=n[1],"int32"===(r=n[0]).dtype&&"int32"===o.dtype)return wC(r,o);var i=Og(r.shape,o.shape);return vd.runKernel(function(t,e){var n=t.realDivide(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=t.div(r.toFloat()),o=Dg(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=Dg(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}})}}),bC=Ym({divStrict_:function(t,e){var n=Bm(t,"a","div"),r=Bm(e,"b","div");return ef(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),wC=Ym({floorDiv_:function(t,e){var n,r=Bm(t,"a","floorDiv"),o=Bm(e,"b","floorDiv");n=ld(r,o);var i=Og((r=n[0]).shape,(o=n[1]).shape);return vd.runKernel(function(t,e){var n=t.floorDiv(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=t.div(r.toFloat()),o=Dg(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=Dg(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}})}}),xC=Ym({maximum_:function(t,e){var n,r=Bm(t,"a","maximum"),o=Bm(e,"b","maximum");return n=ld(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Og(r.shape,o.shape),vd.runKernel(function(t,e){var n=t.maximum(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){return t.mul(n.greaterEqual(r).toFloat())},$b:function(){return t.mul(n.less(r).toFloat())}}})}}),CC=Ym({maximumStrict_:function(t,e){var n=Bm(t,"a","maximumStrict"),r=Bm(e,"b","maximumStrict");return ef(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),EC=Ym({minimum_:function(t,e){var n,r=Bm(t,"a","minimum"),o=Bm(e,"b","minimum");return n=ld(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Og(r.shape,o.shape),vd.runKernel(function(t,e){var n=t.minimum(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){return t.mul(n.lessEqual(r).toFloat())},$b:function(){return t.mul(n.greater(r).toFloat())}}})}}),SC=Ym({minimumStrict_:function(t,e){var n=Bm(t,"a","minimumStrict"),r=Bm(e,"b","minimumStrict");return ef(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),kC=Ym({mod_:function(t,e){var n,r=Bm(t,"a","mod"),o=Bm(e,"b","mod");n=ld(r,o);var i=Og((r=n[0]).shape,(o=n[1]).shape);return vd.runKernel(function(t,e){var n=t.mod(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=Dg(n.shape,i);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),o=Dg(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}})}}),NC=Ym({modStrict_:function(t,e){var n=Bm(t,"a","modStrict"),r=Bm(e,"b","modStrict");return ef(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),IC=Ym({mul_:function(t,e){var n,r=Bm(t,"a","mul"),o=Bm(e,"b","mul");n=ld(r,o);var i=Og((r=n[0]).shape,(o=n[1]).shape);return vd.runKernel(function(t,e){var n=t.multiply(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=t.mul(r.toFloat()),o=Dg(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=Dg(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}})}}),RC=Ym({mulStrict_:function(t,e){var n=Bm(t,"a","mul"),r=Bm(e,"b","mul");return ef(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),AC=Ym({pow_:function(t,e){var n=Bm(t,"base","pow"),r=Bm(e,"exp","pow"),o=Og(n.shape,r.shape);return t=n.cast(sd(n.dtype,r.dtype)),e=r.cast(sd(n.dtype,r.dtype)),vd.runKernel(function(t,e){var o=t.pow(n,r);return e([n,r,o]),o},{$base:n,$exp:r},function(t,e){var n=e[0],r=e[1],i=e[2];return{$base:function(){var e=r.toFloat(),i=t.mul(e.mul(n.pow(e.sub(nv(1))))),a=Dg(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$exp:function(){var e=n.greater(0),a=n.log().where(e,mv(n)),s=t.mul(i.mul(a)),u=Dg(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}})}}),TC=Ym({powStrict_:function(t,e){return ef(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),_C=Ym({squaredDifference_:function(t,e){var n,r=Bm(t,"a","squaredDifference"),o=Bm(e,"b","squaredDifference");return n=ld(r,o),Og((r=n[0]).shape,(o=n[1]).shape),vd.runKernel(function(t,e){var n=t.squaredDifference(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1],o=nv(2);return{$a:function(){return t.mul(n.sub(r).mul(o))},$b:function(){return t.mul(r.sub(n).mul(o))}}})}}),DC=Ym({squaredDifferenceStrict_:function(t,e){var n=Bm(t,"a","squaredDifferenceStrict"),r=Bm(e,"b","squaredDifferenceStrict");return ef(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),OC=Ym({sub_:function(t,e){var n,r=Bm(t,"a","sub"),o=Bm(e,"b","sub");n=ld(r,o);var i=Og((r=n[0]).shape,(o=n[1]).shape);return vd.runKernel(function(t){return t.subtract(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=Dg(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=Dg(o.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}})}}),MC=Ym({subStrict_:function(t,e){var n=Bm(t,"a","subStrict"),r=Bm(e,"b","subStrict");return ef(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),FC=Ym({logicalAnd_:function(t,e){var n=Bm(t,"a","logicalAnd","bool"),r=Bm(e,"b","logicalAnd","bool");return Og(n.shape,r.shape),vd.runKernel(function(t){return t.logicalAnd(n,r)},{$a:n,$b:r})}}),PC=Ym({logicalNot_:function(t){var e=Bm(t,"x","logicalNot","bool");return vd.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),LC=Ym({logicalOr_:function(t,e){var n=Bm(t,"a","logicalOr","bool"),r=Bm(e,"b","logicalOr","bool");return Og(n.shape,r.shape),vd.runKernel(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}}),BC=Ym({logicalXor_:function(t,e){var n=Bm(t,"a","logicalXor","bool"),r=Bm(e,"b","logicalXor","bool");return Og(n.shape,r.shape),LC(t,e).logicalAnd(FC(t,e).logicalNot())}}),zC=Ym({where_:function(t,e,n){var r=Bm(e,"a","where"),o=Bm(n,"b","where"),i=Bm(t,"condition","where","bool");return ef(r.shape,o.shape,"Error in where: "),1===i.rank?tf(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):ef(i.shape,o.shape,"Error in where: "),vd.runKernel(function(t,e){var n=t.select(i,r,o);return e([i]),n},{$condition:i,$a:r,$b:o},function(t,e){var n=e[0];return{$condition:function(){return mv(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}})}}),UC=function(t){return jh(this,void 0,void 0,function(){var e,n,r;return Hh(this,function(o){switch(o.label){case 0:return[4,(e=Bm(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=ry(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},VC=Ym({elu_:function(t){var e=Bm(t,"x","elu");return vd.runKernel(function(t,n){var r=t.elu(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return vd.runKernel(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),WC=Ym({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=Bm(t,"x","leakyRelu");return xC(nv(e).mul(n),n)}}),jC=Ym({prelu_:function(t,e){var n=Bm(t,"x","prelu"),r=Bm(e,"alpha","prelu");return vd.runKernel(function(t,e){var o=t.prelu(n,r);return e([n,r]),o},{$x:n,$alpha:r},function(t,e){var n=e[0],r=e[1],o=n.greater(0);return{$x:function(){return zC(o,t,t.mul(r))},$alpha:function(){var e=zC(o,mv(t),t.mul(n)),i=Dg(r.shape,t.shape);return i.length>0&&(e=e.sum(i)),e.reshape(r.shape)}}})}}),HC=Ym({relu_:function(t){var e=Bm(t,"x","relu");return"bool"===e.dtype?e.toInt():vd.runKernel(function(t,n){var r=t.relu(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n.step().toFloat())}}})}}),GC=Ym({selu_:function(t){var e=Bm(t,"x","selu");return vd.runKernel(function(t,n){var r=t.selu(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){var e=n.greater(nv(0)),r=nv(1.7580993408473768),o=nv(1.0507009873554805),i=t.mul(o),a=t.mul(r).mul(n.toFloat().exp());return zC(e,i,a)}}})}}),qC=Ym({transpose_:function(t,e){var n=Bm(t,"x","transpose");return null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),tf(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(t){tf(t>=0&&t<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1?n.clone():vd.runKernel(function(t){return t.transpose(n,e)},{$x:n},function(t){var n=qm(e);return{$x:function(){return t.transpose(n)}}})}}),KC=Ym({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=Bm(t,"x","localResponseNormalization");tf(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),tf(sf(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=vd.runKernel(function(t,i){var s=t.localResponseNormalization4D(a,e,n,r,o);return i([a,s]),s},{x4D:a},function(t,i){var a=i[0],s=i[1];return{x4D:function(){return vd.runKernel(function(i){return i.LRNGrad(t,a,s,e,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),$C=Ym({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(nv(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=Bm(t,"x","norm"),e,n),i=o.shape;if(r){var a=ff(n,t.shape);i=jm(o.shape,a)}return o.reshape(i)}});function XC(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function YC(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var QC=Ym({gather_:function(t,e,n){void 0===n&&(n=0);var r=Bm(t,"x","gather"),o=Bm(e,"indices","gather","int32");n=ff(n,r.shape)[0];var i=function(t,e,n){for(var r=t.shape[n],o=[],i=1,a=1,s=0;s<n;s++)o.push(t.shape[s]),i*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=n+1;s<t.rank;s++)o.push(t.shape[s]),a*=t.shape[s];return{batchSize:i,sliceSize:a,dimSize:r,outputShape:o}}(r,o,n);return vd.runKernel(function(t,e){var i=t.gather(r,o.flatten(),n);return e([o]),i},{$x:r},function(t,e){var o=e[0];return{$x:function(){var e=r.shape,i=o.size,a=e.slice(0,n),s=a.length,u=e.slice(n,e.length).slice(1),l=u.length,c=XC(0,s),p=XC(s+1,s+1+l),h=YC([a,[i],u]),f=t.reshape(h),d=o.reshape([i]),m=YC([[s],c,p]),v=f.transpose(m),g=ZC(v,d,r.shape[n]),y=qm(m);return g.transpose(y)}}}).reshape(i.outputShape)}}),ZC=Ym({unsortedSegmentSum_:function(t,e,n){var r=Bm(t,"x","unsortedSegmentSum"),o=Bm(e,"segmentIds","unsortedSegmentSum","int32");return tf(sf(n),function(){return"numSegments must be of dtype int"}),vd.runKernel(function(t,e){var i=t.unsortedSegmentSum(r,o,n);return e([o]),i},{$x:r},function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=xC(e,mv(e)),r=QC(t,n),o=iC(e,nv(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=Uv(o,a+1);o=FC(o,lv(r.shape,"bool"));var s=mv(r);return zC(o,r,s)}(t,n)}}})}}),JC=Ym({basicLSTMCell_:function(t,e,n,r,o,i){var a=Bm(t,"forgetBias","basicLSTMCell"),s=Bm(e,"lstmKernel","basicLSTMCell"),u=Bm(n,"lstmBias","basicLSTMCell"),l=Bm(r,"data","basicLSTMCell"),c=Bm(o,"c","basicLSTMCell"),p=Bm(i,"h","basicLSTMCell"),h=l.concat(p,1).matMul(s).add(u),f=h.shape[1]/4,d=[h.shape[0],f],m=h.slice([0,0],d),v=h.slice([0,f],d),g=h.slice([0,2*f],d),y=h.slice([0,3*f],d),b=m.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(a.add(g).sigmoid())),w=b.tanh().mulStrict(y.sigmoid());return[b,w]}}),tE=Ym({multiRNNCell_:function(t,e,n,r){for(var o=Bm(e,"data","multiRNNCell"),i=zm(n,"c","multiRNNCell"),a=zm(r,"h","multiRNNCell"),s=o,u=[],l=0;l<t.length;l++){var c=t[l](s,i[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var p=[],h=[];for(l=0;l<u.length;l+=2)p.push(u[l]),h.push(u[l+1]);return[p,h]}}),eE=Ym({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var i=Bm(t,"v","movingAverage"),a=Bm(e,"x","movingAverage"),s=Bm(n,"decay","movingAverage");cd(i,a),tf(af(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=nv(1),l=u.sub(s),c=a.sub(i).mul(l);if(o){tf(null!=r,function(){return"When using zeroDebias: true, step is required."});var p=Bm(r,"step","movingAverage");c=c.div(u.sub(AC(s,p)))}return i.add(c)}}),nE=Ym({stridedSlice_:function(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var l=Bm(t,"x","stridedSlice");if(r.every(function(t){return 1===t})){var c=mg(l.shape,e,n,r,o,i,a,s,u),p=c[0],h=c[1],f=c[2],d=h.filter(function(t,e){return-1===f.indexOf(e)});return zx(l,p,h).reshape(d)}return vd.runKernel(function(t){return t.stridedSlice(l,e,n,r,o,i,a,s,u)},{$x:l})}}),rE=Ym({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=Bm(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=vd.runKernel(function(t){return t.topk(r,e,n)},{$x:r});return{values:i[0],indices:i[1]}}}),oE=Ym({scatterND_:function(t,e,n){var r=Bm(t,"indices","scatterND","int32"),o=Bm(e,"updates","scatterND");return function(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}!function(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}(n,e,t)}(o,r,n),vd.runKernel(function(t){return t.scatterND(r,o,n)},{$indices:r,$updates:o})}}),iE=Ym({fft_:function(t){tf("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return vd.runKernel(function(t){return t.fft(n)},{input:t}).reshape(t.shape)}}),aE=Ym({ifft_:function(t){tf("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return vd.runKernel(function(t){return t.ifft(n)},{input:t}).reshape(t.shape)}}),sE=Ym({rfft_:function(t,e){tf("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=e&&e<r){var i=t.shape.map(function(t){return 0}),a=t.shape.map(function(t){return t});a[t.shape.length-1]=e,n=t.slice(i,a),r=e}else if(null!=e&&e>r){var s=t.shape.map(function(t){return t});s[t.shape.length-1]=e-r,n=t.concat(cv(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),l=Qm(n,u).as2D(o,r),c=iE(l),p=Math.floor(r/2)+1,h=Zm(c),f=Jm(c),d=h.split([p,r-p],h.shape.length-1),m=f.split([p,r-p],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,Qm(d[0],m[0]).reshape(v)}}),uE=Ym({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=aE(r);return Zm(o)}var i=[n,2*(e-1)],a=Zm(t).as2D(n,e),s=Jm(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),l=s.slice([0,1],[n,e-2]).reverse(1).mul(nv(-1)),c=a.concat(u,1),p=s.concat(l,1);return r=Qm(c,p).as2D(i[0],i[1]),o=aE(r),Zm(o)}}),lE=Object.freeze({fft:iE,ifft:aE,rfft:sE,irfft:uE}),cE=Ym({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var o=Bm(t,"sparseIndices","sparseToDense","int32"),i=Bm(e,"sparseValues","sparseToDense"),a=Bm(r,"defaultValue","sparseToDense",i.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");if(0!==e.rank&&(1!==e.rank||e.size!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),vd.runKernel(function(t){return t.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),pE=Ym({gatherND_:function(t,e){var n=Bm(e,"indices","gatherND","int32"),r=Bm(t,"x","gatherND");return vd.runKernel(function(t){return t.gatherND(r,n)},{$x:r,$indices:n})}}),hE=Ym({dropout_:function(t,e,n,r){if(null!=n&&!af(t.shape,n))throw new Error("Non-default noise shape is not implemented yet: "+JSON.stringify(n));var o=Qv(t.shape,0,1,"float32",r).greater(e);return o=o.div(OC(1,e)),t.mul(o)}});function fE(t,e,n){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=e-n*Math.cos(a)}return rv(o,"float32")}var dE,mE=Ym({hannWindow_:function(t){return fE(t,.5,.5)}}),vE=Ym({hammingWindow_:function(t){return fE(t,.54,.46)}}),gE=Ym({frame_:function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+e<=t.size;)a.push(zx(t,i,e)),i+=n;if(r){var s=i+e-t.size,u=vv([zx(t,i,e-s),pv([s],o)]);a.push(u)}return 0===a.length?ov([],[0,e]):vv(a).as2D(a.length,e)}}),yE=Object.freeze({hannWindow:mE,hammingWindow:vE,frame:gE});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(dE||(dE={}));var bE=Ym({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=dE.SUM_BY_NONZERO_WEIGHTS);var o=Bm(t,"labels","absoluteDifference"),i=Bm(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=Bm(n,"weights","absoluteDifference")),ef(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return wE(s,a,r)}}),wE=Ym({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=dE.SUM_BY_NONZERO_WEIGHTS);var r=Bm(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=Bm(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(n===dE.NONE)return i;if(n===dE.SUM)return i.sum();if(n===dE.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(nv(a)):s}if(n===dE.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(nv(r.size));var u=o.mul(lv(r.shape)).notEqual(nv(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),xE=Ym({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=dE.SUM_BY_NONZERO_WEIGHTS);var i=Bm(t,"labels","cosineDistance"),a=Bm(e,"predictions","cosineDistance"),s=null;null!=r&&(s=Bm(r,"weights","cosineDistance")),ef(i.shape,a.shape,"Error in cosineDistance: ");var u=nv(1).sub(i.mul(a).sum(n,!0));return wE(u,s,o)}}),CE=Ym({hingeLoss_:function(t,e,n,r){void 0===r&&(r=dE.SUM_BY_NONZERO_WEIGHTS);var o=Bm(t,"labels","hingeLoss"),i=Bm(e,"predictions","hingeLoss"),a=null;null!=n&&(a=Bm(n,"weights","hingeLoss")),ef(o.shape,i.shape,"Error in hingeLoss: ");var s=nv(1);o=nv(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return wE(u,a,r)}}),EE=Ym({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=dE.SUM_BY_NONZERO_WEIGHTS);var i=Bm(t,"labels","huberLoss"),a=Bm(e,"predictions","huberLoss"),s=null;null!=n&&(s=Bm(n,"weights","huberLoss")),ef(i.shape,a.shape,"Error in huberLoss: ");var u=nv(r),l=a.sub(i).abs(),c=EC(l,u),p=l.sub(c),h=nv(.5).mul(c.square()).add(u.mul(p));return wE(h,s,o)}}),SE=Ym({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=dE.SUM_BY_NONZERO_WEIGHTS);var i=Bm(t,"labels","logLoss"),a=Bm(e,"predictions","logLoss"),s=null;null!=n&&(s=Bm(n,"weights","logLoss")),ef(i.shape,a.shape,"Error in logLoss: ");var u=nv(1),l=nv(r),c=i.mul(a.add(l).log()).neg().sub(u.sub(i).mul(u.sub(a).add(l).log()));return wE(c,s,o)}}),kE=Ym({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=dE.SUM_BY_NONZERO_WEIGHTS);var o=Bm(t,"labels","meanSquaredError"),i=Bm(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=Bm(n,"weights","meanSquaredError")),ef(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return wE(s,a,r)}}),NE=Ym({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=dE.SUM_BY_NONZERO_WEIGHTS);var i=Bm(t,"multiClassLabels","sigmoidCrossEntropy"),a=Bm(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Bm(n,"weights","sigmoidCrossEntropy")),ef(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=nv(r),l=nv(1),c=nv(.5);i=i.mul(l.sub(u)).add(c.mul(u))}var p=function(t,e){var n=Bm(t,"labels","sigmoidCrossEntropyWithLogits"),r=Bm(e,"logits","sigmoidCrossEntropyWithLogits");ef(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return wE(p,s,o)}}),IE=Ym({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=dE.SUM_BY_NONZERO_WEIGHTS);var i=Bm(t,"onehotLabels","softmaxCrossEntropy"),a=Bm(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Bm(n,"weights","softmaxCrossEntropy")),ef(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=nv(r),l=nv(1),c=nv(i.shape[1]);i=i.mul(l.sub(u)).add(u.div(c))}var p=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return kg(function(t,e,r){var o=e.logSumExp([n],!0),i=e.toFloat().sub(o);return r([t,i]),{value:i.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],o=e[1],i=jm(t.shape,[n]);return[t.reshape(i).mul(r.toFloat().sub(o.exp())),t.reshape(i).mul(o.exp().sub(r.toFloat()))]}}})(t,e)}(i,a);return wE(p,s,o)}}),RE=Object.freeze({get Reduction(){return dE},absoluteDifference:bE,computeWeightedLoss:wE,cosineDistance:xE,hingeLoss:CE,huberLoss:EE,logLoss:SE,meanSquaredError:kE,sigmoidCrossEntropy:NE,softmaxCrossEntropy:IE});function AE(t,e){return void 0===e&&(e=!1),vd.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=Vv(n),i=t.clone(),a=ov([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(t){var e,u=i,l=s,c=o;e=vd.tidy(function(){var e=i.slice([t,t],[n-t,1]),u=e.norm(),l=i.slice([t,t],[1,1]),c=l.sign().neg(),p=l.sub(c.mul(u)),h=e.div(p);s=1===h.shape[0]?a.clone():a.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var f=c.matMul(p).div(u).neg(),d=i.slice([t,0],[n-t,r]),m=f.mul(s);i=0===t?d.sub(m.matMul(s.transpose().matMul(d))):i.slice([0,0],[t,r]).concat(d.sub(m.matMul(s.transpose().matMul(d))),0);var v=o.slice([0,t],[n,o.shape[1]-t]);return o=0===t?v.sub(v.matMul(s).matMul(m.transpose())):o.slice([0,0],[n,t]).concat(v.sub(v.matMul(s).matMul(m.transpose())),1),[s,i,o]}),s=e[0],i=e[1],o=e[2],Em([u,l,c])},c=0;c<u;++c)l(c);return!e&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var TE=Ym({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,tf(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(e){tf(t[e].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"})},o=1;o<t.length;++o)r(o)}else e=!0,t=xv(t,t.shape[0],0).map(function(t){return tg(t,[0])});tf(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(t){i.push(vd.tidy(function(){var e=a[t];if(t>0)for(var n=0;n<t;++n){var r=tC(i[n].mulStrict(e)).mul(i[n]);e=e.sub(r)}return e.div($C(e,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return e?eg(i,0):i}}),_E=Ym({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return AE(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=og(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach(function(t){var n=AE(t,e),r=n[1];o.push(n[0]),i.push(r)}),[eg(o,0).reshape(t.shape),eg(i,0).reshape(t.shape)]}}),DE=Object.freeze({gramSchmidt:TE,qr:_E});function OE(t,e,n,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var i=t.shape[0];return n=Math.min(n,i),tf(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),tf(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),tf(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),tf(1===e.rank,function(){return"scores must be a 1D tensor"}),tf(e.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}var ME=Ym({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=Bm(t,"images","resizeBilinear");tf(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),tf(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=vd.runKernel(function(t,e){return e([o]),t.resizeBilinear(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return vd.runKernel(function(r){return r.resizeBilinearBackprop(t,e[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),FE=Ym({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=Bm(t,"images","resizeNearestNeighbor");tf(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),tf(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),tf("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=vd.runKernel(function(t,e){return e([o]),t.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return vd.runKernel(function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),PE=Ym({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=Bm(t,"boxes","nonMaxSuppression"),a=Bm(e,"scores","nonMaxSuppression"),s=OE(i,a,n,r,o);return n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,vd.runKernel(function(t){return t.nonMaxSuppression(i,a,n,r,o)},{$boxes:i})}}),LE=Ym({cropAndResize_:function(t,e,n,r,o,i){var a=Bm(t,"image","cropAndResize","float32"),s=Bm(e,"boxes","cropAndResize","float32"),u=Bm(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var l=s.shape[0];return tf(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),tf(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),tf(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),tf(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),tf(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),tf("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),vd.runKernel(function(t,e){return t.cropAndResize(a,s,u,r,o,i)},{$image:a,$boxes:s})}}),BE=Object.freeze({resizeBilinear:ME,resizeNearestNeighbor:FE,nonMaxSuppression:PE,nonMaxSuppressionAsync:function(t,e,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),jh(this,void 0,void 0,function(){var i,a,s,u,l,c;return Hh(this,function(p){switch(p.label){case 0:return i=Bm(t,"boxes","nonMaxSuppressionAsync"),a=Bm(e,"scores","nonMaxSuppressionAsync"),s=OE(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,i.data()];case 1:return u=p.sent(),[4,a.data()];case 2:return l=p.sent(),c=Zg(u,l,n,r,o),i!==t&&i.dispose(),a!==e&&a.dispose(),[2,c]}})})},cropAndResize:LE}),zE=Ym({matMul_:function(t,e,n,r,o,i){var a;void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i="linear");var s=Bm(t,"a","fused matMul"),u=Bm(e,"b","fused matMul");a=ld(s,u),s=a[0],u=a[1];var l=n?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],p=n?s.shape[s.rank-1]:s.shape[s.rank-2],h=r?u.shape[u.rank-2]:u.shape[u.rank-1],f=s.shape.slice(0,-2),d=u.shape.slice(0,-2),m=of(f),v=of(d);tf(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),tf(af(f,d),function(){return"Error in fused matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),tf(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var g,y=s.shape.slice(0,-2).concat([p,h]),b=n?s.as3D(m,l,p):s.as3D(m,p,l),w=r?u.as3D(v,h,c):u.as3D(v,c,h);null!=o&&Og(y,(g=ld(g=Bm(o,"bias","fused matMul"),s)[0]).shape);var x={$a:b,$b:w};return null!=o&&(x.$bias=g),vd.runKernel(function(t,e){var o=t.fusedBatchMatMul(b,w,n,r,g,i);return e([b,w,o]),o},x,function(t,e){var a,s=e[0],u=e[1],l=e[2];if(null==i||"linear"===i)a=t;else{if("relu"!==i)throw new Error("Gradient for activation "+i+" has not been implemented yet.");a=t.mul(l.step())}var c={};return null!=o&&(c={$bias:function(){var t=a,e=Dg(g.shape,a.shape);return e.length>0&&(t=t.sum(e)),t.reshape(g.shape)}}),n||r?!n&&r?Object.assign({$a:function(){return a.matMul(u,!1,!1)},$b:function(){return a.matMul(s,!0,!1)}},c):n&&!r?Object.assign({$a:function(){return u.matMul(a,!1,!0)},$b:function(){return s.matMul(a,!1,!1)}},c):Object.assign({$a:function(){return u.matMul(a,!0,!0)},$b:function(){return a.matMul(s,!0,!0)}},c):Object.assign({$a:function(){return a.matMul(u,!1,!0)},$b:function(){return s.matMul(a,!0,!1)}},c)}).reshape(y)}}),UE=Object.freeze({matMul:zE}),VE=Object.freeze({image:BE,linalg:DE,losses:RE,spectral:lE,fused:UE,signal:yE,op:Ym,batchNormalization2d:ux,batchNormalization3d:lx,batchNormalization4d:cx,batchNormalization:px,batchNorm:hx,batchNorm2d:fx,batchNorm3d:dx,batchNorm4d:mx,complex:Qm,real:Zm,imag:Jm,concat:vv,concat1d:gv,concat2d:yv,concat3d:bv,concat4d:wv,split:xv,conv1d:bx,conv2d:wx,conv3d:xx,conv2dDerFilter:Cx,depthwiseConv2d:Ex,separableConv2d:Sx,conv2dTranspose:kx,matMul:Nx,dot:Ix,outerProduct:Rx,reverse:Ax,reverse1d:Tx,reverse2d:_x,reverse3d:Dx,reverse4d:Ox,maxPool:Px,avgPool:Lx,pool:Bx,slice:zx,slice1d:Ux,slice2d:Vx,slice3d:Wx,slice4d:jx,abs:xw,acos:Cw,acosh:Ew,asin:Sw,asinh:kw,atan:Nw,atanh:Iw,ceil:Rw,clipByValue:Aw,cos:Tw,cosh:_w,erf:Dw,exp:Ow,expm1:Mw,floor:Fw,log:Pw,log1p:Lw,logSigmoid:Bw,neg:zw,reciprocal:Uw,round:Vw,rsqrt:Ww,sigmoid:jw,sign:Hw,isNaN:Gw,isInf:qw,isFinite:Kw,sin:$w,sinh:Xw,softplus:Yw,sqrt:Qw,square:Zw,step:Jw,tan:tx,tanh:ex,all:Gx,any:qx,argMax:Kx,argMin:$x,logSumExp:Xx,max:Yx,mean:Qx,min:Zx,moments:Jx,sum:tC,prod:eC,equal:nC,equalStrict:rC,greater:oC,greaterEqual:iC,greaterEqualStrict:aC,greaterStrict:sC,less:uC,lessEqual:lC,lessEqualStrict:cC,lessStrict:pC,notEqual:hC,notEqualStrict:fC,add:dC,addN:mC,addStrict:vC,atan2:gC,div:yC,divStrict:bC,floorDiv:wC,maximum:xC,maximumStrict:CC,minimum:EC,minimumStrict:SC,mod:kC,modStrict:NC,mul:IC,mulStrict:RC,pow:AC,powStrict:TC,squaredDifference:_C,squaredDifferenceStrict:DC,sub:OC,subStrict:MC,elu:VC,leakyRelu:WC,prelu:jC,relu:HC,selu:GC,logicalAnd:FC,logicalNot:PC,logicalOr:LC,logicalXor:BC,where:zC,whereAsync:UC,buffer:Ov,print:Mv,batchToSpaceND:Fv,cast:Pv,clone:Lv,cumsum:Bv,depthToSpace:zv,expandDims:Uv,eye:Vv,multinomial:Wv,oneHot:jv,pad:Hv,pad1d:Gv,pad2d:qv,pad3d:Kv,pad4d:$v,rand:Xv,randomNormal:Yv,randomUniform:Qv,reshape:Zv,spaceToBatchND:Jv,squeeze:tg,stack:eg,tile:ng,truncatedNormal:rg,unstack:og,setdiff1dAsync:ig,fill:pv,linspace:hv,ones:lv,range:fv,scalar:nv,tensor:tv,tensor1d:rv,tensor2d:ov,tensor3d:iv,tensor4d:av,tensor5d:sv,tensor6d:uv,zeros:cv,onesLike:dv,zerosLike:mv,transpose:qC,softmax:Ig,logSoftmax:Rg,localResponseNormalization:KC,norm:$C,gather:QC,unsortedSegmentSum:ZC,basicLSTMCell:JC,multiRNNCell:tE,movingAverage:eE,stridedSlice:nE,topk:rE,scatterND:oE,fft:iE,ifft:aE,rfft:sE,irfft:uE,sparseToDense:cE,gatherND:pE,dropout:hE,hannWindow:mE,hammingWindow:vE,frame:gE}),WE=function(){function t(){if(this.blockSize=48,this.firstUse=!0,Kh.get("IS_BROWSER")){var t="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(300,150):"undefined"!=typeof document?document.createElement("canvas"):null;null!==t&&(this.fromPixels2DContext=t.getContext("2d"))}this.data=new Ag(this,vd)}return t.prototype.register=function(t,e,n){if(this.firstUse&&(this.firstUse=!1,Kh.get("IS_NODE")&&Fm("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:n})},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=e},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,r,o=t.data instanceof Uint8Array,i="undefined"!=typeof ImageData&&t instanceof ImageData,a="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement;if(Kh.get("IS_NODE")&&null==t.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=t.getContext)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(i||o)n=t.data;else{if(!s&&!a)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),n=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(4===e)r=new Int32Array(n);else{var u=t.width*t.height;r=new Int32Array(u*e);for(var l=0;l<u;l++)for(var c=0;c<e;++c)r[l*e+c]=n[4*l+c]}return iv(r,[t.height,t.width,e],"int32")},t.prototype.read=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){var e=this.data.get(t),n=e.complexTensors;return"complex64"===e.dtype?$g(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(t).values},t.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map(function(t){return zf(t)})}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ov(t.shape,t.dtype,n)},t.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},t.prototype.time=function(t){return jh(this,void 0,void 0,function(){var e;return Hh(this,function(n){return e=Ff(),t(),[2,{kernelMs:Ff()-e}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(t,e){var n=Qf.make(t.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:vd.keep(t.clone()),imag:vd.keep(e.clone())},n},t.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},t.prototype.assertNotComplex=function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&tf("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})},t.prototype.slice=function(t,e,n){if(this.assertNotComplex(t,"slice"),yg(t.shape,e,n)){var r=bg(e,t.strides),o=of(n);return tv(this.readSync(t.dataId).subarray(r,r+o),n,t.dtype)}for(var i=Ov(n,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s).map(function(t,n){return t+e[n]});i.values[s]=a.get.apply(a,u)}return i.toTensor()},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){this.assertNotComplex(t,"stridedSlice");var l=mg(t.shape,e,n,r,o,i,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return-1===h.indexOf(e)});if(f.some(function(t){return 0===t}))return tv([],f);for(var d=Ov(p,t.dtype),m=this.bufferSync(t),v=0;v<d.size;v++){for(var g=d.indexToLoc(v),y=new Array(g.length),b=0;b<y.length;b++)y[b]=g[b]*r[b]+c[b];d.set.apply(d,[m.get.apply(m,y)].concat(g))}return d.toTensor().reshape(f)},t.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},t.prototype.reverse=function(t,e){this.assertNotComplex(t,"reverse");for(var n=Ov(t.shape,t.dtype),r=this.bufferSync(t),o=function(o){var i=n.indexToLoc(o),a=i.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(i))},i=0;i<n.size;i++)o(i);return n.toTensor()},t.prototype.concat=function(t,e){var n=this;this.assertNotComplex(t,"concat");var r=t.map(function(t){var n=of(t.shape.slice(e));return t.as2D(-1,n)}),o=Xm(r.map(function(t){return t.shape}),1),i=Ov(o,t[0].dtype).values;if(1===r[0].shape[0]){var a=0;r.forEach(function(t){i.set(n.readSync(t.dataId),a),a+=t.size})}else{var s=0;r.forEach(function(t){for(var e=n.readSync(t.dataId),r=0,a=0;a<t.shape[0];++a)for(var u=a*o[1]+s,l=0;l<t.shape[1];++l)i[u+l]=e[r++];s+=t.shape[1]})}var u=Xm(t.map(function(t){return t.shape}),e);return tv(i,u,t[0].dtype)},t.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(nv(-1),t)},t.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,sd(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.addN=function(t){var e=this;this.assertNotComplex(t,"addN");for(var n=t.map(function(t){return e.readSync(t.dataId)}),r=Ov(t[0].shape,t[0].dtype),o=r.values,i=0;i<t.length;i++)for(var a=n[i],s=0;s<o.length;s++)o[s]+=a[s];return r.toTensor()},t.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,sd(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.batchMatMul=function(t,e,n,r){this.assertNotComplex([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],i=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),l=this.readSync(e.dataId),c=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=c[0],h=c[1],f=c[2],d=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],m=d[0],v=d[1],g=d[2],y=i*a,b=Ov([s,i,a],t.dtype),w=b.values,x=this.blockSize,C=0;C<s;C++)for(var E=0;E<i;E+=x)for(var S=0;S<a;S+=x)for(var k=0;k<o;k+=x)for(var N=Math.min(E+x,i),I=Math.min(S+x,a),R=Math.min(k+x,o),A=E;A<N;A++)for(var T=S;T<I;T++){for(var _=0,D=k;D<R;D++)_+=u[C*p+A*h+D*f]*l[D*m+T*v+C*g];w[C*y+(A*a+T)]+=_}return b.toTensor()},t.prototype.fusedBatchMatMul=function(t,e,n,r,o,i){var a=this.batchMatMul(t,e,n,r);return o&&(a=this.add(a,o)),i&&(a=function(t,e,n){if("linear"===e)return t.linear(n);if("relu"===e)return t.relu(n);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}(this,i,a)),a},t.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,sd(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.realDivide=function(t,e){return this.assertNotComplex([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},t.prototype.floorDiv=function(t,e){return this.assertNotComplex([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},t.prototype.sum=function(t,e){this.assertNotComplex(t,"sum"),Hm("sum",e,t.rank);for(var n=Wm(t.shape,e),r=n[1],o=cv(n[0],sd(t.dtype,"int32")),i=of(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=0,p=0;p<i;++p)c+=s[l+p];a[u]=c}return o},t.prototype.prod=function(t,e){this.assertNotComplex(t,"sum");for(var n=Wm(t.shape,e),r=n[1],o=cv(n[0],sd(t.dtype,"int32")),i=of(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=1,p=0;p<i;++p)c*=s[l+p];a[u]=c}return o},t.prototype.unsortedSegmentSum=function(t,e,n){this.assertNotComplex(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,i=0;i<o;++i)e=e.expandDims(i+1);for(i=0;i<n;++i){var a=nv(i,"int32"),s=nC(a,e).asType("float32").mul(t).sum(0);r.push(s)}return eg(r)},t.prototype.argMin=function(t,e){this.assertNotComplex(t,"argMin");var n=[e];Hm("argMin",n,t.rank);for(var r=Wm(t.shape,n),o=r[1],i=cv(r[0],"int32"),a=of(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0,f=0;f<a;++f){var d=u[c+f];d<p&&(p=d,h=f)}s[l]=h}return i},t.prototype.argMax=function(t,e){this.assertNotComplex(t,"argMax");var n=[e];Hm("argMax",n,t.rank);for(var r=Wm(t.shape,n),o=r[1],i=cv(r[0],"int32"),a=of(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0,f=0;f<a;++f){var d=u[c+f];d>p&&(p=d,h=f)}s[l]=h}return i},t.prototype.cumsum=function(t,e,n,r){if(this.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=sd(t.dtype,"int32"),i=cv(t.shape,o),a=this.readSync(i.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],l=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},c=0;c<s.length;c+=u)for(var p=0;p<u;p++){var h=l(c,p);if(0===p)a[h]=n?0:s[h];else{var f=l(c,p-1);a[h]=n?s[f]+a[f]:s[h]+a[f]}}return i},t.prototype.equal=function(t,e){return this.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},t.prototype.notEqual=function(t,e){return this.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},t.prototype.less=function(t,e){return this.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},t.prototype.lessEqual=function(t,e){return this.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},t.prototype.greater=function(t,e){return this.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},t.prototype.greaterEqual=function(t,e){return this.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},t.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return Qf.make(t.shape,{values:n},"bool")},t.prototype.logicalAnd=function(t,e){return this.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},t.prototype.logicalOr=function(t,e){return this.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},t.prototype.select=function(t,e,n){this.assertNotComplex([t,e,n],"select");for(var r=this.readSync(t.dataId),o=this.readSync(e.dataId),i=this.readSync(n.dataId),a=cv(e.shape,sd(e.dtype,n.dtype)),s=this.readSync(a.dataId),u=0,l=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],c=0;c<r.length;c++)for(var p=0;p<l;p++)s[u++]=1===r[c]?o[c]:i[c];return a},t.prototype.where=function(t){this.assertNotComplex([t],"where");var e=this.readSync(t.dataId);return ry(t.shape,e)},t.prototype.topk=function(t,e,n){return this.assertNotComplex(t,"topk"),ny(this.readSync(t.dataId),t.shape,t.dtype,e)},t.prototype.min=function(t,e){this.assertNotComplex(t,"min"),Hm("min",e,t.rank);for(var n=Wm(t.shape,e),r=n[1],o=cv(n[0],t.dtype),i=of(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p){var h=s[l+p];h<c&&(c=h)}a[u]=c}return o},t.prototype.minimum=function(t,e){return this.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.mod=function(t,e){return this.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},t.prototype.max=function(t,e){this.assertNotComplex(t,"max"),Hm("max",e,t.rank);for(var n=Wm(t.shape,e),r=n[1],o=cv(n[0],t.dtype),i=of(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p){var h=s[l+p];h>c&&(c=h)}a[u]=c}return o},t.prototype.maximum=function(t,e){return this.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.all=function(t,e){this.assertNotComplex(t,"all"),Hm("all",e,t.rank);for(var n=Wm(t.shape,e),r=n[1],o=cv(n[0],t.dtype),i=of(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p)c=c&&s[l+p];a[u]=c}return o},t.prototype.any=function(t,e){this.assertNotComplex(t,"any"),Hm("any",e,t.rank);for(var n=Wm(t.shape,e),r=n[1],o=cv(n[0],t.dtype),i=of(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p)c=c||s[l+p];a[u]=c}return o},t.prototype.squaredDifference=function(t,e){return this.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},t.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=e[r]<0?-1:e[r]>0?1:0;return Qf.make(t.shape,{values:n})},t.prototype.isNaN=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return Qf.make(t.shape,{values:n},"bool")},t.prototype.isInf=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return Qf.make(t.shape,{values:n},"bool")},t.prototype.isFinite=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return Qf.make(t.shape,{values:n},"bool")},t.prototype.round=function(t){this.assertNotComplex(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);n[r]=e[r]-o<.5?Math.floor(e[r]):e[r]-o>.5?Math.ceil(e[r]):o%2==0?o:o+1}return Qf.make(t.shape,{values:n})},t.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.log=function(t){this.assertNotComplex(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log1p(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.sqrt(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/Math.sqrt(e[r]);return Qf.make(t.shape,{values:n})},t.prototype.square=function(t){this.assertNotComplex(t,"square");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=o*o}return Qf.make(t.shape,{values:n})},t.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return Qf.make(t.shape,{values:n})},t.prototype.linear=function(t){return t},t.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var e=cv(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},t.prototype.prelu=function(t,e){return this.assertNotComplex([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},t.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return Qf.make(t.shape,{values:e})},t.prototype.eluDer=function(t,e){this.assertNotComplex([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=this.readSync(t.dataId),i=0;i<r.length;++i){var a=r[i];n[i]=a>=1?o[i]:o[i]*(a+1)}return Qf.make(e.shape,{values:n})},t.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?1.0507009873554805*o:1.7580993408473768*(Math.exp(o)-1)}return Qf.make(t.shape,{values:e})},t.prototype.clip=function(t,e,n){this.assertNotComplex(t,"clip");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>n?n:a<e?e:a}return Qf.make(t.shape,{values:r})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r)e[r]=Math.hypot(n[2*r],n[2*r+1]);return Qf.make(t.shape,{values:e})},t.prototype.int=function(t){this.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return Qf.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return Qf.make(t.shape,{values:e})},t.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i,a=r[o]>-e,s=r[o]<e,u=Math.exp(r[o]);i=s?u:a?r[o]:Math.log(1+u),n[o]=i}return Qf.make(t.shape,{values:n})},t.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.atan2=function(t,e){return this.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},t.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=uf(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return Qf.make(t.shape,{values:e})},t.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r],i=1/(1+.3275911*o);e[r]=1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-o*o)}return Qf.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0),this.assertNotComplex(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i=r[o];n[o]=isNaN(i)?NaN:i>0?1:e}return Qf.make(t.shape,{values:n})},t.prototype.conv2d=function(t,e,n){this.assertNotComplex([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=Ov(n.outShape,t.dtype),c=this.readSync(t.dataId),p=this.readSync(e.dataId),h=l.values,f=0;f<n.batchSize;++f)for(var d=f*t.strides[0],m=f*l.strides[0],v=0;v<n.outHeight;++v)for(var g=m+v*l.strides[1],y=v*n.strideHeight-u,b=0;b<r;b++){var w=y+b*i;if(!(w<0||w>=n.inHeight))for(var x=b*e.strides[0],C=d+w*t.strides[1],E=0;E<n.outWidth;++E)for(var S=g+E*n.outChannels,k=E*n.strideWidth-s,N=0;N<o;N++){var I=k+N*a;if(!(I<0||I>=n.inWidth))for(var R=C+I*n.inChannels,A=x+N*e.strides[1],T=0;T<n.inChannels;++T){for(var _=c[R+T],D=0;D<n.outChannels;++D)h[S+D]+=_*p[A+D];A+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,i=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,p=n.padInfo.top,h=Ov(n.outShape,t.dtype),f=this.readSync(t.dataId),d=this.readSync(e.dataId),m=h.values,v=0;v<n.batchSize;++v)for(var g=v*t.strides[0],y=v*h.strides[0],b=0;b<n.outDepth;++b)for(var w=y+b*h.strides[1],x=b*n.strideDepth-l,C=0;C<r;C++){var E=x+C*a;if(!(E<0||E>=n.inDepth))for(var S=C*e.strides[0],k=g+E*t.strides[1],N=0;N<n.outHeight;++N)for(var I=w+N*h.strides[2],R=N*n.strideHeight-p,A=0;A<o;A++){var T=R+A*s;if(!(T<0||T>=n.inHeight))for(var _=S+A*e.strides[1],D=k+T*t.strides[2],O=0;O<n.outWidth;++O)for(var M=I+O*n.outChannels,F=O*n.strideWidth-c,P=0;P<i;P++){var L=F+P*u;if(!(L<0||L>=n.inWidth))for(var B=D+L*n.inChannels,z=_+P*e.strides[2],U=0;U<n.inChannels;++U){for(var V=f[B+U],W=0;W<n.outChannels;++W)m[M+W]+=V*d[z+W];z+=n.outChannels}}}}return h.toTensor()},t.prototype.conv2dDerInput=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerInput");for(var r=Ov(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=this.readSync(t.dataId),c=t.strides,p=c[0],h=c[1],f=c[2],d=this.readSync(e.dataId),m=e.strides,v=m[0],g=m[1],y=m[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,C=n.inChannels,E=n.inHeight,S=n.inWidth,k=n.outChannels,N=n.outHeight,I=n.outWidth,R=n.strideHeight,A=n.strideWidth,T=w-1-n.padInfo.top,_=x-1-n.padInfo.left,D=0;D<b;++D)for(var O=0;O<C;++O)for(var M=0;M<E;++M)for(var F=M-T,P=Math.max(0,Math.ceil(F/R)),L=Math.min(N,(w+F)/R),B=0;B<S;++B){for(var z=B-_,U=Math.max(0,Math.ceil(z/A)),V=Math.min(I,(x+z)/A),W=0,j=P;j<L;++j)for(var H=j*R-F,G=U;G<V;++G)for(var q=p*D+h*j+f*G,K=v*(w-1-H)+g*(x-1-(G*A-z))+y*O,$=0;$<k;++$)W+=l[q+$]*d[K+$];o[a*D+s*M+u*B+O]=W}return r.toTensor()},t.prototype.conv3dDerInput=function(t,e,n){for(var r=Ov(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=i[3],c=this.readSync(t.dataId),p=t.strides,h=p[0],f=p[1],d=p[2],m=p[3],v=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],w=g[2],x=g[3],C=n.batchSize,E=n.filterDepth,S=n.filterHeight,k=n.filterWidth,N=n.inChannels,I=n.inDepth,R=n.inHeight,A=n.inWidth,T=n.outChannels,_=n.outDepth,D=n.outHeight,O=n.outWidth,M=n.strideDepth,F=n.strideHeight,P=n.strideWidth,L=E-1-n.padInfo.front,B=S-1-n.padInfo.top,z=k-1-n.padInfo.left,U=0;U<C;++U)for(var V=0;V<N;++V)for(var W=0;W<I;++W)for(var j=W-L,H=Math.max(0,Math.ceil(j/M)),G=Math.min(_,(E+j)/M),q=0;q<R;++q)for(var K=q-B,$=Math.max(0,Math.ceil(K/F)),X=Math.min(D,(S+K)/F),Y=0;Y<A;++Y){for(var Q=Y-z,Z=Math.max(0,Math.ceil(Q/P)),J=Math.min(O,(k+Q)/P),tt=0,et=H;et<G;++et)for(var nt=et*M-j,rt=$;rt<X;++rt)for(var ot=rt*F-K,it=Z;it<J;++it)for(var at=h*U+f*et+d*rt+m*it,st=y*(E-1-nt)+b*(S-1-ot)+w*(k-1-(it*P-Q))+x*V,ut=0;ut<T;++ut)tt+=c[at+ut]*v[st+ut];o[a*U+s*W+u*q+l*Y+V]=tt}return r.toTensor()},t.prototype.conv2dDerFilter=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=Ov(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=this.bufferSync(t),p=this.bufferSync(e),h=0;h<i;++h)for(var f=Math.max(0,Math.ceil((l-h)/r)),d=Math.min(n.outHeight,(n.inHeight+l-h)/r),m=0;m<a;++m)for(var v=Math.max(0,Math.ceil((u-m)/o)),g=Math.min(n.outWidth,(n.inWidth+u-m)/o),y=0;y<n.inChannels;++y)for(var b=0;b<n.outChannels;++b){for(var w=0,x=0;x<n.batchSize;++x)for(var C=f;C<d;++C)for(var E=h+C*r-l,S=v;S<g;++S)w+=c.get(x,E,m+S*o-u,y)*p.get(x,C,S,b);s.set(w,h,m,y,b)}return s.toTensor()},t.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=Ov(n.filterShape,"float32"),c=l.values,p=l.strides,h=p[0],f=p[1],d=p[2],m=p[3],v=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],w=g[2],x=g[3],C=this.readSync(t.dataId),E=t.strides,S=E[0],k=E[1],N=E[2],I=E[3],R=n.padInfo.front,A=n.padInfo.left,T=n.padInfo.top,_=0;_<a;++_)for(var D=Math.max(0,Math.ceil((R-_)/r)),O=Math.min(n.outDepth,(n.inDepth+R-_)/r),M=_*h,F=0;F<s;++F)for(var P=Math.max(0,Math.ceil((T-F)/o)),L=Math.min(n.outHeight,(n.inHeight+T-F)/o),B=F*f+M,z=0;z<u;++z)for(var U=Math.max(0,Math.ceil((A-z)/i)),V=Math.min(n.outWidth,(n.inWidth+A-z)/i),W=z*d+B,j=0;j<n.inChannels;++j)for(var H=j*m+W,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var $=K*S,X=K*y,Y=D;Y<O;++Y)for(var Q=(_+Y*r-R)*k+$,Z=Y*b+X,J=P;J<L;++J)for(var tt=(F+J*o-T)*N+Q,et=J*w+Z,nt=U;nt<V;++nt)q+=C[(z+nt*i-A)*I+tt+j]*v[nt*x+et+G];c[H+G]=q}return l.toTensor()},t.prototype.depthwiseConv2D=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=Ov(n.outShape,t.dtype),p=this.readSync(t.dataId),h=this.readSync(e.dataId),f=c.values,d=0;d<n.batchSize;++d)for(var m=d*t.strides[0],v=d*c.strides[0],g=0;g<n.outHeight;++g)for(var y=v+g*c.strides[1],b=g*n.strideHeight-s,w=0;w<r;++w){var x=b+w*i;if(!(x<0||x>=n.inHeight))for(var C=w*e.strides[0],E=m+x*t.strides[1],S=0;S<n.outWidth;++S)for(var k=y+S*c.strides[2],N=S*n.strideWidth-u,I=0;I<o;++I){var R=N+I*a;if(!(R<0||R>=n.inWidth))for(var A=E+R*n.inChannels,T=k,_=C+I*e.strides[1],D=0;D<n.inChannels;++D){for(var O=p[A+D],M=0;M<l;++M)f[T+M]+=O*h[_+M];T+=l,_+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var r=Ov(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=this.readSync(t.dataId),c=t.strides,p=c[0],h=c[1],f=c[2],d=this.readSync(e.dataId),m=e.strides,v=m[0],g=m[1],y=m[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,C=n.inChannels,E=n.inHeight,S=n.inWidth,k=n.outHeight,N=n.outWidth,I=n.strideHeight,R=n.strideWidth,A=w-1-n.padInfo.top,T=x-1-n.padInfo.left,_=n.outChannels/C,D=0;D<b;++D)for(var O=0;O<C;++O)for(var M=0;M<E;++M)for(var F=M-A,P=Math.max(0,Math.ceil(F/I)),L=Math.min(k,(w+F)/I),B=0;B<S;++B){for(var z=B-T,U=Math.max(0,Math.ceil(z/R)),V=Math.min(N,(x+z)/R),W=0,j=P;j<L;++j)for(var H=j*I-F,G=U;G<V;++G)for(var q=p*D+h*j+f*G,K=v*(w-1-H)+g*(x-1-(G*R-z))+y*O,$=0;$<_;++$)W+=l[q+(O*_+$)]*d[K+$];o[a*D+s*M+u*B+O]=W}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=Ov(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,p=this.bufferSync(t),h=this.bufferSync(e),f=0;f<i;++f)for(var d=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),v=0;v<a;++v)for(var g=Math.max(0,Math.ceil((u-v)/o)),y=Math.min(n.outWidth,(n.inWidth+u-v)/o),b=0;b<n.outChannels;++b){for(var w=Math.trunc(b/c),x=b%c,C=0,E=0;E<n.batchSize;++E)for(var S=d;S<m;++S)for(var k=f+S*r-l,N=g;N<y;++N)C+=p.get(E,k,v+N*o-u,w)*h.get(E,S,N,b);s.set(C,f,v,w,x)}return s.toTensor()},t.prototype.tile=function(t,e){return this.assertNotComplex(t,"tile"),ey(this.bufferSync(t),e)},t.prototype.pad=function(t,e,n){this.assertNotComplex(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),o=e.map(function(t){return t[0]}),i=this.bufferSync(t),a=Ov(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=i.indexToLoc(s),l=u.map(function(t,e){return t+o[e]});a.set.apply(a,[i.get.apply(i,u)].concat(l))}return a.toTensor()},t.prototype.transpose=function(t,e){this.assertNotComplex(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var o=this.readSync(t.dataId),i=Ov(n,t.dtype),a=this.bufferSync(t);for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[e[l]];var c=i.locToIndex(u);i.values[c]=o[r]}return i.toTensor()},t.prototype.gather=function(t,e,n){this.assertNotComplex([t,e],"gather");var r=t.shape.slice(),o=this.readSync(e.dataId);r[n]=o.length;for(var i=Ov(r,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=a.locToIndex(l);i.values[s]=a.values[c]}return i.toTensor()},t.prototype.batchToSpaceND=function(t,e,n){this.assertNotComplex([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),o=ag(t.shape,e,r),i=sg(o.length,e.length),a=ug(t.shape,e,r),s=lg(n,e.length),u=cg(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){this.assertNotComplex([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=ag(a.shape,e,r,!1),u=sg(s.length,e.length,!1),l=ug(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(l)},t.prototype.pool=function(t,e,n){this.assertNotComplex(t,"pool");for(var r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=this.readSync(t.dataId),f=Ov(e.outShape,t.dtype),d=f.values,m=e.outShape[1]*e.outShape[2]*e.outShape[3],v=e.outShape[2]*e.outShape[3],g=e.outShape[3],y=0;y<e.batchSize;++y)for(var b=y*m,w=y*t.strides[0],x=0;x<e.inChannels;++x)for(var C=0;C<e.outHeight;++C)for(var E=C*r-l,S=Math.max(0,E),k=Math.min(e.inHeight,s+E),N=b+C*v,I=0;I<e.outWidth;++I){for(var R=I*o-c,A=Math.max(0,R),T=Math.min(e.inWidth,u+R),_=p,D=0,O=0,M=S;M<k;M+=i){for(var F=w+M*t.strides[1],P=A;P<T;P+=a){var L=h[F+P*t.strides[2]+x];"max"===n&&L>_?_=L:"avg"===n&&(D+=L,O++)}if(isNaN(_))break}d[N+I*g+x]="avg"===n?D/O:_}return f.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var n=Ov(e.outShape,"int32"),r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p=this.bufferSync(t),h=0;h<e.batchSize;++h)for(var f=0;f<e.inChannels;++f)for(var d=0;d<e.outHeight;++d){for(var m=d*r-l,v=m;v<0;)v+=i;for(var g=Math.min(e.inHeight,s+m),y=0;y<e.outWidth;++y){for(var b=y*o-c,w=b;w<0;)w+=a;for(var x=Math.min(e.inWidth,u+b),C=Number.NEGATIVE_INFINITY,E=-1,S=v;S<g;S+=i)for(var k=S-m,N=w;N<x;N+=a){var I=N-b,R=p.get(h,S,N,f);R>C&&(C=R,E=k*u+I)}n.set(E,h,d,y,f)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(t,e,n,r){this.assertNotComplex([e,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,r),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,p=c-1-r.padInfo.left,h=l-1-r.padInfo.top,f=Ov(e.shape,"float32"),d=this.bufferSync(o),m=this.bufferSync(t),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var w=y-h,x=b-p,C=0,E=0;E<l;E+=s){var S=(w+E)/i;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var N=(x+k)/a;if(!(N<0||N>=r.outWidth||Math.floor(N)!==N)){var I=l*c-1-d.get(v,S,N,g)===E*c+k?1:0;0!==I&&(C+=m.get(v,S,N,g)*I)}}}f.set(C,v,y,b,g)}return f.toTensor()},t.prototype.avgPoolBackprop=function(t,e,n){this.assertNotComplex([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,p=c-1-n.padInfo.left,h=l-1-n.padInfo.top,f=Ov(e.shape,"float32"),d=1/(i*a),m=this.bufferSync(t),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var w=y-h,x=b-p,C=0,E=0;E<l;E+=s){var S=(w+E)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var N=(x+k)/o;N<0||N>=n.outWidth||Math.floor(N)!==N||(C+=m.get(v,S,N,g))}}f.set(C*d,v,y,b,g)}return f.toTensor()},t.prototype.cast=function(t,e){return Hg(t,e,this)},t.prototype.reshape=function(t,e){return Gg(t,e)},t.prototype.avgPool=function(t,e){return this.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,n,r){this.assertNotComplex(t,"resizeBilinear");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],l=this.readSync(t.dataId),c=new Float32Array(of([i,e,n,u])),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=0,d=p[0]/h[0],m=p[1]/h[1],v=0;v<i;v++)for(var g=0;g<e;g++)for(var y=d*g,b=Math.floor(y),w=y-b,x=Math.min(a-1,Math.ceil(y)),C=v*t.strides[0]+b*t.strides[1],E=v*t.strides[0]+x*t.strides[1],S=0;S<n;S++)for(var k=m*S,N=Math.floor(k),I=k-N,R=Math.min(s-1,Math.ceil(k)),A=C+N*t.strides[2],T=E+N*t.strides[2],_=C+ +R*t.strides[2],D=E+R*t.strides[2],O=0;O<u;O++){var M=l[A+O],F=l[T+O],P=M+(l[_+O]-M)*I;c[f++]=P+(F+(l[D+O]-F)*I-P)*w}return tv(c,[i,e,n,u])},t.prototype.resizeBilinearBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*i*a*s),h=[n&&l>1?i-1:i,n&&c>1?a-1:a],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],d=h[0]/f[0],m=h[1]/f[1],v=this.readSync(t.dataId),g=0,y=0;y<o;y++)for(var b=y*e.strides[0],w=0;w<l;w++)for(var x=w*d,C=Math.floor(x),E=Math.min(Math.ceil(x),i-1),S=b+C*e.strides[1],k=b+E*e.strides[1],N=x-C,I=1-N,R=0;R<c;R++)for(var A=R*m,T=Math.floor(A),_=Math.min(Math.ceil(A),a-1),D=A-T,O=1-D,M=S+T*e.strides[2],F=S+_*e.strides[2],P=k+T*e.strides[2],L=k+_*e.strides[2],B=I*O,z=I*D,U=N*O,V=N*D,W=0;W<s;W++){var j=v[g++];p[M+W]+=j*B,p[F+W]+=j*z,p[P+W]+=j*U,p[L+W]+=j*V}return av(p,[o,a,i,s],e.dtype)},t.prototype.resizeNearestNeighbor=function(t,e,n,r){this.assertNotComplex(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],l=this.readSync(t.dataId),c=new Float32Array(i*e*n*u),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=p[0]/h[0],d=p[1]/h[1],m=0,v=0;v<i;v++)for(var g=v*t.strides[0],y=0;y<e;y++)for(var b=f*y,w=g+Math.min(a-1,r?Math.round(b):Math.floor(b))*t.strides[1],x=0;x<n;x++)for(var C=d*x,E=w+Math.min(s-1,r?Math.round(C):Math.floor(C))*t.strides[2],S=0;S<u;S++)c[m++]=l[E+S];return tv(c,[i,e,n,u],t.dtype)},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*i*a*s),h=this.readSync(t.dataId),f=[n&&l>1?i-1:i,n&&c>1?a-1:a],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=f[0]/d[0],v=f[1]/d[1],g=1/m,y=1/v,b=2*Math.ceil(g)+2,w=2*Math.ceil(y)+2,x=0;x<o;x++)for(var C=x*e.strides[0],E=0;E<i;E++)for(var S=C+E*e.strides[1],k=Math.floor(E*g),N=Math.floor(k-b/2),I=0;I<a;I++)for(var R=S+I*e.strides[2],A=Math.floor(I*y),T=Math.floor(A-w/2),_=0;_<s;_++){for(var D=0,O=0;O<b;O++){var M=O+N;if(!(M<0||M>=l)){var F=C+M*t.strides[1],P=M*m;if(E===Math.min(i-1,n?Math.round(P):Math.floor(P)))for(var L=0;L<w;L++){var B=L+T;if(!(B<0||B>=c)){var z=F+B*t.strides[2],U=B*v;I===Math.min(a-1,n?Math.round(U):Math.floor(U))&&(D+=h[z+_])}}}}p[R+_]=D}return av(p,e.shape,e.dtype)},t.prototype.batchNormalization=function(t,e,n,r,o,i){this.assertNotComplex([t,e,n,o,i],"batchNorm");for(var a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(n.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=i?this.readSync(i.dataId):new Float32Array([0]),p=new Float32Array(a.length),h=c.length,f=l.length,d=u.length,m=s.length,v=0,g=0,y=0,b=0,w=0;w<a.length;++w)p[w]=c[v++]+(a[w]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),v>=h&&(v=0),g>=m&&(g=0),y>=f&&(y=0),b>=d&&(b=0);return av(p,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){this.assertNotComplex(t,"localResponseNormalization4D");var i=t.shape[3],a=i-1,s=this.readSync(t.dataId),u=t.size,l=new Float32Array(u);function c(t){for(var n=t%i,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,a),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var p=0;p<u;p++){var h=c(p),f=s[p]*Math.pow(n+r*h,-o);l[p]=f}return av(l,t.shape)},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){this.assertNotComplex(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),l=this.readSync(e.dataId),c=this.readSync(n.dataId),p=new Float32Array(t.size),h=t.size,f=0;f<h;f++){for(var d=f%s,m=f-d+Math.max(0,d-r),v=f-d+Math.min(s,d+r+1),g=0,y=m;y<v;y++)g+=Math.pow(l[y],2);for(g=i*g+o,y=m;y<v;y++){var b=-2*i*a*l[y]*c[f]/g;f===y&&(b+=Math.pow(g,-a)),p[y]+=b*=u[f]}}return av(p,t.shape)},t.prototype.multinomial=function(t,e,n,r){this.assertNotComplex(t,"multinomial");for(var o=e?t:Ig(t),i=o.shape[0],a=o.shape[1],s=cv([i,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<i;++c){var p=c*a,h=new Float32Array(a-1);h[0]=l[p];for(var f=1;f<h.length;++f)h[f]=h[f-1]+l[p+f];for(var d=Tv(r.toString()),m=c*n,v=0;v<n;++v){var g=d();u[m+v]=h.length;for(var y=0;y<h.length;y++)if(g<h[y]){u[m+v]=y;break}}}return s},t.prototype.oneHot=function(t,e,n,r){this.assertNotComplex(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var i=this.readSync(t.dataId),a=0;a<t.size;++a)i[a]>=0&&i[a]<e&&(o[a*e+i[a]]=n);return ov(o,[t.size,e],"int32")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return this.assertNotComplex(t,"nonMaxSuppression"),Zg(this.readSync(t.dataId),this.readSync(e.dataId),n,r,o)},t.prototype.fft=function(t){return this.fftBatch(t,!1)},t.prototype.ifft=function(t){return this.fftBatch(t,!0)},t.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=Ov(t.shape,"float32"),i=Ov(t.shape,"float32"),a=Zm(t).as2D(n,r),s=Jm(t).as2D(n,r),u=0;u<n;u++)for(var l=a.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),p=Qm(l,c),h=this.readSync(this.fftImpl(p,e).dataId),f=0;f<r;f++){var d=Xg(h,f);o.values[u*r+f]=d.real,i.values[u*r+f]=d.imag}return Qm(o.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=Qm(Zm(o).div(nv(r)),Jm(o).div(nv(r)))),o}var i=this.readSync(t.dataId),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(i,r,e));return Qm(a.real,a.imag).as2D(t.shape[0],t.shape[1])},t.prototype.isExponentOf2=function(t){return 0==(t&t-1)},t.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),o=e/2,i=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),a=Qm(i.real,i.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=Qm(s.real,s.imag).as1D();a=this.fftRadix2(a,o,n),u=this.fftRadix2(u,o,n);var l=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var i=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}(e,n),c=Qm(l.real,l.imag).mul(u),p=a.add(c),h=a.sub(c),f=Zm(p).concat(Zm(h)),d=Jm(p).concat(Jm(h));return Qm(f,d).as1D()},t.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var i=0,a=0,s=0;s<e;s++){var u=Qg(o*s,e,n),l=Xg(t,s);i+=l.real*u.real-l.imag*u.imag,a+=l.real*u.imag+l.imag*u.real}n&&(i/=e,a/=e),Yg(r,i,a,o)}return r},t.prototype.depthToSpace=function(t,e,n){tf("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),tf(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var r=t.shape[0],o=t.shape[1],i=t.shape[2],a=t.shape[3],s=o*e,u=i*e,l=a/(e*e),c=this.readSync(t.dataId),p=new Float32Array(r*s*u*l),h=0,f=0;f<r;++f)for(var d=0;d<s;++d)for(var m=Math.floor(d/e),v=d%e,g=0;g<u;++g)for(var y=Math.floor(g/e),b=(v*e+g%e)*l,w=0;w<l;++w)p[h++]=c[w+b+a*(y+i*(m+o*f))];return av(p,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=Og(t.shape,e.shape),i=Ov(o,n),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=_g(t.shape,o),l=_g(e.shape,o),c=i.values;if(u.length+l.length===0)for(var p=0;p<c.length;++p)c[p]=r(a[p%a.length],s[p%s.length]);else{var h=this.bufferSync(t),f=this.bufferSync(e),d=function(n){var o=i.indexToLoc(n),p=o.slice(-t.rank);u.forEach(function(t){return p[t]=0});var d=h.locToIndex(p),m=o.slice(-e.rank);l.forEach(function(t){return m[t]=0});var v=f.locToIndex(m);c[n]=r(a[d],s[v])};for(p=0;p<c.length;++p)d(p)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=Og(t.shape,e.shape),o=Ov(r,"float32"),i=Ov(r,"float32"),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=_g(t.shape,r),l=_g(e.shape,r),c=o.values,p=i.values;if(u.length+l.length===0)for(var h=0;h<c.length;h++){var f=h%a.length,d=h%s.length,m=n(a[2*f],a[2*f+1],s[2*d],s[2*d+1]);c[h]=m.real,p[h]=m.imag}else{var v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var i=o.indexToLoc(r),h=i.slice(-t.rank);u.forEach(function(t){return h[t]=0});var f=v.locToIndex(h),d=i.slice(-e.rank);l.forEach(function(t){return d[t]=0});var m=g.locToIndex(d),y=n(a[2*f],a[2*f+1],s[2*m],s[2*m+1]);c[r]=y.real,p[r]=y.imag};for(h=0;h<c.length;h++)y(h)}return this.complex(o.toTensor(),i.toTensor())},t.prototype.split=function(t,e,n){return ty(t,e,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(t,e,n,r,o,i){for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],p=e.shape[0],h=r[0],f=r[1],d=Ov([p,h,f,c],t.dtype),m=this.readSync(e.dataId),v=this.readSync(n.dataId),g=this.readSync(t.dataId),y=t.strides,b=d.strides,w=0;w<p;w++){var x=4*w,C=m[x],E=m[x+1],S=m[x+2],k=m[x+3],N=v[w];if(!(N>=s))for(var I=h>1?(S-C)*(u-1)/(h-1):0,R=f>1?(k-E)*(l-1)/(f-1):0,A=0;A<h;A++){var T=h>1?C*(u-1)+A*I:.5*(C+S)*(u-1);if(T<0||T>u-1)for(var _=0;_<f;_++)for(var D=0;D<c;D++){var O=D+_*b[2]+A*b[1]+w*b[0];d.values[O]=i}else if("bilinear"===o){var M=Math.floor(T),F=Math.ceil(T),P=T-M;for(_=0;_<f;_++)if((G=f>1?E*(l-1)+_*R:.5*(E+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)d.values[O=D+_*b[2]+A*b[1]+w*b[0]]=i;else{var L=Math.floor(G),B=Math.ceil(G),z=G-L;for(D=0;D<c;D++){var U=g[O=D+L*y[2]+M*y[1]+N*y[0]],V=g[O=D+B*y[2]+M*y[1]+N*y[0]],W=g[O=D+L*y[2]+F*y[1]+N*y[0]],j=U+(V-U)*z,H=W+(g[O=D+B*y[2]+F*y[1]+N*y[0]]-W)*z;d.values[O=D+_*b[2]+A*b[1]+w*b[0]]=j+(H-j)*P}}}else for(_=0;_<f;++_){var G;if((G=f>1?E*(l-1)+_*R:.5*(E+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)d.values[O=D+_*b[2]+A*b[1]+w*b[0]]=i;else{var q=Math.round(G),K=Math.round(T);for(D=0;D<c;D++)d.values[D+_*b[2]+A*b[1]+w*b[0]]=g[D+q*y[2]+K*y[1]+N*y[0]]}}}}return d.toTensor()},t.prototype.sparseToDense=function(t,e,n,r){var o=dg(0,t,n);return this.scatter(t,e,n,o.outputSize,o.sliceSize,o.numUpdates,o.sliceRank,o.strides,r,!1)},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=pg(t,e),i=o[0],a=o[1],s=o[2],u=o[3];if(0===a)return tv([],i,t.dtype);for(var l=new Kf([a,s],t.dtype),c=this.readSync(e.dataId),p=this.readSync(t.dataId),h=0;h<a;h++){for(var f=[],d=0,m=0;m<r;m++){var v=c[h*r+m];d+=v*u[m],f.push(v)}if(d<0||d>=t.size/s)throw new Error("Invalid indices: "+f+" does not index into "+t.shape);for(var g=0;g<s;g++)l.values[h*s+g]=p[d*s+g]}return l.toTensor().reshape(i)},t.prototype.scatterND=function(t,e,n){var r=dg(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=nv(0);return this.scatter(t,e,n,u,a,i,o,s,l,!0)},t.prototype.fill=function(t,e,n){var r=vf(n=n||If(e),of(t));return r.fill(e),Qf.make(t,{values:r},n)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){var e=vf(t.dtype,of(t.shape));return Qf.make(t.shape,{values:e},t.dtype)},t.prototype.linspace=function(t,e,n){return qg(t,e,n)},t.prototype.scatter=function(t,e,n,r,o,i,a,s,u,l){var c=[r/o,o],p=this.readSync(t.dataId),h=this.readSync(e.dataId);if(0===r)return tv([],n,e.dtype);var f=new Kf(c,e.dtype);f.values.fill(this.readSync(u.dataId)[0]);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<a;g++){var y=p[d*a+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/o)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<o;b++)l?f.values[v*o+b]+=h[d*o+b]:f.values[v*o+b]=0===e.rank?h[0]:h[d*o+b]}return f.toTensor().reshape(n)},t}();vd.registerBackend("cpu",function(){return new WE},1);var jE=function(){function t(){this.textEncoder=new TextEncoder}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();Kh.get("IS_BROWSER")&&Kh.setPlatform("browser",new jE);var HE,GE=function(){function t(){this.util=n(3),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=Kh.global.fetch?Kh.global.fetch(t,e):(null==HE&&(HE=n(2)),HE(t,e))},t.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();Kh.get("IS_NODE")&&Kh.setPlatform("node",new GE);var qE={float32:4,int32:4,uint16:2,uint8:1,bool:1},KE=4;function $E(t,e){for(var n={},r=0,o=function(e){var o=e.name,i=e.dtype,a=e.shape,s=of(a),u=void 0;if("quantization"in e){var l=e.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=qE[l.dtype],p=t.slice(r,r+s*c),h="uint8"===l.dtype?new Uint8Array(p):new Uint16Array(p);if("float32"===i)u=Float32Array.from(h,function(t){return t*l.scale+l.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=Int32Array.from(h,function(t){return Math.round(t*l.scale+l.min)})}r+=s*c}else if("string"===i){var f=of(e.shape);u=[];for(var d=0;d<f;d++){var m=new Uint32Array(t.slice(r,r+KE))[0];r+=KE;var v=new Uint8Array(t.slice(r,r+m));u.push(v),r+=m}}else{var g=qE[i];if(p=t.slice(r,r+s*g),"float32"===i)u=new Float32Array(p);else if("int32"===i)u=new Int32Array(p);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=new Uint8Array(p)}r+=s*g}n[o]=tv(u,a,i)},i=0,a=e;i<a.length;i++)o(a[i]);return n}function XE(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),o=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength}),r.buffer}var YE="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function QE(t){return YE?Buffer.byteLength(t):new Blob([t]).size}function ZE(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function JE(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function tS(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:QE(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:QE(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var eS=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var o=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(t){var n=t(e,r);null!==n&&o.push(n)}),o},t}(),nS="://",rS=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){tf(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(nS)&&(e=e.slice(0,e.indexOf(nS))),tf(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();tf(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function oS(t){if(-1===t.indexOf(nS))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+rS.getSchemes().join(","));return{scheme:t.split(nS)[0],path:t.split(nS)[1]}}function iS(t,e,n){return void 0===n&&(n=!1),jh(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p;return Hh(this,function(h){switch(h.label){case 0:return tf(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),tf((r=eS.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),tf(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],tf((i=eS.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),tf(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=i[0],s=oS(t).scheme,u=oS(t).path,l=s===oS(t).scheme,[4,o.load()];case 1:return c=h.sent(),n&&l?[4,rS.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,a.save(c)];case 4:return p=h.sent(),!n||l?[3,6]:[4,rS.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var aS="models_store",sS="model_info_store";function uS(){if(!Kh.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function lS(t){var e=t.result;e.createObjectStore(aS,{keyPath:"modelPath"}),e.createObjectStore(sS,{keyPath:"modelPath"})}var cS=function(){function t(t){if(this.indexedDB=uS(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return jh(this,void 0,void 0,function(){return Hh(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return lS(o)},o.onsuccess=function(){var i=o.result;if(null==e){var a=i.transaction(aS,"readonly"),s=a.objectStore(aS).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return i.close(),r(s.error)},a.oncomplete=function(){return i.close()}}else{var u,l=tS(e),c=i.transaction(sS,"readwrite"),p=c.objectStore(sS),h=p.put({modelPath:n.modelPath,modelArtifactsInfo:l});h.onsuccess=function(){var o=(u=i.transaction(aS,"readwrite")).objectStore(aS).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:l});o.onsuccess=function(){return t({modelArtifactsInfo:l})},o.onerror=function(t){var e=(p=c.objectStore(sS)).delete(n.modelPath);e.onsuccess=function(){return i.close(),r(o.error)},e.onerror=function(t){return i.close(),r(o.error)}}},h.onerror=function(t){return i.close(),r(h.error)},c.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(t){return r(o.error)}})},t.URL_SCHEME="indexeddb://",t}(),pS=function(t){return Kh.getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(cS.URL_SCHEME)?(e=t.slice(cS.URL_SCHEME.length),new cS(e)):null;var e};eS.registerSaveRouter(pS),eS.registerLoadRouter(pS);var hS=function(){function t(){this.indexedDB=uS()}return t.prototype.listModels=function(){return jh(this,void 0,void 0,function(){var t=this;return Hh(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return lS(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(sS,"readonly"),i=o.objectStore(sS).getAll();i.onsuccess=function(){for(var t={},n=0,r=i.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},i.onerror=function(e){return t.close(),n(i.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return jh(this,void 0,void 0,function(){var e=this;return Hh(this,function(n){var r;return t=(r=t).startsWith(cS.URL_SCHEME)?r.slice(cS.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return lS(o)},o.onsuccess=function(){var e,i=o.result,a=i.transaction(sS,"readwrite"),s=a.objectStore(sS),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),a=function(){var o=(e=i.transaction(aS,"readwrite")).objectStore(aS).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=a,o.onerror=function(t){return a(),i.close(),r(u.error)}},u.onerror=function(t){return i.close(),r(u.error)},a.oncomplete=function(){null==e?i.close():e.oncomplete=function(){return i.close()}}},o.onerror=function(t){return r(o.error)}})]})})},t}();if(Kh.getBool("IS_BROWSER"))try{rS.registerManager(cS.URL_SCHEME,new hS)}catch(od){}var fS="/",dS="tensorflowjs_models",mS="info",vS="model_topology",gS="weight_specs",yS="weight_data",bS="model_metadata";function wS(t){return{info:[dS,t,mS].join(fS),topology:[dS,t,vS].join(fS),weightSpecs:[dS,t,gS].join(fS),weightData:[dS,t,yS].join(fS),modelMetadata:[dS,t,bS].join(fS)}}function xS(t){var e=t.split(fS);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(fS)}var CS=function(){function t(t){if(!Kh.getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=wS(this.modelPath)}return t.prototype.save=function(t){return jh(this,void 0,void 0,function(){var e,n,r;return Hh(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=tS(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(i=t.weightData,YE?Buffer.from(i).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(i))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy})),[2,{modelArtifactsInfo:r}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}var i;return[2]})})},t.prototype.load=function(){return jh(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return Hh(this,function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(o),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(YE){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),ES=function(t){return Kh.getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(CS.URL_SCHEME)?(e=t.slice(CS.URL_SCHEME.length),new CS(e)):null;var e};eS.registerSaveRouter(ES),eS.registerLoadRouter(ES);var SS=function(){function t(){tf(Kh.getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),tf(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return jh(this,void 0,void 0,function(){var t,e,n,r,o,i;return Hh(this,function(a){for(t={},e=dS+fS,n=fS+mS,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(e)&&o.endsWith(n)&&(i=xS(o),t[i]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},t.prototype.removeModel=function(t){return jh(this,void 0,void 0,function(){var e,n;return Hh(this,function(r){var o;if(t=(o=t).startsWith(CS.URL_SCHEME)?o.slice(CS.URL_SCHEME.length):o,e=wS(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(Kh.getBool("IS_BROWSER"))try{rS.registerManager(CS.URL_SCHEME,new SS)}catch(od){}var kS="model",NS=".json",IS=".weights.bin";function RS(t){return new Promise(function(t){return setTimeout(t)}).then(t)}var AS=function(){function t(e){if(!Kh.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=kS),this.modelTopologyFileName=e+NS,this.weightDataFileName=e+IS}return t.prototype.save=function(t){return jh(this,void 0,void 0,function(){var e,n,r,o;return Hh(this,function(i){switch(i.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,r.href=n,[4,RS(function(){return r.dispatchEvent(new MouseEvent("click"))})];case 2:return i.sent(),null==t.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=e,[4,RS(function(){return o.dispatchEvent(new MouseEvent("click"))})]);case 3:i.sent(),i.label=4;case 4:return[2,{modelArtifactsInfo:tS(t)}]}})})},t.URL_SCHEME="downloads://",t}(),TS=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return jh(this,void 0,void 0,function(){var t,e,n=this;return Hh(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var c=[],p=[],h=[];u.forEach(function(t){t.paths.forEach(function(t){p.push(t),h.push(null)}),c.push.apply(c,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=p.indexOf(t);h[o]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:ZE(h)})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(l[t])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return JE(t.name)}),o={},i=0,a=t;i<a.length;i++)a[i].paths.forEach(function(t){var i=JE(t);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[t]=e[r.indexOf(i)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function _S(t,e,n,r){!function(t){tf(null!=t&&Array.isArray(t)&&t.length>0,function(){return"promises must be a none empty array"})}(t),function(t,e){tf(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t}),tf(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),tf(e>=t,function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map(function(i){return i.then(function(i){var a=n+ ++o/t.length*(r-n);return e(a),i}),i}))}function DS(t,e){return jh(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return Hh(this,function(p){switch(p.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?Lf:e.fetchFunc,r=t.map(function(t){return n(t,e.requestInit)}),o=0,i=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=p.sent(),[3,4];case 2:return[4,_S(r,e.onProgress,o,i)];case 3:a=p.sent(),p.label=4;case 4:return s=a.map(function(t){return t.arrayBuffer()}),u=.5,l=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=p.sent(),[3,8];case 6:return[4,_S(s,e.onProgress,u,l)];case 7:c=p.sent(),p.label=8;case 8:return[2,c]}})})}function OS(t){var e=this;return function(n,r,o){return void 0===r&&(r=""),jh(e,void 0,void 0,function(){var e,i,a,s,u,l,c,p,h,f;return Hh(this,function(d){switch(d.label){case 0:if(e=n.map(function(){return!1}),i={},a=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(t,n){var r=0;t.weights.forEach(function(t){var u=qE["quantization"in t?t.quantization.dtype:t.dtype]*of(t.shape),l=function(){e[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:t,groupOffset:r,sizeBytes:u})};null!=o?o.forEach(function(e,n){e===t.name&&(l(),a[n]=!0)}):l(),s.push(t.name),r+=u})}),!a.every(function(t){return t}))throw u=o.filter(function(t,e){return!a[e]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=e.reduce(function(t,e,n){return e&&t.push(n),t},[]),c=[],l.forEach(function(t){n[t].paths.forEach(function(t){var e=r+(r.endsWith("/")?"":"/")+t;c.push(e)})}),[4,t(c)];case 1:return p=d.sent(),h={},f=0,l.forEach(function(t){for(var e=n[t].paths.length,r=0,o=0;o<e;o++)r+=p[f+o].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,l=0;l<e;l++){var c=new Uint8Array(p[f+l]);s.set(c,u),u+=c.byteLength}i[t].forEach(function(t){var e=$E(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)h[n]=e[n]}),f+=e}),[2,h]}})})}}eS.registerSaveRouter(function(t){return Kh.getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(AS.URL_SCHEME)?(void 0===(e=t.slice(AS.URL_SCHEME.length))&&(e="model"),new AS(e)):null;var e});var MS=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(tf("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=Lf,tf(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&tf(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return jh(this,void 0,void 0,function(){var e,n;return Hh(this,function(r){switch(r.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((n=r.sent()).ok)return[2,{modelArtifactsInfo:tS(t),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}})})},t.prototype.load=function(){return jh(this,void 0,void 0,function(){var t,e,n,r,o,i,a,s;return Hh(this,function(u){switch(u.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,t.json()];case 3:return e=u.sent(),[3,5];case 4:throw u.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(o=e.weightsManifest,null==(r=e.modelTopology)&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:s=u.sent(),i=s[0],a=s[1],u.label=7;case 7:return[2,{modelTopology:r,weightSpecs:i,weightData:a}]}})})},t.prototype.loadWeights=function(t){return jh(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,l,c;return Hh(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],o=n[1],i=this.weightPathPrefix||r,a=[],s=0,u=t;s<u.length;s++)a.push.apply(a,u[s].weights);return l=[],t.forEach(function(t){t.paths.forEach(function(t){l.push(i+t+o)})}),[4,DS(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return c=p.sent(),[2,[a,ZE(c)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function FS(t){return null!=t.match(MS.URL_SCHEME_REGEX)}var PS=function(t,e){return(Array.isArray(t)?t.every(function(t){return FS(t)}):FS(t))?LS(t,{onProgress:e}):null};function LS(t,e){return new MS(t,e)}eS.registerSaveRouter(PS),eS.registerLoadRouter(PS);var BS=function(){function t(t,e,n,r){this.modelTopology=t,this.weightSpecs=e,this.weightData=n,this.trainingConfig=r}return t.prototype.load=function(){return jh(this,void 0,void 0,function(){var t;return Hh(this,function(e){return t={},null!=this.modelTopology&&(t=Wh({modelTopology:this.modelTopology},t)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(t=Wh({weightSpecs:this.weightSpecs},t)),null!=this.weightData&&this.weightData.byteLength>0&&(t=Wh({weightData:this.weightData},t)),null!=this.trainingConfig&&(t=Wh({trainingConfig:this.trainingConfig},t)),[2,t]})})},t}(),zS=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(e){return[2,this.saveHandler(t)]})})},t}(),US=Object.freeze({browserFiles:function(t){return new TS(t)},browserHTTPRequest:function(t,e){return LS(t,e)},concatenateArrayBuffers:ZE,decodeWeights:$E,encodeWeights:function(t,e){return jh(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return Hh(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t),i=function(i){var a=o[i],u=Array.isArray(t)?t[i].tensor:t[a];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+a+"': "+u.dtype);var l={name:a,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(t){return jh(s,void 0,void 0,function(){var e,n,r,o,i,a,s;return Hh(this,function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(e=l.sent(),n=e.reduce(function(t,e){return t+e.length},0)+KE*e.length,r=new Uint8Array(n),o=0,i=0;i<e.length;i++)a=e[i],s=new Uint8Array(new Uint32Array([a.length]).buffer),r.set(s,o),r.set(a,o+=KE),o+=a.length;return t(r),[2]}})})});r.push(c)}else r.push(u.data());null!=e&&(l.group=e),n.push(l)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:XE(u.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return new BS(t,e,n,r)},getLoadHandlers:function(t,e){return eS.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:tS,getSaveHandlers:function(t){return eS.getSaveHandlers(t)},http:LS,isHTTPScheme:FS,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),jh(this,void 0,void 0,function(){return Hh(this,function(o){return[2,OS(function(t){return DS(t,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return eS.registerLoadRouter(t)},registerSaveRouter:function(t){return eS.registerSaveRouter(t)},weightsLoaderFactory:OS,withSaveHandler:function(t){return new zS(t)},copyModel:function(t,e){return jh(this,void 0,void 0,function(){return Hh(this,function(n){return[2,iS(t,e,!1)]})})},listModels:function(){return jh(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return Hh(this,function(s){switch(s.label){case 0:t=rS.getSchemes(),e={},n=0,r=t,s.label=1;case 1:return n<r.length?[4,rS.getManager(o=r[n]).listModels()]:[3,4];case 2:for(a in i=s.sent())e[o+nS+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return jh(this,void 0,void 0,function(){return Hh(this,function(n){return[2,iS(t,e,!0)]})})},removeModel:function(t){return jh(this,void 0,void 0,function(){var e;return Hh(this,function(n){return e=oS(t),[2,rS.getManager(e.scheme).removeModel(e.path)]})})}}),VS=Ym({confusionMatrix_:function(t,e,n){var r=Bm(t,"labels","confusionMatrix"),o=Bm(e,"predictions","confusionMatrix");tf(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),tf(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),tf(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),tf(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),tf(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=jv(r.asType("int32"),n),a=jv(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}}),WS=Object.freeze({confusionMatrix:VS}),jS=Ym({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return vd.fromPixels(t,e)}}),HS=Object.freeze({toPixels:function(t,e){return jh(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,p,h,f,d,m,v,g,y,b,w,x,C;return Hh(this,function(E){switch(E.label){case 0:if(n=Bm(t,"img","toPixels"),t instanceof Qf||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=E.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=E.sent(),p=c[0][0],h=c[1][0],u.dispose(),l.dispose(),"float32"===n.dtype){if(p<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+h+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||h>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+h+"].")}for(f="float32"===n.dtype?255:1,d=new Uint8ClampedArray(i*o*4),m=0;m<o*i;++m)v=void 0,g=void 0,y=void 0,b=void 0,1===a?(v=s[m]*f,g=s[m]*f,y=s[m]*f,b=255):3===a?(v=s[3*m]*f,g=s[3*m+1]*f,y=s[3*m+2]*f,b=255):4===a&&(v=s[4*m]*f,g=s[4*m+1]*f,y=s[4*m+2]*f,b=s[4*m+3]*f),d[0+(w=4*m)]=Math.round(v),d[w+1]=Math.round(g),d[w+2]=Math.round(y),d[w+3]=Math.round(b);return null!=e&&(e.width=i,e.height=o,x=e.getContext("2d"),C=new ImageData(d,i,o),x.putImageData(C,0,0)),n!==t&&n.dispose(),[2,d]}})})},fromPixels:jS}),GS=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),qS=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function KS(t){tf(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),tf("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),tf(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),qS.register(t)}var $S=Object.freeze({Serializable:GS,SerializationMap:qS,registerClass:KS}),XS=.001,YS=.1;function QS(){return 32===vd.backend.floatPrecision()?XS:YS}function ZS(t,e,n){var r=!0;if((xf(t)||xf(e))&&(r=!1),xf(t)&&xf(e)&&(r=!0),r){var o=t.constructor.name,i=e.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(e)){var a=Pm(t),s=Pm(e);if(!af(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=xf(t)?t:rf(t),l=xf(e)?e:rf(e);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var p=u[c],h=l[c];if(!n(p,h))throw new Error("Arrays differ: actual["+c+"] = "+p+", expected["+c+"] = "+h+".\nActual:   "+u+".\nExpected: "+l+".")}}function JS(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var tk=Object.freeze({TEST_EPSILON_FLOAT16:YS,expectArraysClose:function(t,e,n){return null==n&&(n=QS()),ZS(t,e,function(t,e){return JS(t,e,n)})},testEpsilon:QS,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return Sf(t)||Sf(t[0])||Sf(e)||Sf(e[0])?ZS(t,n,function(t,e){return t==e}):ZS(t,e,function(t,e){return JS(t,e,0)})},expectNumbersClose:function(t,e,n){if(null==n&&(n=QS()),!JS(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error("Value out of range:"+t[r]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),ek="1.2.5",nk=Object.freeze({gpgpu_util:Rb,webgl_util:dm,MathBackendWebGL:ww,setWebGLContext:wd,GPGPUContext:Ab}),rk=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vh(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,i=r.grads;if(null!=n){var a=n.map(function(t){return{name:t.name,tensor:i[t.name]}});this.applyGradients(a)}else this.applyGradients(i);return Em(i),e?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return Sg(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&Em(this.iterations_)},e.prototype.saveIterations=function(){return jh(this,void 0,void 0,function(){return Hh(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:nv(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){return Hh(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return jh(this,void 0,void 0,function(){var e;return Hh(this,function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}})})},e}(GS);Object.defineProperty(rk,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var ok=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=vd.backend.epsilon()),o}return Vh(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=vd.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Cm(function(){return mv(o).variable(!1)})}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Cm(function(){return mv(o).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable,s=e.accumulatedUpdates[r].variable;Cm(function(){var t=a.mul(e.rho).add(i.square().mul(1-e.rho)),n=s.add(e.epsilon).sqrt().div(a.add(e.epsilon).sqrt()).mul(i),r=s.mul(e.rho).add(n.square().mul(1-e.rho));a.assign(t),s.assign(r);var u=n.mul(-e.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Em(this.accumulatedGrads.map(function(t){return t.variable})),Em(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){var t;return Hh(this,function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){var e;return Hh(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.slice(0,e=t.length/2).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="AdadeltaOptimizer",e}(rk);KS(ok);var ik=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return Vh(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=vd.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Cm(function(){return pv(o.shape,e.initialAccumulatorValue).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable;Cm(function(){var t=a.add(i.square());a.assign(t);var n=i.div(t.add(vd.backend.epsilon()).sqrt()).mul(-e.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Em(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){return Hh(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(rk);KS(ik);var ak=function(t){function e(e,n,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Cm(function(){i.accBeta1=nv(n).variable(),i.accBeta2=nv(r).variable()}),null==o&&(i.epsilon=vd.backend.epsilon()),i}return Vh(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);Cm(function(){var r=OC(1,e.accBeta1),o=OC(1,e.accBeta2);n.forEach(function(n,i){var a=vd.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Cm(function(){return mv(a).variable(!1)})}),null==e.accumulatedSecondMoment[i]&&(e.accumulatedSecondMoment[i]={originalName:n+"/v",variable:Cm(function(){return mv(a).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,l=e.accumulatedSecondMoment[i].variable,c=u.mul(e.beta1).add(s.mul(1-e.beta1)),p=l.mul(e.beta2).add(s.square().mul(1-e.beta2)),h=c.div(r),f=p.div(o);u.assign(c),l.assign(p);var d=h.div(f.sqrt().add(e.epsilon)).mul(-e.learningRate).add(a);a.assign(d)}}),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Em(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&Em(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){var t;return Hh(this,function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){var e,n=this;return Hh(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),Cm(function(){n.accBeta1.assign(AC(n.beta1,n.iterations_+1)),n.accBeta2.assign(AC(n.beta2,n.iterations_+1))}),this.accumulatedFirstMoment=t.slice(0,e=t.length/2).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(rk);KS(ak);var sk=function(t){function e(e,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Cm(function(){a.iteration=nv(0).variable(),a.accBeta1=nv(n).variable()}),null==o&&(a.epsilon=vd.backend.epsilon()),a}return Vh(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);Cm(function(){var r=OC(1,e.accBeta1),o=yC(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach(function(n,i){var a=vd.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:mv(a).variable(!1)}),null==e.accumulatedWeightedInfNorm[i]&&(e.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:mv(a).variable(!1)});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,l=e.accumulatedWeightedInfNorm[i].variable,c=u.mul(e.beta1).add(s.mul(1-e.beta1)),p=l.mul(e.beta2),h=s.abs(),f=p.maximum(h);u.assign(c),l.assign(f);var d=o.div(r).mul(c.div(f.add(e.epsilon))).add(a);a.assign(d)}}),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Em(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&Em(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){return Hh(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(rk);KS(sk);var uk=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return Vh(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var i=vd.registeredVariables[n];Cm(function(){var t=e.c.mul(o).add(i);i.assign(t)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=Sm(nv(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){return Hh(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(rk);KS(uk);var lk=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=nv(o.momentum),o}return Vh(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=vd.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:Cm(function(){return mv(o).variable(!1)})});var i=e.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[n];null!=a&&Cm(function(){var t,n=e.m.mul(i).add(a);t=e.useNesterov?e.c.mul(a.add(n.mul(e.m))).add(o):e.c.mul(n).add(o),i.assign(n),o.assign(t)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Em(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){return Hh(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){return Hh(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="MomentumOptimizer",e}(uk);KS(lk);var ck=function(t){function e(e,n,r,o,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1);var a=t.call(this)||this;return a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=i,null==o&&(a.epsilon=vd.backend.epsilon()),a}return Vh(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=vd.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Cm(function(){return mv(o).variable(!1)})}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:Cm(function(){return mv(o).variable(!1)})}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Cm(function(){return mv(o).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedMeanSquares[r].variable,s=e.accumulatedMoments[r].variable;Cm(function(){var t=a.mul(e.decay).add(i.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,u=n.mul(e.decay).add(i.mul(1-e.decay)),l=s.mul(e.momentum).add(i.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));a.assign(t),n.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var p=a.mul(e.decay).add(i.square().mul(1-e.decay));l=s.mul(e.momentum).add(i.mul(e.learningRate).div(p.add(e.epsilon).sqrt())),a.assign(p),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Em(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Em(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&Em(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return jh(this,void 0,void 0,function(){var t;return Hh(this,function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return jh(this,void 0,void 0,function(){var e;return Hh(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedMeanSquares=t.slice(0,e=this.centered?t.length/3:t.length/2).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(rk);KS(ck);var pk=function(){function t(){}return t.sgd=function(t){return new uk(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new lk(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new ck(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new ak(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new ok(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new sk(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new ik(t,e)},t}(),hk={sgd:pk.sgd,momentum:pk.momentum,adadelta:pk.adadelta,adagrad:pk.adagrad,rmsprop:pk.rmsprop,adamax:pk.adamax,adam:pk.adam},fk="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(t){return t()};function dk(){return new Promise(function(t){return fk(function(){return t()})})}Xf=VE;var mk=function(t,e){return(mk=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function vk(t,e){function n(){this.constructor=t}mk(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function gk(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function yk(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var bk=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e=wk(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach(function(e){var n=e.split(":"),r=n[0];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,n[1])})}},t}();function wk(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")}),e}var xk=null;function Ck(t){xk=t}function Ek(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function Sk(t,e,n){return Math.max(t,Math.min(e,n))}function kk(t){return t%2==0?t:t+1}function Nk(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function Ik(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Rk(t,e,n){void 0===n&&(n=""),Ik(Dk(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function Ak(t){Ik(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function Tk(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||Kk(t)&&!n)for(var r=0;r<t.length;++r)Tk(t[r],e,n);else e.push(t);return e}function _k(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function Dk(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ok(t){return t%1==0}function Mk(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function Fk(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Pk(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Lk(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{var s=e(++i);null!=n&&i>=n?o():setTimeout(a,s)}};a()})}function Bk(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var i=t.slice();return i[r]=e/n,i}function zk(t,e){var n=e.length;return Ik((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),Ik(t.every(function(t){return Ok(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?n+t:t})}function Uk(t,e){for(var n=[],r=[],o=null==e?null:zk(e,t).sort(),i=0,a=0;a<t.length;++a){if(null!=o){if(o[i]===a&&1!==t[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+t[a]+"' is not 1");(null==o[i]||o[i]>a)&&1===t[a]&&(n.push(t[a]),r.push(a)),o[i]<=a&&i++}1!==t[a]&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function Vk(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function Wk(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function jk(t,e,n){if("float32"===e)for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))throw Error("The result of the '"+n+"' is "+o+".")}}function Hk(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function Gk(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function qk(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function Kk(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function $k(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function Xk(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=t.length}),e}function Yk(t){return"string"==typeof t||t instanceof String}function Qk(t){return"boolean"==typeof t}function Zk(t){return"number"==typeof t}function Jk(t){return Array.isArray(t)?Jk(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":Zk(t)?"float32":Yk(t)?"string":Qk(t)?"bool":"float32"}function tN(t){return!!(t&&t.constructor&&t.call&&t.apply)}function eN(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function nN(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function rN(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Tk(t)),n&&Hk(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function oN(t,e){if(0===t.length)return e[0];var n=t.reduce(function(t,e){return t*e});if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var i=n[0],a=0;a<i;a++)o[a]=r[e+a];else{i=n[0];var s=n.slice(1),u=s.reduce(function(t,e){return t*e});for(a=0;a<i;a++)o[a]=t(e+a*u,s,r)}return o}(0,t,e)}function iN(t,e){for(var n=aN(t,e),r=0;r<n.length;r++)n[r]=1;return n}function aN(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function sN(){return xk.platform.now()}function uN(t){t.forEach(function(e){Ik(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function lN(t,e){return void 0===e&&(e="utf-8"),xk.platform.encode(t,e=e||"utf-8")}function cN(t,e){return void 0===e&&(e="utf-8"),xk.platform.decode(t,e=e||"utf-8")}Object.freeze({Environment:bk,getQueryParams:wk,get ENV(){return xk},setEnvironmentGlobal:Ck});var pN=Object.freeze({shuffle:Ek,clamp:Sk,nearestLargerEven:kk,sum:Nk,randUniform:function(t,e){var n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:Ik,assertShapesMatch:Rk,assertNonNull:Ak,flatten:Tk,sizeFromShape:_k,isScalarShape:function(t){return 0===t.length},arraysEqual:Dk,isInt:Ok,tanh:Mk,sizeToSquarishShape:Fk,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return Ek(e),e},rightPad:Pk,repeatedTry:Lk,inferFromImplicitShape:Bk,parseAxisParam:zk,squeezeShape:Uk,getTypedArrayFromDType:Vk,getArrayFromDType:Wk,checkComputationForErrors:jk,checkConversionForErrors:Hk,isValidDtype:Gk,hasEncodingLoss:qk,isTypedArray:Kk,bytesPerElement:$k,bytesFromStringArray:Xk,isString:Yk,isBoolean:Qk,isNumber:Zk,inferDtype:Jk,isFunction:tN,nearestDivisor:eN,computeStrides:nN,toTypedArray:rN,toNestedArray:oN,makeOnesTypedArray:iN,makeZerosTypedArray:aN,now:sN,assertNonNegativeIntegerDimensions:uN,fetch:function(t,e){return xk.platform.fetch(t,e)},encodeString:lN,decodeString:cN}),hN=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new fN)}return t.prototype.profileKernel=function(t,e,n){var r,o=this,i=this.backendTimer.time(function(){r=n()});return(Array.isArray(r)?r:[r]).forEach(function(n){var r=n.dataSync();jk(r,n.dtype,t),i.then(function(i){var a="";null!=i.getExtraProfileInfo&&(a=i.getExtraProfileInfo()),o.logger.logKernelProfile(t,n,r,i.kernelMs,e,a)})}),r},t}(),fN=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o,i){var a=Pk(r+"ms",9),s=Pk(t,25),u=e.rank,l=e.size,c=Pk(e.shape.toString(),14),p="";for(var h in o){var f=o[h].shape,d=f.length;p+=h+": "+d+"D "+(d>0?f:"")+" "}console.log("%c"+s+"\t%c"+a+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+p+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),dN=7;function mN(t,e,n){return Pk(Array.isArray(t)?parseFloat(t[0].toFixed(dN))+" + "+parseFloat(t[1].toFixed(dN))+"j":Yk(t)?"'"+t+"'":"bool"===n?vN(t):parseFloat(t.toFixed(dN)).toString(),e)}function vN(t){return 0===t?"false":"true"}function gN(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var yN=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=_k(t),null!=n){var o=n.length;Ik(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Wk(e,this.size),this.strides=nN(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Ik(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,o=t;r<o.length;r++){var i=o[r];if(i<0||i>=this.shape[n])throw new Error("Requested out of range element at "+t+".   Buffer shape="+this.shape);n++}for(var a=t[t.length-1],s=0;s<t.length-1;++s)a+=this.strides[s]*t[s];return this.values[a]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return CN.make(this.shape,{values:this.values},this.dtype)},t}(),bN=null,wN=null,xN=null,CN=function(){function t(t,e,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=_k(t),this.strides=nN(t),this.dataId=null!=r?r:{},this.id=bN().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",bN().registerTensor(this,o),null!=n&&bN().write(o,this.dataId,n)}return t.make=function(e,n,r,o){var i=n.values;return null!=n.values&&"string"===r&&Yk(n.values[0])&&(i=n.values.map(function(t){return lN(t)})),new t(e,r,i,n.dataId,o)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),Ik(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),wN.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return gk(this,void 0,void 0,function(){var t;return yk(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,wN.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return wN.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return gk(this,void 0,void 0,function(){var t;return yk(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,oN(this.shape,t)]}})})},t.prototype.arraySync=function(){return oN(this.shape,this.dataSync())},t.prototype.data=function(){return gk(this,void 0,void 0,function(){var t,e;return yk(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=bN().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map(function(t){return cN(t)})]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var t=bN().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(t){return cN(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return gk(this,void 0,void 0,function(){var t;return yk(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,bN().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(bN().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),wN.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),wN.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),wN.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),wN.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),wN.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),wN.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),wN.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=nN(e),i=function(t,e,n,r){var o=_k(e),i=r[r.length-1],a=new Array(i).fill(0),s=e.length,u="complex64"===n?gN(t):t;if(s>1)for(var l=0;l<o/i;l++)for(var c=l*i,p=0;p<i;p++)a[p]=Math.max(a[p],mN(u[c+p],0,n).length);return a}(t,e,n,o),a=e.length,s=function t(e,n,r,o,i,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[mN(gN(e)[0],0,r)]:"bool"===r?[vN(e[0])]:[e[0].toString()];if(1===l){if(u>20){var c=Array.from(e.slice(0,3*s)),p=Array.from(e.slice(u-3*s,u));return"complex64"===r&&(c=gN(c),p=gN(p)),["["+c.map(function(t,e){return mN(t,i[e],r)}).join(", ")+", ..., "+p.map(function(t,e){return mN(t,i[u-3+e],r)}).join(", ")+"]"]}return["["+("complex64"===r?gN(e):Array.from(e)).map(function(t,e){return mN(t,i[e],r)}).join(", ")+"]"]}var h=n.slice(1),f=o.slice(1),d=o[0]*s,m=[];if(u>20){for(var v=0;v<3;v++)m.push.apply(m,t(e.slice(g=v*d,g+d),h,r,f,i,!1));for(m.push("..."),v=u-3;v<u;v++)m.push.apply(m,t(e.slice(g=v*d,g+d),h,r,f,i,v===u-1))}else for(v=0;v<u;v++){var g;m.push.apply(m,t(e.slice(g=v*d,g+d),h,r,f,i,v===u-1))}var y=2===l?",":"";for(m[0]="["+m[0]+y,v=1;v<m.length-1;v++)m[v]=" "+m[v]+y;var b=",\n";for(v=2;v<l;v++)b+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":b),m}(t,e,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),wN.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),wN.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),wN.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),wN.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),wN.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),wN.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),wN.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),wN.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),wN.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),wN.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),wN.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),wN.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),xN("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.batchNorm=function(t,e,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),wN.batchNorm(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wN.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),wN.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),wN.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),wN.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),wN.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),wN.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),wN.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),wN.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),wN.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),wN.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),wN.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),wN.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),wN.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),wN.div(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),wN.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),wN.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),wN.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),wN.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),wN.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),wN.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),wN.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),wN.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),wN.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),wN.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),wN.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),wN.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),wN.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),wN.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),wN.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),wN.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),wN.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),wN.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),wN.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),wN.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),wN.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),wN.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),wN.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),wN.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),wN.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),wN.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),wN.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),wN.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),wN.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),wN.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),wN.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),wN.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),wN.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),wN.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),wN.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),wN.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),wN.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),wN.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),wN.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),wN.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),wN.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),wN.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),wN.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),wN.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),wN.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),wN.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),wN.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),wN.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),wN.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),wN.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),wN.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),wN.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),wN.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),wN.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),wN.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),wN.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),wN.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),wN.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),wN.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),wN.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),wN.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),wN.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),wN.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),wN.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),wN.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),wN.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),wN.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),wN.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),wN.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),wN.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),wN.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),wN.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),wN.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),wN.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),wN.conv1d(this,t,e,n,r,o,i)},t.prototype.conv2d=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),wN.conv2d(this,t,e,n,r,o,i)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),wN.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),wN.depthwiseConv2d(this,t,e,n,r,o,i)},t.prototype.separableConv2d=function(t,e,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),wN.separableConv2d(this,t,e,n,r,o,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),wN.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),wN.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),wN.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),wN.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),EN.variable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),wN.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),wN.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),wN.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),wN.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),wN.stridedSlice(this,t,e,n,r,o,i,a,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),wN.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),wN.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),wN.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),wN.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),wN.spectral.irfft(this)},t}();Object.defineProperty(CN,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var EN=function(t){function e(e,n,r){void 0===n&&(n=!0);var o=t.call(this,e.shape,e.dtype,null,e.dataId)||this;o.trainable=n,o.name=r,null==o.name&&(o.name=bN().nextVariableId().toString());try{bN().registerVariable(o)}catch(t){throw bN().disposeTensor(o),t}return o}return vk(e,t),e.variable=function(t,n,r,o){return void 0===n&&(n=!0),null!=o&&o!==t.dtype&&(t=t.asType(o)),new e(t,n,r)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Dk(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");bN().disposeTensor(this),this.dataId=t.dataId,bN().registerTensor(this)},e.prototype.dispose=function(){bN().disposeVariable(this),this.isDisposedInternal=!0},e}(CN);Object.defineProperty(EN,Symbol.hasInstance,{value:function(t){return t instanceof CN&&null!=t.assign&&t.assign instanceof Function}});var SN,kN,NN,IN,RN,AN=EN.variable;!function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(SN||(SN={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(kN||(kN={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(NN||(NN={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(IN||(IN={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(RN||(RN={}));var TN={float32:IN,int32:kN,bool:NN,complex64:RN};function _N(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return TN[t][e]}function DN(t){return _N(t,"int32")}function ON(t,e){if(t.dtype===e.dtype)return[t,e];var n=_N(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function MN(t,e){Ik(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function FN(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof CN)n.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,i=e;for(var a in i){var s=i[a];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}var PN,LN=Object.freeze({makeTypesMatch:ON,assertTypesMatch:MN,isTensorInList:function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1},getTensorsInContainer:FN}),BN=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),zN=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new BN}return t.prototype.ready=function(){return gk(this,void 0,void 0,function(){var t,e,n;return yk(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?[4,this.initializeBackend(n=t[e]).success]:[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return gk(this,void 0,void 0,function(){var e,n,r;return yk(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.profiler=new hN(this.backendInstance),[2,!0]}})})},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,i=r.then(function(n){return!(o<e.pendingBackendInitId||(e.registry[t]=n,e.pendingBackendInit=null,0))}).catch(function(n){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),1))});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),o=r.asyncInit;if(o||r.success)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){this.write(t,e,this.readSync(e))},t.prototype.tidy=function(t,e){var n,r=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=CN.make(t.shape,{dataId:t.dataId},t.dtype);return this.addTapeNode([t],e,function(t){return[t.toFloat()]}),e},t.prototype.runKernel=function(t,e,n){var r,o=this,i=[],a=this.isTapeOn(),s=null!=this.state.activeScope?this.state.activeScope.name:"",u=function(t){a&&(i=t.map(function(t){return o.keep(o.clone(t))}))},l=this.state.numBytes,c=this.state.numTensors;if(this.scopedRun(function(){return o.state.kernelDepth++},function(){return o.state.kernelDepth--},function(){r=o.ENV.getBool("DEBUG")?o.profiler.profileKernel(s,e,function(){return t(o.backend,u)}):t(o.backend,u)}),a){var p={id:this.state.nextTapeNodeId++,name:s,inputs:e,outputs:Array.isArray(r)?r:[r],saved:i};null!=n&&(p.gradient=function(t){return n(t,i)}),this.state.activeTape.push(p)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-l,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-c,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShape:Array.isArray(r)?r.map(function(t){return t.shape}):r.shape}),r},t.prototype.registerTensor=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*$k(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:null!=e?e:this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r,null!=e?e.register(t.dataId,t.shape,t.dtype):this.backend.register(t.dataId,t.shape,t.dtype)}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof EN||this.track(t)},t.prototype.registerVariable=function(t){if(null!=this.state.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.state.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[t])},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return gk(this,void 0,void 0,function(){var e,n;return yk(this,function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n){var r={};t.forEach(function(t,e){r[e]=t});var o={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:r,outputs:[e],gradient:function(t){var e=n(t),r={};return e.forEach(function(t,e){r[e]=function(){return t}}),r}};this.state.activeTape.push(o)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=FN(t),r=new Set(n.map(function(t){return t.id})),o=0;o<this.state.activeScope.track.length;o++){var i=this.state.activeScope.track[o];i.kept||r.has(i.id)||i.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(t){t.kept||t.scopeId!==a.id||e.track(t)})},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),Ik(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",t)});Ik(i instanceof CN,function(){return"The result y returned by f() must be a tensor."});var a=function(t,e,n){for(var r={},o={},i=0;i<e.length;i++)r[e[i].id]=!0;for(i=0;i<t.length;i++){var a=(d=t[i]).inputs;for(var s in a){for(var u=a[s],l=!1,c=0;c<e.length;c++)if(r[u.id]){d.outputs.forEach(function(t){return r[t.id]=!0}),l=!0,o[d.id]=!0;break}if(l)break}}var p={};p[n.id]=!0;var h={};for(i=t.length-1;i>=0;i--)for(a=(d=t[i]).inputs,c=0;c<d.outputs.length;c++)if(p[d.outputs[c].id]){for(var s in a)p[a[s].id]=!0,h[d.id]=!0;break}var f=[];for(i=0;i<t.length;i++){var d;if(o[(d=t[i]).id]&&h[d.id]){var m={};for(var s in d.inputs){var v=d.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},d);g.inputs=m,g.outputs=d.outputs,f.push(g)}}return f}(this.state.activeTape,e,i);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var t,r,s={};s[i.id]=null==n?(r=iN(_k(t=i.shape),"float32"),CN.make(t,{values:r})):n,function(t,e,n){for(var r=function(r){var o=e[r],i=[];if(o.outputs.forEach(function(e){var n=t[e.id];if(null!=n)i.push(n);else{var r=CN.make(e.shape,{values:aN(e.size,e.dtype)},e.dtype);i.push(r)}}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.name+".");var a=o.gradient(1===o.outputs.length?i[0]:i),s=function(e){if(!(e in a))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(a)+".");var r=n(function(){return a[e]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.name+". The gradient of input "+e+" must have 'float32' dtype, but has '"+r.dtype+"'");var i=o.inputs[e];if(!Dk(r.shape,i.shape))throw new Error("Error in gradient for op "+o.name+". The gradient of input '"+e+"' has shape '"+r.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==t[i.id])t[i.id]=r;else{var s=t[i.id];t[i.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=e.length-1;o>=0;o--)r(o)}(s,a,function(t){return o.tidy(t)});var u=e.map(function(t){return s[t.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(t){for(var e in t.saved)t.saved[e].dispose()}),o.state.activeTape=null),{value:i,grads:u}})},t.prototype.customGrad=function(t){var e=this;return Ik(tN(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Ik(r.every(function(t){return t instanceof CN}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return r.forEach(function(t,e){i[e]=t}),e.runKernel(function(e,o){return Ik((n=t.apply(void 0,r.concat([o]))).value instanceof CN,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Ik(tN(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},i,function(t,e){var o=n.gradFunc(t,e),i=Array.isArray(o)?o:[o];Ik(i.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Ik(i.every(function(t){return t instanceof CN}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return i.forEach(function(t,e){a[e]=function(){return t}}),a})}},t.prototype.write=function(t,e,n){var r=this.state.tensorInfo.get(e),o=r.backend;if(t=t||this.backend,"string"===r.dtype){var i=Xk(n);this.state.numBytes+=i-r.bytes,r.bytes=i}t!==o&&(o.disposeData(e),r.backend=t,t.register(e,r.shape,r.dtype)),t.write(e,n)},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return gk(this,void 0,void 0,function(){var e,n;return yk(this,function(r){switch(r.label){case 0:return e=sN(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=sN()-e,[2,n]}})})},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new BN,this.registry)this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),UN=function(){var t=function(){if(null==PN){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}PN=t}return PN}();if(null==t._tfengine){var e=new bk(t);t._tfengine=new zN(e)}return Ck(t._tfengine.ENV),bN=function(){return t._tfengine},t._tfengine}();function VN(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}xk.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),xk.registerFlag("IS_BROWSER",function(){return VN()}),xk.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),xk.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),xk.registerFlag("PROD",function(){return!1}),xk.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return xk.getBool("DEBUG")}),xk.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),xk.registerFlag("IS_TEST",function(){return!1});var WN,jN,HN={},GN={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qN(t,e){HN[t]=e}function KN(t){t in HN||(HN[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=$N(t);return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete HN[t]},!1),1===t?e.getContext("webgl",GN)||e.getContext("experimental-webgl",GN):e.getContext("webgl2",GN)}(t));var e=HN[t];return e.isContextLost()?(delete HN[t],KN(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),HN[t])}function $N(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function XN(t,e){return[e,t]}function YN(t){var e=_k(t);return Fk(Math.ceil(e/4))}function QN(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function ZN(t,e){var n,r,o,i,a,s,u,l,c,p=t;return 2===xk.getNumber("WEBGL_VERSION")?(n=p.R32F,r=p.R16F,o=p.RGBA16F,i=p.RGBA32F,a=p.RED,s=4,u=1,l=p.HALF_FLOAT,c=p.FLOAT):(n=t.RGBA,r=t.RGBA,o=t.RGBA,i=p.RGBA,a=t.RGBA,s=4,u=4,l=null!=e?e.HALF_FLOAT_OES:null,c=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function JN(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+rI(t,e))}(t),r}!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(WN||(WN={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(jN||(jN={}));var tI=5.96e-8,eI=65504;function nI(t){return!!(xk.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||tI<Math.abs(t)&&Math.abs(t)<eI)}function rI(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function oI(t,e,n){return II(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function iI(t,e,n){var r=II(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(JN(t,e,function(){return t.shaderSource(r,n)}),JN(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function aI(t,e,n){var r=II(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(JN(t,e,function(){return t.shaderSource(r,n)}),JN(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=lI.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),i=o.length.toString().length+2,a=o.map(function(t,e){return Pk((e+1).toString(),i)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var l=a.slice(0,r-1),c=a.slice(r-1,r),p=a.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+Pk(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var sI,uI,lI=/ERROR: [0-9]+:([0-9]+):/g;function cI(t,e){return II(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function pI(t,e,n){if(JN(t,e,function(){return t.linkProgram(n)}),!1===t.getProgramParameter(n,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function hI(t,e,n){if(JN(t,e,function(){return t.validateProgram(n)}),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function fI(t,e,n){var r=II(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return JN(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),JN(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function dI(t,e,n){var r=II(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return JN(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),JN(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function mI(t,e){return II(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function vI(t,e){var n=xk.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function gI(t,e){return II(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function yI(t,e,n,r,o,i,a,s){var u=t.getAttribLocation(n,r);return-1!==u&&(JN(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),JN(t,e,function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)}),JN(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function bI(t,e,n,r){RI(t,r),JN(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),JN(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function wI(t,e,n,r){return II(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function xI(t,e,n){return t.getUniformLocation(e,n)}function CI(t,e,n,r,o,i){JN(t,e,function(){return bI(t,e,r,i)}),JN(t,e,function(){return t.uniform1i(o,i)})}function EI(t,e,n,r){JN(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),JN(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function SI(t,e,n){JN(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),JN(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function kI(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+NI(t,e))}function NI(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function II(t,e,n,r){var o=JN(t,e,function(){return n()});if(null==o)throw new Error(r);return o}function RI(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function AI(t,e){return void 0===e&&(e=2),_k(t.slice(0,t.length-e))}function TI(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function _I(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[AI(t)].concat(TI(t))),e}function DI(t,e){var n;void 0===e&&(e=!1);var r=xk.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map(function(e,n){return n>=t.length-2?kk(t[n]):t[n]})).length&&(t=[2,t[0]])),2!==t.length){var o=Uk(t);t=o.newShape}var i=_k(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=AI(t),s=2,u=2;return t.length&&(s=(n=TI(t))[0],u=n[1]),Fk(i=a*(s/2)*(u/2)).map(function(t){return 2*t})}return Fk(i)}function OI(t){return t%2==0}function MI(t,e){if(Dk(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(OI(n)&&OI(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&OI(t[0])&&OI(e[0])}function FI(t){if(null==sI){var e=KN(t);sI=e.getParameter(e.MAX_TEXTURE_SIZE)}return sI}function PI(t){if(null==uI){var e=KN(t);uI=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,uI)}function LI(t){if(0===t)return 0;var e=KN(t);return BI(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:BI(e,"EXT_disjoint_timer_query")?1:0}function BI(t,e){return null!=t.getExtension(e)}function zI(t){try{if(null!=KN(t))return!0}catch(t){return!1}return!1}function UI(t){if(0===t)return!1;var e=KN(t);if(1===t){if(!BI(e,"OES_texture_float"))return!1}else if(!BI(e,"EXT_color_buffer_float"))return!1;return WI(e)}function VI(t){if(0===t)return!1;var e=KN(t);if(1!==t){if(BI(e,"EXT_color_buffer_float"))return WI(e);if(BI(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var n=ZN(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),i}(e,n)}return!1}return!!BI(e,"OES_texture_float")&&!!BI(e,"WEBGL_color_buffer_float")&&WI(e)}function WI(t){var e=ZN(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function jI(t){return 2===t&&null!=KN(t).fenceSync}var HI=Object.freeze({callAndCheck:JN,canBeRepresented:nI,getWebGLErrorMessage:rI,getExtensionOrThrow:oI,createVertexShader:iI,createFragmentShader:aI,createProgram:cI,linkProgram:pI,validateProgram:hI,createStaticVertexBuffer:fI,createStaticIndexBuffer:dI,getNumChannels:function(){return 2===xk.getNumber("WEBGL_VERSION")?1:4},createTexture:mI,validateTextureSize:vI,createFramebuffer:gI,bindVertexBufferToProgramAttribute:yI,bindTextureUnit:bI,unbindTextureUnit:function(t,e,n){RI(t,n),JN(t,e,function(){return t.activeTexture(t.TEXTURE0+n)}),JN(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:wI,getProgramUniformLocation:xI,bindTextureToProgramUniformSampler:CI,bindCanvasToFramebuffer:function(t,e){JN(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),JN(t,e,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),JN(t,e,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:EI,unbindColorTextureFromFramebuffer:SI,validateFramebuffer:kI,getFramebufferErrorMessage:NI,getBatchDim:AI,getRowsCols:TI,getShapeAs3D:_I,getTextureShapeFromLogicalShape:DI,isReshapeFree:MI,getWebGLMaxTextureSize:FI,resetMaxTextureSize:function(){sI=null},resetMaxTexturesInShader:function(){uI=null},getMaxTexturesInShader:PI,getWebGLDisjointQueryTimerVersion:LI,hasExtension:BI,isWebGLVersionEnabled:zI,isRenderToFloatTextureEnabled:UI,isDownloadFloatTextureEnabled:VI,isWebGLFenceEnabled:jI});function GI(t){xk.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function qI(){return UN.memory()}function KI(t,e){return UN.tidy(t,e)}function $I(t){FN(t).forEach(function(t){return t.dispose()})}function XI(t){return UN.keep(t)}function YI(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];xk.getBool("IS_TEST")||console.warn.apply(console,t)}function QI(t,e){var n=t;if(Kk(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||Kk(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&xk.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||Kk(e)){Ik(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),Ik(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var o=n.slice(1),i=0;i<e.length;++i)t(e[i],o,r.concat(i))}else Ik(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(t,r,[]),r}function ZI(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function JI(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof CN)return ZI(r,t.dtype,e,n),t;var o=Jk(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),ZI(r,o,e,n),null==t||!Kk(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+(null==t?"null":t.constructor.name)+"'");var i=QI(t,o);Kk(t)||Array.isArray(t)||(t=[t]);var a="string"!==o?rN(t,o,xk.getBool("DEBUG")):Tk(t,[],!0);return CN.make(i,{values:a},o)}function tR(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return JI(t,e+"["+r+"]",n)},r)}function eR(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function nR(t,e,n){for(var r=t.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[i++]):o.push(e[a++]);return o}function rR(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map(function(e){return t[e]})]}function oR(t,e){return nR(t,e.map(function(t){return 1}),e)}function iR(t,e,n){Ik(eR(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function aR(t,e){if(eR(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function sR(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function uR(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function lR(t,e){var n=t[0].length;t.forEach(function(t,e){Ik(t.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"})}),Ik(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(t,o){for(var i=0;i<n;i++)Ik(i===e||t[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function cR(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function pR(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];UN.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),UN.endScope(o),o}catch(t){throw UN.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}xk.registerFlag("HAS_WEBGL",function(){return xk.getNumber("WEBGL_VERSION")>0}),xk.registerFlag("WEBGL_VERSION",function(){return zI(2)?2:zI(1)?1:0}),xk.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===xk.get("WEBGL_VERSION")}),xk.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),xk.registerFlag("WEBGL_PACK",function(){return xk.getBool("HAS_WEBGL")}),xk.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_PACK_CLIP",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),xk.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_PACK_REDUCE",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_LAZILY_UNPACK",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_CONV_IM2COL",function(){return xk.getBool("WEBGL_PACK")}),xk.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return FI(xk.getNumber("WEBGL_VERSION"))}),xk.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return PI(xk.getNumber("WEBGL_VERSION"))}),xk.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=xk.getNumber("WEBGL_VERSION");return 0===t?0:LI(t)}),xk.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),xk.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return UI(xk.getNumber("WEBGL_VERSION"))}),xk.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return VI(xk.getNumber("WEBGL_VERSION"))}),xk.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return jI(xk.getNumber("WEBGL_VERSION"))}),xk.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return xk.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),xN=GI;var hR=pR({complex_:function(t,e){var n=JI(t,"real","complex"),r=JI(e,"imag","complex");return Rk(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),UN.runKernel(function(t){return t.complex(n,r)},{$real:n,$imag:r})}}),fR=pR({real_:function(t){var e=JI(t,"input","real");return UN.runKernel(function(t){return t.real(e)},{$input:e})}}),dR=pR({imag_:function(t){var e=JI(t,"input","imag");return UN.runKernel(function(t){return t.imag(e)},{$input:e})}});function mR(t,e,n){return vR(t,e,QI(t,n),n)}function vR(t,e,n,r){if(null==r&&(r=Jk(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Kk(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){uN(e);var o=_k(e),i=_k(n);Ik(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<n.length;++a){var s=a!==n.length-1||n[a]!==_k(e.slice(a));Ik(n[a]===e[a]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return Kk(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?rN(t,r,xk.getBool("DEBUG")):Tk(t,[],!0),CN.make(e,{values:t},r)}function gR(t,e){if((Kk(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&Kk(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vR(t,[],[],e)}function yR(t,e){Ak(t);var n=QI(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vR(t,null,n,e)}function bR(t,e,n){if(Ak(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=QI(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vR(t,e,r,n)}function wR(t,e,n){if(Ak(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=QI(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vR(t,e,r,n)}function xR(t,e,n){if(Ak(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=QI(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return vR(t,e,r,n)}function CR(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=CR(t,"float32"),r=ER(t,"float32");return hR(n,r)}var o=iN(_k(t),e);return CN.make(t,{values:o},e)}function ER(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=ER(t,"float32"),r=ER(t,"float32");return hR(n,r)}var o=aN(_k(t),e);return CN.make(t,{values:o},e)}function SR(t,e,n){return UN.runKernel(function(r){return r.fill(t,e,n)},{})}function kR(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return UN.runKernel(function(r){return r.linspace(t,e,n)},{})}function NR(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return ER([0],r);var o=aN(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return yR(o,r)}var IR=pR({onesLike_:function(t){var e=JI(t,"x","onesLike");if("complex64"===e.dtype){var n=IR(fR(e)),r=RR(dR(e));return hR(n,r)}return UN.runKernel(function(t){return t.onesLike(e)},{$x:e},function(t,e){return{$x:function(){return RR(t)}}})}}),RR=pR({zerosLike_:function(t){var e=JI(t,"x","zerosLike");return UN.runKernel(function(t){return t.zerosLike(e)},{$x:e},function(t,e){return{$x:function(){return RR(t)}}})}}),AR=pR({concat_:function(t,e){void 0===e&&(e=0),Ik(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=tR(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")}),e=zk(e,n[0].shape)[0];var r=cR(n.map(function(t){return t.shape}),e);if(0===_k(r))return mR([],r);if(1===(n=n.filter(function(t){return t.size>0})).length)return n[0];var o=n.map(function(t){return t.shape});return lR(o,e),UN.runKernel(function(t){return t.concat(n,e)},n,function(t){var n=o.map(function(t){return t[e]});return MR(t,n,e).map(function(t){return function(){return t}})})}}),TR=pR({concat1d_:function(t){return AR(t,0)}}),_R=pR({concat2d_:function(t,e){return AR(t,e)}}),DR=pR({concat3d_:function(t,e){return AR(t,e)}}),OR=pR({concat4d_:function(t,e){return AR(t,e)}}),MR=pR({split_:function(t,e,n){void 0===n&&(n=0);var r,o=JI(t,"x","split");return n=zk(n,o.shape)[0],"number"==typeof e?(Ik(o.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(o.shape[n]/e)):(Ik(o.shape[n]===e.reduce(function(t,e){return t+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),UN.runKernel(function(t){return t.split(o,r,n)},{$x:o},function(t){return{$x:function(){return AR(t,n)}}})}});function FR(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var PR=FR(function(t){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function i(t,e){var n=new r(t),i=e&&e.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+1.1102230246251565e-16*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.alea=i}(0,t)}),LR=FR(function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xor128=i}(0,t)}),BR=FR(function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xorwow=i}(0,t)}),zR=FR(function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function i(t,e){null==t&&(t=+new Date);var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&(i.x&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xorshift7=i}(0,t)}),UR=FR(function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n=o[i]=(n^=n>>>15)^(t^=t>>>12),e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=0==(n=s[127&i]^=r+(a=a+1640531527|0))?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,s[o]=(r^=r>>>15)^(n^=n>>>12);t.w=a,t.X=s,t.i=o}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function i(t,e){null==t&&(t=+new Date);var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&(i.X&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xor4096=i}(0,t)}),VR=FR(function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.tychei=i}(0,t)}),WR=FR(function(t){!function(e,r){var o,i=this,a=256,s=6,u="random",l=r.pow(a,s),c=r.pow(2,52),p=2*c,h=a-1;function f(t,n,h){var f=[],y=v(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,g(e)]}}():t,3),f),b=new d(f),w=function(){for(var t=b.g(s),e=l,n=0;t<c;)t=(t+n)*a,e*=a,n=b.g(1);for(;t>=p;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,v(g(b.S),e),(n.pass||h||function(t,e,n,o){return o&&(o.S&&m(o,b),t.state=function(){return m(b,{})}),n?(r[u]=t,e):t})(w,y,"global"in n?n.global:this==r,n.state)}function d(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=h&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=h&o+1],n=n*a+s[h&(s[o]=s[i=h&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}function m(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){for(var n,r=t+"",o=0;o<r.length;)e[h&o]=h&(n^=19*e[h&o])+r.charCodeAt(o++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(r["seed"+u]=f,v(r.random(),e),t.exports){t.exports=f;try{o=n(4)}catch(t){}}}([],Math)});WR.alea=PR,WR.xor128=LR,WR.xorwow=BR,WR.xorshift7=zR,WR.xor4096=UR,WR.tychei=VR;var jR=WR.alea,HR=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=jR(i.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,i=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),GR=function(){function t(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;var o=r||Math.random();this.randu=jR(o.toString()),this.randn=new HR(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,r,o,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(e=1-.331*(t=r*r)*t,n=.5*t+this.d*(1-(i*=i*i)+Math.log(i)),(o=this.randu())<e||Math.log(o)<n)break}return i*=1/this.beta*this.d,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),qR=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=1);var o=this;if(this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=jR(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function KR(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",uN(t),new yN(t,e,n)}var $R=pR({batchToSpaceND_:function(t,e,n){var r=JI(t,"x","batchToSpaceND"),o=e.reduce(function(t,e){return t*e});return Ik(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),Ik(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),Ik(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),UN.runKernel(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}})}}),XR=pR({cast_:function(t,e){var n=JI(t,"x","cast");if(!Gk(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return UN.runKernel(function(t){return t.cast(n,e)},{$x:n},function(t){return{$x:function(){return t.clone()}}})}}),YR=pR({clone_:function(t){var e=JI(t,"x","clone",null);return UN.runKernel(function(t){return CN.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),QR=pR({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=JI(t,"x","cumsum"),i=aR([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=uR(1,o.rank)[0],u=UN.runKernel(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),ZR=pR({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=JI(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return Ik(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),Ik(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),Ik(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),UN.runKernel(function(t){return t.depthToSpace(r,e,n)},{$x:r})}}),JR=pR({expandDims_:function(t,e){void 0===e&&(e=0);var n=JI(t,"x","expandDims",null);Ik(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(Ik(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),hA(n,r)}}),tA=pR({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=KR([t,e],r),i=t<=e?t:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return vA(JR(s,0),[n[0],1,1]);if(2===n.length)return vA(JR(JR(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return vA(JR(JR(JR(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),eA=pR({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=JI(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?o.as2D(1,-1):o,u=UN.runKernel(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u}}),nA=pR({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=JI(t,"indices","oneHot","int32"),i=o.shape.concat([e]);return o=o.flatten(),UN.runKernel(function(t){return t.oneHot(o,e,n,r)},{$indices:o},function(t){return{$indices:function(){return ER(o.shape,"float32")}}}).reshape(i)}}),rA=pR({pad_:function(t,e,n){void 0===n&&(n=0);var r=JI(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o=e.map(function(t){return t[0]});return UN.runKernel(function(t){return t.pad(r,e,n)},{$x:r},function(t){return{$x:function(){return t.slice(o,r.shape)}}})}}),oA=pR({pad1d_:function(t,e,n){return void 0===n&&(n=0),Ik(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),rA(t,[e],n)}}),iA=pR({pad2d_:function(t,e,n){return void 0===n&&(n=0),Ik(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),rA(t,e,n)}}),aA=pR({pad3d_:function(t,e,n){return void 0===n&&(n=0),Ik(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),rA(t,e,n)}}),sA=pR({pad4d_:function(t,e,n){return void 0===n&&(n=0),Ik(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),rA(t,e,n)}}),uA=pR({rand_:function(t,e,n){var r=_k(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return CN.make(t,{values:o},n)}}),lA=pR({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new HR(e,n,r,!1,o),a=KR(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),cA=pR({randomGamma_:function(t,e,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new GR(e,n,r,o),a=KR(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),pA=pR({randomUniform_:function(t,e,n,r,o){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=KR(t,r),a=new qR(e,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),hA=pR({reshape_:function(t,e){var n=JI(t,"x","reshape",null);return e=Bk(e,n.size),Ik(n.size===_k(e),function(){return"new shape and old shape must have the same number of elements."}),UN.runKernel(function(t){return t.reshape(n,e)},{$x:n},function(t){return{$x:function(){return t.reshape(n.shape)}}})}}),fA=pR({spaceToBatchND_:function(t,e,n){var r=JI(t,"x","spaceToBatchND");return Ik(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),Ik(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),Ik(r.shape.reduce(function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),UN.runKernel(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}})}}),dA=pR({squeeze_:function(t,e){var n=JI(t,"x","squeeze");return hA(n,Uk(n.shape,e).newShape)}}),mA=pR({stack_:function(t,e){void 0===e&&(e=0);var n=tR(t,"tensors","stack");if(Ik(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(e);var r=n[0].shape,o=n[0].dtype;Ik(e<=n[0].rank,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(t){Rk(r,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){Ik(o===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(t){return t.expandDims(e)});return AR(i,e)}}),vA=pR({tile_:function(t,e){var n=JI(t,"x","tile",null);return Ik(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."}),UN.runKernel(function(t,r){var o=t.tile(n,e);return r([n]),o},{$x:n},function(t,n){var r=n[0];return{$x:function(){var n=RR(r);if(1===r.rank)for(var o=0;o<e[0];++o)n=n.add(t.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<e[0];++o)for(var i=0;i<e[1];++i)n=n.add(t.slice([o*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(var a=0;a<e[2];++a)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}})}}),gA=pR({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new HR(e,n,r,!0,o),a=KR(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),yA=pR({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=JI(t,"x","unstack");return Ik(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length),UN.runKernel(function(t){return t.unstack(n,e)},{$x:n},function(t){return{$x:function(){return mA(t,e)}}})}}),bA=function(t,e){return gk(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,p;return yk(this,function(h){switch(h.label){case 0:return n=JI(t,"x","setdiff1d"),r=JI(e,"y","setdiff1d"),Ik(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),Ik(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),Ik(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(i=h.sent(),a=new Set(i),s=0,c=0;c<o.length;c++)a.has(o[c])||s++;for(u=new yN([s],n.dtype),l=new yN([s],"int32"),c=0,p=0;c<o.length;c++)a.has(o[c])||(u.values[p]=o[c],l.values[p]=c,p++);return[2,[u.toTensor(),l.toTensor()]]}})})};function wA(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([t[a+1]/e[a],e[a]]);o=o.concat(t.slice(i+1))}return o}function xA(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function CA(t,e,n,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/n:t[0]*n);for(var i=1;i<t.length;++i)o.push(i<=e.length?r?e[i-1]*t[i]:t[i]/e[i-1]:t[i]);return o}function EA(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function SA(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}function kA(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=t.shape,s=n.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var l=nN(t.shape).map(function(t){return t/u}).concat([1]).slice(0,r);return[s,o,u,l]}var NA=30;function IA(t){return t<=NA?t:eN(t,Math.floor(Math.sqrt(t)))}function RA(t,e,n){for(var r=e.rank>1?e.shape[e.rank-1]:1,o=n.length,i=1,a=r;a<o;++a)i*=n[a];return{sliceRank:r,numUpdates:e.size/(r<1?1:r),sliceSize:i,strides:nN(n.slice(0,r)).concat([1]),outputSize:_k(n)}}function AA(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],p=[],h=0;h<t.length;h++)l[h]=TA(o,e,r,t,h),c[h]=_A(i,n,r,t,h),u&1<<h&&(c[h]=l[h]+1,p.push(h));var f=new Array(t.length).fill(0);return f=f.map(function(t,e){for(var n=0,o=r[e]||1,i=l[e];!(o>0?i>=c[e]:i<=c[e]);i+=o)n+=1;return n}),[l,f,p]}function TA(t,e,n,r,o){var i=e[o];(t&1<<o||null==i)&&(i=(n[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[o];return i<0&&(i+=a),Sk(0,i,a-1)}function _A(t,e,n,r,o){var i=e[o],a=n[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?Sk(0,i,s):Sk(-1,i,s-1)}function DA(t,e,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function OA(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function MA(t){return UN.customGrad(t)}var FA=pR({softmax_:function(t,e){void 0===e&&(e=-1);var n=JI(t,"logits","softmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return MA(function(t,n){var r=t.logSumExp([e],!0),o=t.toFloat().sub(r).exp();return n([o]),{value:o,gradFunc:function(t,n){var r=n[0],o=t.mul(r);return o.sub(o.sum([e],!0).mul(r))}}})(n)}}),PA=pR({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=JI(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return MA(function(t,n){var r=t.max(e,!0),o=t.sub(r),i=o.toFloat().sub(o.exp().sum(e,!0).log());return n([i]),{value:i,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}})(n)}}),LA=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.data.delete(t)},t}();function BA(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var i=n-1-o;(e[e.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function zA(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],i=e.length-r-1;(null==o||1===o&&e[i]>1)&&n.unshift(i)}return n}function UA(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)n.unshift(a);else if(1===a)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(i)}}return n}function VA(t,e,n,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=qA(e),l=u[0],c=u[1];if("channelsLast"===a)s=[l,c,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[l,c,t[1],t[1]]}return jA(t,s,n,r,o,i,!1,a)}function WA(t,e,n,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,l=KA(e),c=l[0],p=l[1],h=l[2];if("NDHWC"===a)u="channelsLast",s=[c,p,h,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,p,h,t[1],t[1]]}return HA(t,s,n,r,o,!1,u,i)}function jA(t,e,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],h=u[3];if("channelsLast"===s)l=t[0],c=t[1],p=t[2],h=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=t[0],h=t[1],c=t[2],p=t[3]}var f,d=e[0],m=e[1],v=e[3],g=qA(n),y=g[0],b=g[1],w=qA(r),x=w[0],C=w[1],E=$A(d,x),S=$A(m,C),k=function(t,e,n,r,o,i,a,s){var u,l,c;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var p=function(t,e,n,r,o){null==r&&(r=GA(t,e,n));var i=t[1],a=XA((t[0]-e+2*r)/n+1,o);Ik(Ok(a),function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"});var s=XA((i-e+2*r)/n+1,o);return Ik(Ok(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[a,s]}([e,n],i,r,t,s);l=p[0],c=p[1]}else if("same"===t){l=Math.ceil(e/r),c=Math.ceil(n/o);var h=Math.max(0,(l-1)*r+i-e),f=Math.max(0,(c-1)*o+a-n),d=Math.floor(h/2),m=h-d,v=Math.floor(f/2);u={top:d,bottom:m,left:v,right:f-v,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),c=Math.ceil((n-a+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,p,y,b,E,S,i),N=k.outHeight,I=k.outWidth,R=a?v*h:v;return"channelsFirst"===s?f=[l,R,N,I]:"channelsLast"===s&&(f=[l,N,I,R]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:p,inChannels:h,outHeight:N,outWidth:I,outChannels:R,padInfo:k.padInfo,strideHeight:y,strideWidth:b,filterHeight:d,filterWidth:m,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationHeight:x,dilationWidth:C,inShape:t,outShape:f,filterShape:e}}function HA(t,e,n,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],h=u[3],f=u[4];if("channelsLast"===a)l=t[0],c=t[1],p=t[2],h=t[3],f=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);l=t[0],f=t[1],c=t[2],p=t[3],h=t[4]}var d,m=e[0],v=e[1],g=e[2],y=e[4],b=KA(n),w=b[0],x=b[1],C=b[2],E=KA(r),S=E[0],k=E[1],N=E[2],I=$A(m,S),R=$A(v,k),A=$A(g,N),T=function(t,e,n,r,o,i,a,s,u,l,c){var p,h,f,d;if("number"==typeof t){p={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var m=function(t,e,n,r,o,i){null==o&&(o=GA(t,e,r));var a=t[1],s=t[2],u=XA((t[0]-e+2*o)/r+1,i);Ik(Ok(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=XA((a-e+2*o)/r+1,i);Ik(Ok(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var c=XA((s-e+2*o)/r+1,i);return Ik(Ok(c),function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,c,1]}([e,n,r,1],s,0,o,t,c);h=m[0],f=m[1],d=m[2]}else if("same"===t){var v=((h=Math.ceil(e/o))-1)*o+s-e,g=((f=Math.ceil(n/i))-1)*i+u-n,y=((d=Math.ceil(r/a))-1)*a+l-r,b=Math.floor(v/2),w=v-b,x=Math.floor(g/2),C=g-x,E=Math.floor(y/2);p={top:x,bottom:C,left:E,right:y-E,front:b,back:w,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-s+1)/o),f=Math.ceil((n-u+1)/i),d=Math.ceil((r-l+1)/a)}return{padInfo:p,outDepth:h,outHeight:f,outWidth:d}}(o,c,p,h,w,x,C,I,R,A,s),_=T.outDepth,D=T.outHeight,O=T.outWidth,M=i?y*f:y;return"channelsFirst"===a?d=[l,M,_,D,O]:"channelsLast"===a&&(d=[l,_,D,O,M]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:p,inWidth:h,inChannels:f,outDepth:_,outHeight:D,outWidth:O,outChannels:M,padInfo:T.padInfo,strideDepth:w,strideHeight:x,strideWidth:C,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:R,effectiveFilterWidth:A,dilationDepth:S,dilationHeight:k,dilationWidth:N,inShape:t,outShape:d,filterShape:e}}function GA(t,e,n,r){void 0===r&&(r=1);var o=$A(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}function qA(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function KA(t){return"number"==typeof t?[t,t,t]:t}function $A(t,e){return e<=1?t:t+(t-1)*(e-1)}function XA(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function YA(t){var e=qA(t);return 1===e[0]&&1===e[1]&&1===e[2]}function QA(t,e){return YA(t)||YA(e)}function ZA(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function JA(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=ER(t.shape),o=t.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!qk(t.dtype,e))return CN.make(t.shape,{dataId:t.dataId},e);if("complex64"===t.dtype){var a=n.real(t);return i=a.cast(e),a.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){var s=gR(0,t.dtype);return i=n.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function tT(t,e){return CN.make(e,{dataId:t.dataId},t.dtype)}function eT(t,e,n){var r=(e-t)/(n-1),o=aN(n,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return yR(o,"float32")}function nT(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function rT(t,e){return{real:t[2*e],imag:t[2*e+1]}}function oT(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function iT(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function aT(t,e,n,r,o){for(var i=Array.from(e).map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>o}).sort(function(t,e){return e.score-t.score}),a=[],s=0;s<i.length;s++){var u=i[s],l=u.boxIndex;if(u.score<o)break;for(var c=!1,p=a.length-1;p>=0;--p)if(sT(t,l,a[p])>=r){c=!0;break}if(!c&&(a.push(l),a.length>=n))break}return yR(a,"int32")}function sT(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),f=(s-i)*(u-a),d=(p-l)*(h-c);if(f<=0||d<=0)return 0;var m=Math.max(i,l),v=Math.max(a,c),g=Math.min(s,p),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(f+d-b)}function uT(t,e,n){var r=new Array(t.rank).fill(0),o=t.shape.slice();return e.map(function(e){o[n]=e;var i=t.slice(r,o);return r[n]+=e,i})}function lT(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=KR(n,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function cT(t,e,n,r,o){for(var i=e[e.length-1],a=[t.length/i,i],s=a[0],u=a[1],l=Vk(n,s*r),c=Vk("int32",s*r),p=0;p<s;p++){for(var h=p*u,f=t.subarray(h,h+u),d=[],m=0;m<f.length;m++)d.push({value:f[m],index:m});d.sort(function(t,e){return e.value-t.value});var v=p*r,g=l.subarray(v,v+r),y=c.subarray(v,v+r);for(m=0;m<r;m++)g[m]=d[m].value,y[m]=d[m].index}var b=e.slice();return b[b.length-1]=r,[mR(l,b,n),mR(c,b,"int32")]}function pT(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=KR(t,"int32"),i=KR([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]);i.values.set(a,r*t.length)}return i.toTensor()}!function(){function t(){}t.prototype.time=function(t){throw new Error("Not yet implemented.")},t.prototype.read=function(t){throw new Error("Not yet implemented.")},t.prototype.readSync=function(t){throw new Error("Not yet implemented.")},t.prototype.disposeData=function(t){throw new Error("Not yet implemented.")},t.prototype.write=function(t,e){throw new Error("Not yet implemented.")},t.prototype.fromPixels=function(t,e){throw new Error("Not yet implemented.")},t.prototype.register=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.memory=function(){throw new Error("Not yet implemented.")},t.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.fusedBatchMatMul=function(t){throw new Error("Not yet implemented")},t.prototype.slice=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){throw new Error("Not yet implemented")},t.prototype.unstack=function(t,e){throw new Error("Not yet implemented")},t.prototype.reverse=function(t,e){throw new Error("Not yet implemented")},t.prototype.concat=function(t,e){throw new Error("Not yet implemented")},t.prototype.neg=function(t){throw new Error("Not yet implemented")},t.prototype.add=function(t,e){throw new Error("Not yet implemented")},t.prototype.addN=function(t){throw new Error("Not yet implemented")},t.prototype.subtract=function(t,e){throw new Error("Not yet implemented")},t.prototype.multiply=function(t,e){throw new Error("Not yet implemented")},t.prototype.realDivide=function(t,e){throw new Error("Not yet implemented")},t.prototype.floorDiv=function(t,e){throw new Error("Not yet implemented")},t.prototype.sum=function(t,e){throw new Error("Not yet implemented")},t.prototype.prod=function(t,e){throw new Error("Not yet implemented")},t.prototype.unsortedSegmentSum=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.argMin=function(t,e){throw new Error("Not yet implemented")},t.prototype.argMax=function(t,e){throw new Error("Not yet implemented")},t.prototype.equal=function(t,e){throw new Error("Not yet implemented")},t.prototype.notEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.less=function(t,e){throw new Error("Not yet implemented")},t.prototype.lessEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.greater=function(t,e){throw new Error("Not yet implemented")},t.prototype.greaterEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalNot=function(t){throw new Error("Not yet implemented")},t.prototype.logicalAnd=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalOr=function(t,e){throw new Error("Not yet implemented")},t.prototype.where=function(t){throw new Error("Not yet implemented")},t.prototype.select=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.topk=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.min=function(t,e){throw new Error("Not yet implemented")},t.prototype.minimum=function(t,e){throw new Error("Not yet implemented")},t.prototype.mod=function(t,e){throw new Error("Not yet implemented")},t.prototype.max=function(t,e){throw new Error("Not yet implemented")},t.prototype.maximum=function(t,e){throw new Error("Not yet implemented")},t.prototype.all=function(t,e){throw new Error("Not yet implemented")},t.prototype.any=function(t,e){throw new Error("Not yet implemented")},t.prototype.squaredDifference=function(t,e){throw new Error("Not yet implemented")},t.prototype.ceil=function(t){throw new Error("Not yet implemented")},t.prototype.floor=function(t){throw new Error("Not yet implemented")},t.prototype.round=function(t){throw new Error("Not yet implemented")},t.prototype.sign=function(t){throw new Error("Not yet implemented")},t.prototype.isNaN=function(t){throw new Error("Not yet implemented")},t.prototype.isInf=function(t){throw new Error("Not yet implemented")},t.prototype.isFinite=function(t){throw new Error("Not yet implemented")},t.prototype.pow=function(t,e){throw new Error("Not yet implemented")},t.prototype.exp=function(t){throw new Error("Not yet implemented")},t.prototype.expm1=function(t){throw new Error("Not yet implemented")},t.prototype.log=function(t){throw new Error("Not yet implemented")},t.prototype.log1p=function(t){throw new Error("Not yet implemented")},t.prototype.sqrt=function(t){throw new Error("Not yet implemented")},t.prototype.rsqrt=function(t){throw new Error("Not yet implemented")},t.prototype.square=function(t){throw new Error("Not yet implemented")},t.prototype.reciprocal=function(t){throw new Error("Not yet implemented")},t.prototype.relu=function(t){throw new Error("Not yet implemented")},t.prototype.prelu=function(t,e){throw new Error("Not yet implemented")},t.prototype.elu=function(t){throw new Error("Not yet implemented")},t.prototype.eluDer=function(t,e){throw new Error("Not yet implemented")},t.prototype.selu=function(t){throw new Error("Not yet implemented")},t.prototype.int=function(t){throw new Error("Not yet implemented")},t.prototype.clip=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.abs=function(t){throw new Error("Not yet implemented")},t.prototype.complexAbs=function(t){throw new Error("Not yet implemented")},t.prototype.sigmoid=function(t){throw new Error("Not yet implemented")},t.prototype.softplus=function(t){throw new Error("Not yet implemented")},t.prototype.sin=function(t){throw new Error("Not yet implemented")},t.prototype.cos=function(t){throw new Error("Not yet implemented")},t.prototype.tan=function(t){throw new Error("Not yet implemented")},t.prototype.asin=function(t){throw new Error("Not yet implemented")},t.prototype.acos=function(t){throw new Error("Not yet implemented")},t.prototype.atan=function(t){throw new Error("Not yet implemented")},t.prototype.atan2=function(t,e){throw new Error("Not yet implemented")},t.prototype.sinh=function(t){throw new Error("Not yet implemented")},t.prototype.cosh=function(t){throw new Error("Not yet implemented")},t.prototype.tanh=function(t){throw new Error("Not yet implemented")},t.prototype.asinh=function(t){throw new Error("Not yet implemented")},t.prototype.acosh=function(t){throw new Error("Not yet implemented")},t.prototype.atanh=function(t){throw new Error("Not yet implemented")},t.prototype.erf=function(t){throw new Error("Not yet implemented")},t.prototype.step=function(t,e){throw new Error("Not yet implemented")},t.prototype.fusedConv2d=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.conv2d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2D=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv3dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.maxPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.maxPoolBackprop=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.avgPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.avgPoolBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.avgPool3d=function(t,e){throw new Error("Not yet implemented")},t.prototype.avgPool3dBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.maxPool3d=function(t,e){throw new Error("Not yet implemented")},t.prototype.maxPool3dBackprop=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.reshape=function(t,e){throw new Error("Not yet implemented")},t.prototype.cast=function(t,e){throw new Error("Not yet implemented")},t.prototype.tile=function(t,e){throw new Error("Not yet implemented")},t.prototype.pad=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.transpose=function(t,e){throw new Error("Not yet implemented")},t.prototype.gather=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.gatherND=function(t,e){throw new Error("Not yet implemented")},t.prototype.scatterND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchToSpaceND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.spaceToBatchND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeBilinear=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeBilinearBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchNormalization=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){throw new Error("Not yet implemented")},t.prototype.multinomial=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.oneHot=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.cumsum=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){throw new Error("Not yet implemented")},t.prototype.fft=function(t){throw new Error("Not yet implemented")},t.prototype.ifft=function(t){throw new Error("Not yet implemented")},t.prototype.complex=function(t,e){throw new Error("Not yet implemented")},t.prototype.real=function(t){throw new Error("Not yet implemented")},t.prototype.imag=function(t){throw new Error("Not yet implemented")},t.prototype.cropAndResize=function(t,e,n,r,o,i){throw new Error("Not yet implemented")},t.prototype.depthToSpace=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.split=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.sparseToDense=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.diag=function(t){throw new Error("Not yet implemented")},t.prototype.fill=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.onesLike=function(t){throw new Error("Not yet implemented")},t.prototype.zerosLike=function(t){throw new Error("Not yet implemented")},t.prototype.linspace=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.dispose=function(){throw new Error("Not yet implemented")}}(),Object.freeze({castTensor:JA,reshapeTensor:tT,linspaceImpl:eT,upcastType:_N,axesAreInnerMostDims:eR,combineLocations:nR,computeOutAndReduceShapes:rR,expandShapeToKeepDim:oR,assertAxesAreInnerMostDims:iR,getAxesPermutation:aR,getUndoAxesPermutation:sR,getInnerMostAxes:uR,getBroadcastDims:BA,getReductionAxes:zA,assertAndGetBroadcastShape:UA,assertParamsConsistent:lR,computeOutShape:cR,computePool2DInfo:VA,computePool3DInfo:WA,computeConv2DInfo:jA,computeConv3DInfo:HA,computeDefaultPad:GA,tupleValuesAreOne:YA,eitherStridesOrDilationsAreOne:QA,convertConv2DDataFormat:ZA});var hT=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},fT=function(t,e){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},dT=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,i=Math.ceil(t.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function mT(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function vT(t,e){return 1===e?[t]:mT(t,e)}function gT(){var t,e,n,r,o,i,a,s,u,l;return 2===xk.getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 0. || val == 0.) ? false : true;\n      }\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function yT(t,e,n){void 0===n&&(n="index");var r=nN(e);return r.map(function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"}).join("")}function bT(t){var e=nN(t).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var wT="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function xT(t){return"offset"+t}function CT(t){var e=t.name,n=_k(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function ET(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function ST(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function kT(t,e){return e.map(function(e){return t[e]}).join(", ")}var NT=function(t,e,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,Ik(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=Math.ceil(t[t.length-1]/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var i,a,s=this.outputShape,u=s.length,l=ET(u),c=vT("coords",u);if(1===o){var p=ET(a=u+1);i="\n        "+p+" sourceLocR = "+p+"("+c.join()+", 0);\n        ++"+c[u-1]+";\n        "+p+" sourceLocG = "+p+"("+c.join()+", 0);\n        ++"+c[u-2]+";\n        "+p+" sourceLocA = "+p+"("+c.join()+", 0);\n        --"+c[u-1]+";\n        "+p+" sourceLocB = "+p+"("+c.join()+", 0);\n        --"+c[u-2]+";"}else a=u,i="\n        "+l+" sourceLocR = coords;\n        ++"+c[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+c[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+c[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+c[u-2]+";";var h=["x","y","z","w","u","v"].slice(0,a),f="."+h[a-1],d=h.map(function(t){return"int "+t}),m=vT("sourceLocR",a-1).concat("inIdx.r"),v=vT("sourceLocG",a-1).concat("inIdx.g"),g=vT("sourceLocB",a-1).concat("inIdx.b"),y=vT("sourceLocA",a-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",x="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+g.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+d.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+d.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+c[u-1]+" < "+(s[u-1]-1)+";\n        bool hasNextRow = "+c[u-2]+" < "+(s[u-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+x+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+x+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},IT=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},RT=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.effectiveFilterDepth,n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterDepth*t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+e+";\n            wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},AT=function(t,e,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],UA(t,e),UA(t,n);var a="0.0";null!=r&&(UA(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(UA(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},TT=function(t,e,n,r,o,i){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],UA(t,e),UA(t,n);var a="vec4(0.0)";null!=r&&(UA(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(UA(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},_T=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=UA(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},DT="return (a < 0.) ? b * a : a;",OT=function(t,e,n){this.variableNames=["A","B"],this.outputShape=UA(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},MT="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",FT=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=UA(e,n);var o=this.outputShape.length,i="";if(r)if(0===o||1===_k(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+ET(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=vT("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},PT=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),LT=function(){function t(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),BT=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},zT=function(t){this.outputShape=[],this.outputShape=cR(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++)r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+e[n-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},UT=function(t,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=cR(t,e);var n=this.outputShape,r=n.length,o=ET(r),i=vT("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(t,e){return"T"+e});var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var l=a[e],c="vec2("+a.slice(-2).join()+")",p=a.join(),h="if ("+l+" < "+s[0]+")\n          return getChannel(getT0("+p+"), "+c+");";for(u=1;u<s.length;u++)h+="\n        else if ("+l+" < "+s[u]+") {\n          "+l+" -= "+s[u-1]+";\n          return getChannel(getT"+u+"("+p+"), "+c+");\n        }";h+="\n        else {\n          "+l+" -= "+s[s.length-1]+";\n          return getChannel(getT"+s.length+"("+p+"), "+c+");\n        }",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n        if (++"+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n        if (++"+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            --"+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "},VT=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===t.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},WT=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(r?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(r?1:2)+"], coords["+(r?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+r+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jT=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},HT=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},GT=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qT=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+r+"; dm++) {\n              int d2 = d1 * "+r+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},KT=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterHeight,p=t.filterWidth,h=4*Math.floor(t.inChannels/4),f=t.inChannels%4,d="channelsLast"===t.dataFormat,m=d?1:2,v=d?2:3,g=d?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+d+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+d+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+h+") *\n                    getW(wR, wC, "+h+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+h+", xR, xC) *\n                    getW(wR, wC, "+h+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2)\n              );\n\n              if ("+d+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2),\n                getW(wR, wC, "+h+" + 2, d2)\n              );\n\n              if ("+d+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1),\n                  getX(batch, xR, xC, "+h+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC),\n                  getX(batch, "+h+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+b+"\n        setOutput(result);\n      }\n    "},$T=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterDepth,p=t.filterHeight,h=t.filterWidth,f=4*Math.floor(t.inChannels/4),d=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===d)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===d)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===d)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},XT=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+t.strideHeight+", "+t.strideWidth+");\n      const ivec2 pads = ivec2("+t.padInfo.top+", "+t.padInfo.left+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+e+";\n        int q = d2 - d1 * "+e+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+t.filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+t.dilationHeight+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+t.filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+t.dilationWidth+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},YT=function(t){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=t.outShape;for(var e=t.inHeight,n=t.inWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.strideHeight,a=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,p=c,h="int xR; int xC; int xCOffset;",f=0;f<l;f++)for(var d=0;d<c;d++)h+="\n          vec4 xTexelR"+f+"C"+2*d+" = vec4(0.);\n          vec4 wR"+f+"C"+d+" = vec4(0.);\n          vec4 xR"+f+"C"+d+" = vec4(0.);";for(f=0;f<l;f++)for(var m=0;m<p;m++){if(h+="\n          xR = xRCorner + "+f*s+";\n          xC = xCCorner + "+(d=2*m)*u+";\n        ",1===a){if(d<c&&(h+=o%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+f+"C"+d+" = vec4(previous.zw, xTexelR"+f+"C"+d+".xy);\n                } else {\n                  xR"+f+"C"+d+" = vec4(0, 0, xTexelR"+f+"C"+d+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = xTexelR"+f+"C"+d+";\n              ",d+1<c)){var v=o%2==0?kk(u):u;u%2==0&&o%2==1||u%2!=0&&o%2!=1?(h+="\n                  xCOffset = xC + "+o%2+" + "+v+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",u>1&&(h+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+e+" &&\n                      xCOffset >= 0 && xCOffset < "+n+") {\n                      xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+f+"C"+d+" = vec4(0.);\n                    }\n                  "),h+="\n                  xR"+f+"C"+(d+1)+" = vec4(\n                    xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".xy);\n                "):h+="\n                  xCOffset = xC + "+v+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+f+"C"+(d+1)+" = xTexelR"+f+"C"+(d+2)+";\n                "}}else d<c&&(h+="\n              if(xR >= 0 && xR < "+e+") {\n            ",o%2==1?(h+="\n                xCOffset = xC + 1 - "+a+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+n+") {\n                  xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+f+"C"+(d+2)+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = vec4(\n                  xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".zw);\n              ",d+1<c&&(h+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+a+";\n                  if(xCOffset >= 0 && xCOffset < "+n+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+f+"C"+(d+1)+" = vec4(xTexelR"+f+"C"+(d+2)+".xy, final.xy);\n                ")):(h+="\n                if(xC >= 0 && xC < "+n+") {\n                  xTexelR"+f+"C"+d+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+f+"C"+d+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+a+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+f+"C"+(d+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+f+"C"+(d+2)+" = vec4(0.);\n                }\n\n                xR"+f+"C"+d+" = vec4(\n                  xTexelR"+f+"C"+d+".xy, xTexelR"+f+"C"+(d+2)+".xy);\n              ",d+1<c&&(h+="\n                  xR"+f+"C"+(d+1)+" = vec4(\n                    xTexelR"+f+"C"+d+".zw, xTexelR"+f+"C"+(d+2)+".zw);\n                ")),h+="}");d<c&&(h+="\n            vec4 wTexelR"+f+"C"+d+" = getW("+f+", "+d+", d1, q);\n            wR"+f+"C"+d+" = vec4(wTexelR"+f+"C"+d+".xz, wTexelR"+f+"C"+d+".xz);\n          ",d+1<c&&(h+="\n              vec4 wTexelR"+f+"C"+(d+1)+" = getW("+f+", "+(d+1)+", d1, q);\n              wR"+f+"C"+(d+1)+" =\n                vec4(wTexelR"+f+"C"+(d+1)+".xz, wTexelR"+f+"C"+(d+1)+".xz);"))}for(f=0;f<l;f++)for(d=0;d<c;d++)h+="result += xR"+f+"C"+d+" * wR"+f+"C"+d+";";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+o+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},QT=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],u=n[0],l=n[1];this.outputShape=[e[0],u,l,t[3]];var c=[a-1+".0",s-1+".0"],p=c[0],h=c[1],f=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],d=l>1?[""+(s-1)/(l-1),"(x2-x1) * width_ratio","x1*"+h+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+h];this.userCode="\n      const float height_ratio = float("+f[0]+");\n      const float width_ratio = float("+d[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+f[1]+";\n        float width_scale = "+d[1]+";\n\n        float in_y = "+f[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+d[2]+";\n        if( in_x < 0.0 || in_x > "+h+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},ZT=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ET(r)+" coords = getOutputCoords();\n        int end = "+JT(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+JT(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===r)return""+e;if(2===r)return e+".x, "+e+".y";if(3===r)return e+".x, "+e+".y, "+e+".z";if(4===r)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}(0,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function JT(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var t_=function(t,e){this.variableNames=["A"];var n=gT();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+yT(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},e_=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0;var n=gT();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+yT(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},n_=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),r_=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},o_=function(t){this.variableNames=["A"];var e=gT();this.outputShape=t,this.userCode="\n      "+wT+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},i_=function(t){this.variableNames=["A"],this.usesPackedTextures=!0;var e=gT();this.outputShape=t,this.userCode="\n      "+wT+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},a_=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=gT(),o=e[0],i=e[1];this.outputShape=t;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+bT(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},s_=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=gT(),o=e[0],i=e[1];this.outputShape=t;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+t[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n    \n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+bT(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n        \n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},u_=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(n?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},l_=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),c_=function(t){this.variableNames=["A"];var e=gT(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},p_=function(t){this.variableNames=["A"];var e=gT(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},h_=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=ET(this.rank),i=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<t.length;i++)o.push(i===e?"int(getIndices("+r[i]+"))":""+r[i]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},f_=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=ET(e.length),o=ET(n.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function d_(t,e){var n=gT();return iI(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function m_(t,e){return fI(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function v_(t,e){return dI(t,e,new Uint16Array([0,1,2,2,1,3]))}function g_(t,e,n,r,o,i,a){vI(n,r);var s=mI(t,e),u=t.TEXTURE_2D;return JN(t,e,function(){return t.bindTexture(u,s)}),JN(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),JN(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),JN(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),JN(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),JN(t,e,function(){return t.texImage2D(u,0,o,n,r,0,i,a,null)}),JN(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function y_(t,e,n,r,o){var i=XN(n,r);return g_(t,e,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function b_(t,e,n,r,o){var i=XN(n,r);return g_(t,e,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function w_(t,e,n,r,o){var i=XN(n,r);return g_(t,e,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function x_(t,e,n,r,o){var i=QN(n,r);return g_(t,e,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function C_(t,e,n,r,o){var i=QN(n,r);return g_(t,e,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function E_(t,e,n,r){return JN(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),yI(t,e,n,"clipSpacePos",r,3,20,0)&&yI(t,e,n,"uv",r,2,20,12)}function S_(t,e,n,r,o,i,a){var s,u,l;JN(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,l=a.internalFormatPackedFloat),s.set(i),JN(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,l,r,o,0,t.RGBA,u,s)}),JN(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function k_(t,e,n,r){JN(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?JN(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):JN(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),JN(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function N_(t,e,n,r,o){var i=t.createBuffer();JN(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var a=16*n*r;return JN(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),JN(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),JN(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}function I_(t,e,n){var r=t,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function R_(t,e,n,r,o){var i=XN(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return JN(t,e,function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function A_(t,e,n,r,o,i,a,s){var u=t,l=new Float32Array(function(t,e){var n=QN(i,a);return n[0]*n[1]*4}());return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function T_(t,e,n,r){var o=new Float32Array(n*r*4);return JN(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,o)}),o}var __=Object.freeze({createVertexShader:d_,createVertexBuffer:m_,createIndexBuffer:v_,createFloat32MatrixTexture:y_,createFloat16MatrixTexture:b_,createUnsignedBytesMatrixTexture:w_,createPackedMatrixTexture:x_,createFloat16PackedMatrixTexture:C_,bindVertexProgramAttributeStreams:E_,uploadDenseMatrixToTexture:S_,uploadPixelDataToTexture:k_,createBufferFromOutputTexture:N_,downloadFloat32MatrixFromBuffer:I_,downloadByteEncodedFloatMatrixFromOutputTexture:R_,downloadPackedMatrixFromBuffer:A_,downloadMatrixFromPackedOutputTexture:T_}),D_=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=xk.getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,qN(e,t)):this.gl=KN(e),1===xk.getNumber("WEBGL_VERSION"))this.textureFloatExtension=oI(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),xk.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=oI(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"));else if(BI(this.gl,"EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float");else{if(!BI(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=m_(this.gl,this.debug),this.indexBuffer=v_(this.gl,this.debug),this.framebuffer=gI(this.gl,this.debug),this.textureConfig=ZN(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return xk.getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;JN(e,this.debug,function(){return e.finish()}),JN(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),JN(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),JN(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),JN(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),JN(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),y_(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),b_(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),w_(this.gl,this.debug,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),k_(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),S_(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),C_(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),x_(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(SI(this.gl,this.debug,this.framebuffer),this.outputTexture=null),JN(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return R_(r.gl,r.debug,e,n,r.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,i){return A_(this.gl,t,0,0,0,o,i)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return I_(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=N_(this.gl,this.debug,e,n);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(xk.getBool("WEBGL_FENCE_API_ENABLED")){var o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(i,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=i}else xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return T_(r.gl,r.debug,e,n)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=aI(e,this.debug,t),r=d_(e,this.debug),o=cI(e,this.debug);return JN(e,this.debug,function(){return e.attachShader(o,r)}),JN(e,this.debug,function(){return e.attachShader(o,n)}),pI(e,this.debug,o),this.debug&&hI(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=E_(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&JN(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&hI(this.gl,this.debug,this.program),JN(this.gl,this.debug,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?wI(this.gl,this.debug,t,e):xI(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),JN(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),CI(this.gl,this.debug,0,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=QN(e,n);this.setOutputMatrixTextureDriver(t,r[0],r[1])},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&hI(this.gl,this.debug,this.program),kI(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),JN(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),JN(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=oI(this.gl,this.debug,2===xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return gk(this,void 0,void 0,function(){var e=this;return yk(this,function(n){switch(n.label){case 0:return[4,Lk(function(){return e.disposed||e.isQueryAvailable(t,xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Lk(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),EI(this.gl,this.debug,t,this.framebuffer),this.debug&&kI(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(EI(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&kI(this.gl)):SI(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;EI(r,this.debug,t,this.framebuffer),this.debug&&kI(r),this.outputTexture=t,JN(r,this.debug,function(){return r.viewport(0,0,e,n)}),JN(r,this.debug,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),JN(this.gl,this.debug,function(){return o.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function O_(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,o=e[n],i=o.shape;if(!Dk(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!Dk(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var M_=function(t,e,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;for(var r=n.inChannels,o=n.strideWidth,i=n.strideHeight,a=n.padInfo,s=n.outWidth,u=n.dilationWidth,l=n.dilationHeight,c=n.dataFormat,p=a.left,h=a.top,f=r*n.filterWidth,d=gT(),m="channelsLast"===c,v=m?0:1,g=m?1:2,y="",b=0;b<=1;b++)for(var w=0;w<=1;w++)y+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+s+")) * "+i+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+f+");\n\n            if(d0 < "+e[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+s+".) * "+o+". - "+p+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+f+".) / "+r+".));\n\n              if(d1 < "+e[g]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+r+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+d.output+" = result;\n      }\n    "},F_=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},P_=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},L_=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},B_=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(e*n-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},z_=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.effectiveFilterDepth,n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+e+";\n           wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(e*n*r-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+n+" * "+r+" +\n                  wR * "+r+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},U_=function(t,e,n,r,o,i,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var s=Math.ceil((n?t[1]:t[2])/2),u=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",f="";i&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",f="result = activation(result);");var d=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+c[0]+" * "+p[0]+");\n          result += ("+c[1]+" * "+p[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+d+"\n\n        "+f+"\n\n        setOutput(result);\n      }\n    "},V_=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),W_=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},j_=function(t){this.variableNames=["A"],this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=vT("rc",e),r=ET(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),i=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<t;a++)i=e[e.length-1-a]+","+i;n.push(i)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},H_=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,o=ET(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},G_=function(t,e,n){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});for(var r=t.length,o=ET(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=vT("rc",r),u=vT("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",p=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",d=0,m=1===r?2:4;d<m;d++)f+="\n        "+p[d]+"\n        if ("+h+") {\n          result["+d+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+d+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(f+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},q_=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var h="avg"===e,f="0.0";if(h||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+c+", "+p+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var d=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(d="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+c+", "+p+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+d+");\n      }\n    "}},K_=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,p=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===e,g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+f+", "+d+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+c+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+p+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+h+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+p+" * "+h+" +\n                      wR * "+h+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var b=4*Math.floor(r/4),w=r%4,x="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+f+", "+d+", "+m+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+p+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},$_=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,p="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===e?(a="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(a="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "},X_=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+yT(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+bT(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Y_=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Q_=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Z_=function(t,e,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var o=t[1],i=t[2],a=t[3];this.outputShape=[t[0],e,n,a];var s=[r&&e>1?o-1:o,r&&n>1?i-1:i],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/u[0]+",\n          "+s[1]/u[1]+",\n          "+s[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+"; \n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},J_=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,v=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},tD=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},eD=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=ET(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},nD=function(t,e){this.variableNames=["x"],this.usesPackedTextures=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=vT("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=ET(n);function s(n){var r=t.map(function(r,o){return function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",s(t)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},rD=function(t,e,n,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=ET(o.length),u=ET(i.length),l="";1===n?l="i":2===n&&(l="i, j");var c="";1===r?c="i":2===r&&(c="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+l+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+c+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},oD=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var p="";o%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+p+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},iD=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var l=ET(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},aD=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=ET(this.rank),r="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return sD.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map(function(t,e){return"sourceLoc."+sD[e]+" = start["+e+"] + coords."+sD[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),sD=["x","y","z","w","u","v"],uD=function(){function t(t){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=t,this.rank=t.length;var e=ET(this.rank),n=vT("coords",this.rank),r=vT("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+o+")",a="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(t,e){return"start["+e+"]"}).join()+");":t.map(function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+" \n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),lD=function(t,e,n,r){this.variableNames=["x"];var o=n.filter(function(t,e){return-1===r.indexOf(e)});this.outputShape=o;var i=n.length,a=ET(n.length),s=ET(o.length),u="";if(1===i)u="coords * strides + begin";else{var l=0;u=n.map(function(t,e){return-1===r.indexOf(e)?(l++,1===o.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(l-1)+"] * strides["+e+"] + begin["+e+"]"):"begin["+e+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+t+");\n      "+a+" strides = "+a+"("+e+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "},cD=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=pD(e,n),i=hD(t,o,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===jN.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===jN.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===jN.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===jN.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===jN.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=hD(e,pD(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function pD(t,e){if(t===WN.UPLOAD)return jN.PACKED_2X2_FLOAT32;if(t===WN.RENDER||null==t)return e?xk.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?jN.PACKED_2X2_FLOAT32:jN.PACKED_2X2_FLOAT16:xk.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?jN.UNPACKED_FLOAT32:jN.UNPACKED_FLOAT16;if(t===WN.DOWNLOAD||t===WN.PIXELS)return jN.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function hD(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var fD=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=ET(this.rank),i=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},dD=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=ET(this.rank),i=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},mD=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=ET(this.rank),i=mT("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},vD=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},gD="return x;",yD="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",bD="return x;",wD="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",xD=function(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},CD=function(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;var e=t.length,n=vT("rc",e),r=ET(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),i=n.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},ED={};function SD(t,e){if(void 0===e&&(e=!1),"linear"===t)return e?bD:gD;if("relu"===t)return e?wD:yD;if("prelu"===t)return e?MT:DT;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var kD=600,ND=function(){function t(t){if(this.gpgpu=t,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!xk.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var e=KN(xk.getNumber("WEBGL_VERSION"));this.binaryCache=(n=xk.getNumber("WEBGL_VERSION"))in ED?ED[n]:(ED[n]={},ED[n]),this.gpgpu=new D_(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;var n;this.textureManager=new cD(this.gpgpu),this.numMBBeforeWarning=null==xk.global.screen?1024:xk.global.screen.height*xk.global.screen.width*window.devicePixelRatio*kD/1024/1024,this.texData=new LA(this,UN)}return t.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n})},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[t.height,t.width],r=[t.height,t.width,e],o="undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement,i=t.data instanceof Uint8Array,a="undefined"!=typeof ImageData&&t instanceof ImageData,s="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement;if(!(o||i||a||s||u))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);if(u||s){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=$N(xk.getNumber("WEBGL_VERSION")).getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}var l,c,p=this.makeTensorHandle(n,"int32");if(this.texData.get(p.dataId).usage=WN.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(p.dataId),t),xk.getBool("WEBGL_PACK")){l=new p_(r);var h=this.makePackedTensor(l.outputShape,p.dtype);c=this.compileAndRun(l,[p],h)}else l=new c_(r),c=this.compileAndRun(l,[p]);return this.disposeData(p.dataId),c},t.prototype.makeTensorHandle=function(t,e){var n={};return this.register(n,t,e),{dataId:n,shape:t,dtype:e}},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");if(xk.getBool("DEBUG"))for(var n=0;n<e.length;n++){var r=e[n];if(!nI(r))throw Error("The value "+r+" cannot be represented on this device.")}var o=this.texData.get(t);if("complex64"===o.dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(t),o.usage=WN.UPLOAD,o.values=e},t.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors,i=e.shape;if(null!=e.slice){var a=new vD(i,"return x;"),s=this.compileAndRun(a,[{dataId:t,shape:i,dtype:r}]),u=this.readSync(s.dataId);return s.dispose(),u}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var l,c,p=null!=this.activeTimers;return p&&(l=sN()),c="complex64"===r?nT(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),p&&(this.downloadWaitMs+=sN()-l),this.convertAndCacheOnCPU(t,c)},t.prototype.read=function(t){return gk(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,l,c,p,h,f,d,m,v,g,y;return yk(this,function(b){switch(b.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(t){return n.push(t)})];if(r=this.texData.get(t),o=r.values,i=r.shape,a=r.dtype,s=r.complexTensors,null!=r.slice)return u=new vD(i,"return x;"),l=this.compileAndRun(u,[{dataId:t,shape:i,dtype:a}]),c=this.read(l.dataId),l.dispose(),[2,c];if(null!=o)return[2,this.convertAndCacheOnCPU(t)];if(!xk.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===xk.getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==a&&xk.get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(t),t=h.dataId,f=this.texData.get(h.dataId),p=(e=this.gpgpu).createBufferFromTexture.apply(e,[f.texture].concat(YN(i)))),this.pendingRead.set(t,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:b.sent(),b.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return m=b.sent(),d=nT(m[0],m[1]),[3,5];case 4:null==p?d=this.getValuesFromTexture(t):(v=_k(i),d=this.gpgpu.downloadFloat32MatrixFromBuffer(p,v),this.disposeData(t)),b.label=5;case 5:return g=this.convertAndCacheOnCPU(t,d),y=this.pendingRead.get(t),this.pendingRead.delete(t),y.forEach(function(t){return t(g)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,g]}})})},t.prototype.getValuesFromTexture=function(t){var e,n=this,r=this.texData.get(t),o=r.shape,i=r.dtype,a=r.isPacked,s=_k(o);if(xk.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),l=this.texData.get(u.dataId),c=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[l.texture].concat(YN(o))).subarray(0,s);return this.disposeData(u.dataId),c}var p=xk.getBool("WEBGL_PACK")&&!0===a,h=p?_I(o):o,f=this.makeTensorHandle(h,"float32");f.size=_k(o),this.texData.get(f.dataId).usage=WN.DOWNLOAD;var d=KI(function(){var e=p?new i_(h):new o_(h);return n.compileAndRun(e,[{shape:h,dtype:i,dataId:t}],f,null)}),m=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,s);return this.disposeData(f.dataId),v},t.prototype.time=function(t){return gk(this,void 0,void 0,function(){var e,n,r,o,i,a,s;return yk(this,function(u){switch(u.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),o=Tk(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),i=Tk(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return a=u.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:Nk(a),getExtraProfileInfo:function(){return a.map(function(t,e){return{name:i[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:sN(),endMs:null}},t.prototype.endTimer=function(t){return xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=sN(),t)},t.prototype.getQueryTime=function(t){return gk(this,void 0,void 0,function(){var e;return yk(this,function(n){return xk.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},t.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t))if(this.pendingRead.has(t))this.pendingDisposal.add(t);else if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}},t.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,o=e.texShape,i=e.usage,a=e.isPacked,s=e.slice,u=s&&s.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,i,a)));var c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getCPUBackend=function(){return xk.getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=UN.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(t,e){var n=this.makeOutputArray(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:UN.keep(t.clone()),imag:UN.keep(e.clone())},n},t.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},t.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===_k(n))return mR([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,o=DA(t.shape,e,n);if(r||!o){var i=xk.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uD(n):new aD(n),a=i.getCustomSetupFunc(e);return this.compileAndRun(i,[t],null,a)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},t.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),o=CN.make(n,{},t.dtype,this),i=this.texData.get(o.dataId);Object.assign(i,r),i.shape=n,i.dtype=t.dtype;var a=OA(e,t.strides);r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r,o,i,a,s,u);var l=AA(t.shape,e,n,r,o,i,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return-1===h.indexOf(e)});if(f.some(function(t){return 0===t}))return mR([],f);var d=new lD(c,r,p,h);return this.compileAndRun(d,[t])},t.prototype.reverse=function(t,e){var n=xk.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nD(t.shape,e):new eD(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var n=t.map(function(t){return fR(t)}),r=t.map(function(t){return dR(t)});return hR(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>xk.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),i=this.concat(t.slice(0,o),e),a=this.concat(t.slice(o),e);return this.concat([i,a],e)}if(xk.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var s=new UT(t.map(function(t){return t.shape}),e);return this.compileAndRun(s,t)}var u=cR(t.map(function(t){return t.shape}),e),l=t.map(function(t){return t.as2D(-1,_k(t.shape.slice(e)))}),c=new zT(l.map(function(t){return t.shape}));return this.compileAndRun(c,l).reshape(u)},t.prototype.neg=function(t){var e=new vD(t.shape,"return -x;");return this.compileAndRun(e,[t])},t.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===i)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===i?t:t.as3D(s,a,1),l=1===i?2:1,c=1===i?e.as3D(s,1,a):e;return this.multiply(u,c).sum(l,!0)}var p=_N(t.dtype,e.dtype),h=new U_(t.shape,[s,o,i],n,r),f=this.makePackedTensor(h.outputShape,p);return this.compileAndRun(h,[t,e],f)},t.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,i=t.bias,a=t.activation,s=t.preluActivationWeights,u=r?e.shape[2]:e.shape[1],l=o?n.shape[1]:n.shape[2],c=e.shape[0],p=_N(e.dtype,n.dtype),h=null!=i,f=null!=s,d=a?SD(a,!0):null,m=new U_(e.shape,[c,u,l],r,o,h,d,f),v=this.makePackedTensor(m.outputShape,p),g=[e,n];return i&&g.push(i),s&&g.push(s),this.compileAndRun(m,g,v)},t.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new _T("return areal * breal - aimag * bimag;",t.shape,e.shape),i=new _T("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag),this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(o,a),u=this.compileAndRun(i,a),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"return a * b;",t.dtype);var c=new OT("return a * b;",t.shape,e.shape),p=this.makeOutputArray(c.outputShape,t.dtype);return this.compileAndRun(c,[t,e],p)},t.prototype.batchNormalization=function(t,e,n,r,o,i){var a=[t,e,n],s=null;null!=i&&(s=i.shape,a.push(i));var u=null;if(null!=o&&(u=o.shape,a.push(o)),xk.getBool("WEBGL_PACK_NORMALIZATION")){var l=new TT(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(l,a)}var c=new AT(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(c,a)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){var i=xk.getBool("WEBGL_PACK_NORMALIZATION")?new L_(t.shape,e,n,r,o):new F_(t.shape,e,n,r,o);return this.compileAndRun(i,[t])},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){var s=new P_(e.shape,r,o,i,a);return this.compileAndRun(s,[e,n,t])},t.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map(function(t){return cN(t)});return lT(KR(t.shape,t.dtype,n),e)}var r=new fD(t.shape,e);return this.compileAndRun(r,[t])},t.prototype.pad=function(t,e,n){var r=xk.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new G_(t.shape,e,n):new H_(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=xk.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mD(t.shape,e):new dD(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new h_(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},t.prototype.batchToSpaceND=function(t,e,n){Ik(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=wA(t.shape,e,r),i=xA(o.length,e.length),a=CA(t.shape,e,r),s=EA(n,e.length),u=SA(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){Ik(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=wA(a.shape,e,r,!1),u=xA(s.length,e.length,!1),l=CA(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(l)},t.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],i=IA(o),a=new $_({windowSize:i,inSize:o,batchSize:r},e),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],n);return this.compileAndRun(a,[t],u),1===u.shape[1]?u:this.reduce(u,e,n)},t.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var i=IA(o),a=new dT({windowSize:i,inSize:o,batchSize:r},e,null==n),s=a.outputShape,u=this.makeOutputArray([s[0],s[1]],"int32"),l=[t];return null!=n&&l.push(n),this.compileAndRun(a,l,u),1===u.shape[1]?u:this.argReduce(t,e,u)},t.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,o=IA(r[r.length-1]),i=new NT(r,o,e,null==n),a=this.makePackedTensor(i.outputShape,"int32");return this.compileAndRun(i,null==n?[t]:[t,n],a),a.rank===t.rank?this.argReducePacked(t,e,a):a},t.prototype.sum=function(t,e){iR("sum",e,t.rank);var n=rR(t.shape,e),r=n[0],o=_k(n[1]),i=t.as2D(-1,o),a=DN(t.dtype);return this.reduce(i,"sum",a).reshape(r)},t.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=rR(t.shape,e),r=n[0],o=_k(n[1]),i=t.as2D(-1,o),a=DN(t.dtype);return this.reduce(i,"prod",a).reshape(r)},t.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=aR([r],t.rank),i=t;null!=o&&(i=t.transpose(o),r=uR(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],o=t.length,i=0;i<o;i++)r.push(i!==e?t[i]:n);return r}(i.shape,r,n),s=_k([i.shape[r]]),u=i.as2D(-1,s),l=DN(t.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",e,l,n).reshape(a);return null!=o&&(c=c.transpose(sR(o))),c},t.prototype.segOpCompute=function(t,e,n,r,o){var i=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=NA?(n=t,r=!0):n=eN(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=eN(t,n+1);return n}(a,o),u=new oD({windowSize:s,inSize:a,batchSize:i,numSegments:o},e),l=u.outputShape,c=this.makeOutputArray([l[0],l[1]],r);return this.compileAndRun(u,[t,n],c),c.shape[1]===o?c:(n=NR(0,o).tile([a/s]),this.segOpCompute(c,e,n,r,o))},t.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(iR("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!xk.getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=rR(t.shape,r),i=o[0],a=_k(o[1]),s=t.as2D(-1,a);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(t,n)},t.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},t.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},t.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new ZT(t.shape,n,r);return this.compileAndRun(o,[t])},t.prototype.equal=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new OT("return float(a == b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.notEqual=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new OT("return float(a != b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new OT("return float(a < b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.lessEqual=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new OT("return float(a <= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new OT("return float(a > b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greaterEqual=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new OT("return float(a >= b);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalNot=function(t){var e=new vD(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},t.prototype.logicalAnd=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new OT("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalOr=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new OT("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.select=function(t,e,n){var r=new iD(t.rank,e.shape,e.rank),o=this.makeOutputArray(r.outputShape,_N(e.dtype,n.dtype));return this.compileAndRun(r,[t,e,n],o)},t.prototype.where=function(t){YI("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return pT(t.shape,e)},t.prototype.topk=function(t,e,n){return cT(t.dataSync(),t.shape,t.dtype,e)},t.prototype.min=function(t,e){iR("min",e,t.rank);var n=rR(t.shape,e),r=n[0],o=_k(n[1]),i=t.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FT("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new OT("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.mod=function(t,e){var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FT("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new OT("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);iR("max",e,t.rank);var n=rR(t.shape,e),r=n[0],o=_k(n[1]),i=t.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FT("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new OT("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.all=function(t,e){iR("all",e,t.rank);var n=rR(t.shape,e),r=n[0],o=_k(n[1]),i=t.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(t,e){iR("any",e,t.rank);var n=rR(t.shape,e),r=n[0],o=_k(n[1]),i=t.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.squaredDifference=function(t,e){var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FT("return (a - b) * (a - b);",t.shape,e.shape):new OT("return (a - b) * (a - b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.realDivide=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(b.x == 0.0) {\n    result.x = NAN;\n  } else if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(b.y == 0.0) {\n    result.y = NAN;\n  } else if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(b.z == 0.0) {\n    result.z = NAN;\n  } else if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(b.w == 0.0) {\n    result.w = NAN;\n  } else if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new OT("\nif (b == 0.0) {\n  return NAN;\n}\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t,e],r)},t.prototype.floorDiv=function(t,e){if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new OT("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[t,e],r)},t.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,"return a + b;");if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=_N(t.dtype,e.dtype);if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"return a + b;",n);var r=new OT("return a + b;",t.shape,e.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[t,e],o)},t.prototype.packedBinaryOp=function(t,e,n,r,o){void 0===o&&(o=!1);var i=new FT(n,t.shape,e.shape,o),a=this.makePackedTensor(i.outputShape,r);return this.compileAndRun(i,[t,e],a)},t.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),i=this.texData.get(e.dataId),a=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map(function(o){var i=o[0],a=o[1],s=r.makeComplexComponentTensorHandle(t,i),u=r.makeComplexComponentTensorHandle(e,a),l=new OT(n,t.shape,e.shape),c=r.makeOutputArray(l.outputShape,_N(i.dtype,a.dtype));return r.compileAndRun(l,[s,u],c)}),s=a[0],u=a[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorHandle=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},t.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>xk.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var o=t.map(function(t){return t.dtype}).reduce(function(t,e){return _N(t,e)}),i=t.map(function(t){return t.shape}),a=xk.getBool("WEBGL_PACK"),s=a?new fT(t[0].shape,i):new hT(t[0].shape,i),u=a?this.makePackedTensor(s.outputShape,o):this.makeOutputArray(s.outputShape,o);return this.compileAndRun(s,t,u)},t.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,"return a - b;");if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=_N(t.dtype,e.dtype);if(xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"return a - b;",t.dtype);var r=new OT("return a - b;",t.shape,e.shape),o=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[t,e],o)},t.prototype.pow=function(t,e){var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS"),r=n?new FT("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new OT("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),o=_N(t.dtype,e.dtype),i=n?this.makePackedTensor(r.outputShape,o):this.makeOutputArray(r.outputShape,o);return this.compileAndRun(r,[t,e],i)},t.prototype.ceil=function(t){var e=new vD(t.shape,"return ceil(x);");return this.compileAndRun(e,[t])},t.prototype.floor=function(t){var e=new vD(t.shape,"return floor(x);");return this.compileAndRun(e,[t])},t.prototype.sign=function(t){var e=new vD(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},t.prototype.isNaN=function(t){var e=new vD(t.shape,"return float(isnan(x));"),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},t.prototype.isInf=function(t){var e=new vD(t.shape,"return float(isinf(x));"),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},t.prototype.isFinite=function(t){var e=new vD(t.shape,"return float(!isnan(x) && !isinf(x));"),n=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[t],n)},t.prototype.round=function(t){var e=new vD(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},t.prototype.exp=function(t){var e;return e=xk.getBool("WEBGL_PACK")?new xD(t.shape,"return exp(x);"):new vD(t.shape,"return exp(x);"),this.compileAndRun(e,[t])},t.prototype.expm1=function(t){var e=new vD(t.shape,"return exp(x) - 1.0;");return this.compileAndRun(e,[t])},t.prototype.log=function(t){var e;return e=xk.getBool("WEBGL_PACK")?new xD(t.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new vD(t.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(e,[t])},t.prototype.log1p=function(t){var e=new vD(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},t.prototype.sqrt=function(t){var e=new vD(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},t.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new vD(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},t.prototype.square=function(t){var e=new vD(t.shape,"return x * x;");return this.compileAndRun(e,[t])},t.prototype.reciprocal=function(t){var e=new vD(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},t.prototype.relu=function(t){var e;return e=xk.getBool("WEBGL_PACK")?new xD(t.shape,wD):new vD(t.shape,yD),this.compileAndRun(e,[t])},t.prototype.prelu=function(t,e){var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FT(MT,t.shape,e.shape):new OT(DT,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.elu=function(t){var e=new vD(t.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[t])},t.prototype.eluDer=function(t,e){var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FT("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new OT("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.selu=function(t){var e=new vD(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},t.prototype.int=function(t){var e=new vD(t.shape,"return float(int(x));"),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},t.prototype.clip=function(t,e,n){var r,o=(r=xk.getBool("WEBGL_PACK_CLIP")?new LT(t.shape):new PT(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,o)},t.prototype.abs=function(t){var e=new vD(t.shape,"return abs(x);");return this.compileAndRun(e,[t])},t.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new BT(t.shape),r=[this.makeComplexComponentTensorHandle(t,e.complexTensors.real),this.makeComplexComponentTensorHandle(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(t){var e=new vD(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},t.prototype.softplus=function(t){var e=new vD(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},t.prototype.sin=function(t){var e=new vD(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},t.prototype.cos=function(t){var e=new vD(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},t.prototype.tan=function(t){var e=new vD(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},t.prototype.asin=function(t){var e=new vD(t.shape,"return asin(x);");return this.compileAndRun(e,[t])},t.prototype.acos=function(t){var e=new vD(t.shape,"return acos(x);");return this.compileAndRun(e,[t])},t.prototype.atan=function(t){var e=new vD(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},t.prototype.atan2=function(t,e){var n=xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new FT("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new OT("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.sinh=function(t){var e=new vD(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.cosh=function(t){var e=new vD(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},t.prototype.tanh=function(t){var e=new vD(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},t.prototype.asinh=function(t){var e=new vD(t.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},t.prototype.acosh=function(t){var e=new vD(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])},t.prototype.atanh=function(t){var e=new vD(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])},t.prototype.erf=function(t){var e=new vD(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(e,[t])},t.prototype.step=function(t,e){var n=new vD(t.shape,function(t){return void 0===t&&(t=0),"if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},t.prototype.conv2dByMatMul=function(t,e,n,r,o,i){var a=t.shape,s=this.texData.get(t.dataId),u="channelsLast"===n.dataFormat,l=a[2]%2!=0&&!!s.isPacked;if((1==a[0]*a[1]*a[2]||1===n.outChannels)&&n.inChannels>1e3||!xk.getBool("WEBGL_LAZILY_UNPACK")||!xk.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!l){var c=this.reshape(t,[1,u?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],n.inChannels]),p=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:c,b:p,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),n.outShape)}var h=CN.make([1,u?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),n.inChannels],{dataId:t.dataId},t.dtype,this),f=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,Ik(MI(s.shape,h.shape),function(){return"packed reshape "+s.shape+" to "+h.shape+" isn't free"});var d=this.reshape(e,[1,n.inChannels,n.outChannels]),m=this.fusedBatchMatMul({a:h,b:d,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),v=this.texData.get(m.dataId);return Ik(v.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=f,v.shape=n.outShape,CN.make(n.outShape,{dataId:m.dataId},m.dtype,this)},t.prototype.conv2dWithIm2Row=function(t,e,n,r,o,i){var a=n.outWidth,s=n.outHeight,u="channelsLast"===n.dataFormat,l=n.filterWidth*n.filterHeight*n.inChannels,c=s*a,p=[l,c],h=t.squeeze([0]),f=e.reshape([1,l,-1]),d=new M_(p,h.shape,n),m=this.compileAndRun(d,[h]).reshape([1,p[0],p[1]]),v=null!=r,g=null!=i,y=o?SD(o,!0):null,b=new U_(m.shape,[1,c,n.outChannels],!0,!1,v,y,g),w=[m,f];return r&&w.push(r),g&&w.push(i),this.compileAndRun(b,w).reshape(u?[1,s,a,n.outChannels]:[1,n.outChannels,s,a])},t.prototype.fusedConv2d=function(t,e,n,r,o,i){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n,r,o,i);if(xk.getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n,r,o,i);var a=null!=r,s=null!=i,u=o?SD(o,!1):null,l=new KT(n,a,u,s),c=[t,e];return r&&c.push(r),i&&c.push(i),this.compileAndRun(l,c)},t.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(xk.getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new KT(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerInput=function(t,e,n){var r=new WT(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerFilter=function(t,e,n){var r=new VT(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2D=function(t,e,n){var r;return xk.getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new YT(n),this.compileAndRun(r,[t,e],this.makePackedTensor(n.outShape,t.dtype))):(r=new XT(n),this.compileAndRun(r,[t,e]))},t.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new qT(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new GT(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3d=function(t,e,n){var r=new $T(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerInput=function(t,e,n){var r=new HT(n);return this.compileAndRun(r,[t,e])},t.prototype.conv3dDerFilter=function(t,e,n){var r=new jT(n);return this.compileAndRun(r,[t,e])},t.prototype.maxPool=function(t,e){var n=new q_(e,"max",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.avgPool=function(t,e){var n=new q_(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPoolBackprop=function(t,e,n,r){var o=new q_(r,"max",!0),i=this.compileAndRun(o,[e]),a=new B_(r),s=this.makeOutputArray(a.outputShape,e.dtype),u=this.compileAndRun(a,[t,i],s);return i.dispose(),u},t.prototype.avgPoolBackprop=function(t,e,n){var r=new IT(n),o=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],o)},t.prototype.cast=function(t,e){return JA(t,e,this)},t.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},t.prototype.avgPool3d=function(t,e){var n=new K_(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.avgPool3dBackprop=function(t,e,n){var r=new RT(n),o=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],o)},t.prototype.maxPool3d=function(t,e){var n=new K_(e,"max",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPool3dBackprop=function(t,e,n,r){var o=new K_(r,"max",!0),i=this.compileAndRun(o,[e]),a=new z_(r),s=this.makeOutputArray(a.outputShape,e.dtype),u=this.compileAndRun(a,[t,i],s);return i.dispose(),u},t.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);return!n.isPacked||MI(t.shape,e)||null!==n.texture&&MI(n.shape,e)?tT(t,e):this.packedReshape(t,e)},t.prototype.resizeBilinear=function(t,e,n,r){var o=xk.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Z_(t.shape,e,n,r):new Q_(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Y_(t,e,n);return this.compileAndRun(r,[t])},t.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new tD(t.shape,e,n,r);return this.compileAndRun(o,[t])},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new J_(t,e,n);return this.compileAndRun(r,[t])},t.prototype.multinomial=function(t,e,n,r){var o=e?t:FA(t),i=new V_(o.shape[0],o.shape[1],n),a=this.makeOutputArray(i.outputShape,"int32"),s=i.getCustomSetupFunc(r);return this.compileAndRun(i,[o],a,s)},t.prototype.oneHot=function(t,e,n,r){var o=new W_(t.size,e,n,r);return this.compileAndRun(o,[t])},t.prototype.diag=function(t){var e=new r_(t.size);return this.compileAndRun(e,[t])},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return YI("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),aT(t.dataSync(),e.dataSync(),n,r,o)},t.prototype.cropAndResize=function(t,e,n,r,o,i){var a=new QT(t.shape,e.shape,r,o,i);return this.compileAndRun(a,[t,e,n])},t.prototype.depthToSpace=function(t,e,n){Ik(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var r=t.shape[0],o=("NHWC"===n?t.shape[1]:t.shape[2])*e,i=("NHWC"===n?t.shape[2]:t.shape[3])*e,a=("NHWC"===n?t.shape[3]:t.shape[1])/(e*e),s=new n_("NHWC"===n?[r,o,i,a]:[r,a,o,i],e,n);return this.compileAndRun(s,[t])},t.prototype.split=function(t,e,n){return uT(t,e,n)},t.prototype.scatterND=function(t,e,n){var r=RA(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/a,a],c=t.reshape([i,o]),p=e.reshape([i,a]);if(0===u)return tT(mR([]),n);var h=gR(0),f=new rD(i,o,c.rank,p.rank,s,l);return this.compileAndRun(f,[p,c,h]).reshape(n)},t.prototype.sparseToDense=function(t,e,n,r){var o=RA(0,t,n),i=new rD(o.numUpdates,o.sliceRank,t.rank,e.rank,o.strides,[o.outputSize,1],!1);return this.compileAndRun(i,[e,t,r]).reshape(n)},t.prototype.fft=function(t){return this.fftImpl(t,!1)},t.prototype.ifft=function(t){return this.fftImpl(t,!0)},t.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new u_("return real * expR - imag * expI;",t.shape,e),o=new u_("return real * expI + imag * expR;",t.shape,e),i=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)],a=this.compileAndRun(r,i),s=this.compileAndRun(o,i),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=kA(t,e),i=o[0],a=o[1],s=o[2],u=o[3],l=e.reshape([a,r]),c=t.reshape([t.size/s,s]),p=new f_(r,u,[a,s]);return this.compileAndRun(p,[c,l]).reshape(i)},t.prototype.fill=function(t,e,n){if("string"===(n=n||Jk(e))){var r=Wk(n,_k(t));return r.fill(e),CN.make(t,{values:r},n)}var o=new l_(t,e),i=o.getCustomSetupFunc(e),a=this.makeOutputArray(t,n);return this.compileAndRun(o,[],a,i)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},t.prototype.linspace=function(t,e,n){return eT(t,e,n)},t.prototype.makeOutputArray=function(t,e){return CN.make(t,{},e,this)},t.prototype.makePackedTensor=function(t,e){var n=CN.make(t,{},e,this);return this.texData.get(n.dataId).isPacked=!0,n},t.prototype.unpackTensor=function(t){var e=new CD(t.shape);return this.compileAndRun(e,[t],CN.make(e.outputShape,{},t.dtype,this))},t.prototype.packTensor=function(t){var e=new j_(t.shape);return this.compileAndRun(e,[t],this.makePackedTensor(t.shape,t.dtype),null,!0)},t.prototype.packedReshape=function(t,e){var n=t.reshape([AI(t.shape)].concat(TI(t.shape))),r=[AI(e)].concat(TI(e)),o=new X_(r,n.shape);return this.compileAndRun(o,[n]).reshape(e)},t.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,o=n.shape,i=n.dtype,a=_I(o),s=YN(o),u=this.makeTensorHandle(o,"float32");return this.texData.get(u.dataId).isPacked=!0,this.texData.get(u.dataId).dtype=i,this.texData.get(u.dataId).texShape=s.map(function(t){return 2*t}),e=r?new e_(a,s):new t_(a,s),this.compileAndRun(e,[{shape:a,dtype:i,dataId:t}],u,null,!0),u},t.prototype.compileAndRun=function(t,e,n,r,o){var i=this;if(void 0===o&&(o=!1),null==n&&(n=t.usesPackedTextures?this.makePackedTensor(t.outputShape,e[0].dtype):this.makeOutputArray(t.outputShape,e[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=Vk(n.dtype,0),n;var a=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(e.dataId);if(null==n.texture){if(!t.usesPackedTextures&&_k(e.shape)<=xk.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.usesPackedTextures&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.usesPackedTextures)e=n.isPacked?i.unpackTensor(e):i.packTensor(e),n=i.texData.get(e.dataId);else if(n.isPacked&&!MI(n.shape,e.shape)){var r=e,o=e.shape;e.shape=n.shape,e=i.packedReshape(e,o),n=i.texData.get(e.dataId),r.shape=o}return i.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,u={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},l=function(t,e,n){var r="";return a.concat(u).forEach(function(t){r+=t.shape+"_"+(t.isUniform?"uniform":t.texData.texShape)+"_"+(null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0)}),t.constructor.name+"_"+r+"_"+t.userCode}(t),c=this.getAndSaveBinary(l,function(){return function(t,e,n,r){var o=e.userCode,i=n.map(function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}}),a=i.map(function(t){return t.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=function(t,e,n,r){var o=[];t.forEach(function(t){var e=_k(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))});var i,a,s=o.join("\n"),u=t.map(function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";return r+=n?function t(e){var n;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=e.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+gT().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=gT();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],s=gT();if(null!=o&&Dk(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=ST(e,n.slice(1));return"\n        "+t(s)+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+kT(["b","row","col"],[1,2])+");\n        }\n      "}var u=a[0],l=a[1],c=Math.ceil(n[2]/2);return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+l+", "+c*Math.ceil(n[1]/2)+", "+c+", b, row, col);\n      return "+gT().texture2D+"("+r+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=a[0],u=a[1],l=Math.ceil(e[n-1]/2),c=l*Math.ceil(e[n-2]/2),p="int b, int row, int col",h="b * "+c+" + (row / 2) * "+l+" + (col / 2)",f=2;f<n-1;f++)p="int b"+f+", "+p,h="b"+f+" * "+(c*=e[n-f-1])+" + "+h;return"\n    vec4 "+o+"("+p+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+gT().texture2D+"("+r+", uv);\n    }\n  "}(e)}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape;if(1===r[0]&&1===r[1])return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var o=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+xT(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+CT(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=xT(e);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Dk(n,i))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+i[0]+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var a=Uk(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var l=ST(e,s);return"\n      "+t(l)+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+kT(["row","col"],u)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+CT(e)+"\n      }\n    ";var c=i[0],p=i[1],h=xT(r);return 1===p?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===c?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+p+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+h+";\n    vec2 uv = uvFromFlat("+c+", "+p+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],a=n[2],s=Uk(n),u=s.newShape,l=s.keptDims;if(u.length<n.length){var c=ST(e,u);return"\n        "+t(c)+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+kT(["row","col","depth"],l)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+CT(e)+"\n      }\n    ";var p=e.shapeInfo.texShape,h=p[0],f=p[1],d=e.shapeInfo.flatOffset;return f===i&&null==d?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+f+".0, "+h+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":f===a&&null==d?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+".0, "+h+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+xT(r)+";\n        vec2 uv = uvFromFlat("+h+", "+f+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],a=n[2]*i,s=n[1]*a,u=Uk(n),l=u.newShape,c=u.keptDims;if(l.length<n.length){var p=ST(e,l);return"\n      "+t(p)+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+kT(["row","col","depth","depth2"],c)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+a+", "+i+", 1)));\n        "+CT(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,d=f[0],m=f[1];return m===s&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===i&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+m+", index + "+xT(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[4],a=n[3]*i,s=n[2]*a,u=n[1]*s,l=Uk(n),c=l.newShape,p=l.keptDims;if(c.length<n.length){var h=ST(e,c);return"\n      "+t(h)+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+kT(["row","col","depth","depth2","depth3"],p)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+a+", "+i+")) +\n          depth3;\n        "+CT(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,m=d[0],v=d[1];return v===u&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===i&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+xT(r)+";\n      vec2 uv = uvFromFlat("+m+", "+v+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=Uk(n),a=i.newShape,s=i.keptDims;if(a.length<n.length){var u=ST(e,a);return"\n      "+t(u)+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+kT(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var l=n[5],c=n[4]*l,p=n[3]*c,h=n[2]*p,f=n[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+h+", "+p+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+CT(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];return g===f&&null==d?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+p+", "+c+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===l&&null==d?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+h+" + depth * "+p+" +\n          depth2 * "+c+" + depth3 * "+l+" + depth4 + "+xT(r)+";\n      vec2 uv = uvFromFlat("+v+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t),t.shapeInfo.logicalShape.length<=e.logicalShape.length&&(r+=n?function(t,e){var n,r,o=t.name,i=o.charAt(0).toUpperCase()+o.slice(1),a="get"+i+"AtOutCoords",s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length,l=BA(t.shapeInfo.logicalShape,e.logicalShape),c=ET(u),p=u-s,h=["x","y","z","w","u","v"];n=0===s?"":u<2&&l.length>=1?"coords = 0;":l.map(function(t){return"coords."+h[t+p]+" = 0;"}).join("\n"),r=u<2&&s>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+h[e+p]}).join(", ");var f="return outputValue;",d=1===_k(t.shapeInfo.logicalShape),m=1===_k(e.logicalShape);if(1!==s||d||m){if(d&&!m)f=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){var v=s-2,g=s-1;l.indexOf(v)>-1&&l.indexOf(g)>-1?f="return vec4(outputValue.x);":l.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+r+");\n      "+f+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,a=e.logicalShape.length;if(!t.shapeInfo.isUniform&&i===a&&null==t.shapeInfo.flatOffset&&Dk(t.shapeInfo.texShape,e.texShape))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var s=ET(a),u=BA(t.shapeInfo.logicalShape,e.logicalShape),l=a-i,c=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+s+" coords = getOutputCoords();\n      "+(0===i?"":a<2&&u.length>=1?"coords = 0;":u.map(function(t){return"coords."+c[t+l]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(a<2&&i>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+c[e+l]}).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)}).join("\n"),l=e.texShape,c=gT(),p="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+c.texture2D+"(textureSampler, uv).r;\n    }\n  ",h=c.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+c.varyingFs+" vec2 resultUV;\n    "+c.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    #define isnan(value) isnan_custom(value)\n    "+c.defineSpecialNaN+"\n    bvec4 isnan_custom(vec4 val) {\n      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n    }\n\n    "+c.defineSpecialInf+"\n    "+c.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    \nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  ";return e.isPacked?(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Dk(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=t,r=e,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=(i=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+i+");\n      int c = imod(index, "+i+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,a="",s="b, r, c",u=2;u<t.length-1;u++)a="\n      int b"+u+" = index / "+(i*=t[t.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var n,r,o,i,a}(e.logicalShape,l),a="\n    void setOutput(vec4 val) {\n      "+c.output+" = val;\n    }\n  "):(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return Dk(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=e,r=yT(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=yT(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=yT(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=yT(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r}(e.logicalShape,l),a="\n    void setOutput(float val) {\n      "+c.output+" = vec4(val, 0, 0, 0);\n    }\n  "),r&&(h+="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n"),[h,p,a,s,i,u,n].join("\n")}(i,s,o,e.usesPackedTextures),l=t.createProgram(u),c=null,p=t.getUniformLocation(l,"NAN",!1);1===xk.getNumber("WEBGL_VERSION")&&(c=t.getUniformLocation(l,"INFINITY",!1));for(var h={},f=0;f<e.variableNames.length;f++){var d=e.variableNames[f];h[d]=t.getUniformLocation(l,d,!1),h["offset"+d]=t.getUniformLocation(l,"offset"+d,!1)}return{program:e,source:u,webGLProgram:l,uniformLocations:h,inShapeInfos:a,outShapeInfo:s,infLoc:c,nanLoc:p}}(i.gpgpu,t,a,u)}),p=null!=this.activeTimers;return p&&(s=this.startTimer()),function(t,e,n,r,o){O_(e.inShapeInfos,n),O_([e.outShapeInfo],[r]);var i=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,a[0],a[1]):t.setOutputMatrixTexture(i,a[0],a[1]),t.setProgram(e.webGLProgram),1===xk.getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(function(n,r){var o=e.program.variableNames[r],i=e.uniformLocations[o],a=e.uniformLocations["offset"+o];if(null!=i)if(n.isUniform)if(_k(n.shape)<2)t.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,i,r)}),null!=o&&o(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,c,a,u,r),p&&(s=this.endTimer(s),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(s)})),!xk.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(n.dataId).isPacked&&!1===o?this.unpackTensor(n):n},t.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),null!=this.canvas&&null!=this.canvas.remove?this.canvas.remove():this.canvas=null,null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=KI(function(){var e=xk.getBool("DEBUG");xk.set("DEBUG",!1);var n=t.abs(gR(1e-8)).dataSync()[0];return xk.set("DEBUG",e),n>0?32:16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.values,a=n.usage,s=n.isPacked;if(null==n.texture){var u,l=null!=this.activeTimers;l&&(u=sN());var c=n.texShape;if(null==c&&(c=DI(r,s),n.texShape=c),null!=i){var p=_I(r),h=void 0,f=c[1],d=c[0],m=i instanceof Uint8Array;s?(f=(e=QN(c[0],c[1]))[0],h=new s_(p,[d=e[1],f],m)):h=new a_(p,[d,f],m);var v=this.makeTensorHandle([d,f],o);this.texData.get(v.dataId).usage=m?WN.PIXELS:WN.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),f,d,i);var g=this.makeTensorHandle(h.outputShape,v.dtype);g.size=_k(h.outputShape),this.texData.get(g.dataId).isPacked=s,this.compileAndRun(h,[v],g);var y=this.texData.get(g.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(v.dataId),this.texData.delete(g.dataId),n.values=null,l&&(this.uploadWaitMs+=sN()-u)}else{var b=this.acquireTexture(c,a,o,s);n.texture=b}}},t.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},t.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,r)},t.prototype.computeBytes=function(t,e){return t[0]*t[1]*$k(e)},t}();VN()&&UN.registerBackend("webgl",function(){return new ND},2);var ID=pR({abs_:function(t){var e=JI(t,"x","abs");return"complex64"===e.dtype?UN.runKernel(function(t){return t.complexAbs(e)},{$x:e}):UN.runKernel(function(t,n){var r=t.abs(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.toFloat().step(-1))}}})}}),RD=pR({acos_:function(t){var e=JI(t,"x","acos");return UN.runKernel(function(t,n){var r=t.acos(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(gR(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),AD=pR({acosh_:function(t){var e=JI(t,"x","acosh");return UN.runKernel(function(t,n){var r=t.acosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),TD=pR({asin_:function(t){var e=JI(t,"x","asin");return UN.runKernel(function(t,n){var r=t.asin(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(gR(1).sub(n.toFloat().square()).sqrt())}}})}}),_D=pR({asinh_:function(t){var e=JI(t,"x","asinh");return UN.runKernel(function(t,n){var r=t.asinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(gR(1).add(n.toFloat().square()).sqrt())}}})}}),DD=pR({atan_:function(t){var e=JI(t,"x","atan");return UN.runKernel(function(t,n){var r=t.atan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}})}}),OD=pR({atanh_:function(t){var e=JI(t,"x","atanh");return UN.runKernel(function(t,n){var r=t.atanh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(gR(1).sub(n.toFloat().square()))}}})}}),MD=pR({ceil_:function(t){var e=JI(t,"x","ceil");return UN.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return RR(t)}}})}}),FD=pR({clipByValue_:function(t,e,n){var r=JI(t,"x","clipByValue");return Ik(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."}),UN.runKernel(function(t,o){var i=t.clip(r,e,n);return o([r]),i},{$x:r},function(t,r){var o=r[0];return{$x:function(){return t.where(o.greaterEqual(e).logicalAnd(o.lessEqual(n)),RR(t))}}})}}),PD=pR({cos_:function(t){var e=JI(t,"x","cos");return UN.runKernel(function(t,n){var r=t.cos(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sin().neg().mul(t)}}})}}),LD=pR({cosh_:function(t){var e=JI(t,"x","cosh");return UN.runKernel(function(t,n){var r=t.cosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}})}}),BD=pR({erf_:function(t){var e=JI(t,"x","erf");return Ik("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),UN.runKernel(function(t,n){var r=t.erf(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),zD=pR({exp_:function(t){var e=JI(t,"x","exp");return UN.runKernel(function(t,n){var r=t.exp(e);return n([r]),r},{$x:e},function(t,e){return{$x:function(){return t.mulStrict(e[0])}}})}}),UD=pR({expm1_:function(t){var e=JI(t,"x","expm1");return UN.runKernel(function(t,n){var r=t.expm1(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}})}}),VD=pR({floor_:function(t){var e=JI(t,"x","floor");return UN.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return RR(t)}}})}}),WD=pR({log_:function(t){var e=JI(t,"x","log");return UN.runKernel(function(t,n){var r=t.log(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat())}}})}}),jD=pR({log1p_:function(t){var e=JI(t,"x","log1p");return UN.runKernel(function(t,n){var r=t.log1p(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}})}}),HD=pR({logSigmoid_:function(t){var e=JI(t,"x","logSigmoid");return UN.runKernel(function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}})}}),GD=pR({neg_:function(t){var e=JI(t,"x","neg");return UN.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),qD=pR({reciprocal_:function(t){var e=JI(t,"x","reciprocal");return UN.runKernel(function(t,n){var r=t.reciprocal(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}})}}),KD=pR({round_:function(t){var e=JI(t,"x","round");return UN.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return RR(t)}}})}}),$D=pR({rsqrt_:function(t){var e=JI(t,"x","rsqrt");return UN.runKernel(function(t,n){var r=t.rsqrt(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}})}}),XD=pR({sigmoid_:function(t){var e=JI(t,"x","sigmoid");return UN.runKernel(function(t,n){var r=t.sigmoid(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.mul(gR(1).sub(n)))}}})}}),YD=pR({sign_:function(t){var e=JI(t,"x","sign");return UN.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return RR(t)}}})}}),QD=pR({isNaN_:function(t){var e=JI(t,"x","isNaN");return UN.runKernel(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return RR(t)}}})}}),ZD=pR({isInf_:function(t){var e=JI(t,"x","isInf");return UN.runKernel(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return RR(t)}}})}}),JD=pR({isFinite_:function(t){var e=JI(t,"x","isFinite");return UN.runKernel(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return RR(t)}}})}}),tO=pR({sin_:function(t){var e=JI(t,"x","sin");return UN.runKernel(function(t,n){var r=t.sin(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cos().mul(t)}}})}}),eO=pR({sinh_:function(t){var e=JI(t,"x","sinh");return UN.runKernel(function(t,n){var r=t.sinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}})}}),nO=pR({softplus_:function(t){var e=JI(t,"x","softplus");return UN.runKernel(function(t,n){var r=t.softplus(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}})}}),rO=pR({sqrt_:function(t){var e=JI(t,"x","sqrt");return UN.runKernel(function(t,n){var r=t.sqrt(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}})}}),oO=pR({square_:function(t){var e=JI(t,"x","square");return UN.runKernel(function(t,n){return n([e]),t.square(e)},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.toFloat().mul(2))}}})}}),iO=pR({step_:function(t,e){void 0===e&&(e=0);var n=JI(t,"x","step");return UN.runKernel(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return RR(t)}}})}}),aO=pR({tan_:function(t){var e=JI(t,"x","tan");return UN.runKernel(function(t,n){var r=t.tan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}})}}),sO=pR({tanh_:function(t){var e=JI(t,"x","tanh");return UN.runKernel(function(t,n){var r=t.tanh(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return gR(1).sub(n.square()).mulStrict(t)}}})}});function uO(t,e,n,r,o,i){var a,s,u=JI(t,"x","batchNorm"),l=JI(e,"mean","batchNorm"),c=JI(n,"variance","batchNorm");return null!=o&&(a=JI(o,"scale","batchNorm")),null!=r&&(s=JI(r,"offset","batchNorm")),Ik(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Ik(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),Ik(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=a&&Ik(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&Ik(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),pO(u,l,c,s,a,i)}function lO(t,e,n,r,o,i){var a,s,u=JI(t,"x","batchNorm"),l=JI(e,"mean","batchNorm"),c=JI(n,"variance","batchNorm");return null!=o&&(a=JI(o,"scale","batchNorm")),null!=r&&(s=JI(r,"offset","batchNorm")),Ik(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Ik(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),Ik(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=a&&Ik(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&Ik(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),pO(u,l,c,s,a,i)}function cO(t,e,n,r,o,i){var a,s,u=JI(t,"x","batchNorm"),l=JI(e,"mean","batchNorm"),c=JI(n,"variance","batchNorm");return null!=o&&(a=JI(o,"scale","batchNorm")),null!=r&&(s=JI(r,"offset","batchNorm")),Ik(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),Ik(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),Ik(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=a&&Ik(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&Ik(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),pO(u,l,c,s,a,i)}function pO(t,e,n,r,o,i){null==i&&(i=.001);var a,s,u,l=JI(t,"x","batchNorm"),c=JI(e,"mean","batchNorm"),p=JI(n,"variance","batchNorm");return null!=o&&(a=JI(o,"scale","batchNorm")),null!=r&&(s=JI(r,"offset","batchNorm")),Ik(c.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Ik(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Ik(null==a||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,UN.runKernel(function(t,e){var n=t.batchNormalization(u,hO(c),hO(p),i,hO(a),hO(s));return e([l,c,p,a]),n},{$x:l,$mean:c,$variance:p,$scale:a,$offset:s},function(t,e){var n=e[0],r=e[1],o=e[2],a=e[3],s=null==a?gR(1):a,l=zA(r.shape,u.shape),c=[];if(1===r.rank){for(var p=0;p<u.shape.length-1;++p)c.push(u.shape[p]);c.push(1)}var h=n.sub(r),f=t.mul(s),d=$D(o.add(gR(i))),m=d.mul(d).mul(d).mul(gR(-.5));return{$x:function(){return 1===r.rank?t.mul(vA(d.as4D(1,1,1,r.shape[0]),c)).mul(s).reshape(n.shape):t.mul(d).mul(s).reshape(n.shape)},$mean:function(){var t=d.mul(gR(-1)).mul(f);return 1===r.rank&&(t=t.sum(l)),t.reshape(r.shape)},$variance:function(){var t=m.mul(h).mul(f);return 1===r.rank&&(t=t.sum(l)),t.reshape(r.shape)},$scale:function(){var e=h.mul(d),n=t.mul(e);return 1===r.rank&&(n=n.sum(l)),n.reshape(r.shape)},$offset:function(){var e=t;return 1===r.rank&&(e=e.sum(l)),e.reshape(r.shape)}}}).reshape(l.shape)}function hO(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function fO(){GI("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var dO=pR({batchNormalization2d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),fO(),uO(t,e,n,i,o,r)}}),mO=pR({batchNormalization3d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),fO(),lO(t,e,n,i,o,r)}}),vO=pR({batchNormalization4d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),fO(),cO(t,e,n,i,o,r)}}),gO=pR({batchNormalization_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),fO(),pO(t,e,n,i,o,r)}}),yO=pR({batchNorm_:pO}),bO=pR({batchNorm2d_:uO}),wO=pR({batchNorm3d_:lO}),xO=pR({batchNorm4d_:cO}),CO=pR({logicalAnd_:function(t,e){var n=JI(t,"a","logicalAnd","bool"),r=JI(e,"b","logicalAnd","bool");return UA(n.shape,r.shape),UN.runKernel(function(t){return t.logicalAnd(n,r)},{$a:n,$b:r})}}),EO=pR({logicalNot_:function(t){var e=JI(t,"x","logicalNot","bool");return UN.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),SO=pR({logicalOr_:function(t,e){var n=JI(t,"a","logicalOr","bool"),r=JI(e,"b","logicalOr","bool");return UA(n.shape,r.shape),UN.runKernel(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}}),kO=pR({logicalXor_:function(t,e){var n=JI(t,"a","logicalXor","bool"),r=JI(e,"b","logicalXor","bool");return UA(n.shape,r.shape),SO(t,e).logicalAnd(CO(t,e).logicalNot())}}),NO=pR({where_:function(t,e,n){var r=JI(e,"a","where"),o=JI(n,"b","where"),i=JI(t,"condition","where","bool");return Rk(r.shape,o.shape,"Error in where: "),1===i.rank?Ik(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Rk(i.shape,o.shape,"Error in where: "),UN.runKernel(function(t,e){var n=t.select(i,r,o);return e([i]),n},{$condition:i,$a:r,$b:o},function(t,e){var n=e[0];return{$condition:function(){return RR(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}})}}),IO=function(t){return gk(this,void 0,void 0,function(){var e,n,r;return yk(this,function(o){switch(o.label){case 0:return[4,(e=JI(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=pT(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},RO=pR({add_:function(t,e){var n,r=JI(t,"a","add"),o=JI(e,"b","add");n=ON(r,o);var i=UA((r=n[0]).shape,(o=n[1]).shape);return UN.runKernel(function(t){return t.add(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=zA(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=zA(o.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(o.shape)}}})}}),AO=pR({addN_:function(t){Ik(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Ik(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return JI(t,"tensors"+e,"addN")}),n=e[0];return e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!Dk(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),UN.runKernel(function(t){return t.addN(e)},e,function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n})}}),TO=pR({addStrict_:function(t,e){var n=JI(t,"a","addStrict"),r=JI(e,"b","addStrict");return Rk(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),_O=pR({atan2_:function(t,e){var n,r=JI(t,"a","atan2"),o=JI(e,"b","atan2");n=ON(r,o);var i=UA((r=n[0]).shape,(o=n[1]).shape);return UN.runKernel(function(t,e){var n=t.atan2(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=RO(n.square(),r.square()),o=t.mul(r.div(e)),a=zA(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},$b:function(){var e=RO(n.square(),r.square()),o=GD(t.mul(n.div(e))),a=zA(r.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(r.shape)}}})}}),DO=pR({div_:function(t,e){var n,r=JI(t,"a","div"),o=JI(e,"b","div");if(n=ON(r,o),o=n[1],"int32"===(r=n[0]).dtype&&"int32"===o.dtype)return MO(r,o);var i=UA(r.shape,o.shape);return UN.runKernel(function(t,e){var n=t.realDivide(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=t.div(r.toFloat()),o=zA(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=zA(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}})}}),OO=pR({divStrict_:function(t,e){var n=JI(t,"a","div"),r=JI(e,"b","div");return Rk(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),MO=pR({floorDiv_:function(t,e){var n,r=JI(t,"a","floorDiv"),o=JI(e,"b","floorDiv");n=ON(r,o);var i=UA((r=n[0]).shape,(o=n[1]).shape);return UN.runKernel(function(t,e){var n=t.floorDiv(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=t.div(r.toFloat()),o=zA(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=zA(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}})}}),FO=pR({maximum_:function(t,e){var n,r=JI(t,"a","maximum"),o=JI(e,"b","maximum");return n=ON(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),UA(r.shape,o.shape),UN.runKernel(function(t,e){var n=t.maximum(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){return t.mul(n.greaterEqual(r).toFloat())},$b:function(){return t.mul(n.less(r).toFloat())}}})}}),PO=pR({maximumStrict_:function(t,e){var n=JI(t,"a","maximumStrict"),r=JI(e,"b","maximumStrict");return Rk(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),LO=pR({minimum_:function(t,e){var n,r=JI(t,"a","minimum"),o=JI(e,"b","minimum");return n=ON(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),UA(r.shape,o.shape),UN.runKernel(function(t,e){var n=t.minimum(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){return t.mul(n.lessEqual(r).toFloat())},$b:function(){return t.mul(n.greater(r).toFloat())}}})}}),BO=pR({minimumStrict_:function(t,e){var n=JI(t,"a","minimumStrict"),r=JI(e,"b","minimumStrict");return Rk(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),zO=pR({mod_:function(t,e){var n,r=JI(t,"a","mod"),o=JI(e,"b","mod");n=ON(r,o);var i=UA((r=n[0]).shape,(o=n[1]).shape);return UN.runKernel(function(t,e){var n=t.mod(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=zA(n.shape,i);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),o=zA(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}})}}),UO=pR({modStrict_:function(t,e){var n=JI(t,"a","modStrict"),r=JI(e,"b","modStrict");return Rk(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),VO=pR({mul_:function(t,e){var n,r=JI(t,"a","mul"),o=JI(e,"b","mul");n=ON(r,o);var i=UA((r=n[0]).shape,(o=n[1]).shape);return UN.runKernel(function(t,e){var n=t.multiply(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=t.mul(r.toFloat()),o=zA(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},$b:function(){var e=t.mul(n.toFloat()),o=zA(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}})}}),WO=pR({mulStrict_:function(t,e){var n=JI(t,"a","mul"),r=JI(e,"b","mul");return Rk(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),jO=pR({pow_:function(t,e){var n=JI(t,"base","pow"),r=JI(e,"exp","pow"),o=UA(n.shape,r.shape);return t=n.cast(_N(n.dtype,r.dtype)),e=r.cast(_N(n.dtype,r.dtype)),UN.runKernel(function(t,e){var o=t.pow(n,r);return e([n,r,o]),o},{$base:n,$exp:r},function(t,e){var n=e[0],r=e[1],i=e[2];return{$base:function(){var e=r.toFloat(),i=t.mul(e.mul(n.pow(e.sub(gR(1))))),a=zA(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$exp:function(){var e=n.greater(0),a=n.log().where(e,RR(n)),s=t.mul(i.mul(a)),u=zA(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}})}}),HO=pR({powStrict_:function(t,e){return Rk(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),GO=pR({squaredDifference_:function(t,e){var n,r=JI(t,"a","squaredDifference"),o=JI(e,"b","squaredDifference");return n=ON(r,o),UA((r=n[0]).shape,(o=n[1]).shape),UN.runKernel(function(t,e){var n=t.squaredDifference(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1],o=gR(2);return{$a:function(){return t.mul(n.sub(r).mul(o))},$b:function(){return t.mul(r.sub(n).mul(o))}}})}}),qO=pR({squaredDifferenceStrict_:function(t,e){var n=JI(t,"a","squaredDifferenceStrict"),r=JI(e,"b","squaredDifferenceStrict");return Rk(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),KO=pR({sub_:function(t,e){var n,r=JI(t,"a","sub"),o=JI(e,"b","sub");n=ON(r,o);var i=UA((r=n[0]).shape,(o=n[1]).shape);return UN.runKernel(function(t){return t.subtract(r,o)},{$a:r,$b:o},function(t){return{$a:function(){var e=t,n=zA(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},$b:function(){var e=t,n=zA(o.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}})}}),$O=pR({subStrict_:function(t,e){var n=JI(t,"a","subStrict"),r=JI(e,"b","subStrict");return Rk(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),XO=pR({equal_:function(t,e){var n,r=JI(t,"a","equal"),o=JI(e,"b","equal");return n=ON(r,o),UA((r=n[0]).shape,(o=n[1]).shape),UN.runKernel(function(t){return t.equal(r,o)},{$a:r,$b:o})}}),YO=pR({equalStrict_:function(t,e){var n=JI(t,"a","equalStrict"),r=JI(e,"b","equalStrict");return Rk(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),QO=pR({greater_:function(t,e){var n,r=JI(t,"a","greater"),o=JI(e,"b","greater");return n=ON(r,o),UA((r=n[0]).shape,(o=n[1]).shape),UN.runKernel(function(t){return t.greater(r,o)},{$a:r,$b:o})}}),ZO=pR({greaterEqual_:function(t,e){var n,r=JI(t,"a","greaterEqual"),o=JI(e,"b","greaterEqual");return n=ON(r,o),UA((r=n[0]).shape,(o=n[1]).shape),UN.runKernel(function(t,e){var n=t.greaterEqual(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){return RR(n)},$b:function(){return RR(r)}}})}}),JO=pR({greaterEqualStrict_:function(t,e){var n=JI(t,"a","greaterEqualStrict"),r=JI(e,"b","greaterEqualStrict");return Rk(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),tM=pR({greaterStrict_:function(t,e){var n=JI(t,"a","greaterStrict"),r=JI(e,"b","greaterStrict");return Rk(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),eM=pR({less_:function(t,e){var n,r=JI(t,"a","less"),o=JI(e,"b","less");return n=ON(r,o),UA((r=n[0]).shape,(o=n[1]).shape),UN.runKernel(function(t){return t.less(r,o)},{$a:r,$b:o})}}),nM=pR({lessEqual_:function(t,e){var n,r=JI(t,"a","lessEqual"),o=JI(e,"b","lessEqual");return n=ON(r,o),UA((r=n[0]).shape,(o=n[1]).shape),UN.runKernel(function(t){return t.lessEqual(r,o)},{$a:r,$b:o})}}),rM=pR({lessEqualStrict_:function(t,e){var n=JI(t,"a","lessEqualStrict"),r=JI(e,"b","lessEqualStrict");return Rk(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),oM=pR({lessStrict_:function(t,e){var n=JI(t,"a","lessStrict"),r=JI(e,"b","lessStrict");return Rk(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),iM=pR({notEqual_:function(t,e){var n,r=JI(t,"a","notEqual"),o=JI(e,"b","notEqual");return n=ON(r,o),UA((r=n[0]).shape,(o=n[1]).shape),UN.runKernel(function(t){return t.notEqual(r,o)},{$a:r,$b:o})}}),aM=pR({notEqualStrict_:function(t,e){var n=JI(t,"a","notEqualStrict"),r=JI(e,"b","notEqualStrict");return Rk(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function sM(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function uM(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var lM=pR({gather_:function(t,e,n){void 0===n&&(n=0);var r=JI(t,"x","gather"),o=JI(e,"indices","gather","int32");n=zk(n,r.shape)[0];var i=function(t,e,n){for(var r=t.shape[n],o=[],i=1,a=1,s=0;s<n;s++)o.push(t.shape[s]),i*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=n+1;s<t.rank;s++)o.push(t.shape[s]),a*=t.shape[s];return{batchSize:i,sliceSize:a,dimSize:r,outputShape:o}}(r,o,n);return UN.runKernel(function(t,e){var i=t.gather(r,o.flatten(),n);return e([o]),i},{$x:r},function(t,e){var o=e[0];return{$x:function(){var e=r.shape,i=o.size,a=e.slice(0,n),s=a.length,u=e.slice(n,e.length).slice(1),l=u.length,c=sM(0,s),p=sM(s+1,s+1+l),h=uM([a,[i],u]),f=t.reshape(h),d=o.reshape([i]),m=uM([[s],c,p]),v=f.transpose(m),g=cM(v,d,r.shape[n]),y=sR(m);return g.transpose(y)}}}).reshape(i.outputShape)}}),cM=pR({unsortedSegmentSum_:function(t,e,n){var r=JI(t,"x","unsortedSegmentSum"),o=JI(e,"segmentIds","unsortedSegmentSum","int32");return Ik(Ok(n),function(){return"numSegments must be of dtype int"}),UN.runKernel(function(t,e){var i=t.unsortedSegmentSum(r,o,n);return e([o]),i},{$x:r},function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=FO(e,RR(e)),r=lM(t,n),o=ZO(e,gR(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=JR(o,a+1);o=CO(o,CR(r.shape,"bool"));var s=RR(r);return NO(o,r,s)}(t,n)}}})}});function pM(t,e,n,r,o,i,a){void 0===i&&(i="NHWC"),Ik(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var s=t,u=e,l=!1;3===e.rank&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),Ik(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),Ik(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),Ik(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];Ik(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),Ik(p===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&Ik(Ok(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var h=ZA(i),f=jA(s,n.shape,r,1,o,a,!1,h),d=UN.runKernel(function(t,e){var r=t.conv2dDerInput(u,n,f);return e([n,u]),r},{dy4D:u,filter:n},function(t,e){var n=e[0],s=e[1];return{dy4D:function(){return vM(t,n,r,o,i,1,a)},filter:function(){return yM(t,s,n.shape,r,o,i,a)}}});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function hM(t,e,n,r,o,i,a){void 0===i&&(i="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Ik(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),Ik(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),Ik(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l="NHWC"===i?s.shape[3]:s.shape[1],c="NHWC"===i?u.shape[3]:u.shape[1];Ik(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),Ik(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),null!=a&&Ik(Ok(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var p=ZA(i),h=jA(s.shape,n,r,1,o,a,!1,p);return UN.runKernel(function(t){return t.conv2dDerFilter(s,u,h)},{x4D:s,dy4D:u})}function fM(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t);return 1===e[0]&&1===e[1]&&1===e[2]}function dM(t,e,n,r,o){Ik(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var i=t,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],l=a.shape[4];Ik(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),Ik(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),Ik(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),Ik(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),Ik(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=HA(i,n.shape,r,1,o),p=UN.runKernel(function(t){return t.conv3dDerInput(a,n,c)},{dy5D:a});return s?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var mM=pR({conv1d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=JI(t,"x","conv1d"),u=JI(e,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),Ik(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),Ik(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&Ik(Ok(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),Ik(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),Ik(QA(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),Ik("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=vM(h,p,[1,n],r,"NHWC",[1,i],a);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),vM=pR({conv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=JI(t,"x","conv2d"),u=JI(e,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Ik(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),Ik(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&Ik(Ok(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var p="NHWC"===o?l.shape[3]:l.shape[1];Ik(p===u.shape[2],function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+u.shape[2]+"."}),Ik(QA(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var h=ZA(o),f=jA(l.shape,u.shape,n,i,r,a,!1,h),d=UN.runKernel(function(t,e){var n=t.conv2d(l,u,f);return e([u,l]),n},{x:l,$filter:u},function(t,e){var a=e[0],s=e[1];return Ik(YA(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return pM(s.shape,t,a,n,r,o)},$filter:function(){return hM(s,t,a.shape,n,r,o)}}});return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),gM=pR({conv3d_:function(t,e,n,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var a=JI(t,"x","conv3d"),s=JI(e,"filter","conv3d"),u=a,l=!1;4===a.rank&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),Ik(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Ik(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),Ik(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),Ik(function(t,e){return fM(n)||fM(e)}(0,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),Ik("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=HA(u.shape,s.shape,n,i,r),p=UN.runKernel(function(t,e){var n=t.conv3d(u,s,c);return e([u,s]),n},{x:u,$filter:s},function(t,e){Ik(fM(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var o=e[0],a=e[1];return{x:function(){return dM(o.shape,t,a,n,r)},$filter:function(){return function(t,e,n,r,o){var i=t;4===t.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),Ik(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),Ik(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),Ik(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),Ik(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."}),Ik(a.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=HA(i.shape,n,r,1,o);return UN.runKernel(function(t){return t.conv3dDerFilter(i,a,s)},{x5D:i,dy5D:a})}(o,t,a.shape,n,r)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),yM=pR({conv2dDerFilter_:hM}),bM=pR({conv2dDerInput_:pM}),wM=pR({depthwiseConv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=JI(t,"x","depthwiseConv2d"),u=JI(e,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Ik(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),Ik(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),Ik(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),Ik(QA(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=a&&Ik(Ok(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var p=jA(l.shape,u.shape,n,i,r,a,!0),h=UN.runKernel(function(t,e){var n=t.depthwiseConv2D(l,u,p);return e([l,u]),n},{x:l,$filter:u},function(t,e){Ik(YA(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var n=e[0],r=e[1];return{x:function(){return function(t,e,n,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=UN.runKernel(function(t){return t.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}(0,t,r,p)},$filter:function(){return function(t,e,n,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),UN.runKernel(function(t){return t.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}(n,t,0,p)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),xM=pR({separableConv2d_:function(t,e,n,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=JI(t,"x","separableConv2d"),u=JI(e,"depthwiseFilter","separableConv2d"),l=JI(n,"pointwiseFilter","separableConv2d"),c=s,p=!1;if(3===s.rank&&(p=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Ik(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),Ik(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),Ik(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),Ik(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),Ik(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],f=u.shape[3];Ik(l.shape[2]===h*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+l.shape[2]+"."});var d=wM(c,u,r,o,a,i),m=vM(d,l,1,"valid",a);return p?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),CM=pR({conv2dTranspose_:function(t,e,n,r,o,i){return pM(n,JI(t,"x","conv2dTranspose"),JI(e,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),EM=pR({conv3dTranspose_:function(t,e,n,r,o){return dM(n,JI(t,"x","conv3dTranspose"),JI(e,"filter","conv3dTranspose"),r,o)}}),SM=pR({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=JI(t,"a","matMul"),a=JI(e,"b","matMul");o=ON(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],p=i.shape.slice(0,-2),h=a.shape.slice(0,-2),f=_k(p),d=_k(h);Ik(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),Ik(Dk(p,h),function(){return"Error in matMul: outer dimensions ("+p+") and ("+h+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),Ik(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([l,c]),v=n?i.as3D(f,s,l):i.as3D(f,l,s),g=r?a.as3D(d,c,u):a.as3D(d,u,c);return UN.runKernel(function(t,e){var o=t.batchMatMul(v,g,n,r);return e([v,g]),o},{$a:v,$b:g},function(t,e){var o=e[0],i=e[1];return n||r?!n&&r?{$a:function(){return t.matMul(i,!1,!1)},$b:function(){return t.matMul(o,!0,!1)}}:n&&!r?{$a:function(){return i.matMul(t,!1,!0)},$b:function(){return o.matMul(t,!1,!1)}}:{$a:function(){return i.matMul(t,!0,!0)},$b:function(){return t.matMul(o,!0,!0)}}:{$a:function(){return t.matMul(i,!1,!0)},$b:function(){return o.matMul(t,!0,!1)}}}).reshape(m)}}),kM=pR({dot_:function(t,e){var n=JI(t,"t1","dot"),r=JI(e,"t2","dot");Ik(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return Ik(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),NM=pR({outerProduct_:function(t,e){var n=JI(t,"v1","outerProduct"),r=JI(e,"v2","outerProduct");return Ik(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),IM=pR({reverse_:function(t,e){var n=JI(t,"x","reverse");if(0===n.rank)return n.clone();var r=zk(e,n.shape);return UN.runKernel(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)}}),RM=pR({reverse1d_:function(t){var e=JI(t,"x","reverse");return Ik(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),IM(e,0)}}),AM=pR({reverse2d_:function(t,e){var n=JI(t,"x","reverse");return Ik(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),IM(n,e)}}),TM=pR({reverse3d_:function(t,e){var n=JI(t,"x","reverse");return Ik(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),IM(n,e)}}),_M=pR({reverse4d_:function(t,e){var n=JI(t,"x","reverse");return Ik(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),IM(n,e)}});function DM(t,e,n,r,o,i){var a=JI(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),Ik(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Ik(QA(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=i&&Ik(Ok(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=VA(s.shape,e,n,r,o,i),c=UN.runKernel(function(t,e){var n=t.maxPool(s,l);return e([s,n]),n},{x:s},function(t,i){var a=i[0],s=i[1];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=JI(t,"dy","maxPoolBackprop"),l=JI(e,"input","maxPoolBackprop"),c=JI(n,"output","maxPoolBackprop");Ik(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==i&&(i=[1,1]),Ik(QA(o,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),Ik(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),Ik(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var p=VA(l.shape,r,o,i,a,void 0);return UN.runKernel(function(t){return t.maxPoolBackprop(u,l,c,p)},{$dy:u,$input:l})}(t,a,s,e,n,r,o)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function OM(t,e,n,r,o,i){var a=JI(t,"x","avgPool","float32");null==r&&(r=[1,1]),Ik(QA(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Ik(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&Ik(Ok(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=VA(s.shape,e,n,r,o,i),c=UN.runKernel(function(t){return t.avgPool(s,l)},{x:s},function(t){return{x:function(){return function(t,e,n,r,o,i){var a=JI(t,"dy","avgPoolBackprop"),s=JI(e,"input","avgPoolBackprop");Ik(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),null==o&&(o=[1,1]),Ik(QA(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=a,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Ik(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),Ik(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var p=VA(u.shape,n,r,o,i),h=UN.runKernel(function(t){return t.avgPoolBackprop(l,u,p)},{dy4D:l,input4D:u});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(t,s,e,n,r,o)}}});return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var MM=pR({maxPool_:function(t,e,n,r,o){return DM(t,e,n,1,r,o)}}),FM=pR({avgPool_:function(t,e,n,r,o){return OM(t,e,n,1,r,o)}}),PM=pR({pool_:function(t,e,n,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=JI(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Ik(QA(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var l,c=VA(s.shape,e,i,o,r),p=[c.dilationHeight,c.dilationWidth];l="same"===r?function(t,e){var n=[c.filterHeight,c.filterWidth].map(function(t,n){return t+(t-1)*(e[n]-1)}).map(function(t){return t-1}),r=n.map(function(t){return Math.floor(t/2)}),o=n.map(function(t,e){return t-r[e]});return n.map(function(t,e){return[r[e],o[e]]})}(0,p):[[0,0],[0,0]];var h=1===p[0]&&1===p[1],f=function(t,e,n){var r=n.map(function(t){return t[0]}),o=n.map(function(t){return t[1]}),i=t.concat(r,o),a=e.map(function(t,e){return(t-i[e]%t)%t}),s=o.map(function(t,e){return t+a[e]});return[e.map(function(t,e){return[r[e],s[e]]}),e.map(function(t,e){return[0,a[e]]})]}([c.inHeight,c.inWidth],p,l),d=f[1],m=h?r:"valid",v=h?s:fA(s,p,f[0]),g=("avg"===n?function(){return OM(v,e,i,1,m)}:function(){return DM(v,e,i,1,m)})(),y=h?g:$R(g,p,d);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),LM=pR({maxPool3d_:function(t,e,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=JI(t,"x","maxPool3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),Ik(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),Ik("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),Ik(QA(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=o&&Ik(Ok(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=WA(u.shape,e,n,a,r,o,i),p=UN.runKernel(function(t,e){var n=t.maxPool3d(u,c);return e([u,n]),n},{x:u},function(t,i){var s=i[0],u=i[1];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=JI(t,"dy","maxPool3dBackprop"),l=JI(e,"input","maxPool3dBackprop"),c=JI(n,"output","maxPool3dBackprop"),p=u,h=l,f=c,d=!1;4===l.rank&&(d=!0,p=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),f=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),Ik(5===p.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+p.rank+"."}),Ik(5===h.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."}),Ik(5===f.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."}),null==i&&(i=[1,1,1]),Ik(QA(o,i),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),null!=s&&Ik(Ok(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var m=WA(h.shape,r,o,i,a,s),v=UN.runKernel(function(t){return t.maxPool3dBackprop(p,h,f,m)},{dy5D:p,input5D:h});return d?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}(t,s,u,e,n,a,r,o)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),BM=pR({avgPool3d_:function(t,e,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=JI(t,"x","avgPool3d","float32"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),Ik(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),Ik("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),Ik(QA(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=o&&Ik(Ok(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=WA(u.shape,e,n,a,r,o,i),p=UN.runKernel(function(t){return t.avgPool3d(u,c)},{x:u},function(t){return{x:function(){return function(t,e,n,r,o,i,a){var s=JI(t,"dy","avgPool3dBackprop"),u=JI(e,"input","avgPool3dBackprop"),l=s,c=u,p=!1;4===u.rank&&(p=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),Ik(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),Ik(5===c.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),null==o&&(o=[1,1,1]),Ik(QA(r,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=a&&Ik(Ok(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=WA(c.shape,n,r,o,i,a),f=UN.runKernel(function(t){return t.avgPool3dBackprop(l,c,h)},{dy5D:l,input5D:c});return p?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(t,u,e,n,a,r,o)}}});return p=p.cast(u.dtype),l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),zM=pR({slice_:function(t,e,n){var r,o,i=JI(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice(),o=(o=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(Ik(-1===t,function(){return"Bad value in size"}),i.shape[e]-r[e])}),function(t,e,n){Ik(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),Ik(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(r){Ik(e[r]+n[r]<=t.shape[r],function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"})},o=0;o<t.rank;++o)r(o)}(i,r,o);var a=i.shape;return UN.runKernel(function(t){return t.slice(i,r,o)},{$x:i},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-o[n]]);return{$x:function(){return t.pad(e)}}})}}),UM=pR({slice1d_:function(t,e,n){var r=JI(t,"x","slice1d");return Ik(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),zM(r,[e],[n])}}),VM=pR({slice2d_:function(t,e,n){var r=JI(t,"x","slice2d");return Ik(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),zM(r,e,n)}}),WM=pR({slice3d_:function(t,e,n){var r=JI(t,"x","slice3d");return Ik(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),zM(r,e,n)}}),jM=pR({slice4d_:function(t,e,n){var r=JI(t,"x","slice4d");return Ik(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),zM(r,e,n)}});function HM(t,e,n,r,o){return e.rank<n.rank&&(e=e.reshape(oR(e.shape,r))),t.rank<n.rank&&(t=t.reshape(oR(t.shape,r))),{$x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==o?r:r.transpose(o)}}}var GM=pR({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","all","bool"),o=zk(e,r.shape),i=o,a=aR(i,r.rank);null!=a&&(r=r.transpose(a),i=uR(i.length,r.rank));var s=UN.runKernel(function(t){return t.all(r,i)},{$x:r});if(n){var u=oR(s.shape,o);return s.reshape(u)}return s}}),qM=pR({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","any","bool"),o=zk(e,r.shape),i=o,a=aR(i,r.rank);null!=a&&(r=r.transpose(a),i=uR(i.length,r.rank));var s=UN.runKernel(function(t){return t.any(r,i)},{$x:r});if(n){var u=oR(s.shape,o);return s.reshape(u)}return s}}),KM=pR({argMax_:function(t,e){void 0===e&&(e=0);var n=JI(t,"x","argMax");null==e&&(e=0);var r=zk(e,n.shape),o=aR(r,n.rank);return null!=o&&(n=n.transpose(o),r=uR(r.length,n.rank)),UN.runKernel(function(t,e){var o=t.argMax(n,r[0]);return e([n]),o},{$x:n},function(t,e){var n=e[0];return{$x:function(){return RR(n)}}})}}),$M=pR({argMin_:function(t,e){void 0===e&&(e=0);var n=JI(t,"x","argMin");null==e&&(e=0);var r=zk(e,n.shape),o=aR(r,n.rank);return null!=o&&(n=n.transpose(o),r=uR(r.length,n.rank)),UN.runKernel(function(t,e){var o=t.argMin(n,r[0]);return e([n]),o},{$x:n},function(t,e){var n=e[0];return{$x:function(){return RR(n)}}})}}),XM=pR({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","logSumExp"),o=zk(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=oR(s.shape,o);return s.reshape(u)}return s}}),YM=pR({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","max"),o=r,i=zk(e,r.shape),a=i,s=aR(a,r.rank);null!=s&&(r=r.transpose(s),a=uR(a.length,r.rank));var u=UN.runKernel(function(t,e){var n=t.max(r,a);return e([o,n]),n},{$x:r},function(t,e){return HM(t,e[1],e[0],i,s)});if(n){var l=oR(u.shape,i);u=u.reshape(l)}return u}}),QM=pR({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","mean"),o=zk(e,r.shape),i=_k(rR(r.shape,o)[1]);return MA(function(t){var r=gR(i);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(CR(t.shape,"float32")).div(i)}}})(r)}}),ZM=pR({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","min"),o=r,i=zk(e,r.shape),a=i,s=aR(a,r.rank);null!=s&&(r=r.transpose(s),a=uR(a.length,r.rank));var u=UN.runKernel(function(t,e){var n=t.min(r,a);return e([o,n]),n},{$x:r},function(t,e){return HM(t,e[1],e[0],i,s)});if(n){var l=oR(u.shape,i);u=u.reshape(l)}return u}}),JM=pR({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=zk(e,(t=JI(t,"x","moments")).shape),o=t.mean(r,n),i=o.shape;n||(i=oR(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),tF=pR({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=zk(e,r.shape);return MA(function(t){var e=aR(o,t.rank),r=o,i=t;null!=e&&(i=t.transpose(e),r=uR(r.length,t.rank));var a=UN.runKernel(function(t){return t.sum(i,r)},{permutedX:i});if(n){var s=oR(a.shape,o);a=a.reshape(s)}return{value:a,gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(CR(t.shape,"float32"))}}})(r)}}),eF=pR({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=JI(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=zk(e,r.shape),i=aR(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=uR(a.length,r.rank));var u=UN.runKernel(function(t){return t.prod(s,a)},{permutedX:s});if(n){var l=oR(u.shape,o);u=u.reshape(l)}return u}}),nF=pR({elu_:function(t){var e=JI(t,"x","elu");return UN.runKernel(function(t,n){var r=t.elu(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return UN.runKernel(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),rF=pR({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=JI(t,"x","leakyRelu");return FO(gR(e).mul(n),n)}}),oF=pR({prelu_:function(t,e){var n=JI(t,"x","prelu"),r=JI(e,"alpha","prelu");return UN.runKernel(function(t,e){var o=t.prelu(n,r);return e([n,r]),o},{$x:n,$alpha:r},function(t,e){var n=e[0],r=e[1],o=n.greater(0);return{$x:function(){return NO(o,t,t.mul(r))},$alpha:function(){var e=NO(o,RR(t),t.mul(n)),i=zA(r.shape,t.shape);return i.length>0&&(e=e.sum(i)),e.reshape(r.shape)}}})}}),iF=pR({relu_:function(t){var e=JI(t,"x","relu");return"bool"===e.dtype?e.toInt():UN.runKernel(function(t,n){var r=t.relu(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n.step().toFloat())}}})}}),aF=pR({selu_:function(t){var e=JI(t,"x","selu");return UN.runKernel(function(t,n){var r=t.selu(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){var e=n.greater(gR(0)),r=gR(1.7580993408473768),o=gR(1.0507009873554805),i=t.mul(o),a=t.mul(r).mul(n.toFloat().exp());return NO(e,i,a)}}})}}),sF=pR({transpose_:function(t,e){var n=JI(t,"x","transpose");return null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),Ik(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(t){Ik(t>=0&&t<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1?n.clone():UN.runKernel(function(t){return t.transpose(n,e)},{$x:n},function(t){var n=sR(e);return{$x:function(){return t.transpose(n)}}})}}),uF=pR({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=JI(t,"x","localResponseNormalization");Ik(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),Ik(Ok(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=UN.runKernel(function(t,i){var s=t.localResponseNormalization4D(a,e,n,r,o);return i([a,s]),s},{x4D:a},function(t,i){var a=i[0],s=i[1];return{x4D:function(){return UN.runKernel(function(i){return i.LRNGrad(t,a,s,e,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),lF=pR({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(gR(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=JI(t,"x","norm"),e,n),i=o.shape;if(r){var a=zk(n,t.shape);i=oR(o.shape,a)}return o.reshape(i)}}),cF=pR({basicLSTMCell_:function(t,e,n,r,o,i){var a=JI(t,"forgetBias","basicLSTMCell"),s=JI(e,"lstmKernel","basicLSTMCell"),u=JI(n,"lstmBias","basicLSTMCell"),l=JI(r,"data","basicLSTMCell"),c=JI(o,"c","basicLSTMCell"),p=JI(i,"h","basicLSTMCell"),h=l.concat(p,1).matMul(s).add(u),f=h.shape[1]/4,d=[h.shape[0],f],m=h.slice([0,0],d),v=h.slice([0,f],d),g=h.slice([0,2*f],d),y=h.slice([0,3*f],d),b=m.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(a.add(g).sigmoid())),w=b.tanh().mulStrict(y.sigmoid());return[b,w]}}),pF=pR({multiRNNCell_:function(t,e,n,r){for(var o=JI(e,"data","multiRNNCell"),i=tR(n,"c","multiRNNCell"),a=tR(r,"h","multiRNNCell"),s=o,u=[],l=0;l<t.length;l++){var c=t[l](s,i[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var p=[],h=[];for(l=0;l<u.length;l+=2)p.push(u[l]),h.push(u[l+1]);return[p,h]}}),hF=pR({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var i=JI(t,"v","movingAverage"),a=JI(e,"x","movingAverage"),s=JI(n,"decay","movingAverage");MN(i,a),Ik(Dk(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=gR(1),l=u.sub(s),c=a.sub(i).mul(l);if(o){Ik(null!=r,function(){return"When using zeroDebias: true, step is required."});var p=JI(r,"step","movingAverage");c=c.div(u.sub(jO(s,p)))}return i.add(c)}}),fF=pR({stridedSlice_:function(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var l=JI(t,"x","stridedSlice");if(r.every(function(t){return 1===t})){var c=AA(l.shape,e,n,r,o,i,a,s,u),p=c[0],h=c[1],f=c[2],d=h.filter(function(t,e){return-1===f.indexOf(e)});return zM(l,p,h).reshape(d)}return UN.runKernel(function(t){return t.stridedSlice(l,e,n,r,o,i,a,s,u)},{$x:l})}}),dF=pR({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=JI(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=UN.runKernel(function(t){return t.topk(r,e,n)},{$x:r});return{values:i[0],indices:i[1]}}}),mF=pR({scatterND_:function(t,e,n){var r=JI(t,"indices","scatterND","int32"),o=JI(e,"updates","scatterND");return function(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}!function(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}(n,e,t)}(o,r,n),UN.runKernel(function(t){return t.scatterND(r,o,n)},{$indices:r,$updates:o})}}),vF=pR({fft_:function(t){Ik("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return UN.runKernel(function(t){return t.fft(n)},{input:t}).reshape(t.shape)}}),gF=pR({ifft_:function(t){Ik("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return UN.runKernel(function(t){return t.ifft(n)},{input:t}).reshape(t.shape)}}),yF=pR({rfft_:function(t,e){Ik("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=e&&e<r){var i=t.shape.map(function(t){return 0}),a=t.shape.map(function(t){return t});a[t.shape.length-1]=e,n=t.slice(i,a),r=e}else if(null!=e&&e>r){var s=t.shape.map(function(t){return t});s[t.shape.length-1]=e-r,n=t.concat(ER(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),l=hR(n,u).as2D(o,r),c=vF(l),p=Math.floor(r/2)+1,h=fR(c),f=dR(c),d=h.split([p,r-p],h.shape.length-1),m=f.split([p,r-p],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,hR(d[0],m[0]).reshape(v)}}),bF=pR({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=gF(r);return fR(o)}var i=[n,2*(e-1)],a=fR(t).as2D(n,e),s=dR(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),l=s.slice([0,1],[n,e-2]).reverse(1).mul(gR(-1)),c=a.concat(u,1),p=s.concat(l,1);return r=hR(c,p).as2D(i[0],i[1]),o=gF(r),fR(o)}}),wF=Object.freeze({fft:vF,ifft:gF,rfft:yF,irfft:bF}),xF=pR({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var o=JI(t,"sparseIndices","sparseToDense","int32"),i=JI(e,"sparseValues","sparseToDense"),a=JI(r,"defaultValue","sparseToDense",i.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");if(0!==e.rank&&(1!==e.rank||e.size!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),UN.runKernel(function(t){return t.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),CF=pR({gatherND_:function(t,e){var n=JI(e,"indices","gatherND","int32"),r=JI(t,"x","gatherND");return UN.runKernel(function(t){return t.gatherND(r,n)},{$x:r,$indices:n})}}),EF=pR({diag_:function(t){var e=JI(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return UN.runKernel(function(t){return t.diag(e)},{$x:e}).reshape(n)}}),SF=pR({dropout_:function(t,e,n,r){var o=JI(t,"x","dropout");if(Ik("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),Ik(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return t instanceof CN?o.clone():o;var i=function(t,e){if(null==e)return t.shape.slice();if(Dk(t.shape,e))return e;if(t.shape.length===e.length){for(var n=[],r=0;r<t.shape.length;r++)n.push(null==e[r]&&null!=t.shape[r]?t.shape[r]:e[r]);return n}return e}(o,n),a=1-e,s=pA(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function kF(t,e,n){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=e-n*Math.cos(a)}return yR(o,"float32")}var NF,IF=pR({hannWindow_:function(t){return kF(t,.5,.5)}}),RF=pR({hammingWindow_:function(t){return kF(t,.54,.46)}}),AF=pR({frame_:function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+e<=t.size;)a.push(zM(t,i,e)),i+=n;if(r){var s=i+e-t.size,u=AR([zM(t,i,e-s),SR([s],o)]);a.push(u)}return 0===a.length?bR([],[0,e]):AR(a).as2D(a.length,e)}}),TF=pR({stft_:function(t,e,n,r,o){void 0===o&&(o=IF),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))));for(var i=AF(t,e,n),a=VO(i,o(e)),s=[],u=0;u<i.shape[0];u++)s.push(yF(a.slice([u,0],[1,e]),r));return AR(s)}}),_F=Object.freeze({hannWindow:IF,hammingWindow:RF,frame:AF,stft:TF});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(NF||(NF={}));var DF=pR({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=NF.SUM_BY_NONZERO_WEIGHTS);var o=JI(t,"labels","absoluteDifference"),i=JI(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=JI(n,"weights","absoluteDifference")),Rk(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return OF(s,a,r)}}),OF=pR({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=NF.SUM_BY_NONZERO_WEIGHTS);var r=JI(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=JI(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(n===NF.NONE)return i;if(n===NF.SUM)return i.sum();if(n===NF.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(gR(a)):s}if(n===NF.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(gR(r.size));var u=o.mul(CR(r.shape)).notEqual(gR(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),MF=pR({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=NF.SUM_BY_NONZERO_WEIGHTS);var i=JI(t,"labels","cosineDistance"),a=JI(e,"predictions","cosineDistance"),s=null;null!=r&&(s=JI(r,"weights","cosineDistance")),Rk(i.shape,a.shape,"Error in cosineDistance: ");var u=gR(1).sub(i.mul(a).sum(n,!0));return OF(u,s,o)}}),FF=pR({hingeLoss_:function(t,e,n,r){void 0===r&&(r=NF.SUM_BY_NONZERO_WEIGHTS);var o=JI(t,"labels","hingeLoss"),i=JI(e,"predictions","hingeLoss"),a=null;null!=n&&(a=JI(n,"weights","hingeLoss")),Rk(o.shape,i.shape,"Error in hingeLoss: ");var s=gR(1);o=gR(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return OF(u,a,r)}}),PF=pR({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=NF.SUM_BY_NONZERO_WEIGHTS);var i=JI(t,"labels","huberLoss"),a=JI(e,"predictions","huberLoss"),s=null;null!=n&&(s=JI(n,"weights","huberLoss")),Rk(i.shape,a.shape,"Error in huberLoss: ");var u=gR(r),l=a.sub(i).abs(),c=LO(l,u),p=l.sub(c),h=gR(.5).mul(c.square()).add(u.mul(p));return OF(h,s,o)}}),LF=pR({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=NF.SUM_BY_NONZERO_WEIGHTS);var i=JI(t,"labels","logLoss"),a=JI(e,"predictions","logLoss"),s=null;null!=n&&(s=JI(n,"weights","logLoss")),Rk(i.shape,a.shape,"Error in logLoss: ");var u=gR(1),l=gR(r),c=i.mul(a.add(l).log()).neg().sub(u.sub(i).mul(u.sub(a).add(l).log()));return OF(c,s,o)}}),BF=pR({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=NF.SUM_BY_NONZERO_WEIGHTS);var o=JI(t,"labels","meanSquaredError"),i=JI(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=JI(n,"weights","meanSquaredError")),Rk(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return OF(s,a,r)}}),zF=pR({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=NF.SUM_BY_NONZERO_WEIGHTS);var i=JI(t,"multiClassLabels","sigmoidCrossEntropy"),a=JI(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=JI(n,"weights","sigmoidCrossEntropy")),Rk(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=gR(r),l=gR(1),c=gR(.5);i=i.mul(l.sub(u)).add(c.mul(u))}var p=function(t,e){var n=JI(t,"labels","sigmoidCrossEntropyWithLogits"),r=JI(e,"logits","sigmoidCrossEntropyWithLogits");Rk(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return OF(p,s,o)}}),UF=pR({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=NF.SUM_BY_NONZERO_WEIGHTS);var i=JI(t,"onehotLabels","softmaxCrossEntropy"),a=JI(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=JI(n,"weights","softmaxCrossEntropy")),Rk(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=gR(r),l=gR(1),c=gR(i.shape[1]);i=i.mul(l.sub(u)).add(u.div(c))}var p=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return MA(function(t,e,r){var o=e.logSumExp([n],!0),i=e.toFloat().sub(o);return r([t,i]),{value:i.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],o=e[1],i=oR(t.shape,[n]);return[t.reshape(i).mul(r.toFloat().sub(o.exp())),t.reshape(i).mul(o.exp().sub(r.toFloat()))]}}})(t,e)}(i,a);return OF(p,s,o)}}),VF=Object.freeze({get Reduction(){return NF},absoluteDifference:DF,computeWeightedLoss:OF,cosineDistance:MF,hingeLoss:FF,huberLoss:PF,logLoss:LF,meanSquaredError:BF,sigmoidCrossEntropy:zF,softmaxCrossEntropy:UF});function WF(t,e){return void 0===e&&(e=!1),UN.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=tA(n),i=t.clone(),a=bR([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(t){var e,u=i,l=s,c=o;e=UN.tidy(function(){var e=i.slice([t,t],[n-t,1]),u=e.norm(),l=i.slice([t,t],[1,1]),c=bR([[-1]]).where(l.greater(0),bR([[1]])),p=l.sub(c.mul(u)),h=e.div(p);s=1===h.shape[0]?a.clone():a.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var f=c.matMul(p).div(u).neg(),d=i.slice([t,0],[n-t,r]),m=f.mul(s);i=0===t?d.sub(m.matMul(s.transpose().matMul(d))):i.slice([0,0],[t,r]).concat(d.sub(m.matMul(s.transpose().matMul(d))),0);var v=o.slice([0,t],[n,o.shape[1]-t]);return o=0===t?v.sub(v.matMul(s).matMul(m.transpose())):o.slice([0,0],[n,t]).concat(v.sub(v.matMul(s).matMul(m.transpose())),1),[s,i,o]}),s=e[0],i=e[1],o=e[2],$I([u,l,c])},c=0;c<u;++c)l(c);return!e&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var jF=pR({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,Ik(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(e){Ik(t[e].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"})},o=1;o<t.length;++o)r(o)}else e=!0,t=MR(t,t.shape[0],0).map(function(t){return dA(t,[0])});Ik(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(t){i.push(UN.tidy(function(){var e=a[t];if(t>0)for(var n=0;n<t;++n){var r=tF(i[n].mulStrict(e)).mul(i[n]);e=e.sub(r)}return e.div(lF(e,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return e?mA(i,0):i}}),HF=pR({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return WF(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=yA(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach(function(t){var n=WF(t,e),r=n[1];o.push(n[0]),i.push(r)}),[mA(o,0).reshape(t.shape),mA(i,0).reshape(t.shape)]}}),GF=Object.freeze({gramSchmidt:jF,qr:HF});function qF(t,e,n,r,o){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY);var i=t.shape[0];return n=Math.min(n,i),Ik(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),Ik(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),Ik(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),Ik(1===e.rank,function(){return"scores must be a 1D tensor"}),Ik(e.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o}}var KF=pR({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=JI(t,"images","resizeBilinear");Ik(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),Ik(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=UN.runKernel(function(t,e){return e([o]),t.resizeBilinear(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return UN.runKernel(function(r){return r.resizeBilinearBackprop(t,e[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),$F=pR({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=JI(t,"images","resizeNearestNeighbor");Ik(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),Ik(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),Ik("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=UN.runKernel(function(t,e){return e([o]),t.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return UN.runKernel(function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),XF=pR({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=JI(t,"boxes","nonMaxSuppression"),a=JI(e,"scores","nonMaxSuppression"),s=qF(i,a,n,r,o);return n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,UN.runKernel(function(t){return t.nonMaxSuppression(i,a,n,r,o)},{$boxes:i})}}),YF=pR({cropAndResize_:function(t,e,n,r,o,i){var a=JI(t,"image","cropAndResize","float32"),s=JI(e,"boxes","cropAndResize","float32"),u=JI(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var l=s.shape[0];return Ik(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),Ik(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),Ik(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),Ik(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),Ik(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),Ik("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),UN.runKernel(function(t,e){return t.cropAndResize(a,s,u,r,o,i)},{$image:a,$boxes:s})}}),QF=Object.freeze({resizeBilinear:KF,resizeNearestNeighbor:$F,nonMaxSuppression:XF,nonMaxSuppressionAsync:function(t,e,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),gk(this,void 0,void 0,function(){var i,a,s,u,l,c;return yk(this,function(p){switch(p.label){case 0:return i=JI(t,"boxes","nonMaxSuppressionAsync"),a=JI(e,"scores","nonMaxSuppressionAsync"),s=qF(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,i.data()];case 1:return u=p.sent(),[4,a.data()];case 2:return l=p.sent(),c=aT(u,l,n,r,o),i!==t&&i.dispose(),a!==e&&a.dispose(),[2,c]}})})},cropAndResize:YF}),ZF=pR({matMul_:function(t){var e,n=t.b,r=t.transposeA,o=void 0!==r&&r,i=t.transposeB,a=void 0!==i&&i,s=t.bias,u=t.activation,l=void 0===u?"linear":u,c=t.preluActivationWeights,p=JI(t.a,"a","fused matMul"),h=JI(n,"b","fused matMul");e=ON(p,h),p=e[0],h=e[1];var f=o?p.shape[p.rank-2]:p.shape[p.rank-1],d=a?h.shape[h.rank-1]:h.shape[h.rank-2],m=o?p.shape[p.rank-1]:p.shape[p.rank-2],v=a?h.shape[h.rank-2]:h.shape[h.rank-1],g=p.shape.slice(0,-2),y=h.shape.slice(0,-2),b=_k(g),w=_k(y);Ik(p.rank>=2&&h.rank>=2&&p.rank===h.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+h.rank+"."}),Ik(Dk(g,y),function(){return"Error in fused matMul: outer dimensions ("+g+") and ("+y+") of Tensors with shapes "+p.shape+" and "+h.shape+" must match."}),Ik(f===d,function(){return"Error in fused matMul: inner shapes ("+f+") and ("+d+") of Tensors with shapes "+p.shape+" and "+h.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var x,C,E=p.shape.slice(0,-2).concat([m,v]),S=o?p.as3D(b,f,m):p.as3D(b,m,f),k=a?h.as3D(w,v,d):h.as3D(w,d,v);null!=s&&UA(E,(x=ON(x=JI(s,"bias","fused matMul"),p)[0]).shape),null!=c&&(C=JI(c,"prelu weights","fused matMul"));var N={$a:S,$b:k};return null!=s&&(N.$bias=x),null!=c&&(N.$preluActivationWeights=C),UN.runKernel(function(t,e){var n=t.fusedBatchMatMul({a:S,b:k,transposeA:o,transposeB:a,bias:x,activation:l,preluActivationWeights:C});return e([S,k,n]),n},N,function(t,e){var n,r=e[0],i=e[1],u=e[2];if(null==l||"linear"===l)n=t;else{if("relu"!==l)throw new Error("Gradient for activation "+l+" has not been implemented yet.");n=t.mul(u.step())}var c={};return null!=s&&(c={$bias:function(){var t=n,e=zA(x.shape,n.shape);return e.length>0&&(t=t.sum(e)),t.reshape(x.shape)}}),o||a?!o&&a?Object.assign({$a:function(){return n.matMul(i,!1,!1)},$b:function(){return n.matMul(r,!0,!1)}},c):o&&!a?Object.assign({$a:function(){return i.matMul(n,!1,!0)},$b:function(){return r.matMul(n,!1,!1)}},c):Object.assign({$a:function(){return i.matMul(n,!0,!0)},$b:function(){return n.matMul(r,!0,!0)}},c):Object.assign({$a:function(){return n.matMul(i,!1,!0)},$b:function(){return r.matMul(n,!0,!1)}},c)}).reshape(E)}}),JF=pR({conv2d_:function(t){var e=t.filter,n=t.strides,r=t.pad,o=t.dataFormat,i=void 0===o?"NHWC":o,a=t.dilations,s=void 0===a?[1,1]:a,u=t.dimRoundingMode,l=t.bias,c=t.activation,p=void 0===c?"linear":c,h=t.preluActivationWeights,f=JI(t.x,"x","conv2d"),d=JI(e,"filter","conv2d"),m=f,v=!1;3===f.rank&&(v=!0,m=f.as4D(1,f.shape[0],f.shape[1],f.shape[2])),Ik(4===m.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),Ik(4===d.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+d.rank+"."}),null!=u&&Ik(Ok(r),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+r+"."}),Ik(m.shape[3]===d.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+d.shape[2]+"."}),Ik(QA(n,s),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+s+"'"}),Ik("NHWC"===i,function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var g,y,b=jA(m.shape,d.shape,n,s,r,u);null!=l&&(g=ON(g=JI(l,"bias","fused conv2d"),f)[0],UA(b.outShape,g.shape)),null!=h&&(y=JI(h,"prelu weights","fused conv2d"));var w={x:m,$filter:d};null!=l&&(w.$bias=g),null!=h&&(w.$preluActivationWeights=y);var x=UN.runKernel(function(t,e){var n=t.fusedConv2d(m,d,b,g,p,y);return e([d,m,n]),n},w,function(t,e){var o,i=e[0],a=e[1],u=e[2];if(null==p||"linear"===p)o=t;else{if("relu"!==p)throw new Error("Gradient for activation "+p+" has not been implemented yet.");o=t.mul(u.step())}Ik(YA(s),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"});var c={};return null!=l&&(c={$bias:function(){var t=o,e=zA(g.shape,o.shape);return e.length>0&&(t=t.sum(e)),t.reshape(g.shape)}}),Object.assign({x:function(){return bM(a.shape,o,i,n,r)},$filter:function(){return yM(a,o,i.shape,n,r)}},c)});return v?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),tP=Object.freeze({matMul:ZF,conv2d:JF}),eP=Object.freeze({image:QF,linalg:GF,losses:VF,spectral:wF,fused:tP,signal:_F,op:pR,batchNormalization2d:dO,batchNormalization3d:mO,batchNormalization4d:vO,batchNormalization:gO,batchNorm:yO,batchNorm2d:bO,batchNorm3d:wO,batchNorm4d:xO,booleanMaskAsync:function(t,e,n){return gk(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,d,m;return yk(this,function(v){switch(v.label){case 0:for(r=JI(t,"tensor","boolMask"),o=JI(e,"mask","boolMask","bool"),i=null==n?0:n,s=r.shape,Ik((a=o.rank)>0,function(){return"mask cannot be scalar"}),Rk(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+a;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+a)),p=r.reshape(c),h=o.reshape([-1]),[4,IO(h)];case 1:return f=v.sent(),d=f.squeeze([1]),m=lM(p,d,i),t!==r&&r.dispose(),e!==o&&o.dispose(),d.dispose(),p.dispose(),h.dispose(),f.dispose(),[2,m]}})})},complex:hR,real:fR,imag:dR,concat:AR,concat1d:TR,concat2d:_R,concat3d:DR,concat4d:OR,split:MR,conv1d:mM,conv2d:vM,conv3d:gM,conv2dDerFilter:yM,conv2dDerInput:bM,depthwiseConv2d:wM,separableConv2d:xM,conv2dTranspose:CM,conv3dTranspose:EM,matMul:SM,dot:kM,outerProduct:NM,reverse:IM,reverse1d:RM,reverse2d:AM,reverse3d:TM,reverse4d:_M,maxPool:MM,avgPool:FM,pool:PM,maxPool3d:LM,avgPool3d:BM,slice:zM,slice1d:UM,slice2d:VM,slice3d:WM,slice4d:jM,abs:ID,acos:RD,acosh:AD,asin:TD,asinh:_D,atan:DD,atanh:OD,ceil:MD,clipByValue:FD,cos:PD,cosh:LD,erf:BD,exp:zD,expm1:UD,floor:VD,log:WD,log1p:jD,logSigmoid:HD,neg:GD,reciprocal:qD,round:KD,rsqrt:$D,sigmoid:XD,sign:YD,isNaN:QD,isInf:ZD,isFinite:JD,sin:tO,sinh:eO,softplus:nO,sqrt:rO,square:oO,step:iO,tan:aO,tanh:sO,all:GM,any:qM,argMax:KM,argMin:$M,logSumExp:XM,max:YM,mean:QM,min:ZM,moments:JM,sum:tF,prod:eF,equal:XO,equalStrict:YO,greater:QO,greaterEqual:ZO,greaterEqualStrict:JO,greaterStrict:tM,less:eM,lessEqual:nM,lessEqualStrict:rM,lessStrict:oM,notEqual:iM,notEqualStrict:aM,add:RO,addN:AO,addStrict:TO,atan2:_O,div:DO,divStrict:OO,floorDiv:MO,maximum:FO,maximumStrict:PO,minimum:LO,minimumStrict:BO,mod:zO,modStrict:UO,mul:VO,mulStrict:WO,pow:jO,powStrict:HO,squaredDifference:GO,squaredDifferenceStrict:qO,sub:KO,subStrict:$O,elu:nF,leakyRelu:rF,prelu:oF,relu:iF,selu:aF,logicalAnd:CO,logicalNot:EO,logicalOr:SO,logicalXor:kO,where:NO,whereAsync:IO,buffer:KR,print:function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},batchToSpaceND:$R,cast:XR,clone:YR,cumsum:QR,depthToSpace:ZR,expandDims:JR,eye:tA,multinomial:eA,oneHot:nA,pad:rA,pad1d:oA,pad2d:iA,pad3d:aA,pad4d:sA,rand:uA,randomNormal:lA,randomGamma:cA,randomUniform:pA,reshape:hA,spaceToBatchND:fA,squeeze:dA,stack:mA,tile:vA,truncatedNormal:gA,unstack:yA,setdiff1dAsync:bA,fill:SR,linspace:kR,ones:CR,range:NR,scalar:gR,tensor:mR,tensor1d:yR,tensor2d:bR,tensor3d:wR,tensor4d:xR,tensor5d:function(t,e,n){if(Ak(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=QI(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return vR(t,e,r,n)},tensor6d:function(t,e,n){if(Ak(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=QI(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return vR(t,e=e||r,r,n)},zeros:ER,onesLike:IR,zerosLike:RR,transpose:sF,softmax:FA,logSoftmax:PA,localResponseNormalization:uF,norm:lF,gather:lM,unsortedSegmentSum:cM,basicLSTMCell:cF,multiRNNCell:pF,movingAverage:hF,stridedSlice:fF,topk:dF,scatterND:mF,fft:vF,ifft:gF,rfft:yF,irfft:bF,sparseToDense:xF,gatherND:CF,diag:EF,dropout:SF,hannWindow:IF,hammingWindow:RF,frame:AF,stft:TF,inTopKAsync:function(t,e,n){return void 0===n&&(n=1),gk(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,d,m,v;return yk(this,function(g){switch(g.label){case 0:return r=JI(t,"predictions","inTopK"),o=JI(e,"targets","inTopK"),Ik(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),Ik(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Rk(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],Ik(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return a=g.sent(),[4,o.data()];case 2:for(s=g.sent(),c=(u=[a.length/i,i])[1],p=Vk("bool",l=u[0]),h=0;h<l;h++){for(d=a.subarray(f=h*c,f+c),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(t,e){return e.value-t.value}),p[h]=0,v=0;v<n;v++)if(m[v].index===s[h]){p[h]=1;break}}return t!==r&&r.dispose(),e!==o&&o.dispose(),[2,mR(p,o.shape,"bool")]}})})}});function nP(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("prelu"===n)return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var rP=function(){function t(){if(this.blockSize=48,this.firstUse=!0,xk.get("IS_BROWSER")){var t="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(300,150):"undefined"!=typeof document?document.createElement("canvas"):null;null!==t&&(this.fromPixels2DContext=t.getContext("2d"))}this.data=new LA(this,UN)}return t.prototype.register=function(t,e,n){if(this.firstUse&&(this.firstUse=!1,xk.get("IS_NODE")&&YI("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:n})},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=e},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,r,o=t.data instanceof Uint8Array,i="undefined"!=typeof ImageData&&t instanceof ImageData,a="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement;if(xk.get("IS_NODE")&&null==t.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=t.getContext)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(i||o)n=t.data;else{if(!s&&!a)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),n=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}if(4===e)r=new Int32Array(n);else{var u=t.width*t.height;r=new Int32Array(u*e);for(var l=0;l<u;l++)for(var c=0;c<e;++c)r[l*e+c]=n[4*l+c]}return wR(r,[t.height,t.width,e],"int32")},t.prototype.read=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){var e=this.data.get(t),n=e.complexTensors;return"complex64"===e.dtype?nT(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(t).values},t.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map(function(t){return cN(t)})}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return KR(t.shape,t.dtype,n)},t.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},t.prototype.time=function(t){return gk(this,void 0,void 0,function(){var e;return yk(this,function(n){return e=sN(),t(),[2,{kernelMs:sN()-e}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(t,e){var n=CN.make(t.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:UN.keep(t.clone()),imag:UN.keep(e.clone())},n},t.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},t.prototype.assertNotComplex=function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&Ik("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})},t.prototype.slice=function(t,e,n){if(this.assertNotComplex(t,"slice"),DA(t.shape,e,n)){var r=OA(e,t.strides),o=_k(n);return mR(this.readSync(t.dataId).subarray(r,r+o),n,t.dtype)}for(var i=KR(n,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s).map(function(t,n){return t+e[n]});i.values[s]=a.get.apply(a,u)}return i.toTensor()},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s,u){this.assertNotComplex(t,"stridedSlice");var l=AA(t.shape,e,n,r,o,i,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return-1===h.indexOf(e)});if(f.some(function(t){return 0===t}))return mR([],f);for(var d=KR(p,t.dtype),m=this.bufferSync(t),v=0;v<d.size;v++){for(var g=d.indexToLoc(v),y=new Array(g.length),b=0;b<y.length;b++)y[b]=g[b]*r[b]+c[b];d.set.apply(d,[m.get.apply(m,y)].concat(g))}return d.toTensor().reshape(f)},t.prototype.diag=function(t){for(var e=this.readSync(t.dataId),n=KR([t.size,t.size],t.dtype),r=n.values,o=0;o<e.length;o++)r[o*t.size+o]=e[o];return n.toTensor()},t.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},t.prototype.reverse=function(t,e){this.assertNotComplex(t,"reverse");for(var n=KR(t.shape,t.dtype),r=this.bufferSync(t),o=function(o){var i=n.indexToLoc(o),a=i.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(i))},i=0;i<n.size;i++)o(i);return n.toTensor()},t.prototype.concat=function(t,e){var n=this;if("complex64"===t[0].dtype){var r=t.map(function(t){return fR(t)}),o=t.map(function(t){return dR(t)});return hR(this.concat(r,e),this.concat(o,e))}var i=t.map(function(t){var n=_k(t.shape.slice(e));return t.as2D(-1,n)}),a=cR(i.map(function(t){return t.shape}),1),s=KR(a,t[0].dtype).values;if(1===i[0].shape[0]){var u=0;i.forEach(function(t){s.set(n.readSync(t.dataId),u),u+=t.size})}else{var l=0;i.forEach(function(t){for(var e=n.readSync(t.dataId),r=0,o=0;o<t.shape[0];++o)for(var i=o*a[1]+l,u=0;u<t.shape[1];++u)s[i+u]=e[r++];l+=t.shape[1]})}var c=cR(t.map(function(t){return t.shape}),e);return mR(s,c,t[0].dtype)},t.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(gR(-1),t)},t.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,_N(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.addN=function(t){var e=this;this.assertNotComplex(t,"addN");for(var n=t.map(function(t){return e.readSync(t.dataId)}),r=KR(t[0].shape,t[0].dtype),o=r.values,i=0;i<t.length;i++)for(var a=n[i],s=0;s<o.length;s++)o[s]+=a[s];return r.toTensor()},t.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,_N(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.batchMatMul=function(t,e,n,r){this.assertNotComplex([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],i=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),l=this.readSync(e.dataId),c=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=c[0],h=c[1],f=c[2],d=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],m=d[0],v=d[1],g=d[2],y=i*a,b=KR([s,i,a],t.dtype),w=b.values,x=this.blockSize,C=0;C<s;C++)for(var E=0;E<i;E+=x)for(var S=0;S<a;S+=x)for(var k=0;k<o;k+=x)for(var N=Math.min(E+x,i),I=Math.min(S+x,a),R=Math.min(k+x,o),A=E;A<N;A++)for(var T=S;T<I;T++){for(var _=0,D=k;D<R;D++)_+=u[C*p+A*h+D*f]*l[D*m+T*v+C*g];w[C*y+(A*a+T)]+=_}return b.toTensor()},t.prototype.fusedBatchMatMul=function(t){var e=t.bias,n=t.activation,r=t.preluActivationWeights,o=this.batchMatMul(t.a,t.b,t.transposeA,t.transposeB);return e&&(o=this.add(o,e)),n&&(o=nP(this,o,n,r)),o},t.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,_N(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.realDivide=function(t,e){return this.assertNotComplex([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},t.prototype.floorDiv=function(t,e){return this.assertNotComplex([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},t.prototype.sum=function(t,e){this.assertNotComplex(t,"sum"),iR("sum",e,t.rank);for(var n=rR(t.shape,e),r=n[1],o=ER(n[0],_N(t.dtype,"int32")),i=_k(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=0,p=0;p<i;++p)c+=s[l+p];a[u]=c}return o},t.prototype.prod=function(t,e){this.assertNotComplex(t,"sum");for(var n=rR(t.shape,e),r=n[1],o=ER(n[0],_N(t.dtype,"int32")),i=_k(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=1,p=0;p<i;++p)c*=s[l+p];a[u]=c}return o},t.prototype.unsortedSegmentSum=function(t,e,n){this.assertNotComplex(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,i=0;i<o;++i)e=e.expandDims(i+1);for(i=0;i<n;++i){var a=gR(i,"int32"),s=XO(a,e).asType("float32").mul(t).sum(0);r.push(s)}return mA(r)},t.prototype.argMin=function(t,e){this.assertNotComplex(t,"argMin");var n=[e];iR("argMin",n,t.rank);for(var r=rR(t.shape,n),o=r[1],i=ER(r[0],"int32"),a=_k(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0,f=0;f<a;++f){var d=u[c+f];d<p&&(p=d,h=f)}s[l]=h}return i},t.prototype.argMax=function(t,e){this.assertNotComplex(t,"argMax");var n=[e];iR("argMax",n,t.rank);for(var r=rR(t.shape,n),o=r[1],i=ER(r[0],"int32"),a=_k(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0,f=0;f<a;++f){var d=u[c+f];d>p&&(p=d,h=f)}s[l]=h}return i},t.prototype.cumsum=function(t,e,n,r){if(this.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=_N(t.dtype,"int32"),i=ER(t.shape,o),a=this.readSync(i.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],l=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},c=0;c<s.length;c+=u)for(var p=0;p<u;p++){var h=l(c,p);if(0===p)a[h]=n?0:s[h];else{var f=l(c,p-1);a[h]=n?s[f]+a[f]:s[h]+a[f]}}return i},t.prototype.equal=function(t,e){return this.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},t.prototype.notEqual=function(t,e){return this.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},t.prototype.less=function(t,e){return this.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},t.prototype.lessEqual=function(t,e){return this.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},t.prototype.greater=function(t,e){return this.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},t.prototype.greaterEqual=function(t,e){return this.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},t.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return CN.make(t.shape,{values:n},"bool")},t.prototype.logicalAnd=function(t,e){return this.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},t.prototype.logicalOr=function(t,e){return this.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},t.prototype.select=function(t,e,n){this.assertNotComplex([t,e,n],"select");for(var r=this.readSync(t.dataId),o=this.readSync(e.dataId),i=this.readSync(n.dataId),a=ER(e.shape,_N(e.dtype,n.dtype)),s=this.readSync(a.dataId),u=0,l=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],c=0;c<r.length;c++)for(var p=0;p<l;p++)s[u++]=1===r[c]?o[c]:i[c];return a},t.prototype.where=function(t){this.assertNotComplex([t],"where");var e=this.readSync(t.dataId);return pT(t.shape,e)},t.prototype.topk=function(t,e,n){return this.assertNotComplex(t,"topk"),cT(this.readSync(t.dataId),t.shape,t.dtype,e)},t.prototype.min=function(t,e){this.assertNotComplex(t,"min"),iR("min",e,t.rank);for(var n=rR(t.shape,e),r=n[1],o=ER(n[0],t.dtype),i=_k(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p){var h=s[l+p];h<c&&(c=h)}a[u]=c}return o},t.prototype.minimum=function(t,e){return this.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.mod=function(t,e){return this.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},t.prototype.max=function(t,e){this.assertNotComplex(t,"max"),iR("max",e,t.rank);for(var n=rR(t.shape,e),r=n[1],o=ER(n[0],t.dtype),i=_k(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p){var h=s[l+p];h>c&&(c=h)}a[u]=c}return o},t.prototype.maximum=function(t,e){return this.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.all=function(t,e){this.assertNotComplex(t,"all"),iR("all",e,t.rank);for(var n=rR(t.shape,e),r=n[1],o=ER(n[0],t.dtype),i=_k(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p)c=c&&s[l+p];a[u]=c}return o},t.prototype.any=function(t,e){this.assertNotComplex(t,"any"),iR("any",e,t.rank);for(var n=rR(t.shape,e),r=n[1],o=ER(n[0],t.dtype),i=_k(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var l=u*i,c=s[l],p=0;p<i;++p)c=c||s[l+p];a[u]=c}return o},t.prototype.squaredDifference=function(t,e){return this.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},t.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return CN.make(t.shape,{values:n})},t.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return CN.make(t.shape,{values:n})},t.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=e[r]<0?-1:e[r]>0?1:0;return CN.make(t.shape,{values:n})},t.prototype.isNaN=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return CN.make(t.shape,{values:n},"bool")},t.prototype.isInf=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return CN.make(t.shape,{values:n},"bool")},t.prototype.isFinite=function(t){this.assertNotComplex(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return CN.make(t.shape,{values:n},"bool")},t.prototype.round=function(t){this.assertNotComplex(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);n[r]=e[r]-o<.5?Math.floor(e[r]):e[r]-o>.5?Math.ceil(e[r]):o%2==0?o:o+1}return CN.make(t.shape,{values:n})},t.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return CN.make(t.shape,{values:n})},t.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return CN.make(t.shape,{values:n})},t.prototype.log=function(t){this.assertNotComplex(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log(e[r]);return CN.make(t.shape,{values:n})},t.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log1p(e[r]);return CN.make(t.shape,{values:n})},t.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.sqrt(e[r]);return CN.make(t.shape,{values:n})},t.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/Math.sqrt(e[r]);return CN.make(t.shape,{values:n})},t.prototype.square=function(t){this.assertNotComplex(t,"square");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=o*o}return CN.make(t.shape,{values:n})},t.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return CN.make(t.shape,{values:n})},t.prototype.linear=function(t){return t},t.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var e=ER(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},t.prototype.prelu=function(t,e){return this.assertNotComplex([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},t.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return CN.make(t.shape,{values:e})},t.prototype.eluDer=function(t,e){this.assertNotComplex([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=this.readSync(t.dataId),i=0;i<r.length;++i){var a=r[i];n[i]=a>=1?o[i]:o[i]*(a+1)}return CN.make(e.shape,{values:n})},t.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?1.0507009873554805*o:1.7580993408473768*(Math.exp(o)-1)}return CN.make(t.shape,{values:e})},t.prototype.clip=function(t,e,n){this.assertNotComplex(t,"clip");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>n?n:a<e?e:a}return CN.make(t.shape,{values:r})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return CN.make(t.shape,{values:e})},t.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r)e[r]=Math.hypot(n[2*r],n[2*r+1]);return CN.make(t.shape,{values:e})},t.prototype.int=function(t){this.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return CN.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return CN.make(t.shape,{values:e})},t.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i,a=r[o]>-e,s=r[o]<e,u=Math.exp(r[o]);i=s?u:a?r[o]:Math.log(1+u),n[o]=i}return CN.make(t.shape,{values:n})},t.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return CN.make(t.shape,{values:e})},t.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return CN.make(t.shape,{values:e})},t.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return CN.make(t.shape,{values:e})},t.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return CN.make(t.shape,{values:e})},t.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return CN.make(t.shape,{values:e})},t.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return CN.make(t.shape,{values:e})},t.prototype.atan2=function(t,e){return this.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},t.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return CN.make(t.shape,{values:e})},t.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return CN.make(t.shape,{values:e})},t.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Mk(n[r]);return CN.make(t.shape,{values:e})},t.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return CN.make(t.shape,{values:e})},t.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return CN.make(t.shape,{values:e})},t.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return CN.make(t.shape,{values:e})},t.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r],i=1/(1+.3275911*o);e[r]=1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-o*o)}return CN.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0),this.assertNotComplex(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i=r[o];n[o]=isNaN(i)?NaN:i>0?1:e}return CN.make(t.shape,{values:n})},t.prototype.fusedConv2d=function(t,e,n,r,o,i){var a=this.conv2d(t,e,n);return r&&(a=this.add(a,r)),o&&(a=nP(this,a,o,i)),a},t.prototype.conv2d=function(t,e,n){this.assertNotComplex([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l="channelsLast"===n.dataFormat,c=KR(n.outShape,t.dtype),p=t.strides[0],h=l?t.strides[1]:t.strides[2],f=l?t.strides[2]:1,d=l?1:t.strides[1],m=c.strides[0],v=l?c.strides[1]:c.strides[2],g=l?c.strides[2]:1,y=l?1:c.strides[1],b=this.readSync(t.dataId),w=this.readSync(e.dataId),x=c.values,C=0;C<n.batchSize;++C)for(var E=C*p,S=C*m,k=0;k<n.outHeight;++k)for(var N=S+k*v,I=k*n.strideHeight-u,R=0;R<r;R++){var A=I+R*i;if(!(A<0||A>=n.inHeight))for(var T=R*e.strides[0],_=E+A*h,D=0;D<n.outWidth;++D)for(var O=N+D*g,M=D*n.strideWidth-s,F=0;F<o;F++){var P=M+F*a;if(!(P<0||P>=n.inWidth))for(var L=_+P*f,B=T+F*e.strides[1],z=0;z<n.inChannels;++z){for(var U=b[L+z*d],V=0;V<n.outChannels;++V)x[O+V*y]+=U*w[B+V];B+=n.outChannels}}}return c.toTensor()},t.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,i=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,p=n.padInfo.top,h=KR(n.outShape,t.dtype),f=this.readSync(t.dataId),d=this.readSync(e.dataId),m=h.values,v=0;v<n.batchSize;++v)for(var g=v*t.strides[0],y=v*h.strides[0],b=0;b<n.outDepth;++b)for(var w=y+b*h.strides[1],x=b*n.strideDepth-l,C=0;C<r;C++){var E=x+C*a;if(!(E<0||E>=n.inDepth))for(var S=C*e.strides[0],k=g+E*t.strides[1],N=0;N<n.outHeight;++N)for(var I=w+N*h.strides[2],R=N*n.strideHeight-p,A=0;A<o;A++){var T=R+A*s;if(!(T<0||T>=n.inHeight))for(var _=S+A*e.strides[1],D=k+T*t.strides[2],O=0;O<n.outWidth;++O)for(var M=I+O*n.outChannels,F=O*n.strideWidth-c,P=0;P<i;P++){var L=F+P*u;if(!(L<0||L>=n.inWidth))for(var B=D+L*n.inChannels,z=_+P*e.strides[2],U=0;U<n.inChannels;++U){for(var V=f[B+U],W=0;W<n.outChannels;++W)m[M+W]+=V*d[z+W];z+=n.outChannels}}}}return h.toTensor()},t.prototype.conv2dDerInput=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerInput");for(var r=KR(n.inShape,"float32"),o=r.values,i=this.readSync(t.dataId),a=this.readSync(e.dataId),s=e.strides,u=s[0],l=s[1],c=s[2],p=n.batchSize,h=n.filterHeight,f=n.filterWidth,d=n.inChannels,m=n.inHeight,v=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,w=n.strideHeight,x=n.strideWidth,C=h-1-n.padInfo.top,E=f-1-n.padInfo.left,S="channelsLast"===n.dataFormat,k=r.strides[0],N=S?r.strides[1]:r.strides[2],I=S?r.strides[2]:1,R=S?1:r.strides[1],A=t.strides[0],T=S?t.strides[1]:t.strides[2],_=S?t.strides[2]:1,D=S?1:t.strides[1],O=0;O<p;++O)for(var M=0;M<d;++M)for(var F=0;F<m;++F)for(var P=F-C,L=Math.max(0,Math.ceil(P/w)),B=Math.min(y,(h+P)/w),z=0;z<v;++z){for(var U=z-E,V=Math.max(0,Math.ceil(U/x)),W=Math.min(b,(f+U)/x),j=0,H=L;H<B;++H)for(var G=H*w-P,q=V;q<W;++q)for(var K=A*O+T*H+_*q,$=u*(h-1-G)+l*(f-1-(q*x-U))+c*M,X=0;X<g;++X)j+=i[K+D*X]*a[$+X];o[k*O+N*F+I*z+R*M]=j}return r.toTensor()},t.prototype.conv3dDerInput=function(t,e,n){for(var r=KR(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=i[3],c=this.readSync(t.dataId),p=t.strides,h=p[0],f=p[1],d=p[2],m=p[3],v=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],w=g[2],x=g[3],C=n.batchSize,E=n.filterDepth,S=n.filterHeight,k=n.filterWidth,N=n.inChannels,I=n.inDepth,R=n.inHeight,A=n.inWidth,T=n.outChannels,_=n.outDepth,D=n.outHeight,O=n.outWidth,M=n.strideDepth,F=n.strideHeight,P=n.strideWidth,L=E-1-n.padInfo.front,B=S-1-n.padInfo.top,z=k-1-n.padInfo.left,U=0;U<C;++U)for(var V=0;V<N;++V)for(var W=0;W<I;++W)for(var j=W-L,H=Math.max(0,Math.ceil(j/M)),G=Math.min(_,(E+j)/M),q=0;q<R;++q)for(var K=q-B,$=Math.max(0,Math.ceil(K/F)),X=Math.min(D,(S+K)/F),Y=0;Y<A;++Y){for(var Q=Y-z,Z=Math.max(0,Math.ceil(Q/P)),J=Math.min(O,(k+Q)/P),tt=0,et=H;et<G;++et)for(var nt=et*M-j,rt=$;rt<X;++rt)for(var ot=rt*F-K,it=Z;it<J;++it)for(var at=h*U+f*et+d*rt+m*it,st=y*(E-1-nt)+b*(S-1-ot)+w*(k-1-(it*P-Q))+x*V,ut=0;ut<T;++ut)tt+=c[at+ut]*v[st+ut];o[a*U+s*W+u*q+l*Y+V]=tt}return r.toTensor()},t.prototype.conv2dDerFilter=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s="channelsLast"===n.dataFormat,u=KR(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,p=this.bufferSync(t),h=this.bufferSync(e),f=0;f<i;++f)for(var d=Math.max(0,Math.ceil((c-f)/r)),m=Math.min(n.outHeight,(n.inHeight+c-f)/r),v=0;v<a;++v)for(var g=Math.max(0,Math.ceil((l-v)/o)),y=Math.min(n.outWidth,(n.inWidth+l-v)/o),b=0;b<n.inChannels;++b)for(var w=0;w<n.outChannels;++w){for(var x=0,C=0;C<n.batchSize;++C)for(var E=d;E<m;++E)for(var S=f+E*r-c,k=g;k<y;++k){var N=v+k*o-l;x+=s?p.get(C,S,N,b)*h.get(C,E,k,w):p.get(C,b,S,N)*h.get(C,w,E,k)}u.set(x,f,v,b,w)}return u.toTensor()},t.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=KR(n.filterShape,"float32"),c=l.values,p=l.strides,h=p[0],f=p[1],d=p[2],m=p[3],v=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],w=g[2],x=g[3],C=this.readSync(t.dataId),E=t.strides,S=E[0],k=E[1],N=E[2],I=E[3],R=n.padInfo.front,A=n.padInfo.left,T=n.padInfo.top,_=0;_<a;++_)for(var D=Math.max(0,Math.ceil((R-_)/r)),O=Math.min(n.outDepth,(n.inDepth+R-_)/r),M=_*h,F=0;F<s;++F)for(var P=Math.max(0,Math.ceil((T-F)/o)),L=Math.min(n.outHeight,(n.inHeight+T-F)/o),B=F*f+M,z=0;z<u;++z)for(var U=Math.max(0,Math.ceil((A-z)/i)),V=Math.min(n.outWidth,(n.inWidth+A-z)/i),W=z*d+B,j=0;j<n.inChannels;++j)for(var H=j*m+W,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var $=K*S,X=K*y,Y=D;Y<O;++Y)for(var Q=(_+Y*r-R)*k+$,Z=Y*b+X,J=P;J<L;++J)for(var tt=(F+J*o-T)*N+Q,et=J*w+Z,nt=U;nt<V;++nt)q+=C[(z+nt*i-A)*I+tt+j]*v[nt*x+et+G];c[H+G]=q}return l.toTensor()},t.prototype.depthwiseConv2D=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=KR(n.outShape,t.dtype),p=this.readSync(t.dataId),h=this.readSync(e.dataId),f=c.values,d=0;d<n.batchSize;++d)for(var m=d*t.strides[0],v=d*c.strides[0],g=0;g<n.outHeight;++g)for(var y=v+g*c.strides[1],b=g*n.strideHeight-s,w=0;w<r;++w){var x=b+w*i;if(!(x<0||x>=n.inHeight))for(var C=w*e.strides[0],E=m+x*t.strides[1],S=0;S<n.outWidth;++S)for(var k=y+S*c.strides[2],N=S*n.strideWidth-u,I=0;I<o;++I){var R=N+I*a;if(!(R<0||R>=n.inWidth))for(var A=E+R*n.inChannels,T=k,_=C+I*e.strides[1],D=0;D<n.inChannels;++D){for(var O=p[A+D],M=0;M<l;++M)f[T+M]+=O*h[_+M];T+=l,_+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var r=KR(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],l=this.readSync(t.dataId),c=t.strides,p=c[0],h=c[1],f=c[2],d=this.readSync(e.dataId),m=e.strides,v=m[0],g=m[1],y=m[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,C=n.inChannels,E=n.inHeight,S=n.inWidth,k=n.outHeight,N=n.outWidth,I=n.strideHeight,R=n.strideWidth,A=w-1-n.padInfo.top,T=x-1-n.padInfo.left,_=n.outChannels/C,D=0;D<b;++D)for(var O=0;O<C;++O)for(var M=0;M<E;++M)for(var F=M-A,P=Math.max(0,Math.ceil(F/I)),L=Math.min(k,(w+F)/I),B=0;B<S;++B){for(var z=B-T,U=Math.max(0,Math.ceil(z/R)),V=Math.min(N,(x+z)/R),W=0,j=P;j<L;++j)for(var H=j*I-F,G=U;G<V;++G)for(var q=p*D+h*j+f*G,K=v*(w-1-H)+g*(x-1-(G*R-z))+y*O,$=0;$<_;++$)W+=l[q+(O*_+$)]*d[K+$];o[a*D+s*M+u*B+O]=W}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=KR(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,p=this.bufferSync(t),h=this.bufferSync(e),f=0;f<i;++f)for(var d=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),v=0;v<a;++v)for(var g=Math.max(0,Math.ceil((u-v)/o)),y=Math.min(n.outWidth,(n.inWidth+u-v)/o),b=0;b<n.outChannels;++b){for(var w=Math.trunc(b/c),x=b%c,C=0,E=0;E<n.batchSize;++E)for(var S=d;S<m;++S)for(var k=f+S*r-l,N=g;N<y;++N)C+=p.get(E,k,v+N*o-u,w)*h.get(E,S,N,b);s.set(C,f,v,w,x)}return s.toTensor()},t.prototype.tile=function(t,e){return this.assertNotComplex(t,"tile"),lT(this.bufferSync(t),e)},t.prototype.pad=function(t,e,n){this.assertNotComplex(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),o=e.map(function(t){return t[0]}),i=this.bufferSync(t),a=KR(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=i.indexToLoc(s),l=u.map(function(t,e){return t+o[e]});a.set.apply(a,[i.get.apply(i,u)].concat(l))}return a.toTensor()},t.prototype.transpose=function(t,e){this.assertNotComplex(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var o=this.readSync(t.dataId),i=KR(n,t.dtype),a=this.bufferSync(t);for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[e[l]];var c=i.locToIndex(u);i.values[c]=o[r]}return i.toTensor()},t.prototype.gather=function(t,e,n){this.assertNotComplex([t,e],"gather");var r=t.shape.slice(),o=this.readSync(e.dataId);r[n]=o.length;for(var i=KR(r,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=a.locToIndex(l);i.values[s]=a.values[c]}return i.toTensor()},t.prototype.batchToSpaceND=function(t,e,n){this.assertNotComplex([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),o=wA(t.shape,e,r),i=xA(o.length,e.length),a=CA(t.shape,e,r),s=EA(n,e.length),u=SA(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){this.assertNotComplex([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=wA(a.shape,e,r,!1),u=xA(s.length,e.length,!1),l=CA(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(l)},t.prototype.pool=function(t,e,n){this.assertNotComplex(t,"pool");for(var r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=this.readSync(t.dataId),f=KR(e.outShape,t.dtype),d=f.values,m=e.outShape[1]*e.outShape[2]*e.outShape[3],v=e.outShape[2]*e.outShape[3],g=e.outShape[3],y=0;y<e.batchSize;++y)for(var b=y*m,w=y*t.strides[0],x=0;x<e.inChannels;++x)for(var C=0;C<e.outHeight;++C)for(var E=C*r-l,S=Math.max(0,E),k=Math.min(e.inHeight,s+E),N=b+C*v,I=0;I<e.outWidth;++I){for(var R=I*o-c,A=Math.max(0,R),T=Math.min(e.inWidth,u+R),_=p,D=0,O=0,M=S;M<k;M+=i){for(var F=w+M*t.strides[1],P=A;P<T;P+=a){var L=h[F+P*t.strides[2]+x];"max"===n&&L>_?_=L:"avg"===n&&(D+=L,O++)}if(isNaN(_))break}d[N+I*g+x]="avg"===n?D/O:_}return f.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var n=KR(e.outShape,"int32"),r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p=this.bufferSync(t),h=0;h<e.batchSize;++h)for(var f=0;f<e.inChannels;++f)for(var d=0;d<e.outHeight;++d){for(var m=d*r-l,v=m;v<0;)v+=i;for(var g=Math.min(e.inHeight,s+m),y=0;y<e.outWidth;++y){for(var b=y*o-c,w=b;w<0;)w+=a;for(var x=Math.min(e.inWidth,u+b),C=Number.NEGATIVE_INFINITY,E=-1,S=v;S<g;S+=i)for(var k=S-m,N=w;N<x;N+=a){var I=N-b,R=p.get(h,S,N,f);R>C&&(C=R,E=k*u+I)}n.set(E,h,d,y,f)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(t,e,n,r){this.assertNotComplex([e,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,r),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,p=c-1-r.padInfo.left,h=l-1-r.padInfo.top,f=KR(e.shape,"float32"),d=this.bufferSync(o),m=this.bufferSync(t),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var w=y-h,x=b-p,C=0,E=0;E<l;E+=s){var S=(w+E)/i;if(!(S<0||S>=r.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var N=(x+k)/a;if(!(N<0||N>=r.outWidth||Math.floor(N)!==N)){var I=l*c-1-d.get(v,S,N,g)===E*c+k?1:0;0!==I&&(C+=m.get(v,S,N,g)*I)}}}f.set(C,v,y,b,g)}return f.toTensor()},t.prototype.avgPoolBackprop=function(t,e,n){this.assertNotComplex([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,p=c-1-n.padInfo.left,h=l-1-n.padInfo.top,f=KR(e.shape,"float32"),d=1/(i*a),m=this.bufferSync(t),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var w=y-h,x=b-p,C=0,E=0;E<l;E+=s){var S=(w+E)/r;if(!(S<0||S>=n.outHeight||Math.floor(S)!==S))for(var k=0;k<c;k+=u){var N=(x+k)/o;N<0||N>=n.outWidth||Math.floor(N)!==N||(C+=m.get(v,S,N,g))}}f.set(C*d,v,y,b,g)}return f.toTensor()},t.prototype.pool3d=function(t,e,n){this.assertNotComplex(t,"pool3d");for(var r=e.strideDepth,o=e.strideHeight,i=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=e.padInfo.front,f=e.padInfo.top,d=e.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(t.dataId),g=KR(e.outShape,t.dtype),y=g.values,b=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[2]*e.outShape[3]*e.outShape[4],x=e.outShape[3]*e.outShape[4],C=e.outShape[4],E=0;E<e.batchSize;++E)for(var S=E*b,k=E*t.strides[0],N=0;N<e.inChannels;++N)for(var I=0;I<e.outDepth;++I){for(var R=I*r-h,A=R;A<0;)A+=a;for(var T=Math.min(e.inDepth,l+R),_=S+I*w,D=0;D<e.outHeight;++D){for(var O=D*o-f,M=O;M<0;)M+=s;for(var F=Math.min(e.inHeight,c+O),P=_+D*x,L=0;L<e.outWidth;++L){for(var B=L*i-d,z=B;z<0;)z+=u;for(var U=Math.min(e.inWidth,p+B),V=P+L*C,W=m,j=0,H=0,G=A;G<T;G+=a){for(var q=k+G*t.strides[1],K=M;K<F;K+=s){for(var $=q+K*t.strides[2],X=z;X<U;X+=u){var Y=v[$+X*t.strides[3]+N];if("max"===n&&Y>W?W=Y:"avg"===n&&(j+=Y,H++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}y[V+N]="avg"===n?j/H:W}}}return g.toTensor()},t.prototype.avgPool3d=function(t,e){return this.assertNotComplex(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(t,e,n){this.assertNotComplex([t,e],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=n.dilationDepth,c=n.dilationHeight,p=n.dilationWidth,h=n.effectiveFilterDepth,f=n.effectiveFilterHeight,d=n.effectiveFilterWidth,m=h-1-n.padInfo.front,v=d-1-n.padInfo.left,g=f-1-n.padInfo.top,y=KR(e.shape,"float32"),b=1/(a*s*u),w=this.bufferSync(t),x=0;x<n.batchSize;++x)for(var C=0;C<n.inChannels;++C)for(var E=0;E<n.inDepth;++E)for(var S=0;S<n.inHeight;++S)for(var k=0;k<n.inWidth;++k){for(var N=E-m,I=S-g,R=k-v,A=0,T=0;T<h;T+=l){var _=(N+T)/r;if(!(_<0||_>=n.outDepth||Math.floor(_)!==_))for(var D=0;D<f;D+=c){var O=(I+D)/o;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var M=0;M<d;M+=p){var F=(R+M)/i;F<0||F>=n.outWidth||Math.floor(F)!==F||(A+=w.get(x,_,O,F,C))}}}y.set(A*b,x,E,S,k,C)}return y.toTensor()},t.prototype.maxPool3d=function(t,e){return this.assertNotComplex(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},t.prototype.maxPool3dPositions=function(t,e){for(var n=KR(e.outShape,"int32"),r=e.strideDepth,o=e.strideHeight,i=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,p=e.effectiveFilterWidth,h=e.padInfo.front,f=e.padInfo.top,d=e.padInfo.left,m=this.bufferSync(t),v=0;v<e.batchSize;++v)for(var g=0;g<e.inChannels;++g)for(var y=0;y<e.outDepth;++y){for(var b=y*r-h,w=b;w<0;)w+=a;for(var x=Math.min(e.inDepth,l+b),C=0;C<e.outHeight;++C){for(var E=C*o-f,S=E;S<0;)S+=s;for(var k=Math.min(e.inHeight,c+E),N=0;N<e.outWidth;++N){for(var I=N*i-d,R=I;R<0;)R+=u;for(var A=Math.min(e.inWidth,p+I),T=Number.NEGATIVE_INFINITY,_=-1,D=w;D<x;D+=a)for(var O=D-b,M=S;M<k;M+=s)for(var F=M-E,P=R;P<A;P+=u){var L=P-I,B=m.get(v,D,M,P,g);B>=T&&(T=B,_=O*c*p+F*c+L)}n.set(_,v,y,C,N,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(t,e,n,r){this.assertNotComplex([e,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(e,r),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,p=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=p-1-r.padInfo.front,m=f-1-r.padInfo.left,v=h-1-r.padInfo.top,g=KR(e.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var x=0;x<r.inChannels;++x)for(var C=0;C<r.inDepth;++C)for(var E=0;E<r.inHeight;++E)for(var S=0;S<r.inWidth;++S){for(var k=C-d,N=E-v,I=S-m,R=0,A=0;A<p;A+=u){var T=(k+A)/i;if(!(T<0||T>=r.outDepth||Math.floor(T)!==T))for(var _=0;_<h;_+=l){var D=(N+_)/a;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var O=0;O<f;O+=c){var M=(I+O)/s;if(!(M<0||M>=r.outWidth||Math.floor(M)!==M)){var F=p*h*f-1-y.get(w,T,D,M,x)===A*h*f+_*f+O?1:0;0!==F&&(R+=b.get(w,T,D,M,x)*F)}}}}g.set(R,w,C,E,S,x)}return g.toTensor()},t.prototype.cast=function(t,e){return JA(t,e,this)},t.prototype.reshape=function(t,e){return tT(t,e)},t.prototype.avgPool=function(t,e){return this.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,n,r){this.assertNotComplex(t,"resizeBilinear");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],l=this.readSync(t.dataId),c=new Float32Array(_k([i,e,n,u])),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=0,d=p[0]/h[0],m=p[1]/h[1],v=0;v<i;v++)for(var g=0;g<e;g++)for(var y=d*g,b=Math.floor(y),w=y-b,x=Math.min(a-1,Math.ceil(y)),C=v*t.strides[0]+b*t.strides[1],E=v*t.strides[0]+x*t.strides[1],S=0;S<n;S++)for(var k=m*S,N=Math.floor(k),I=k-N,R=Math.min(s-1,Math.ceil(k)),A=C+N*t.strides[2],T=E+N*t.strides[2],_=C+ +R*t.strides[2],D=E+R*t.strides[2],O=0;O<u;O++){var M=l[A+O],F=l[T+O],P=M+(l[_+O]-M)*I;c[f++]=P+(F+(l[D+O]-F)*I-P)*w}return mR(c,[i,e,n,u])},t.prototype.resizeBilinearBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*i*a*s),h=[n&&l>1?i-1:i,n&&c>1?a-1:a],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],d=h[0]/f[0],m=h[1]/f[1],v=this.readSync(t.dataId),g=0,y=0;y<o;y++)for(var b=y*e.strides[0],w=0;w<l;w++)for(var x=w*d,C=Math.floor(x),E=Math.min(Math.ceil(x),i-1),S=b+C*e.strides[1],k=b+E*e.strides[1],N=x-C,I=1-N,R=0;R<c;R++)for(var A=R*m,T=Math.floor(A),_=Math.min(Math.ceil(A),a-1),D=A-T,O=1-D,M=S+T*e.strides[2],F=S+_*e.strides[2],P=k+T*e.strides[2],L=k+_*e.strides[2],B=I*O,z=I*D,U=N*O,V=N*D,W=0;W<s;W++){var j=v[g++];p[M+W]+=j*B,p[F+W]+=j*z,p[P+W]+=j*U,p[L+W]+=j*V}return xR(p,[o,a,i,s],e.dtype)},t.prototype.resizeNearestNeighbor=function(t,e,n,r){this.assertNotComplex(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],l=this.readSync(t.dataId),c=new Float32Array(i*e*n*u),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=p[0]/h[0],d=p[1]/h[1],m=0,v=0;v<i;v++)for(var g=v*t.strides[0],y=0;y<e;y++)for(var b=f*y,w=g+Math.min(a-1,r?Math.round(b):Math.floor(b))*t.strides[1],x=0;x<n;x++)for(var C=d*x,E=w+Math.min(s-1,r?Math.round(C):Math.floor(C))*t.strides[2],S=0;S<u;S++)c[m++]=l[E+S];return mR(c,[i,e,n,u],t.dtype)},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(o*i*a*s),h=this.readSync(t.dataId),f=[n&&l>1?i-1:i,n&&c>1?a-1:a],d=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=f[0]/d[0],v=f[1]/d[1],g=1/m,y=1/v,b=2*Math.ceil(g)+2,w=2*Math.ceil(y)+2,x=0;x<o;x++)for(var C=x*e.strides[0],E=0;E<i;E++)for(var S=C+E*e.strides[1],k=Math.floor(E*g),N=Math.floor(k-b/2),I=0;I<a;I++)for(var R=S+I*e.strides[2],A=Math.floor(I*y),T=Math.floor(A-w/2),_=0;_<s;_++){for(var D=0,O=0;O<b;O++){var M=O+N;if(!(M<0||M>=l)){var F=C+M*t.strides[1],P=M*m;if(E===Math.min(i-1,n?Math.round(P):Math.floor(P)))for(var L=0;L<w;L++){var B=L+T;if(!(B<0||B>=c)){var z=F+B*t.strides[2],U=B*v;I===Math.min(a-1,n?Math.round(U):Math.floor(U))&&(D+=h[z+_])}}}}p[R+_]=D}return xR(p,e.shape,e.dtype)},t.prototype.batchNormalization=function(t,e,n,r,o,i){this.assertNotComplex([t,e,n,o,i],"batchNorm");for(var a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(n.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=i?this.readSync(i.dataId):new Float32Array([0]),p=new Float32Array(a.length),h=c.length,f=l.length,d=u.length,m=s.length,v=0,g=0,y=0,b=0,w=0;w<a.length;++w)p[w]=c[v++]+(a[w]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),v>=h&&(v=0),g>=m&&(g=0),y>=f&&(y=0),b>=d&&(b=0);return xR(p,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){this.assertNotComplex(t,"localResponseNormalization4D");var i=t.shape[3],a=i-1,s=this.readSync(t.dataId),u=t.size,l=new Float32Array(u);function c(t){for(var n=t%i,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,a),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var p=0;p<u;p++){var h=c(p),f=s[p]*Math.pow(n+r*h,-o);l[p]=f}return xR(l,t.shape)},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){this.assertNotComplex(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),l=this.readSync(e.dataId),c=this.readSync(n.dataId),p=new Float32Array(t.size),h=t.size,f=0;f<h;f++){for(var d=f%s,m=f-d+Math.max(0,d-r),v=f-d+Math.min(s,d+r+1),g=0,y=m;y<v;y++)g+=Math.pow(l[y],2);for(g=i*g+o,y=m;y<v;y++){var b=-2*i*a*l[y]*c[f]/g;f===y&&(b+=Math.pow(g,-a)),p[y]+=b*=u[f]}}return xR(p,t.shape)},t.prototype.multinomial=function(t,e,n,r){this.assertNotComplex(t,"multinomial");for(var o=e?t:FA(t),i=o.shape[0],a=o.shape[1],s=ER([i,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<i;++c){var p=c*a,h=new Float32Array(a-1);h[0]=l[p];for(var f=1;f<h.length;++f)h[f]=h[f-1]+l[p+f];for(var d=jR(r.toString()),m=c*n,v=0;v<n;++v){var g=d();u[m+v]=h.length;for(var y=0;y<h.length;y++)if(g<h[y]){u[m+v]=y;break}}}return s},t.prototype.oneHot=function(t,e,n,r){this.assertNotComplex(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var i=this.readSync(t.dataId),a=0;a<t.size;++a)i[a]>=0&&i[a]<e&&(o[a*e+i[a]]=n);return bR(o,[t.size,e],"int32")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return this.assertNotComplex(t,"nonMaxSuppression"),aT(this.readSync(t.dataId),this.readSync(e.dataId),n,r,o)},t.prototype.fft=function(t){return this.fftBatch(t,!1)},t.prototype.ifft=function(t){return this.fftBatch(t,!0)},t.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=KR(t.shape,"float32"),i=KR(t.shape,"float32"),a=fR(t).as2D(n,r),s=dR(t).as2D(n,r),u=0;u<n;u++)for(var l=a.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),p=hR(l,c),h=this.readSync(this.fftImpl(p,e).dataId),f=0;f<r;f++){var d=rT(h,f);o.values[u*r+f]=d.real,i.values[u*r+f]=d.imag}return hR(o.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=hR(fR(o).div(gR(r)),dR(o).div(gR(r)))),o}var i=this.readSync(t.dataId),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(i,r,e));return hR(a.real,a.imag).as2D(t.shape[0],t.shape[1])},t.prototype.isExponentOf2=function(t){return 0==(t&t-1)},t.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),o=e/2,i=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),a=hR(i.real,i.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=hR(s.real,s.imag).as1D();a=this.fftRadix2(a,o,n),u=this.fftRadix2(u,o,n);var l=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var i=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}(e,n),c=hR(l.real,l.imag).mul(u),p=a.add(c),h=a.sub(c),f=fR(p).concat(fR(h)),d=dR(p).concat(dR(h));return hR(f,d).as1D()},t.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var i=0,a=0,s=0;s<e;s++){var u=iT(o*s,e,n),l=rT(t,s);i+=l.real*u.real-l.imag*u.imag,a+=l.real*u.imag+l.imag*u.real}n&&(i/=e,a/=e),oT(r,i,a,o)}return r},t.prototype.depthToSpace=function(t,e,n){Ik("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),Ik(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var r=t.shape[0],o=t.shape[1],i=t.shape[2],a=t.shape[3],s=o*e,u=i*e,l=a/(e*e),c=this.readSync(t.dataId),p=new Float32Array(r*s*u*l),h=0,f=0;f<r;++f)for(var d=0;d<s;++d)for(var m=Math.floor(d/e),v=d%e,g=0;g<u;++g)for(var y=Math.floor(g/e),b=(v*e+g%e)*l,w=0;w<l;++w)p[h++]=c[w+b+a*(y+i*(m+o*f))];return xR(p,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=UA(t.shape,e.shape),i=KR(o,n),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=BA(t.shape,o),l=BA(e.shape,o),c=i.values;if(u.length+l.length===0)for(var p=0;p<c.length;++p)c[p]=r(a[p%a.length],s[p%s.length]);else{var h=this.bufferSync(t),f=this.bufferSync(e),d=function(n){var o=i.indexToLoc(n),p=o.slice(-t.rank);u.forEach(function(t){return p[t]=0});var d=h.locToIndex(p),m=o.slice(-e.rank);l.forEach(function(t){return m[t]=0});var v=f.locToIndex(m);c[n]=r(a[d],s[v])};for(p=0;p<c.length;++p)d(p)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=UA(t.shape,e.shape),o=KR(r,"float32"),i=KR(r,"float32"),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=BA(t.shape,r),l=BA(e.shape,r),c=o.values,p=i.values;if(u.length+l.length===0)for(var h=0;h<c.length;h++){var f=h%a.length,d=h%s.length,m=n(a[2*f],a[2*f+1],s[2*d],s[2*d+1]);c[h]=m.real,p[h]=m.imag}else{var v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var i=o.indexToLoc(r),h=i.slice(-t.rank);u.forEach(function(t){return h[t]=0});var f=v.locToIndex(h),d=i.slice(-e.rank);l.forEach(function(t){return d[t]=0});var m=g.locToIndex(d),y=n(a[2*f],a[2*f+1],s[2*m],s[2*m+1]);c[r]=y.real,p[r]=y.imag};for(h=0;h<c.length;h++)y(h)}return this.complex(o.toTensor(),i.toTensor())},t.prototype.split=function(t,e,n){return uT(t,e,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(t,e,n,r,o,i){for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],p=e.shape[0],h=r[0],f=r[1],d=KR([p,h,f,c],t.dtype),m=this.readSync(e.dataId),v=this.readSync(n.dataId),g=this.readSync(t.dataId),y=t.strides,b=d.strides,w=0;w<p;w++){var x=4*w,C=m[x],E=m[x+1],S=m[x+2],k=m[x+3],N=v[w];if(!(N>=s))for(var I=h>1?(S-C)*(u-1)/(h-1):0,R=f>1?(k-E)*(l-1)/(f-1):0,A=0;A<h;A++){var T=h>1?C*(u-1)+A*I:.5*(C+S)*(u-1);if(T<0||T>u-1)for(var _=0;_<f;_++)for(var D=0;D<c;D++){var O=D+_*b[2]+A*b[1]+w*b[0];d.values[O]=i}else if("bilinear"===o){var M=Math.floor(T),F=Math.ceil(T),P=T-M;for(_=0;_<f;_++)if((G=f>1?E*(l-1)+_*R:.5*(E+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)d.values[O=D+_*b[2]+A*b[1]+w*b[0]]=i;else{var L=Math.floor(G),B=Math.ceil(G),z=G-L;for(D=0;D<c;D++){var U=g[O=D+L*y[2]+M*y[1]+N*y[0]],V=g[O=D+B*y[2]+M*y[1]+N*y[0]],W=g[O=D+L*y[2]+F*y[1]+N*y[0]],j=U+(V-U)*z,H=W+(g[O=D+B*y[2]+F*y[1]+N*y[0]]-W)*z;d.values[O=D+_*b[2]+A*b[1]+w*b[0]]=j+(H-j)*P}}}else for(_=0;_<f;++_){var G;if((G=f>1?E*(l-1)+_*R:.5*(E+k)*(l-1))<0||G>l-1)for(D=0;D<c;D++)d.values[O=D+_*b[2]+A*b[1]+w*b[0]]=i;else{var q=Math.round(G),K=Math.round(T);for(D=0;D<c;D++)d.values[D+_*b[2]+A*b[1]+w*b[0]]=g[D+q*y[2]+K*y[1]+N*y[0]]}}}}return d.toTensor()},t.prototype.sparseToDense=function(t,e,n,r){var o=RA(0,t,n);return this.scatter(t,e,n,o.outputSize,o.sliceSize,o.numUpdates,o.sliceRank,o.strides,r,!1)},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=kA(t,e),i=o[0],a=o[1],s=o[2],u=o[3];if(0===a)return mR([],i,t.dtype);for(var l=new yN([a,s],t.dtype),c=this.readSync(e.dataId),p=this.readSync(t.dataId),h=0;h<a;h++){for(var f=[],d=0,m=0;m<r;m++){var v=c[h*r+m];d+=v*u[m],f.push(v)}if(d<0||d>=t.size/s)throw new Error("Invalid indices: "+f+" does not index into "+t.shape);for(var g=0;g<s;g++)l.values[h*s+g]=p[d*s+g]}return l.toTensor().reshape(i)},t.prototype.scatterND=function(t,e,n){var r=RA(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=gR(0);return this.scatter(t,e,n,u,a,i,o,s,l,!0)},t.prototype.fill=function(t,e,n){var r=Wk(n=n||Jk(e),_k(t));return r.fill(e),CN.make(t,{values:r},n)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){var e=Wk(t.dtype,_k(t.shape));return CN.make(t.shape,{values:e},t.dtype)},t.prototype.linspace=function(t,e,n){return eT(t,e,n)},t.prototype.scatter=function(t,e,n,r,o,i,a,s,u,l){var c=[r/o,o],p=this.readSync(t.dataId),h=this.readSync(e.dataId);if(0===r)return mR([],n,e.dtype);var f=new yN(c,e.dtype);f.values.fill(this.readSync(u.dataId)[0]);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<a;g++){var y=p[d*a+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/o)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<o;b++)l?f.values[v*o+b]+=h[d*o+b]:f.values[v*o+b]=0===e.rank?h[0]:h[d*o+b]}return f.toTensor().reshape(n)},t}();UN.registerBackend("cpu",function(){return new rP},1);var oP=function(){function t(){this.textEncoder=new TextEncoder}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();xk.get("IS_BROWSER")&&xk.setPlatform("browser",new oP);var iP,aP=function(){function t(){this.util=n(6),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=xk.global.fetch?xk.global.fetch(t,e):(null==iP&&(iP=n(5)),iP(t,e))},t.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();xk.get("IS_NODE")&&xk.setPlatform("node",new aP);var sP={float32:4,int32:4,uint16:2,uint8:1,bool:1},uP=4;function lP(t,e){for(var n={},r=0,o=function(e){var o=e.name,i=e.dtype,a=e.shape,s=_k(a),u=void 0;if("quantization"in e){var l=e.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=sP[l.dtype],p=t.slice(r,r+s*c),h="uint8"===l.dtype?new Uint8Array(p):new Uint16Array(p);if("float32"===i)u=Float32Array.from(h,function(t){return t*l.scale+l.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=Int32Array.from(h,function(t){return Math.round(t*l.scale+l.min)})}r+=s*c}else if("string"===i){var f=_k(e.shape);u=[];for(var d=0;d<f;d++){var m=new Uint32Array(t.slice(r,r+uP))[0];r+=uP;var v=new Uint8Array(t.slice(r,r+m));u.push(v),r+=m}}else{var g=sP[i];if(p=t.slice(r,r+s*g),"float32"===i)u=new Float32Array(p);else if("int32"===i)u=new Int32Array(p);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=new Uint8Array(p)}r+=s*g}n[o]=mR(u,a,i)},i=0,a=e;i<a.length;i++)o(a[i]);return n}function cP(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),o=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength}),r.buffer}var pP="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function hP(t){return pP?Buffer.byteLength(t):new Blob([t]).size}function fP(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function dP(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function mP(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:hP(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:hP(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var vP=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var o=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(t){var n=t(e,r);null!==n&&o.push(n)}),o},t}(),gP="://",yP=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){Ik(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(gP)&&(e=e.slice(0,e.indexOf(gP))),Ik(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();Ik(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function bP(t){if(-1===t.indexOf(gP))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+yP.getSchemes().join(","));return{scheme:t.split(gP)[0],path:t.split(gP)[1]}}function wP(t,e,n){return void 0===n&&(n=!1),gk(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p;return yk(this,function(h){switch(h.label){case 0:return Ik(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),Ik((r=vP.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),Ik(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],Ik((i=vP.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),Ik(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=i[0],s=bP(t).scheme,u=bP(t).path,l=s===bP(t).scheme,[4,o.load()];case 1:return c=h.sent(),n&&l?[4,yP.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,a.save(c)];case 4:return p=h.sent(),!n||l?[3,6]:[4,yP.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var xP="models_store",CP="model_info_store";function EP(){if(!xk.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function SP(t){var e=t.result;e.createObjectStore(xP,{keyPath:"modelPath"}),e.createObjectStore(CP,{keyPath:"modelPath"})}var kP=function(){function t(t){if(this.indexedDB=EP(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return SP(o)},o.onsuccess=function(){var i=o.result;if(null==e){var a=i.transaction(xP,"readonly"),s=a.objectStore(xP).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return i.close(),r(s.error)},a.oncomplete=function(){return i.close()}}else{var u,l=mP(e),c=i.transaction(CP,"readwrite"),p=c.objectStore(CP),h=p.put({modelPath:n.modelPath,modelArtifactsInfo:l});h.onsuccess=function(){var o=(u=i.transaction(xP,"readwrite")).objectStore(xP).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:l});o.onsuccess=function(){return t({modelArtifactsInfo:l})},o.onerror=function(t){var e=(p=c.objectStore(CP)).delete(n.modelPath);e.onsuccess=function(){return i.close(),r(o.error)},e.onerror=function(t){return i.close(),r(o.error)}}},h.onerror=function(t){return i.close(),r(h.error)},c.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(t){return r(o.error)}})},t.URL_SCHEME="indexeddb://",t}(),NP=function(t){return xk.getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(kP.URL_SCHEME)?(e=t.slice(kP.URL_SCHEME.length),new kP(e)):null;var e};vP.registerSaveRouter(NP),vP.registerLoadRouter(NP);var IP=function(){function t(){this.indexedDB=EP()}return t.prototype.listModels=function(){return gk(this,void 0,void 0,function(){var t=this;return yk(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return SP(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(CP,"readonly"),i=o.objectStore(CP).getAll();i.onsuccess=function(){for(var t={},n=0,r=i.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},i.onerror=function(e){return t.close(),n(i.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return gk(this,void 0,void 0,function(){var e=this;return yk(this,function(n){var r;return t=(r=t).startsWith(kP.URL_SCHEME)?r.slice(kP.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return SP(o)},o.onsuccess=function(){var e,i=o.result,a=i.transaction(CP,"readwrite"),s=a.objectStore(CP),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),a=function(){var o=(e=i.transaction(xP,"readwrite")).objectStore(xP).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=a,o.onerror=function(t){return a(),i.close(),r(u.error)}},u.onerror=function(t){return i.close(),r(u.error)},a.oncomplete=function(){null==e?i.close():e.oncomplete=function(){return i.close()}}},o.onerror=function(t){return r(o.error)}})]})})},t}();if(xk.getBool("IS_BROWSER"))try{yP.registerManager(kP.URL_SCHEME,new IP)}catch(od){}var RP="/",AP="tensorflowjs_models",TP="info",_P="model_topology",DP="weight_specs",OP="weight_data",MP="model_metadata";function FP(t){return{info:[AP,t,TP].join(RP),topology:[AP,t,_P].join(RP),weightSpecs:[AP,t,DP].join(RP),weightData:[AP,t,OP].join(RP),modelMetadata:[AP,t,MP].join(RP)}}function PP(t){var e=t.split(RP);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(RP)}var LP=function(){function t(t){if(!xk.getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=FP(this.modelPath)}return t.prototype.save=function(t){return gk(this,void 0,void 0,function(){var e,n,r;return yk(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=mP(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(i=t.weightData,pP?Buffer.from(i).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(i))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy})),[2,{modelArtifactsInfo:r}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}var i;return[2]})})},t.prototype.load=function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return yk(this,function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(o),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(pP){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),BP=function(t){return xk.getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(LP.URL_SCHEME)?(e=t.slice(LP.URL_SCHEME.length),new LP(e)):null;var e};vP.registerSaveRouter(BP),vP.registerLoadRouter(BP);var zP=function(){function t(){Ik(xk.getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Ik(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i;return yk(this,function(a){for(t={},e=AP+RP,n=RP+TP,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(e)&&o.endsWith(n)&&(i=PP(o),t[i]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},t.prototype.removeModel=function(t){return gk(this,void 0,void 0,function(){var e,n;return yk(this,function(r){var o;if(t=(o=t).startsWith(LP.URL_SCHEME)?o.slice(LP.URL_SCHEME.length):o,e=FP(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(xk.getBool("IS_BROWSER"))try{yP.registerManager(LP.URL_SCHEME,new zP)}catch(od){}var UP="model",VP=".json",WP=".weights.bin";function jP(t){return new Promise(function(t){return setTimeout(t)}).then(t)}var HP=function(){function t(e){if(!xk.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=UP),this.modelTopologyFileName=e+VP,this.weightDataFileName=e+WP}return t.prototype.save=function(t){return gk(this,void 0,void 0,function(){var e,n,r,o;return yk(this,function(i){switch(i.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,r.href=n,[4,jP(function(){return r.dispatchEvent(new MouseEvent("click"))})];case 2:return i.sent(),null==t.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=e,[4,jP(function(){return o.dispatchEvent(new MouseEvent("click"))})]);case 3:i.sent(),i.label=4;case 4:return[2,{modelArtifactsInfo:mP(t)}]}})})},t.URL_SCHEME="downloads://",t}(),GP=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return gk(this,void 0,void 0,function(){var t,e,n=this;return yk(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var c=[],p=[],h=[];u.forEach(function(t){t.paths.forEach(function(t){p.push(t),h.push(null)}),c.push.apply(c,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=p.indexOf(t);h[o]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:fP(h)})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(l[t])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return dP(t.name)}),o={},i=0,a=t;i<a.length;i++)a[i].paths.forEach(function(t){var i=dP(t);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[t]=e[r.indexOf(i)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function qP(t,e,n,r){!function(t){Ik(null!=t&&Array.isArray(t)&&t.length>0,function(){return"promises must be a none empty array"})}(t),function(t,e){Ik(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t}),Ik(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),Ik(e>=t,function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map(function(i){return i.then(function(i){var a=n+ ++o/t.length*(r-n);return e(a),i}),i}))}function KP(t,e){return gk(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return yk(this,function(p){switch(p.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?xk.platform.fetch:e.fetchFunc,r=t.map(function(t){return n(t,e.requestInit,{isBinary:!0})}),o=0,i=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=p.sent(),[3,4];case 2:return[4,qP(r,e.onProgress,o,i)];case 3:a=p.sent(),p.label=4;case 4:return s=a.map(function(t){return t.arrayBuffer()}),u=.5,l=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=p.sent(),[3,8];case 6:return[4,qP(s,e.onProgress,u,l)];case 7:c=p.sent(),p.label=8;case 8:return[2,c]}})})}function $P(t){var e=this;return function(n,r,o){return void 0===r&&(r=""),gk(e,void 0,void 0,function(){var e,i,a,s,u,l,c,p,h,f;return yk(this,function(d){switch(d.label){case 0:if(e=n.map(function(){return!1}),i={},a=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(t,n){var r=0;t.weights.forEach(function(t){var u=sP["quantization"in t?t.quantization.dtype:t.dtype]*_k(t.shape),l=function(){e[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:t,groupOffset:r,sizeBytes:u})};null!=o?o.forEach(function(e,n){e===t.name&&(l(),a[n]=!0)}):l(),s.push(t.name),r+=u})}),!a.every(function(t){return t}))throw u=o.filter(function(t,e){return!a[e]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=e.reduce(function(t,e,n){return e&&t.push(n),t},[]),c=[],l.forEach(function(t){n[t].paths.forEach(function(t){var e=r+(r.endsWith("/")?"":"/")+t;c.push(e)})}),[4,t(c)];case 1:return p=d.sent(),h={},f=0,l.forEach(function(t){for(var e=n[t].paths.length,r=0,o=0;o<e;o++)r+=p[f+o].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,l=0;l<e;l++){var c=new Uint8Array(p[f+l]);s.set(c,u),u+=c.byteLength}i[t].forEach(function(t){var e=lP(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)h[n]=e[n]}),f+=e}),[2,h]}})})}}vP.registerSaveRouter(function(t){return xk.getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(HP.URL_SCHEME)?(void 0===(e=t.slice(HP.URL_SCHEME.length))&&(e="model"),new HP(e)):null;var e});var XP=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(Ik("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=xk.platform.fetch,Ik(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&Ik(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return gk(this,void 0,void 0,function(){var e,n;return yk(this,function(r){switch(r.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((n=r.sent()).ok)return[2,{modelArtifactsInfo:mP(t),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}})})},t.prototype.load=function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i,a,s;return yk(this,function(u){switch(u.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=u.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");u.label=2;case 2:return u.trys.push([2,4,,5]),[4,t.json()];case 3:return e=u.sent(),[3,5];case 4:throw u.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(o=e.weightsManifest,null==(r=e.modelTopology)&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:s=u.sent(),i=s[0],a=s[1],u.label=7;case 7:return[2,{modelTopology:r,weightSpecs:i,weightData:a}]}})})},t.prototype.loadWeights=function(t){return gk(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,l,c;return yk(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],o=n[1],i=this.weightPathPrefix||r,a=[],s=0,u=t;s<u.length;s++)a.push.apply(a,u[s].weights);return l=[],t.forEach(function(t){t.paths.forEach(function(t){l.push(i+t+o)})}),[4,KP(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return c=p.sent(),[2,[a,fP(c)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function YP(t){return null!=t.match(XP.URL_SCHEME_REGEX)}var QP=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every(function(t){return YP(t)}):YP(t))?ZP(t,{onProgress:e}):null};function ZP(t,e){return new XP(t,e)}vP.registerSaveRouter(QP),vP.registerLoadRouter(QP);var JP=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){return[2,this.modelArtifacts]})})},t}(),tL=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(e){return[2,this.saveHandler(t)]})})},t}(),eL=Object.freeze({browserFiles:function(t){return new GP(t)},browserHTTPRequest:function(t,e){return ZP(t,e)},concatenateArrayBuffers:fP,decodeWeights:lP,encodeWeights:function(t,e){return gk(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return yk(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t),i=function(i){var a=o[i],u=Array.isArray(t)?t[i].tensor:t[a];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+a+"': "+u.dtype);var l={name:a,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(t){return gk(s,void 0,void 0,function(){var e,n,r,o,i,a,s;return yk(this,function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(e=l.sent(),n=e.reduce(function(t,e){return t+e.length},0)+uP*e.length,r=new Uint8Array(n),o=0,i=0;i<e.length;i++)a=e[i],s=new Uint8Array(new Uint32Array([a.length]).buffer),r.set(s,o),r.set(a,o+=uP),o+=a.length;return t(r),[2]}})})});r.push(c)}else r.push(u.data());null!=e&&(l.group=e),n.push(l)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:cP(u.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new JP(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new JP({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new JP({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return vP.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:mP,getSaveHandlers:function(t){return vP.getSaveHandlers(t)},http:ZP,isHTTPScheme:YP,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),gk(this,void 0,void 0,function(){return yk(this,function(o){return[2,$P(function(t){return KP(t,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return vP.registerLoadRouter(t)},registerSaveRouter:function(t){return vP.registerSaveRouter(t)},weightsLoaderFactory:$P,withSaveHandler:function(t){return new tL(t)},copyModel:function(t,e){return gk(this,void 0,void 0,function(){return yk(this,function(n){return[2,wP(t,e,!1)]})})},listModels:function(){return gk(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return yk(this,function(s){switch(s.label){case 0:t=yP.getSchemes(),e={},n=0,r=t,s.label=1;case 1:return n<r.length?[4,yP.getManager(o=r[n]).listModels()]:[3,4];case 2:for(a in i=s.sent())e[o+gP+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return gk(this,void 0,void 0,function(){return yk(this,function(n){return[2,wP(t,e,!0)]})})},removeModel:function(t){return gk(this,void 0,void 0,function(){var e;return yk(this,function(n){return e=bP(t),[2,yP.getManager(e.scheme).removeModel(e.path)]})})}}),nL=pR({confusionMatrix_:function(t,e,n){var r=JI(t,"labels","confusionMatrix"),o=JI(e,"predictions","confusionMatrix");Ik(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),Ik(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),Ik(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),Ik(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),Ik(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=nA(r.asType("int32"),n),a=nA(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}}),rL=(Object.freeze({confusionMatrix:nL}),pR({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return UN.fromPixels(t,e)}})),oL=Object.freeze({toPixels:function(t,e){return gk(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,p,h,f,d,m,v,g,y,b,w,x,C;return yk(this,function(E){switch(E.label){case 0:if(n=JI(t,"img","toPixels"),t instanceof CN||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=E.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=E.sent(),p=c[0][0],h=c[1][0],u.dispose(),l.dispose(),"float32"===n.dtype){if(p<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+h+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||h>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+h+"].")}for(f="float32"===n.dtype?255:1,d=new Uint8ClampedArray(i*o*4),m=0;m<o*i;++m)v=void 0,g=void 0,y=void 0,b=void 0,1===a?(v=s[m]*f,g=s[m]*f,y=s[m]*f,b=255):3===a?(v=s[3*m]*f,g=s[3*m+1]*f,y=s[3*m+2]*f,b=255):4===a&&(v=s[4*m]*f,g=s[4*m+1]*f,y=s[4*m+2]*f,b=s[4*m+3]*f),d[0+(w=4*m)]=Math.round(v),d[w+1]=Math.round(g),d[w+2]=Math.round(y),d[w+3]=Math.round(b);return null!=e&&(e.width=i,e.height=o,x=e.getContext("2d"),C=new ImageData(d,i,o),x.putImageData(C,0,0)),n!==t&&n.dispose(),[2,d]}})})},fromPixels:rL}),iL=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),aL=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function sL(t){Ik(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),Ik("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),Ik(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),aL.register(t)}var uL=Object.freeze({Serializable:iL,SerializationMap:aL,registerClass:sL}),lL=.001,cL=.1;function pL(){return 32===UN.backend.floatPrecision()?lL:cL}function hL(t,e,n){var r=!0;if((Kk(t)||Kk(e))&&(r=!1),Kk(t)&&Kk(e)&&(r=!0),r){var o=t.constructor.name,i=e.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(e)){var a=QI(t),s=QI(e);if(!Dk(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=Kk(t)?t:Tk(t),l=Kk(e)?e:Tk(e);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var p=u[c],h=l[c];if(!n(p,h))throw new Error("Arrays differ: actual["+c+"] = "+p+", expected["+c+"] = "+h+".\nActual:   "+u+".\nExpected: "+l+".")}}function fL(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}Object.freeze({TEST_EPSILON_FLOAT16:cL,expectArraysClose:function(t,e,n){return null==n&&(n=pL()),hL(t,e,function(t,e){return fL(t,e,n)})},testEpsilon:pL,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return Yk(t)||Yk(t[0])||Yk(e)||Yk(e[0])?hL(t,n,function(t,e){return t==e}):hL(t,e,function(t,e){return fL(t,e,0)})},expectNumbersClose:function(t,e,n){if(null==n&&(n=pL()),!fL(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error("Value out of range:"+t[r]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:__,webgl_util:HI,MathBackendWebGL:ND,setWebGLContext:qN,GPGPUContext:D_});var dL=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return vk(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,i=r.grads;if(null!=n){var a=n.map(function(t){return{name:t.name,tensor:i[t.name]}});this.applyGradients(a)}else this.applyGradients(i);return $I(i),e?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return function(t,e){Ik(tN(t),function(){return"The f passed in variableGrads(f) must be a function"}),Ik(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof EN}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=e;if(!n)for(var r in e=[],UN.registeredVariables)e.push(UN.registeredVariables[r]);var o=n?e.filter(function(t){return!t.trainable}):null,i=e.length;Ik((e=e.filter(function(t){return t.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=UN.gradients(t,e,null,!0),s=a.value,u=a.grads;Ik(u.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Ik(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(t,e){null!=u[e]&&(l[t.name]=u[e])}),null!=o&&o.forEach(function(t){return l[t.name]=null}),{value:s,grads:l}}(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&$I(this.iterations_)},e.prototype.saveIterations=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:gR(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return gk(this,void 0,void 0,function(){var e;return yk(this,function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}})})},e}(iL);Object.defineProperty(dL,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var mL=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=UN.backend.epsilon()),o}return vk(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=UN.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:KI(function(){return RR(o).variable(!1)})}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:KI(function(){return RR(o).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable,s=e.accumulatedUpdates[r].variable;KI(function(){var t=a.mul(e.rho).add(i.square().mul(1-e.rho)),n=s.add(e.epsilon).sqrt().div(a.add(e.epsilon).sqrt()).mul(i),r=s.mul(e.rho).add(n.square().mul(1-e.rho));a.assign(t),s.assign(r);var u=n.mul(-e.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&($I(this.accumulatedGrads.map(function(t){return t.variable})),$I(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){var t;return yk(this,function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){var e;return yk(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.slice(0,e=t.length/2).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(dL);sL(mL);var vL=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return vk(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=UN.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:KI(function(){return SR(o.shape,e.initialAccumulatorValue).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable;KI(function(){var t=a.add(i.square());a.assign(t);var n=i.div(t.add(UN.backend.epsilon()).sqrt()).mul(-e.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&$I(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(dL);sL(vL);var gL=function(t){function e(e,n,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],KI(function(){i.accBeta1=gR(n).variable(),i.accBeta2=gR(r).variable()}),null==o&&(i.epsilon=UN.backend.epsilon()),i}return vk(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);KI(function(){var r=KO(1,e.accBeta1),o=KO(1,e.accBeta2);n.forEach(function(n,i){var a=UN.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:KI(function(){return RR(a).variable(!1)})}),null==e.accumulatedSecondMoment[i]&&(e.accumulatedSecondMoment[i]={originalName:n+"/v",variable:KI(function(){return RR(a).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,l=e.accumulatedSecondMoment[i].variable,c=u.mul(e.beta1).add(s.mul(1-e.beta1)),p=l.mul(e.beta2).add(s.square().mul(1-e.beta2)),h=c.div(r),f=p.div(o);u.assign(c),l.assign(p);var d=h.div(f.sqrt().add(e.epsilon)).mul(-e.learningRate).add(a);a.assign(d)}}),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&$I(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&$I(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){var t;return yk(this,function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){var e,n=this;return yk(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),KI(function(){n.accBeta1.assign(jO(n.beta1,n.iterations_+1)),n.accBeta2.assign(jO(n.beta2,n.iterations_+1))}),this.accumulatedFirstMoment=t.slice(0,e=t.length/2).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(dL);sL(gL);var yL=function(t){function e(e,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],KI(function(){a.iteration=gR(0).variable(),a.accBeta1=gR(n).variable()}),null==o&&(a.epsilon=UN.backend.epsilon()),a}return vk(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);KI(function(){var r=KO(1,e.accBeta1),o=DO(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach(function(n,i){var a=UN.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:RR(a).variable(!1)}),null==e.accumulatedWeightedInfNorm[i]&&(e.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:RR(a).variable(!1)});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,l=e.accumulatedWeightedInfNorm[i].variable,c=u.mul(e.beta1).add(s.mul(1-e.beta1)),p=l.mul(e.beta2),h=s.abs(),f=p.maximum(h);u.assign(c),l.assign(f);var d=o.div(r).mul(c.div(f.add(e.epsilon))).add(a);a.assign(d)}}),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&$I(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&$I(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(dL);sL(yL);var bL=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return vk(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var i=UN.registeredVariables[n];KI(function(){var t=e.c.mul(o).add(i);i.assign(t)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=XI(gR(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(dL);sL(bL);var wL=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=gR(o.momentum),o}return vk(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=UN.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:KI(function(){return RR(o).variable(!1)})});var i=e.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[n];null!=a&&KI(function(){var t,n=e.m.mul(i).add(a);t=e.useNesterov?e.c.mul(a.add(n.mul(e.m))).add(o):e.c.mul(n).add(o),i.assign(n),o.assign(t)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&$I(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){return yk(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){return yk(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(bL);sL(wL);var xL=function(t){function e(e,n,r,o,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1);var a=t.call(this)||this;return a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=i,null==o&&(a.epsilon=UN.backend.epsilon()),a}return vk(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=UN.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:KI(function(){return RR(o).variable(!1)})}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:KI(function(){return RR(o).variable(!1)})}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:KI(function(){return RR(o).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedMeanSquares[r].variable,s=e.accumulatedMoments[r].variable;KI(function(){var t=a.mul(e.decay).add(i.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,u=n.mul(e.decay).add(i.mul(1-e.decay)),l=s.mul(e.momentum).add(i.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));a.assign(t),n.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var p=a.mul(e.decay).add(i.square().mul(1-e.decay));l=s.mul(e.momentum).add(i.mul(e.learningRate).div(p.add(e.epsilon).sqrt())),a.assign(p),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&$I(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&$I(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&$I(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return gk(this,void 0,void 0,function(){var t;return yk(this,function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return gk(this,void 0,void 0,function(){var e;return yk(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedMeanSquares=t.slice(0,e=this.centered?t.length/3:t.length/2).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(dL);sL(xL);var CL=function(){function t(){}return t.sgd=function(t){return new bL(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new wL(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new xL(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new gL(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new mL(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new yL(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new vL(t,e)},t}(),EL={sgd:CL.sgd,momentum:CL.momentum,adadelta:CL.adadelta,adagrad:CL.adagrad,rmsprop:CL.rmsprop,adamax:CL.adamax,adam:CL.adam},SL="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(t){return t()};function kL(){return new Promise(function(t){return SL(function(){return t()})})}wN=eP;var NL=function(t,e){return(NL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function IL(t,e){function n(){this.constructor=t}NL(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var RL,AL=function(){return(AL=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function TL(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function _L(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function DL(){return null==RL&&(RL=UN.backend.epsilon()),RL}var OL=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return IL(e,t),e}(Error),ML=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return IL(e,t),e}(Error),FL=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return IL(e,t),e}(Error),PL=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return IL(e,t),e}(Error),LL=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return IL(e,t),e}(Error);function BL(t,e){if(Array.isArray(t)){for(var n=[],r=0;r<e;r++)n=n.concat(t);return n}return(n=new Array(e)).fill(t),n}function zL(t,e){if(!t)throw new LL(e)}function UL(t,e){for(var n=0,r=0,o=t;r<o.length;r++)o[r]===e&&n++;return n}function VL(t){return 1===t.length?t[0]:t}function WL(t){return Array.isArray(t)?t:[t]}function jL(t){var e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function HL(t){return t.length<=1?t:-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,function(t,e){return e.toUpperCase()})}!function(t){IL(function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r},t)}(Error);var GL={};function qL(t){if(null==t)return null;var e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function KL(t,e,n,r,o){var i,a,s;if(void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r="object"),void 0===o&&(o=!1),"string"==typeof t){var u=void 0;if(t in n)u=n[t];else if(t in GL)u=GL[t];else if(null==(u=e[t]))throw new FL("Unknown "+r+": "+t+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return u}var l=t;if(null==l.className||null==l.config)throw new FL(r+": Improper config format: "+JSON.stringify(l)+".\n'className' and 'config' must set.");var c=l.className,p=void 0,h=void 0;if(c in n?(p=(i=n[c])[0],h=i[1]):c in GL?(p=(a=GL.className)[0],h=a[1]):c in e&&(p=(s=e[c])[0],h=s[1]),null==p)throw new FL("Unknown "+r+": "+c+". This may be due to one of the following reasons:\n1. The "+r+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+r+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=h){for(var f={},d=0,m=Object.keys(GL);d<m.length;d++)f[x=m[d]]=GL[x];for(var v=0,g=Object.keys(n);v<g.length;v++)f[x=g[v]]=n[x];l.config.customObjects=f;for(var y=AL({},GL),b=0,w=Object.keys(n);b<w.length;b++){var x=w[b];GL[x]=n[x]}!function t(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach(function(e){return t(e)});else for(var n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=e[o];null!=i&&"object"==typeof i&&(Array.isArray(i)||"ndarray"!==i.type||"number"!=typeof i.value?t(i):e[o]=i.value)}}(l.config);var C=h(p,l.config,n,o);return GL=AL({},y),C}y=AL({},GL);for(var E=0,S=Object.keys(n);E<S.length;E++)GL[x=S[E]]=n[x];return C=new p(l.config),GL=AL({},y),C}function $L(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function XL(t){if(null==t)return t;for(var e=[],n=0,r=t;n<r.length;n++){var o=r[n];-1===e.indexOf(o)&&e.push(o)}return e}function YL(t){if(null==t)throw new FL("Invalid value in obj: "+JSON.stringify(t));for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function QL(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new FL(n+" is not a valid "+e+".  Valid values are "+t+" or null/undefined.")}function ZL(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),zL(n>=0),zL(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every(function(t){return typeof t===e})}function JL(t,e){Array.isArray(t)?(pN.assert(t.length>0,function(){return e+" is unexpectedly an empty array."}),t.forEach(function(t,n){return JL(t,"element "+(n+1)+" of "+e)})):pN.assert(Number.isInteger(t)&&t>0,function(){return"Expected "+e+" to be a positive integer, but got "+function t(e){return null===e?"null":Array.isArray(e)?"["+e.map(function(e){return t(e)}).join(",")+"]":"string"==typeof e?'"'+e+'"':""+e}(t)+"."})}function tB(t,e){return KI(function(){return rO(tF(WO(t,t),e,!0))})}var eB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.getConfig=function(){return{}},e}(uL.Serializable),nB=function(t){function e(e){var n=t.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return IL(e,t),e.prototype.apply=function(t){var e=this;return KI(function(){var n=tB(t,e.axis),r=FD(n,0,e.maxValue);return VO(t,DO(r,RO(DL(),n)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}(eB);uL.registerClass(nB);var rB=function(t){function e(e){var n=t.call(this)||this;return n.defaultAxis=0,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return IL(e,t),e.prototype.apply=function(t){var e=this;return KI(function(){return DO(t,RO(DL(),tB(t,e.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}(eB);uL.registerClass(rB);var oB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return iF(t)},e.className="NonNeg",e}(eB);uL.registerClass(oB);var iB=function(t){function e(e){var n=t.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=e.minValue?e.minValue:n.defaultMinValue,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.rate=null!=e.rate?e.rate:n.defaultRate,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return IL(e,t),e.prototype.apply=function(t){var e=this;return KI(function(){var n=tB(t,e.axis),r=RO(VO(e.rate,FD(n,e.minValue,e.maxValue)),VO(1-e.rate,n));return VO(t,DO(r,RO(DL(),n)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}(eB);uL.registerClass(iB);var aB={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function sB(t){return qL(t)}function uB(t,e){return void 0===e&&(e={}),KL(t,uL.SerializationMap.getMap().classNameMap,e,"constraint")}function lB(t){return null==t?null:"string"==typeof t?uB({className:t in aB?aB[t]:t,config:{}}):t instanceof eB?t:uB(t)}var cB=Object.freeze({maxNorm:function(t){return new nB(t)},unitNorm:function(t){return new rB(t)},nonNeg:function(){return new oB},minMaxNorm:function(t){return new iB(t)}}),pB=["channelsFirst","channelsLast"],hB=["valid","same","causal"],fB=["max","avg"],dB=["sum","mul","concat","ave"],mB=new Map;function vB(t){QL(pB,"DataFormat",t)}function gB(t){QL(hB,"PaddingMode",t)}var yB=[],bB="/";function wB(t,e){yB.push(t);try{var n=e();return yB.pop(),n}catch(t){throw yB.pop(),t}}function xB(t){if(!SB(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===yB.length?"":yB.join(bB)+bB)+t}function CB(t){if(!SB(t))throw new Error("Not a valid tensor name: '"+t+"'");mB.has(t)||mB.set(t,0);var e=mB.get(t);if(mB.set(t,mB.get(t)+1),e>0){var n=t+"_"+e;return mB.set(n,1),n}return t}var EB=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function SB(t){return!!t.match(EB)}function kB(t){return t===parseInt(t.toString(),10)}function NB(t,e,n){null==e&&(e=0),null==n&&(n=t.length);for(var r=1,o=e;o<n;++o)r*=t[o];return r}function IB(t){return yR(t=Array.isArray(t)?new Float32Array(t):t)}function RB(t){return ZM(IB(t)).dataSync()[0]}function AB(t){return YM(IB(t)).dataSync()[0]}function TB(t,e){if(e<t)throw new FL("end ("+e+") < begin ("+t+") is forbidden.");for(var n=[],r=t;r<e;++r)n.push(r);return n}function _B(t,e){return t.asType(e)}function DB(t,e){void 0===e&&(e=-1);var n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),t.reshape(n)}function OB(t,e,n){return KI(function(){switch(t.rank){case 1:return UM(t,e,n);case 2:return VM(t,[e,0],[n,t.shape[1]]);case 3:return WM(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return jM(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);default:throw new FL("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}})}function MB(t,e,n){return KI(function(){switch(t.rank){case 1:return UM(t,e,n);case 2:return VM(t,[0,e],[t.shape[0],n]);case 3:return WM(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return jM(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new FL("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function FB(t,e,n,r){return KI(function(){switch(t.rank){case 1:return UM(t,e,n);case 2:switch(r){case 1:return OB(t,e,n);case 2:return MB(t,e,n);default:throw new FL("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return OB(t,e,n);case 2:return WM(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return MB(t,e,n);default:throw new FL("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return OB(t,e,n);case 2:return jM(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return jM(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return MB(t,e,n);default:throw new FL("The axis is not within the rank of the tensor "+r)}default:throw new FL("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function PB(t,e){var n;return void 0===e&&(e=-1),e<0&&(e=0!==(n=t[0].rank)?n:0),e===t[0].rank&&(e=-1),AR(t,e)}function LB(t,e){switch(t.rank){case 1:return TR([t,e]);case 2:return _R([t,e],0);case 3:return DR([t,e],0);case 4:return OR([t,e],0);default:throw new FL("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function BB(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new FL("The length of input n ("+e.length+") does not match the number of dimensions in input x ("+t.rank+")");return vA(t,e)}function zB(t,e,n,r,o){return void 0===e&&(e=0),void 0===n&&(n=1),lA(t,e,n,r,o)}function UB(t,e,n,r){if(t.rank<2||e.rank<2)throw new PL("dot requires both inputs to be rank >= 2 but got x shape = "+t.shape+" and y shape = "+e.shape);if(e.rank>=3&&(s=t.shape.slice(-1)[0])!==(c=e.shape.slice(-2)[0]))throw new PL("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+t.shape+" and  y shape = "+e.shape);if(2===t.rank&&2===e.rank){var o=!1,i=!1;return tP.matMul(t,e,o,i,r?jB(t.rank,r,"channelsLast"):null,n)}var a=t.shape.slice(),s=a.pop();t=t.reshape([-1,s]);var u=e.shape.slice(),l=u.pop(),c=u.pop(),p=u.concat([l]),h=Array.from({length:e.rank},function(t,n){return 0===n?e.rank-2:n<=e.rank-2?n-1:n});e=e.transpose(h).reshape([c,-1]);var f=a.concat(p);return tP.matMul(t,e,o=!1,i=!1,r?jB(t.rank,r,"channelsLast"):null,n).reshape(f)}function VB(t,e,n){return KI(function(){return e=Array.isArray(e)?yR(e,"int32"):e.toInt(),lM(t,e,n)})}function WB(t){return WO(t,t)}function jB(t,e,n){var r=e.shape;if(1!==e.rank&&e.rank!==t)throw new FL("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t);if(5===t){if("channelsFirst"===n)return e.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return e.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===t){if("channelsFirst"===n)return e.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return e.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===t){if("channelsFirst"===n)return e.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return e.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(t<3)return e;throw new FL("Unsupported input rank by biasAdd: "+e.rank)}function HB(t,e,n){return KI(function(){return null==n&&(n="channelsLast"),vB(n),t.add(jB(t.rank,e,n))})}function GB(t,e,n,r){return KI(function(){return SF(t,e,n,r)})}function qB(t,e,n){return void 0===n&&(n=!1),n?t():e()}var KB=["fanIn","fanOut","fanAvg"],$B=["normal","uniform","truncatedNormal"],XB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(uL.Serializable),YB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t,e){return ER(t,e)},e.className="Zeros",e}(XB);uL.registerClass(YB);var QB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t,e){return CR(t,e)},e.className="Ones",e}(XB);uL.registerClass(QB);var ZB=function(t){function e(e){var n=t.call(this)||this;if("object"!=typeof e)throw new FL("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new FL("config must have value set but got "+e);return n.value=e.value,n}return IL(e,t),e.prototype.apply=function(t,e){var n=this;return KI(function(){return VO(gR(n.value),CR(t,e))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(XB);uL.registerClass(ZB);var JB=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=e.minval||n.DEFAULT_MINVAL,n.maxval=e.maxval||n.DEFAULT_MAXVAL,n.seed=e.seed,n}return IL(e,t),e.prototype.apply=function(t,e){return pA(t,this.minval,this.maxval,e)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(XB);uL.registerClass(JB);var tz=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return IL(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new PL("randomNormal does not support dType "+e+".");return zB(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(XB);uL.registerClass(tz);var ez=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return IL(e,t),e.prototype.apply=function(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new PL("truncatedNormal does not support dType "+e+".");return gA(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(XB);uL.registerClass(ez);var nz=function(t){function e(e){var n=t.call(this)||this;return n.gain=null!=e.gain?e.gain:1,n}return IL(e,t),e.prototype.apply=function(t,e){var n=this;return KI(function(){if(2!==t.length||t[0]!==t[1])throw new FL("Identity matrix initializer can only be used for 2D square matrices.");return VO(n.gain,tA(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e.className="Identity",e}(XB);uL.registerClass(nz);var rz=function(t){function e(e){var n=t.call(this)||this;if(e.scale<0)throw new FL("scale must be a positive float. Got: "+e.scale);return n.scale=null==e.scale?1:e.scale,n.mode=null==e.mode?"fanIn":e.mode,QL(KB,"FanMode",n.mode),n.distribution=null==e.distribution?"normal":e.distribution,QL($B,"Distribution",n.distribution),n.seed=e.seed,n}return IL(e,t),e.prototype.apply=function(t,e){var n=function(t,e){var n,r;if(void 0===e&&(e="channelsLast"),vB(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length))if("channelsFirst"===e){var o=NB(t,2);n=t[1]*o,r=t[0]*o}else"channelsLast"===e&&(o=NB(t,0,t.length-2),n=t[t.length-2]*o,r=t[t.length-1]*o);else{var i=NB(t);n=Math.sqrt(i),r=Math.sqrt(i)}return[n,r]}(t),r=n[0],o=n[1],i=this.scale;if(i/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,o):Math.max(1,(r+o)/2),"normal"===this.distribution){var a=Math.sqrt(i);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new PL(this.getClassName()+" does not support dType "+e+".");return gA(t,0,a,e,this.seed)}var s=Math.sqrt(3*i);return pA(t,-s,s,e)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(XB);uL.registerClass(rz);var oz=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return IL(e,t),e.prototype.getClassName=function(){return rz.className},e.className="GlorotUniform",e}(rz);uL.registerClass(oz);var iz=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return IL(e,t),e.prototype.getClassName=function(){return rz.className},e.className="GlorotNormal",e}(rz);uL.registerClass(iz);var az=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return IL(e,t),e.prototype.getClassName=function(){return rz.className},e.className="HeNormal",e}(rz);uL.registerClass(az);var sz=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return IL(e,t),e.prototype.getClassName=function(){return rz.className},e.className="HeUniform",e}(rz);uL.registerClass(sz);var uz=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return IL(e,t),e.prototype.getClassName=function(){return rz.className},e.className="LeCunNormal",e}(rz);uL.registerClass(uz);var lz=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})||this}return IL(e,t),e.prototype.getClassName=function(){return rz.className},e.className="LeCunNormal",e}(rz);uL.registerClass(lz);var cz=function(t){function e(e){var n=t.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==e.gain?n.DEFAULT_GAIN:e.gain,n.seed=e.seed,null!=n.seed)throw new PL("Random seed is not implemented for Orthogonal Initializer yet.");return n}return IL(e,t),e.prototype.apply=function(t,e){var n=this;return KI(function(){if(2!==t.length)throw new PL("The Orthogonal Initializer does not support non-2D shapes yet.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+t[0]*t[1]+") elements: Slowness may result.");var e=zB(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32"),r=GF.gramSchmidt(e);return t[0]>t[1]&&(r=r.transpose()),VO(n.gain,r)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(XB);uL.registerClass(cz);var pz={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function hz(t,e){return void 0===e&&(e={}),KL(t,uL.SerializationMap.getMap().classNameMap,e,"initializer")}function fz(t){return qL(t)}function dz(t){if("string"==typeof t){var e=t in pz?pz[t]:t;if("GlorotNormal"===e)return new iz;if("GlorotUniform"===e)return new oz;if("HeNormal"===e)return new az;if("HeUniform"===e)return new sz;if("LeCunNormal"===e)return new uz;if("LeCunUniform"===e)return new lz;var n={};return n.className=e,n.config={},hz(n)}return t instanceof XB?t:hz(t)}var mz=Object.freeze({zeros:function(){return new YB},ones:function(){return new QB},constant:function(t){return new ZB(t)},randomUniform:function(t){return new JB(t)},randomNormal:function(t){return new tz(t)},truncatedNormal:function(t){return new ez(t)},identity:function(t){return new nz(t)},varianceScaling:function(t){return new rz(t)},glorotUniform:function(t){return new oz(t)},glorotNormal:function(t){return new iz(t)},heNormal:function(t){return new az(t)},heUniform:function(t){return new sz(t)},leCunNormal:function(t){return new uz(t)},leCunUniform:function(t){return new lz(t)},orthogonal:function(t){return new cz(t)}}),vz=0;function gz(){return vz++}var yz={};function bz(t){return void 0===t&&(t=""),t in yz||(yz[t]=0),yz[t]+=1,t+yz[t].toString()}function wz(t){return Array.isArray(t)&&Array.isArray(t[0])}function xz(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function Cz(t){var e;if(Array.isArray(t)){if(1!==t.length)throw new FL("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function Ez(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new FL("Expected exactly 1 Shape; got "+t.length)}return t}function Sz(t){for(var e=0,n=0,r=t;n<r.length;n++){var o=r[n];e+=0===o.shape.length?1:o.shape.reduce(function(t,e){return t*e})}return e}var kz="Variable",Nz=function(){function t(t,e,n,r,o){void 0===e&&(e="float32"),void 0===n&&(n=kz),void 0===r&&(r=!0),void 0===o&&(o=null),this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=gz(),this.originalName=xB(n=null==n?kz:n),this.name=CB(this.originalName),this.trainable_=r,this.constraint=o,this.val=AN(t,this.trainable_,this.name,this.dtype)}return t.prototype.read=function(){return this.assertNotDisposed(),this.val},t.prototype.write=function(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},t.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},t.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(t.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.trainable_=t,this.val.trainable=t},enumerable:!0,configurable:!0}),t}();function Iz(t){return t.map(function(t){return t.read()})}function Rz(t){t.forEach(function(t){t[0].write(t[1])})}var Az,Tz,_z=function(t){this.dtype=t.dtype,this.shape=t.shape,this.ndim=null!=t.shape?t.shape.length:t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},Dz=function(t,e,n,r,o,i,a){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=gz(),null!=i&&(this.originalName=xB(i),this.name=CB(this.originalName)),this.rank=e.length},Oz=0,Mz=function(){function t(t,e){this.callArgs=e,this.id=Oz++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(var n=0,r=t.inboundLayers;n<r.length;n++){var o=r[n];null!=o&&o.outboundNodes.push(this)}t.outboundLayer.inboundNodes.push(this)}return t.prototype.getConfig=function(){for(var t=[],e=0,n=this.inboundLayers;e<n.length;e++){var r=n[e];t.push(null!=r?r.name:null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},t}(),Fz=0,Pz=function(t){function e(e){var n=t.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=Fz++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=e.name;if(!r){var o=n.getClassName();r=jL(o)+"_"+bz(o)}if(n.name=r,n.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){var i=void 0;if(null!=e.batchInputShape)i=e.batchInputShape;else if(null!=e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),i=[a].concat(e.inputShape)}n.batchInputShape=i;var s=e.dtype;null==s&&(s=e.inputDType),null==s&&(s="float32"),n.dtype=s}return n.initialWeights=null!=e.weights?e.weights:null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return IL(e,t),e.nodeKey=function(t,e){return t.name+"_ib-"+e.toString()},e.prototype.getNodeAtIndex=function(t,e){if(0===this.inboundNodes.length)throw new ML("The layer has never been called and thus has no defined "+e+".");if(this.inboundNodes.length<=t)throw new FL("Asked to get "+e+" at node "+t+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return VL(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return VL(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new OL("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new OL("Layer "+this.name+" is not connected, no input to return.");return VL(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new OL("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new OL("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return VL(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(e){return e.trainable=t}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=WL(t),null!=this.inputSpec&&0!==this.inputSpec.length){var e=WL(this.inputSpec);if(t.length!==e.length)throw new FL("Layer "+this.name+" expects "+e.length+" inputs, but it received "+t.length+" input tensors. Input received: "+t);for(var n=0;n<t.length;n++){var r=t[n],o=e[n];if(null!=o){var i=r.rank;if(null!=o.ndim&&i!==o.ndim)throw new FL("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+o.ndim+", found ndim="+i);if(null!=o.maxNDim&&i>o.maxNDim)throw new FL("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+o.maxNDim+", found ndim="+i);if(null!=o.minNDim&&i<o.minNDim)throw new FL("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+o.minNDim+", found ndim="+i+".");if(null!=o.dtype&&r.dtype!==o.dtype)throw new FL("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+o.dtype+", found dtype="+r.dtype+".");if(o.axes){var a=r.shape;for(var s in o.axes){var u=Number(s),l=o.axes[s];if(null!=l&&-1===[l,null].indexOf(u>=0?a[u]:a[a.length+u]))throw new FL("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+a+".")}}if(null!=o.shape)for(var c=0;c<o.shape.length;++c){var p=o.shape[c],h=r.shape[c];if(null!=p&&null!=h&&p!==h)throw new FL("Input "+n+" is incompatible with layer "+this.name+": expected shape="+o.shape+", found shape="+r.shape+".")}}}}},e.prototype.call=function(t,e){return t},e.prototype.invokeCallHook=function(t,e){null!=this._callHook&&this._callHook(t,e)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,e){var n=this;e=e||{},this.assertNotDisposed();for(var r=WL(t),o=!0,i=0,a=r;i<a.length;i++)if(!(a[i]instanceof Dz)){o=!1;break}for(var s=!0,u=0,l=r;u<l.length;u++)if(l[u]instanceof Dz){s=!1;break}if(o===s)throw new FL("Arguments to apply() must be all SymbolicTensors or all Tensors");return wB(this.name,function(){if(!n.built){n.assertInputCompatibility(t);for(var o=[],i=0,a=WL(t);i<a.length;i++)o.push(a[i].shape);n.build(VL(o)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&s&&(n._refCount=1)}if(n.assertInputCompatibility(t),s){for(var u=[],l=0,c=WL(d=n.call(t,e));l<c.length;l++){var p=c[l];-1!==r.indexOf(p)&&(p=p.clone()),u.push(p)}if(d=VL(u),null!=n.activityRegularizer)throw new PL("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}var h=function(t){for(var e=[],n=0,r=t=WL(t);n<r.length;n++)e.push(r[n].shape);return VL(e)}(t),f=n.computeOutputShape(h),d=void 0,m="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(t)?h[0]:h),d=null!=f&&f.length>0&&Array.isArray(f[0])?f.map(function(r,o){return new Dz(m,r,n,WL(t),e,n.name,o)}):new Dz(m,f,n,WL(t),e,n.name),n.addInboundNode(t,d,null,null,h,f,e),n._refCount++,null!=n.activityRegularizer)throw new PL("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d})},e.prototype.warnOnIncompatibleInputShape=function(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(t)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var e=!1;this.batchInputShape.forEach(function(n,r){null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)}),e&&console.warn("The shape of the input tensor ("+JSON.stringify(t)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new OL("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var t=[],e=0,n=this.inboundNodes;e<n.length;e++){var r=JSON.stringify(n[e].outputShapes);-1===t.indexOf(r)&&t.push(r)}if(1===t.length){var o=this.inboundNodes[0].outputShapes;return Array.isArray(o)&&Array.isArray(o[0])&&1===o.length?o[0]:o}throw new OL("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new ML("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return Sz(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return void 0===t&&(t=!1),Iz(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var e=this;KI(function(){var n=e.weights;if(n.length!==t.length)throw new FL('You called setWeights(weights) on layer "'+e.name+'" with a weight list of length '+t.length+", but the layer was expecting "+n.length+" weights. Provided weights: "+t+"...");if(0!==n.length){for(var r=[],o=Iz(n),i=0;i<o.length;++i){var a=o[i],s=n[i],u=t[i];if(!pN.arraysEqual(a.shape,u.shape))throw new FL("Layer weight shape "+a.shape+" not compatible with provided weight shape "+u.shape);r.push([s,u])}Rz(r)}})},e.prototype.addWeight=function(t,e,n,r,o,i,a){if(-1!==this._addedWeightNames.indexOf(t))throw new FL("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=dz("zeros"));var s=r.apply(e,n),u=new Nz(s,n,t,i,a);return s.dispose(),null!=o&&this.addLoss(function(){return o.apply(u.read())}),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var e;null==t||Array.isArray(t)&&0===t.length||(t=WL(t),null!=this._losses&&(e=this.losses).push.apply(e,t))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,e){var n=this;if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");e.forEach(function(t){if(null!=t)throw new TypeError("Layer "+n.name+" does not support masking, but was passed an inputMask.")})}return null}return e},e.prototype.addInboundNode=function(t,e,n,r,o,i,a){void 0===a&&(a=null);var s=WL(t);e=WL(e),n=WL(n),r=WL(r),o=xz(o),i=xz(i);for(var u=[],l=[],c=[],p=0,h=s;p<h.length;p++){var f=h[p];u.push(f.sourceLayer),l.push(f.nodeIndex),c.push(f.tensorIndex)}new Mz({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:s,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:o,outputShapes:i},a);for(var d=0;d<e.length;d++)e[d].sourceLayer=this,e[d].nodeIndex=this.inboundNodes.length-1,e[d].tensorIndex=d},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(uL.Serializable),Lz=function(t){function e(e){var n=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:bz("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new FL("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=e.batchInputShape;if(null==r){if(null==e.inputShape)throw new FL("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new FL("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var o=e.dtype||"float32";n.batchInputShape=r,n.dtype=o,n.inputSpec=[{shape:r}];var i=new Dz(n.dtype,n.batchInputShape,n,[],{},n.name);return i.nodeIndex=0,i.tensorIndex=0,new Mz({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return IL(e,t),e.prototype.apply=function(t,e){throw new FL("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(Pz);function Bz(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new FL("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));var n=t.dtype;return null==n&&(n="float32"),new Lz({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}function zz(t){return TL(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u;return _L(this,function(l){switch(l.label){case 0:if(null==t)return[2];for(o in e=[],n=[],r=[],t)"number"!=typeof(i=t[o])&&(e.push((a=i).data()),n.push(o),r.push(a));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=l.sent(),u=0;u<s.length;++u)t[n[u]]=s[u][0];$I(r),l.label=2;case 2:return[2]}})})}function Uz(t){if(null!=t)for(var e in t){var n=t[e];"number"!=typeof n&&n.dispose()}}uL.registerClass(Lz),(Tz=Az||(Az={}))[Tz.SILENT=0]="SILENT",Tz[Tz.VERBOSE=1]="VERBOSE";var Vz=125,Wz=function(){function t(){this.validationData=null}return t.prototype.setParams=function(t){this.params=t},t.prototype.onEpochBegin=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(t){return[2]})})},t.prototype.onEpochEnd=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(t){return[2]})})},t.prototype.onBatchBegin=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(t){return[2]})})},t.prototype.onBatchEnd=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(t){return[2]})})},t.prototype.onTrainBegin=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(t){return[2]})})},t.prototype.onTrainEnd=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(t){return[2]})})},t.prototype.setModel=function(t){},t}(),jz=function(){function t(t,e){void 0===e&&(e=10),null==t&&(t=[]),this.callbacks=t,this.queueLength=e}return t.prototype.append=function(t){this.callbacks.push(t)},t.prototype.setParams=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setParams(t)},t.prototype.setModel=function(t){for(var e=0,n=this.callbacks;e<n.length;e++)n[e].setModel(t)},t.prototype.onEpochBegin=function(t,e){return TL(this,void 0,void 0,function(){var n,r;return _L(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onEpochBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onEpochEnd=function(t,e){return TL(this,void 0,void 0,function(){var n,r;return _L(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onEpochEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchBegin=function(t,e){return TL(this,void 0,void 0,function(){var n,r;return _L(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onBatchBegin(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchEnd=function(t,e){return TL(this,void 0,void 0,function(){var n,r;return _L(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?[4,r[n].onBatchEnd(t,e)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onTrainBegin=function(t){return TL(this,void 0,void 0,function(){var e,n;return _L(this,function(r){switch(r.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,r.label=1;case 1:return e<n.length?[4,n[e].onTrainBegin(t)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype.onTrainEnd=function(t){return TL(this,void 0,void 0,function(){var e,n;return _L(this,function(r){switch(r.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,r.label=1;case 1:return e<n.length?[4,n[e].onTrainEnd(t)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t}(),Hz=function(t){function e(){return t.call(this)||this}return IL(e,t),e.prototype.onEpochBegin=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(t){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,e){return TL(this,void 0,void 0,function(){var t,n,r,o,i=this;return _L(this,function(a){for(o in null==e&&(e={}),this.seen+=t=null==e.size?0:e.size,n=function(n){var o=e[n];if("number"==typeof o)r.totals.hasOwnProperty(n)||(r.totals[n]=0),r.totals[n]=r.totals[n]+o*t;else{var a=void 0;n in r.totals?a=r.totals[n]:r.totals[n]=0,r.totals[n]=KI(function(){return RO(i.totals[n],VO(o,t))}),null!=a&&a.dispose()}},r=this,e)n(o);return[2]})})},e.prototype.onEpochEnd=function(t,e){return TL(this,void 0,void 0,function(){var t,n,r,o,i=this;return _L(this,function(a){if(null!=e)for(t=function(t){if(null==n.totals[t])return"continue";"number"==typeof n.totals[t]?e[t]=n.totals[t]/n.seen:KI(function(){e[t]=VO(DO(1,i.seen),i.totals[t]),i.totals[t].dispose(),XI(e[t])})},n=this,r=0,o=this.params.metrics;r<o.length;r++)t(o[r]);return[2]})})},e}(Wz),Gz=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.onTrainBegin=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(t){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,e){return TL(this,void 0,void 0,function(){var n;return _L(this,function(r){for(n in null==e&&(e={}),this.epoch.push(t),e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n]);return[2]})})},e.prototype.syncData=function(){return TL(this,void 0,void 0,function(){var t,e,n,r,o,i,a,s;return _L(this,function(u){switch(u.label){case 0:for(r in t=[],e=[],n=[],this.history)for(o=this.history[r],i=0;i<o.length;++i)"number"!=typeof o[i]&&(t.push(o[i].data()),e.push(r),n.push(i));return[4,Promise.all(t)];case 1:for(a=u.sent(),s=0;s<a.length;++s)this.history[e[s]][n[s]].dispose(),this.history[e[s]][n[s]]=a[s][0];return[2]}})})},e}(Wz),qz=function(t){function e(e,n){var r=t.call(this)||this;if(r.currentEpoch=0,r.yieldEvery=n||"auto","auto"===r.yieldEvery&&(r.yieldEvery=Vz),"never"===r.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return pN.isNumber(r.yieldEvery)&&(r.maybeWait=function(t,e){var n,r=pN.now();return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var a=pN.now();return a-r<e?n:(r=a,n=t.apply(void 0,o))}}(r.maybeWait.bind(r),r.yieldEvery)),r.trainBegin=e.onTrainBegin,r.trainEnd=e.onTrainEnd,r.epochBegin=e.onEpochBegin,r.epochEnd=e.onEpochEnd,r.batchBegin=e.onBatchBegin,r.batchEnd=e.onBatchEnd,r.yield=e.onYield,r}return IL(e,t),e.prototype.maybeWait=function(t,e,n){return TL(this,void 0,void 0,function(){var r;return _L(this,function(o){switch(o.label){case 0:return r=[],null==this.yield?[3,2]:[4,zz(n)];case 1:o.sent(),r.push(this.yield(t,e,n)),o.label=2;case 2:return r.push(kL()),[4,Promise.all(r)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(n){switch(n.label){case 0:return this.currentEpoch=t,null==this.epochBegin?[3,3]:[4,zz(e)];case 1:return n.sent(),[4,this.epochBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,e){return TL(this,void 0,void 0,function(){var n;return _L(this,function(r){switch(r.label){case 0:return n=[],null==this.epochEnd?[3,2]:[4,zz(e)];case 1:r.sent(),n.push(this.epochEnd(t,e)),r.label=2;case 2:return"epoch"===this.yieldEvery&&n.push(kL()),[4,Promise.all(n)];case 3:return r.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,zz(e)];case 1:return n.sent(),[4,this.batchBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,e){return TL(this,void 0,void 0,function(){var n;return _L(this,function(r){switch(r.label){case 0:return n=[],null==this.batchEnd?[3,2]:[4,zz(e)];case 1:r.sent(),n.push(this.batchEnd(t,e)),r.label=2;case 2:return"batch"===this.yieldEvery?n.push(kL()):pN.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),[4,Promise.all(n)];case 3:return r.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,zz(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,zz(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(Wz);function Kz(t,e){return null==t&&(t={}),t instanceof Wz?[t]:Array.isArray(t)&&t[0]instanceof Wz?t:WL(t).map(function(t){return new qz(t,e)})}var $z=function(){function t(){}return t.registerCallbackConstructor=function(e,n){pN.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, but got "+e}),t.checkForDuplicate(n),null==t.constructors[e]&&(t.constructors[e]=[]),t.constructors[e].push(n)},t.checkForDuplicate=function(e){for(var n in t.constructors)t.constructors[+n].forEach(function(t){if(t===e)throw new FL("Duplicate callback constructor.")})},t.clear=function(){t.constructors={}},t.createCallbacks=function(e){var n=[];for(var r in t.constructors){var o=+r;e>=o&&n.push.apply(n,t.constructors[o])}return n.map(function(t){return new t})},t.constructors={},t}();function Xz(t,e,n,r,o,i,a,s,u){var l=new Gz,c=[new Hz].concat($z.createCallbacks(e));null!=t&&c.push.apply(c,t),c.push(l);var p=new jz(c);return p.setParams({epochs:n,initialEpoch:r,samples:o,steps:i,batchSize:a,verbose:e,doValidation:s,metrics:u}),{callbackList:p,history:l}}function Yz(t,e,n){return void 0===e&&(e={}),void 0===n&&(n=!1),KL(t,uL.SerializationMap.getMap().classNameMap,e,"layer",n)}function Qz(t,e){return KI(function(){"float32"!==t.dtype&&(t=t.asType("float32"));var n=tF(WB(t),e,!0),r=SR(n.shape,DL()),o=rO(FO(n,r));return DO(t,o)})}function Zz(t,e){return KI(function(){return QM(WB(KO(e,t)),-1)})}function Jz(t,e){return KI(function(){return QM(ID(KO(e,t)),-1)})}function tU(t,e){return KI(function(){var n=KO(t,e),r=FD(ID(t),DL(),Number.MAX_VALUE),o=ID(DO(n,r));return VO(100,QM(o,-1))})}function eU(t,e,n){return void 0===n&&(n=!1),KI(function(){if(n)e=FA(e);else{var r=tF(e,e.shape.length-1,!0);e=DO(e,r)}return e=FD(e,DL(),1-DL()),GD(tF(VO(t.toFloat(),WD(e)),e.shape.length-1))})}function nU(t,e){return KI(function(){var n=VD(function(t){var e=[NB(t.shape)];return t.reshape(e)}(t)).toInt(),r=(e=FD(e,DL(),1-DL())).shape;return eU(nA(n,r[r.length-1]).reshape(r),e,!1)})}function rU(t,e){return KI(function(){var n;return n=FD(e,DL(),1-DL()),n=WD(DO(n,KO(1,n))),QM(function(t,e){if(!pN.arraysEqual(t.shape,e.shape))throw new FL("logits and labels must have the same shape, but got shapes "+JSON.stringify(t.shape)+" and "+JSON.stringify(e.shape));return KI(function(){var n=e.relu(),r=e.abs().neg();return n.sub(e.mul(t)).add(r.exp().log1p())})}(t,n),-1)})}function oU(t,e){return KI(function(){var n=Qz(t,-1),r=Qz(e,-1),o=VO(n,r);return GD(tF(o,-1))})}var iU={meanSquaredError:Zz,meanAbsoluteError:Jz,meanAbsolutePercentageError:tU,meanSquaredLogarithmicError:function(t,e){return KI(function(){var n=FD(e,DL(),Number.MAX_VALUE),r=WD(RO(1,n)),o=FD(t,DL(),Number.MAX_VALUE),i=WD(RO(1,o));return QM(WB(KO(r,i)),-1)})},squaredHinge:function(t,e){return KI(function(){var n=FO(0,KO(1,VO(t,e)));return QM(WB(n),-1)})},hinge:function(t,e){return KI(function(){var n=FO(0,KO(1,VO(t,e)));return QM(n,-1)})},categoricalHinge:function(t,e){return KI(function(){var n=tF(VO(t,e),-1),r=YM(VO(KO(1,t),e),-1);return FO(0,RO(1,KO(r,n)))})},logcosh:function(t,e){return KI(function(){var n=Math.log(2),r=KO(e,t),o=KO(RO(r,nO(VO(-2,r))),n);return QM(o,-1)})},categoricalCrossentropy:eU,sparseCategoricalCrossentropy:nU,binaryCrossentropy:rU,kullbackLeiblerDivergence:function(t,e){return KI(function(){var n=FD(t,DL(),1),r=FD(e,DL(),1);return tF(VO(t,WD(DO(n,r))),-1)})},poisson:function(t,e){return KI(function(){var n=WD(RO(DL(),e));return QM(KO(e,VO(t,n)),-1)})},cosineProximity:oU};function aU(t){if("string"==typeof t){if(t in iU)return iU[t];var e="Unknown loss "+t;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss "+t+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new FL(e)}return t}function sU(t,e){return KI(function(){var n=VO(.5,IR(e)),r=_B(QO(e,n),t.dtype);return QM(XO(t,r),-1)})}function uU(t,e){return KI(function(){return _B(XO(KM(t,-1),KM(e,-1)),"float32")})}function lU(t,e){return KI(function(){return CO(t.equal(1),e.equal(1)).sum().cast("float32")})}function cU(t,e){return KI(function(){var n=lU(t,e),r=function(t,e){return KI(function(){return CO(t.equal(0),e.equal(1)).sum().cast("float32")})}(t,e),o=n.add(r);return NO(QO(o,0),n.div(o),0).cast("float32")})}function pU(t,e){return rU(t,e)}function hU(t,e){return t.rank===e.rank&&(t=t.squeeze([t.rank-1])),(e=e.argMax(-1)).dtype!==t.dtype&&(e=e.asType(t.dtype)),XO(t,e).asType("float32")}var fU=eU,dU=nU,mU={binaryAccuracy:sU,categoricalAccuracy:uU,precision:cU,categoricalCrossentropy:fU,sparseCategoricalCrossentropy:dU,mse:Zz,MSE:Zz,mae:Jz,MAE:Jz,mape:tU,MAPE:tU,cosine:oU};function vU(t){if(zL(null!==t,"Unknown LossOrMetricFn "+t),"string"==typeof t)return t;for(var e=void 0,n=0,r=Object.keys(iU);n<r.length;n++){var o=r[n];if(iU[o]===t){e=o;break}}if(void 0!==e)return e;for(var i=0,a=Object.keys(mU);i<a.length;i++)if(mU[o=a[i]]===t){e=o;break}return void 0!==e?e:t.name}function gU(t,e,n){void 0===n&&(n=console.log);for(var r="",o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=t[o]).slice(0,e[o]),r+=" ".repeat(e[o]-r.length);n(r)}function yU(t,e,n){var r;try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}gU([t.name+" ("+t.getClassName()+")",r,t.countParams().toString()],e,n)}function bU(t,e,n,r){var o;try{o=JSON.stringify(t.outputShape)}catch(t){o="multiple"}for(var i=[],a=0,s=t.inboundNodes;a<s.length;a++){var u=s[a];if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var l=0;l<u.inboundLayers.length;++l)i.push(u.inboundLayers[l].name+"["+u.nodeIndices[l]+"]["+u.tensorIndices[l]+"]")}var c=t.name,p=t.getClassName(),h=0===i.length?"":i[0];for(gU([c+" ("+p+")",o,t.countParams().toString(),h],e,r),l=1;l<i.length;++l)gU(["","","",i[l]],e,r)}function wU(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function xU(t,e){if(null===t)return null;if("string"==typeof t)return HL(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var n=[],r=t.length,o=0;o<r;++o){var i=t[o];wU(e,o,i)?n.push(i):n.push(xU(i,e))}return n}for(var a={},s=0,u=Object.keys(t);s<u.length;s++){var l=u[s],c=t[l];if("name"===l&&"string"==typeof c)a[l]=c;else{var p=HL(l);a[p]=xU(c,p)}}return a}var CU="1.2.5",EU=function(){function t(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof t)for(var n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(null==e)return;for(var r=0,o=e;r<o.length;r++){var i=o[r];this.add(i.key,i.value)}}}return t.prototype.add=function(t,e,n){if(null!=this.id2Value[t.id])throw new FL("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return XR(e,t.dtype)}catch(n){throw new FL("The dtype of the feed ("+e.dtype+") can not be cast to the dtype of the key '"+t.name+"' ("+t.dtype+").")}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this},t.prototype.addFeed=function(t){this.add(t.key,t.value)},t.prototype.hasKey=function(t){return null!=this.id2Value[t.id]},t.prototype.names=function(){return Object.keys(this.name2Id)},t.prototype.getValue=function(t){if(t instanceof Dz){if(null==this.id2Value[t.id])throw new FL("Nonexistent key: "+t.name);return this.id2Value[t.id]}var e=this.name2Id[t];if(null==e)throw new FL("Feed dict has no SymbolicTensor name: "+t);return this.id2Value[e]},t.prototype.getMask=function(t){if(t instanceof Dz){if(null==this.id2Value[t.id])throw new FL("Nonexistent key: "+t.name);return this.id2Mask[t.id]}var e=this.name2Id[t];if(null==e)throw new FL("Feed dict has no SymbolicTensor name: "+t);return this.id2Mask[e]},t.prototype.disposeMasks=function(){null!=this.id2Mask&&$I(this.id2Mask)},t}(),SU={},kU={};function NU(t,e,n,r){for(var o=null!=n&&n.training,i=Array.isArray(t),a=i?t:[t],s=a.map(function(t){return t.name}),u=[],l=e.names(),c=0,p=s;c<p.length;c++){var h=p[c];-1!==l.indexOf(h)?u.push(e.getValue(h)):u.push(null)}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var f,d,m=s.join(",")+"|"+e.names().join(",");if(null==SU[m]){var v=function(t,e){pN.assert(null!=t&&t.length>0,function(){return"Expected at least one fetch, got none"});var n=[],r={};if(1===t.length){var o=RU(t[0],e);n=o.sorted,r=o.recipientMap}else for(var i=new Set,a=0,s=t;a<s.length;a++){for(var u=RU(s[a],e),l=u.recipientMap,c=0,p=u.sorted;c<p.length;c++){var h=p[c];i.has(h.name)||(n.push(h),i.add(h.name))}var f=function(t){null==r[t]&&(r[t]=new Set),l[t].forEach(function(e){return r[t].add(e)})};for(var d in l)f(d)}return{sorted:n,recipientCounts:IU(r)}}(a,e);d=v.recipientCounts,SU[m]=f=v.sorted,kU[m]=d}f=SU[m],d={},o||Object.assign(d,kU[m]);for(var g=new EU(e),y=0;y<f.length;++y){if(null!=r){var b=qI().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var w=f[y],x=w.sourceLayer;if(!(x instanceof Lz)){for(var C=[],E=[],S=[],k=!1,N=0,I=w.inputs;N<I.length;N++){var R=I[N],A=g.getValue(R),T=g.getMask(R);C.push(A),E.push(T),null!=T&&(k=!0),o||(d[R.name]--,0!==d[R.name]||e.hasKey(R)||-1!==s.indexOf(R.name)||A.isDisposed||!0===R.sourceLayer.stateful||S.push(A))}k&&((n=n||{}).mask=E[0]);var _=WL(x.apply(C,n)),D=null;x.supportsMasking&&(D=x.computeMask(C,E));for(var O=AU(w),M=Array.isArray(O)?O:[O],F=0;F<M.length;++F){g.hasKey(M[F])||g.add(M[F],_[F],Array.isArray(D)?D[0]:D);var P=s.indexOf(M[F].name);-1!==P&&(u[P]=_[F])}o||$I(S)}}return g.disposeMasks(),i?u:u[0]}function IU(t){var e={};for(var n in t)e[n]=t[n].size;return e}function RU(t,e){for(var n=new Set,r=[],o={},i=0,a=e.names();i<a.length;i++)n.add(a[i]);var s=[],u=[];for(s.push(t);s.length>0;){var l=s[s.length-1];if(n.has(l.name))s.pop();else{var c=u[u.length-1]===s.length-1;if(0===l.inputs.length||c)s.pop(),r.push(l),n.add(l.name),c&&u.pop();else{u.push(s.length-1);for(var p=0,h=l.inputs;p<h.length;p++){var f=h[p];null==o[f.name]&&(o[f.name]=new Set),o[f.name].add(l.name),n.has(f.name)||s.push(f)}}}}return{sorted:r,recipientMap:o}}function AU(t){var e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{for(var n=null,r=0;r<t.sourceLayer.inboundNodes.length;++r)for(var o=0,i=t.sourceLayer.inboundNodes[r].outputTensors;o<i.length;o++)if(i[o].id===t.id){n=r;break}e=t.sourceLayer.getOutputAt(n)}return e}var TU=function(t){function e(n){var r=t.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var o=r.getClassName().toLowerCase();r.name=bz(o)}if(r.supportsMasking=!1,r.trainable_=!0,r.inputs=Array.isArray(n.inputs)?n.inputs.slice():[n.inputs],r.outputs=Array.isArray(n.outputs)?n.outputs.slice():[n.outputs],XL(r.inputs).length!==r.inputs.length)throw new FL("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map(function(t){return t.name}));XL(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map(function(t){return t.name})),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[];for(var i=0,a=r.outputs;i<a.length;i++){var s=(N=a[i]).sourceLayer,u=N.nodeIndex,l=N.tensorIndex;r.outputLayers.push(s),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(l)}for(var c=0,p=r.inputs;c<p.length;c++)s=(N=p[c]).sourceLayer,l=N.tensorIndex,zL(0===(u=N.nodeIndex),"input layer has >1 nodes"),zL(0===l,"input layer has >1 tensors"),r.inputLayers.push(s),r.inputLayersNodeIndices.push(u),r.inputLayersTensorIndices.push(l);r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var h=0;h<r.inputLayers.length;h++){if(!((s=r.inputLayers[h])instanceof Lz))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: "+n.inputs+". Input "+h+" (0-based) originates from layer type "+s.getClassName()+".");r.inputNames.push(s.name),r.feedInputShapes.push(s.batchInputShape),r.feedInputNames.push(s.name)}for(var f=0,d=r.outputLayers;f<d.length;f++)r.outputNames.push((s=d[f]).name);r.internalInputShapes=r.inputs.map(function(t){return t.shape}),r.internalOutputShapes=r.outputs.map(function(t){return t.shape});for(var m={},v={},g={},y={},b={},w=[],x=function(t,n,o,i,a,s){null!=i&&null!=a&&null!=s||(i=t.sourceLayer,a=t.nodeIndex,s=t.tensorIndex);var u=i.inboundNodes[a];if(-1!==o.indexOf(u))throw new ML("The tensor "+t.name+' at layer "'+i.name+'" is part of a cycle.');if(-1===n.indexOf(u)){r.containerNodes.add(e.nodeKey(i,a)),i.id in b||(b[i.id]=Object.keys(b).length),-1===o.indexOf(u)&&o.push(u);for(var l=u.inboundLayers.length,c=0;c<l;c++)x(u.inputTensors[c],n,o,u.inboundLayers[c],u.nodeIndices[c],u.tensorIndices[c]);for(n.push(u);o.indexOf(u)>=0;)o.splice(o.indexOf(u),1);w.push(u)}},C=[],E=[],S=0,k=r.outputs;S<k.length;S++){var N=k[S];x(N,C,E)}for(var I=0,R=w.slice().reverse();I<R.length;I++){v[(K=R[I]).id]=K,K.id in m||(m[K.id]=0);var A=m[K.id];for(A=Math.max(A,null==g[K.outboundLayer.id]?0:g[K.outboundLayer.id]),g[K.outboundLayer.id]=A,y[K.outboundLayer.id]=K.outboundLayer,m[K.id]=A,h=0;h<K.inboundLayers.length;h++){var T=K.inboundLayers[h].inboundNodes[u=K.nodeIndices[h]];m[T.id]=Math.max(A+1,null==m[T.id]?0:m[T.id]),v[T.id]=T}}var _={};for(var D in m)(A=m[D])in _||(_[A]=[]),_[A].push(v[D]);var O={};for(var M in g)(A=g[M])in O||(O[A]=[]),O[A].push(y[M]);var F=Object.keys(O).map(function(t){return parseInt(t,10)}).sort($L);r.layers=[];for(var P=0,L=F;P<L.length;P++){var B=O[A=L[P]];B.sort(function(t,e){var n=b[t.id],r=b[e.id];return n<r?-1:n>r?1:0});for(var z=0,U=B;z<U.length;z++)r.layers.push(s=U[z])}r.layersByDepth=O,F=Object.keys(_).map(function(t){return parseInt(t,10)}).sort($L);for(var V=r.inputs.slice(),W=[],j=0,H=F;j<H.length;j++)for(var G=0,q=_[A=H[j]];G<q.length;G++){var K;if(null!=(s=(K=q[G]).outboundLayer)){for(var $=0,X=K.inputTensors;$<X.length;$++)if(-1===V.indexOf(N=X[$]))throw new ML("Graph disconnected: cannot obtain value for tensor "+N+' at layer "'+s.name+'". The following previous layers were accessed without issue: '+W);for(var Y=0,Q=K.outputTensors;Y<Q.length;Y++)V.push(N=Q[Y]);W.push(s.name)}}r.nodesByDepth=_;for(var Z=r.layers.map(function(t){return t.name}),J=function(t){var e=Z.filter(function(e){return e===t}).length;if(1!==e)throw new ML('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Z))},tt=0,et=Z;tt<et.length;tt++)J(et[tt]);return r.outboundNodes=[],r.inboundNodes=[],new Mz({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map(function(t){return null}),outputMasks:r.outputs.map(function(t){return null}),inputShapes:r.inputs.map(function(t){return t.shape}),outputShapes:r.outputs.map(function(t){return t.shape})}),r.built=!0,r._refCount=1,r}return IL(e,t),e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){this.assertNotDisposed();var t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount)for(var e=0,n=this.layers;e<n.length;e++)t.numDisposedVariables+=n[e].dispose().numDisposedVariables;return t.refCountAfterDispose=this._refCount,t},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(e){e._trainableWeights.forEach(function(e){return e.trainable=t})}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new FL("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var t=[],e=0,n=this.layers;e<n.length;e++)t=t.concat(n[e].trainableWeights);return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var o=[],i=0,a=this.layers;i<a.length;i++)o.push.apply(o,(r=a[i]).trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,e){void 0===e&&(e=!0);for(var n={},r=0,o=0,i=this.layers;o<i.length;o++)for(var a=0,s=i[o].weights;a<s.length;a++){var u=s[a];if(null!=n[u.originalName])throw new FL("Duplicate weight name: "+u.originalName);n[u.originalName]=u,r++}var l=[];for(var c in t){if(null!=n[c])l.push([n[c],t[c]]);else if(e)throw new FL("Provided weight data has no target variable: "+c);delete n[c]}if(e){var p=[];for(var h in n)p.push(h);if(p.length>0)throw new FL(p.length+" of "+r+" weights are not set: "+p)}Rz(l)},e.prototype.updatedConfig=function(){var t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers "+CU,e.backend="TensorFlow.js",e},e.prototype.toJSON=function(t,e){void 0===e&&(e=!0);var n=function t(e,n){if(null==e)return null;if("string"==typeof e)return jL(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var r=[],o=e.length,i=0;i<o;++i){var a=e[i];wU(n,i,a)?r.push(a):r.push(t(a,n))}return r}for(var s={},u=0,l=Object.keys(e);u<l.length;u++){var c=l[u],p=e[c];s[jL(c)]="name"!==c&&"className"!==c||"string"!=typeof p?t(p,c):p}return s}(this.updatedConfig());return e?JSON.stringify(n):n},e.prototype.call=function(t,e){var n=this;return KI(function(){t=WL(t);for(var r=new EU,o=0;o<n.inputs.length;++o)r.add(n.inputs[o],t[o]);return NU(n.outputs,r,e)})},e.prototype.computeMask=function(t,e){var n=this;return KI(function(){var r;return t=WL(t),r=null==e?BL(null,t.length):WL(e),n.runInternalGraph(t,r)[1]})},e.prototype.computeOutputShape=function(t){var e=xz(t);if(e.length!==this.inputLayers.length)throw new FL("Invalid inputShape argument "+t+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<e.length;r++){var o=this.inputLayers[r];n[b=o.name+"_0_0"]=e[r]}var i=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort($L);if(i.length>1)for(var a=0,s=i;a<s.length;a++)for(var u=0,l=this.nodesByDepth[s[a]];u<l.length;u++){var c=l[u];if(o=c.outboundLayer,-1===this.inputLayers.map(function(t){return t.id}).indexOf(o.id)){for(var p=[],h=0;h<c.inboundLayers.length;h++){var f=c.tensorIndices[h],d=n[b=c.inboundLayers[h].name+"_"+c.nodeIndices[h]+"_"+f];p.push(d)}var m=xz(o.computeOutputShape(VL(p))),v=o.inboundNodes.indexOf(c);for(h=0;h<m.length;h++)n[b=o.name+"_"+v+"_"+h]=m[h]}}var g=[],y=[];for(r=0;r<this.outputLayers.length;r++){var b=(o=this.outputLayers[r]).name+"_"+(v=this.outputLayersNodeIndices[r])+"_"+(f=this.outputLayersTensorIndices[r]);y.push(b)}for(r=0;r<y.length;r++){var w=y[r];zL(w in n),g.push(n[w])}return VL(g)},e.prototype.runInternalGraph=function(t,e){null==e&&(e=BL(null,t.length));for(var n={},r=0;r<this.inputs.length;++r){var o=this.inputs[r],i=t[r],a=e[r];n[o.id]=[i,a]}for(var s=0,u=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort($L);s<u.length;s++)for(var l=0,c=this.nodesByDepth[u[s]];l<c.length;l++){for(var p=c[l],h=p.outboundLayer,f=p.inputTensors,d=p.outputTensors,m=new Array,v=0,g=f;v<g.length;v++)(o=g[v]).id in n&&m.push(n[o.id]);if(m.length===f.length){var y={},b=void 0,w=void 0,x=void 0,C=void 0;if(null!=p.callArgs&&(y=p.callArgs),1===m.length){var E=m[0],S=E[0],k=E[1];null==y.mask&&(y.mask=k),x=WL(h.call(S,y)),C=WL(h.computeMask(S,k)),b=[S],w=[k]}else b=m.map(function(t){return t[0]}),w=m.map(function(t){return t[1]}),null==y.mask&&(y.mask=w),x=WL(h.call(b,y)),C=WL(h.computeMask(b,w));if(h.activityRegularizer)throw new PL("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<d.length;++r)n[(o=d[r]).id]=[i=x[r],a=C[r]]}}for(var N=[],I=[],R=[],A=0,T=this.outputs;A<T.length;A++){zL((o=T[A]).id in n,"Could not compute output "+o.name+" : "+o.id);var _=n[o.id],D=_[0];a=_[1],R.push(D.shape),N.push(D),I.push(a)}return[N,I,R]},e.prototype.buildNodeConversionMap=function(t){for(var n,r={},o=0,i=this.layers;o<i.length;o++){var a=i[o];n=a instanceof e?1:0;for(var s=0;s<a.inboundNodes.length;s++){var u=e.nodeKey(a,s);this.containerNodes.has(u)&&(r[u]=n,n+=1)}}return r},e.prototype.getLayer=function(t,e){if(null!=e){if(this.layers.length<=e)throw new FL("Was asked to retrieve layer at index "+e+", but model only has "+this.layers.length+" layer(s).");return this.layers[e]}if(null==t)throw new FL("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var o=r[n];if(o.name===t)return o}throw new FL("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return KI(function(){for(var n=[],r=0,o=t.layers;r<o.length;r++)for(var i=o[r],a=0;a<i.inboundNodes.length;++a){var s=e.nodeKey(i,a);t.containerNodes.has(s)&&n.push.apply(n,i.calculateLosses())}return n})},e.prototype.getConfig=function(){for(var t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],o=0,i=this.layers;o<i.length;o++){for(var a=(w=i[o]).getClassName(),s=w.getConfig(),u=[],l=0;l<w.inboundNodes.length;l++){var c=w.inboundNodes[l],p=e.nodeKey(w,l),h={};if(this.containerNodes.has(p)){if(c.callArgs)try{JSON.stringify(c.callArgs),h=c.callArgs}catch(t){console.warn("Layer "+w.name+" was passed non-serializable keyword arguments: "+c.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),h={}}if(c.inboundLayers.length>0){for(var f=[],d=0;d<c.inboundLayers.length;d++){var m=c.inboundLayers[d],v=c.nodeIndices[d],g=c.tensorIndices[d];null==(C=n[e.nodeKey(m,v)])&&(C=0),f.push([m.name,C,g,h])}u.push(f)}}}var y={};y.name=w.name,y.className=a,y.config=s,y.inboundNodes=u,r.push(y)}t.layers=r;var b=[];for(d=0;d<this.inputLayers.length;d++){var w=this.inputLayers[d];p=e.nodeKey(w,v=this.inputLayersNodeIndices[d]),this.containerNodes.has(p)&&(null!==(C=n[p])&&void 0!==C||(C=0),b.push([w.name,C,g=this.inputLayersTensorIndices[d]]))}t.inputLayers=b;var x=[];for(d=0;d<this.outputLayers.length;d++){var C;p=e.nodeKey(w=this.outputLayers[d],v=this.outputLayersNodeIndices[d]),this.containerNodes.has(p)&&(null!==(C=n[p])&&void 0!==C||(C=0),x.push([w.name,C,g=this.outputLayersTensorIndices[d]]))}return t.outputLayers=x,t},e.fromConfig=function(t,e,n,r){void 0===n&&(n={}),void 0===r&&(r=!1);var o={},i={};function a(t,e){t.name in i?i[t.name].push(e):i[t.name]=[e]}function s(t,e){for(var n,r=[],i=0,s=e;i<s.length;i++){var u=s[i],l=u[0],c=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(l in o))return void a(t,e);var h=o[l];if(h.inboundNodes.length<=c)return void a(t,e);r.push(h.inboundNodes[c].outputTensors[p])}r.length>0&&t.apply(VL(r),n)}function u(t){var n=t.name,i=Yz(t,null!=e.customObjects?e.customObjects:{});i.setFastWeightInitDuringBuild(r),o[n]=i,t.inboundNodes.forEach(function(t){if(!(t instanceof Array))throw new FL("Corrupted configuration, expected array for nodeData: "+t);a(i,t)})}for(var l=e.name,c=e.layers,p=0,h=c;p<h.length;p++)u(m=h[p]);for(;!YL(i);)for(var f=0,d=c;f<d.length;f++){var m=d[f];if((A=o[m.name]).name in i){var v=i[A.name];delete i[A.name];for(var g=0,y=v;g<y.length;g++)s(A,y[g])}}for(var b=[],w=[],x=0,C=e.inputLayers;x<C.length;x++){var E=(m=C[x])[0],S=m[1],k=m[2];zL(E in o);var N=(A=o[E]).inboundNodes[S].outputTensors;b.push(N[k])}for(var I=0,R=e.outputLayers;I<R.length;I++){var A;E=(m=R[I])[0],S=m[1],k=m[2],zL(E in o),N=(A=o[E]).inboundNodes[S].outputTensors,w.push(N[k])}return new t({inputs:b,outputs:w,name:l})},Object.defineProperty(e.prototype,"stateful",{get:function(){if(this._stateful)throw new FL("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var t=0,e=this.layers;t<e.length;t++)if(e[t].stateful)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){var t=this;KI(function(){t.layers.forEach(function(t){t.stateful&&t.resetStates()})})},e}(Pz);function _U(t,e){return function(t,e,n){var r=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(t){return null});if(1===r)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error("Provided "+n+" is an array of "+t.length+" element(s), but the model has "+r+" outputs. Make sure a set of weights is provided for each model output.");return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){var o=[];return e.forEach(function(e){o.push(e in t?t[e]:null)}),o}throw new Error("The model has multiple ("+r+") outputs, so "+n+" must be either an array with "+r+" elements or an object with "+e+" keys. Provided "+n+" not understood: "+JSON.stringify(t))}(t,e,"classWeight")}function DU(t,e,n,r){return TL(this,void 0,void 0,function(){var o,i,a,s,u;return _L(this,function(l){switch(l.label){case 0:if(null!=e||null!=r)throw new Error("Support sampleWeight is not implemented yet");return null==n?[3,2]:(o=KI(function(){if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1)return t.argMax(1);if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+t.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor ("+t.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),s=(a=Array).from,[4,o.data()]);case 1:return i=s.apply(a,[l.sent()]),$I(o),u=[],i.forEach(function(t){if(null==n[t])throw new Error("classWeight must contain all classes in the training data. The class "+t+" exists in the data but not in classWeight");u.push(n[t])}),[2,yR(u,"float32")];case 2:return[2,null]}})})}function OU(t,e){return VO(t,e)}var MU=32;function FU(t,e){var n,r;r=e.ys,pN.assert(null!=(n=e.xs)&&null!=r,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+e});var o=PU("input",t.inputNames,n),i=PU("output",t.outputNames,r),a=o[0].shape[0];pN.assert(o.length===t.inputs.length,function(){return"LayersModel has "+t.inputs.length+" inputs, but the dataset provides "+o.length+" inputs.  (Expected input keys: "+JSON.stringify(t.inputNames)+")"}),pN.assert(i.length===t.outputs.length,function(){return"LayersModel has "+t.outputs.length+" outputs, but the dataset provides "+i.length+" outputs.  (Expected output keys: "+JSON.stringify(t.outputNames)+")"});var s=function(e){pN.assert(o[e].shape[0]===a,function(){return"Batch size mismatch: input "+t.inputNames[e]+" has "+o[e].shape[0]+"; expected  "+a+" based on input "+t.inputNames[0]+"."})};for(var u in o)s(u);var l=function(e){pN.assert(i[e].shape[0]===a,function(){return"Batch size mismatch: output "+t.outputNames[e]+" has "+i[e].shape[0]+"; expected  "+a+" based on input "+t.inputNames[0]+"."})};for(var c in i)l(c);return{xs:o,ys:i}}function PU(t,e,n){if(n instanceof CN)return[n];if(Array.isArray(n))return pN.assert(n.length===e.length,function(){return"Received an array of "+n.length+" Tensors, but expected "+e.length+" to match the "+t+" keys "+e+"."}),n;for(var r=[],o=0,i=e;o<i.length;o++){var a=i[o];if(null==n[a])throw new FL("The feature data generated by the dataset lacks the required "+t+" key '"+a+"'.");r.push(n[a])}return r}function LU(t,e,n){return TL(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,d,m,v,g,y,b,w,x,C,E,S,k,N,I,R,A,T,_,D,O,M;return _L(this,function(F){switch(F.label){case 0:if(r=null!=n.batchesPerEpoch,pN.assert(null!=t.optimizer,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),pN.assert(null!=n,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),pN.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs}),pN.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch}),pN.assert(null==n.validationSplit,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,F.label=1;case 1:return F.trys.push([1,,26,27]),i=void 0,a=void 0,(o=null!=n.validationData)&&(BU(n.validationData)?pN.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches}):(s=function(t){if(3===t.length)throw new PL("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData),i=s.xs,a=s.ys)),u=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),c=o?l.slice().concat(l.map(function(t){return"val_"+t})):l.slice(),p=Kz(n.callbacks,n.yieldEvery),h=Xz(p,null==n.verbose?1:n.verbose,n.epochs,null,null,function(t,e){var n=null;return null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}(e,n),null,o,c),d=h.history,(f=h.callbackList).setModel(t),t.history=d,[4,f.onTrainBegin()];case 2:return F.sent(),t.stopTraining_=!1,m=null==n.initialEpoch?0:n.initialEpoch,[4,e.iterator()];case 3:v=F.sent(),F.label=4;case 4:return m<n.epochs?(g={},[4,f.onEpochBegin(m)]):[3,23];case 5:return F.sent(),y=0,b=0,r?[3,7]:[4,e.iterator()];case 6:v=F.sent(),F.label=7;case 7:return!r||y<n.batchesPerEpoch?[4,v.next()]:[3,21];case 8:return w=F.sent(),r&&w.done?(console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+y+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,21]):null==w.value?[3,15]:(x=FU(t,w.value),C=x.xs,E=x.ys,(S={}).batch=b,S.size=C[0].shape[0],[4,f.onBatchBegin(b,S)]);case 9:if(F.sent(),k=[],null==n.classWeight)return[3,13];N=_U(n.classWeight,t.outputNames),M=0,F.label=10;case 10:return M<N.length?(R=(I=k).push,[4,DU(E[M],null,N[M])]):[3,13];case 11:R.apply(I,[F.sent()]),F.label=12;case 12:return++M,[3,10];case 13:for(A=C.concat(E).concat(k),T=u(A),$I(A),M=0;M<l.length;++M)S[l[M]]=_=T[M],XI(_);return[4,f.onBatchEnd(b,S)];case 14:F.sent(),Uz(S),b++,y++,F.label=15;case 15:return(r?y>=n.batchesPerEpoch:w.done)?o?(D=void 0,BU(n.validationData)?(O=WL,[4,t.evaluateDataset(n.validationData,{batches:n.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return D=O.apply(void 0,[F.sent()]),[3,18];case 17:D=WL(t.evaluate(i,a,{batchSize:null==n.validationBatchSize?MU:n.validationBatchSize,verbose:0})),F.label=18;case 18:for(M=0;M<t.metricsNames.length;++M)g["val_"+t.metricsNames[M]]=D[M];F.label=19;case 19:return[3,21];case 20:return t.stopTraining_?[3,21]:[3,7];case 21:return[4,f.onEpochEnd(m,g)];case 22:return F.sent(),m++,t.stopTraining_?[3,23]:[3,4];case 23:return[4,f.onTrainEnd()];case 24:return F.sent(),[4,t.history.syncData()];case 25:return F.sent(),[2,t.history];case 26:return t.isTraining=!1,[7];case 27:return[2]}})})}function BU(t){return"function"==typeof t.iterator}function zU(t,e,n){return TL(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h;return _L(this,function(f){switch(f.label){case 0:if(r=null!=(n=n||{}).batches,o=t.testFunction,i=[],n.verbose>0)throw new PL("Verbose mode is not implemented yet.");return pN.assert(!r||n.batches>0&&Number.isInteger(n.batches),function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches)}),"function"==typeof e.next?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=f.sent(),f.label=3;case 3:a=s,u=0,l=0,c=function(){var e;return _L(this,function(s){switch(s.label){case 0:return[4,a.next()];case 1:return e=s.sent(),i=KI(function(){if(e.value){var n=FU(t,e.value),r=n.xs.concat(n.ys),a=KI(function(){return o(r)});if($I(r),0===l)for(var s=0;s<a.length;++s)i.push(gR(0));var c=r[0].shape[0],p=function(t){var e=a[t],n=i[t];i[t]=KI(function(){return RO(i[t],VO(c,e))}),l>0&&$I(n)};for(s=0;s<a.length;++s)p(s);$I(a),u+=c,++l}return i}),e.done?(r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+n.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},f.label=4;case 4:return!r||l<n.batches?[5,c()]:[3,6];case 5:return"break"===f.sent()?[3,6]:[3,4];case 6:for(p=0;p<i.length;++p)h=i[p],i[p]=DO(i[p],u),$I(h);return[2,VL(i)]}})})}function UU(t){pN.assert(t>0&&Number.isInteger(t),function(){return"batchSize is required to be a positive integer, but got "+t})}function VU(t,e,n){return null==t?[null]:Array.isArray(t)?t.map(function(t){return OB(t,e,n-e)}):OB(t,e,n-e)}function WU(t,e){return KI(function(){return null==t?null:Array.isArray(t)?t.map(function(t){return WU(t,e)}):VB(t,"int32"===e.dtype?e:e.toInt())})}function jU(t,e){for(var n=[],r=0,o=null;r<t;)(o=r+e)>=t&&(o=t),n.push([r,o]),r=o;return n}function HU(t,e,n,r,o,i,a,s,u,l,c,p,h,f,d){return TL(this,void 0,void 0,function(){var m,v,g,y,b,w,x,C;return _L(this,function(E){switch(E.label){case 0:if(null==o&&(o=32),null==i&&(i=1),null==c&&(c=!0),null==h&&(h=0),m=!1,null!=u&&null!=l&&(m=!0),null!=d&&(m=!0,null==f))throw new FL("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return null!=(v=t.checkNumSamples(n,o,f,"steps_per_epoch"))&&(g=TB(0,v)),null==a&&(a=1),y=Xz(s,a,i,h,v,f,o,m,p),w=y.history,(b=y.callbackList).setModel(t),t.history=w,[4,b.onTrainBegin()];case 1:E.sent(),t.stopTraining_=!1,x=function(i){var a,s,p,h,d;return _L(this,function(y){switch(y.label){case 0:return[4,b.onEpochBegin(i)];case 1:if(y.sent(),a={},null==f)return[3,2];throw new PL("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===c)throw new PL("batch shuffling is not implemneted yet");c&&pN.shuffle(g),s=yR(g),p=jU(v,o),h=function(i){var c;return _L(this,function(h){switch(h.label){case 0:return[4,b.onBatchBegin(i,c={})];case 1:return h.sent(),KI(function(){var h=p[i][0],f=p[i][1],d=OB(s,h,f-h);c.batch=i,c.size=f-h;for(var v=WU(n,d),g=e(v),y=0;y<r.length;++y){var b=r[y],w=g[y];c[b]=w,XI(w)}if(i===p.length-1&&m){var x=t.testLoop(u,l,o);for(y=0;y<r.length;++y)b=r[y],XI(w=x[y]),a["val_"+b]=w}}),[4,b.onBatchEnd(i,c)];case 2:return h.sent(),Uz(c),t.stopTraining_?[2,"break"]:[2]}})},d=0,y.label=3;case 3:return d<p.length?[5,h(d)]:[3,6];case 4:if("break"===y.sent())return[3,6];y.label=5;case 5:return++d,[3,3];case 6:s.dispose(),y.label=7;case 7:return[4,b.onEpochEnd(i,a)];case 8:return y.sent(),t.stopTraining_?[2,"break"]:[2]}})},C=h,E.label=2;case 2:return C<i?[5,x(C)]:[3,5];case 3:if("break"===E.sent())return[3,5];E.label=4;case 4:return++C,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return E.sent(),[4,t.history.syncData()];case 7:return E.sent(),[2,t.history]}})})}function GU(t,e,n,r){return void 0===r&&(r={}),TL(this,void 0,void 0,function(){var o,i,a,s,u,l,c,p,h,f,d,m,v,g,y,b,w,x,C,E;return _L(this,function(S){switch(S.label){case 0:if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,S.label=1;case 1:return S.trys.push([1,,7,8]),UU(p=null==r.batchSize?32:r.batchSize),[4,t.standardizeUserData(e,n,r.sampleWeight,r.classWeight,!1,p)];case 2:if(h=S.sent(),o=h[0],i=h[1],c=h[2],f=!1,d=void 0,!(null!=r.validationData&&r.validationData.length>0))return[3,4];if(f=!0,2!==r.validationData.length)throw 3===r.validationData.length?new PL("validationData including sample weights is not supported yet."):new FL("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+r.validationData+" is invalid.");return[4,t.standardizeUserData(a=r.validationData[0],s=r.validationData[1],null,null,!0,p)];case 3:return m=S.sent(),d=(u=m[0]).concat(l=m[1]),[3,5];case 4:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(f=!0,v=Math.floor(o[0].shape[0]*(1-r.validationSplit)),u=VU(o,v,g=o[0].shape[0]),o=VU(o,0,v),l=VU(i,v,g),i=VU(i,0,v),d=u.concat(l)):null!=r.validationSteps&&(f=!0),S.label=5;case 5:return y=o.concat(i).concat(c),t.checkTrainableWeightsConsistency(),b=t.makeTrainFunction(),w=t.getDedupedMetricsNames(),x=void 0,C=void 0,f?(t.makeTestFunction(),x=t.testFunction,C=w.slice().concat(w.map(function(t){return"val_"+t}))):(x=null,d=[],C=w.slice()),E=Kz(r.callbacks,r.yieldEvery),[4,HU(t,b,y,w,p,r.epochs,r.verbose,E,x,d,r.shuffle,C,r.initialEpoch,null,null)];case 6:return[2,S.sent()];case 7:return t.isTraining=!1,KU(o,e),KU(i,n),KU(u,a),KU(l,s),null!=c&&$I(c),[7];case 8:return[2]}})})}function qU(t){var e=[];t instanceof CN&&(t=[t]);for(var n=0;n<t.length;++n){var r=t[n];if(1===r.rank)e.push(DB(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function KU(t,e){if(null!=t){var n=[];if(e instanceof CN)n.push(e.id);else if(Array.isArray(e))e.forEach(function(t){return n.push(t.id)});else if(null!=e)for(var r in e)n.push(e[r].id);var o=[];if(t instanceof CN)-1===n.indexOf(t.id)&&o.push(t);else if(Array.isArray(t))t.forEach(function(t){-1===n.indexOf(t.id)&&o.push(t)});else if(null!=t)for(var i in t){var a=t[i];-1===n.indexOf(a.id)&&o.push(a)}o.forEach(function(t){t.isDisposed||t.dispose()})}}function $U(t){return Array.isArray(t)}function XU(t){return!function(t){return t instanceof CN}(t)&&!$U(t)}function YU(t,e,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=""),null==e||0===e.length){if(null!=t){var i=!1;if($U(t)&&t.length>0)i=!0;else if(XU(t)){for(var a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new FL("Error when checking model "+o+" expected no data, but got "+t)}return[]}if(null==t)return e.map(function(t){return null});var s;if(XU(t)){t=t,s=[];for(var u=0,l=e;u<l.length;u++){var c=l[u];if(null==t[c])throw new FL('No data provided for "'+c+'". Need data for each key in: '+e);s.push(t[c])}}else if($U(t)){if((t=t).length!==e.length)throw new FL("Error when checking model "+o+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+e.length+" Tensor(s), but instead got the following list of Tensor(s): "+t);s=t}else{if(t=t,e.length>1)throw new FL("The model "+o+" expects "+e.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+t.shape);s=[t]}if(s=qU(s),null!=n)for(var p=0;p<e.length;++p)if(null!=n[p]){var h=s[p];if(h.shape.length!==n[p].length)throw new FL("Error when checking "+o+": expected "+e[p]+" to have "+n[p].length+" dimension(s). but got array with shape "+h.shape);for(var f=0;f<n[p].length;++f)if(0!==f||r){var d=n[p][f];if(null!=d&&d>=0&&h.shape[f]!==d)throw new FL("Error when checking "+o+": expected "+e[p]+" to have shape ["+n[p]+"], but got array with shape ["+h.shape+"].")}}return s}function QU(t,e,n,r,o){var i;if(void 0===r&&(r=!0),void 0===o&&(o=""),Array.isArray(t)){if(t.length!==e.length)throw new FL("Error when checking model "+o+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+e.length+" Tensor(s), but instead got "+t.length+" Tensors(s).");i=t}else{if(e.length>1)throw new FL("The model expects "+e.length+" "+o+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(t.shape)+".");i=[t]}if(null!=n)for(var a=0;a<e.length;++a)if(null!=n[a]){var s=i[a];if(s.shape.length!==n[a].length)throw new FL("Error when checking "+o+": expected "+e[a]+" to have "+n[a].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[a].length;++u)if(0!==u||r){var l=n[a][u];if(null!=l&&l!==s.shape[u])throw new FL("Error when checking "+o+": expected "+e[a]+" to have shape "+JSON.stringify(n[a])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}var ZU=function(t){function e(e){var n=t.call(this,e)||this;return n.isTraining=!1,n}return IL(e,t),e.prototype.summary=function(t,e,n){if(void 0===n&&(n=console.log),!this.built)throw new FL("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(t,e,n,r){void 0===r&&(r=console.log);var o,i=function(t){var e=!0,n=[],r=[];for(var o in t.nodesByDepth)n.push(t.nodesByDepth[o]);for(var i=0,a=n;i<a.length;i++){var s=a[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){e=!1;break}r.push.apply(r,s)}if(e)for(var u=0,l=t.layers;u<l.length;u++){for(var c=!1,p=0,h=l[u].inboundNodes;p<h.length;p++)if(-1!==r.indexOf(h[p])){if(c){e=!1;break}c=!0}if(!e)break}return e}(t),a=["Layer (type)","Output shape","Param #"];if(i?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(function(t){return Math.floor(e*t)})),!i)for(var s in a.push("Receives inputs"),o=[],t.nodesByDepth)o.push.apply(o,t.nodesByDepth[s]);r("_".repeat(e)),gU(a,n,r),r("=".repeat(e));for(var u=t.layers,l=0;l<u.length;++l)i?yU(u[l],n,r):bU(u[l],n,o,r),r((l===u.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();var c=function(t){return Sz(null!=t.collectedTrainableWeights?t.collectedTrainableWeights:t.trainableWeights)}(t),p=Sz(t.nonTrainableWeights);r("Total params: "+(c+p)),r("Trainable params: "+c),r("Non-trainable params: "+p),r("_".repeat(e))}(this,t,e,n)},e.prototype.compile=function(t){var e=this;if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){var e={Adagrad:function(){return EL.adagrad(.01)},Adadelta:function(){return EL.adadelta(1,.95,DL())},Adam:function(){return EL.adam(.001,.9,.999,DL())},Adamax:function(){return EL.adamax(.002,.9,.999,DL(),0)},RMSProp:function(){return EL.rmsprop(.001,.9,0,DL())},SGD:function(){return EL.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new FL("Unknown Optimizer "+t)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof dL))throw new FL("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new FL("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+t.loss+".");n=t.loss.map(function(t){return aU(t)})}else{var r=aU(t.loss);this.outputs.forEach(function(t){n.push(r)})}else{for(var o in t.loss=t.loss,t.loss)if(-1===this.outputNames.indexOf(o))throw new FL('Unknown entry in loss dictionary: "'+o+'". Only expected the following keys: '+this.outputNames);for(var i=0,a=this.outputNames;i<a.length;i++){var s=a[i];null==t.loss[s]&&console.warn('Output "'+s+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+s+" during training"),n.push(aU(t.loss[s]))}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var l=this.internalOutputShapes[u];this.feedOutputNames.push(this.outputNames[u]),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[u])}var c=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],wB("loss",function(){for(var t=0;t<e.outputs.length;++t)-1===c.indexOf(t)&&e.outputs.length>1&&(e.metricsTensors.push([e.lossFunctions[t],t]),e.metricsNames.push(e.outputNames[t]+"_loss"))});var p=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(t){return[]});var n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+t);n=t}if(Array.isArray(n))return e.map(function(t){return n});for(var r=[],o=0,i=e;o<i.length;o++){var a=i[o],s=n.hasOwnProperty(a)?n[a]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}(t.metrics,this.outputNames);wB("metric",function(){for(var t=function(t){if(-1!==c.indexOf(t))return"continue";!function(n){for(var r,o,i,a=function(n){if("string"==typeof n&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(n)){var a=e.internalOutputShapes[t];1===a[a.length-1]||e.lossFunctions[t]===rU?-1!==["accuracy","acc"].indexOf(n)?o=sU:-1!==["crossentropy","ce"].indexOf(n)&&(o=pU):e.lossFunctions[t]===nU?-1!==["accuracy","acc"].indexOf(n)?o=hU:-1!==["crossentropy","ce"].indexOf(n)&&(o=dU):-1!==["accuracy","acc"].indexOf(n)?o=uU:-1!==["crossentropy","ce"].indexOf(n)&&(o=fU);var s=void 0;-1!==["accuracy","acc"].indexOf(n)?s="acc":-1!==["crossentropy","ce"].indexOf(n)&&(s="ce"),i=o,r=""+s}else{var u=function(t){if("string"==typeof n&&n in mU)return mU[n];if("string"!=typeof n&&null!=n)return n;throw new FL("Unknown metric "+n)}();i=u,r=""+vU(n)}var l;wB(r,function(){l=i}),function(t,n,r){e.outputNames.length>1&&(n=e.outputNames[t]+"_"+n),e.metricsNames.push(n),e.metricsTensors.push([r,t])}(t,r,l)},s=0,u=p[t];s<u.length;s++)a(u[s])}()},n=0;n<e.outputs.length;++n)t(n)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,e,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;UU(r);var o=this.standardizeUserDataXY(t,e,!0,r);try{var i=o[0].concat(o[1]);return this.makeTestFunction(),VL(this.testLoop(this.testFunction,i,r,n.verbose,n.steps))}finally{KU(o[0],t),KU(o[1],e)}},e.prototype.evaluateDataset=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(n){return this.makeTestFunction(),[2,zU(this,t,e)]})})},e.prototype.checkNumSamples=function(t,e,n,r){var o;if(void 0===r&&(r="steps"),null!=n){if(o=null,null!=e)throw new FL("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+e)}else{if(null==t)throw new FL("Either the input data should have a defined shape, or "+r+" shoud be specified.");o=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return o},e.prototype.execute=function(t,e){if(Array.isArray(e)&&0===e.length)throw new FL("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(e),r=this.retrieveSymbolicTensors(n?e:[e]),o=new EU;if(t instanceof CN&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new FL("The number of inputs provided ("+t.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var i=0;i<this.inputs.length;++i)o.add(this.inputs[i],t[i])}else for(var a=0,s=this.inputs;a<s.length;a++){var u=s[a],l=t[u.name];if(null==l)throw new FL("No value is provided for the model's input "+u.name);o.add(u,l)}var c=NU(r,o);return n?c:c[0]},e.prototype.retrieveSymbolicTensors=function(t){for(var e=BL(null,t.length),n=t.length,r=0,o=this.layers;r<o.length;r++){for(var i=o[r],a=Array.isArray(i.output)?i.output:[i.output],s=a.map(function(t){return t.name}),u=0;u<t.length;++u){var l=s.indexOf(t[u]);if(-1!==l&&(e[u]=a[l],n--),0===n)break}if(0===n)break}if(n>0){var c=[];throw e.forEach(function(e,n){null==e&&c.push(t[n])}),new FL("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return e},e.prototype.predictLoop=function(t,e,n){var r=this;return void 0===e&&(e=32),void 0===n&&(n=!1),KI(function(){var o=r.checkNumSamples(t);if(n)throw new PL("Verbose predictLoop() is not implemented yet.");for(var i=jU(o,e),a=r.outputs.map(function(t){return[]}),s=function(e){KI(function(){var n=VU(t,i[e][0],i[e][1]),o=[];if(Array.isArray(n))for(var a=0;a<n.length;++a)o.push({key:r.inputs[a],value:n[a]});else o.push({key:r.inputs[0],value:n});var s=new EU(o);return NU(r.outputs,s)}).forEach(function(t,e){return a[e].push(t)})},u=0;u<i.length;++u)s(u);return VL(a.map(function(t){return AR(t,0)}))})},e.prototype.predict=function(t,e){void 0===e&&(e={});var n=qU(t);QU(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==e.batchSize?32:e.batchSize;return UU(r),this.predictLoop(n,r)}finally{KU(n,t)}},e.prototype.predictOnBatch=function(t){return QU(t,this.inputNames,this.feedInputShapes,!0),this.predictLoop(t,t.shape[0])},e.prototype.standardizeUserDataXY=function(t,e,n,r){if(void 0===n&&(n=!0),null==this.optimizer_)throw new ML("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],i=0;i<this.feedOutputShapes.length;++i){var a=this.feedOutputShapes[i];o.push(this.feedLossFns[i]===nU?a.slice(0,a.length-1).concat([1]):a)}if(function(t,e,n){var r=XL(t.map(function(t){return t.shape[0]}));r.sort();var o=XL(e.map(function(t){return t.shape[0]}));if(o.sort(),r.length>1)throw new FL("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(t){return t.shape})));if(o.length>1)throw new FL("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(t){return t.shape})));if(r.length>0&&o.length>0&&!pN.arraysEqual(r,o))throw new FL("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+o[0]+" target sample(s).")}(t=YU(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=YU(e,this.feedOutputNames,o,!1,"target")),function(t,e,n){for(var r=[Zz,rU,eU],o=0;o<t.length;++o){var i=t[o],a=e[o],s=n[o];if(null!=a){if(a===eU&&1===i.shape[i.shape.length-1])throw new FL("You are passing a target array of shape "+i.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(a))for(var u=i.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var p=l[c];if(null!=p&&u[c]!==p)throw new FL("A target Tensor with shape "+i.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new FL("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+r+". Found: "+t[0].shape[0]+" sample(s).");return[t,e]},e.prototype.standardizeUserData=function(t,e,n,r,o,i){return void 0===o&&(o=!0),TL(this,void 0,void 0,function(){var a,s,u,l,c,p,h,f;return _L(this,function(d){switch(d.label){case 0:if(a=this.standardizeUserDataXY(t,e,o,i),s=a[0],u=a[1],null!=n)throw new Error("sample weight is not supported yet.");if(l=null,null==r)return[3,4];c=_U(r,this.outputNames),l=[],p=0,d.label=1;case 1:return p<c.length?(f=(h=l).push,[4,DU(u[p],null,c[p])]):[3,4];case 2:f.apply(h,[d.sent()]),d.label=3;case 3:return++p,[3,1];case 4:return[2,[s,u,l]]}})})},e.prototype.testLoop=function(t,e,n,r,o){var i=this;return void 0===r&&(r=0),KI(function(){var a=i.checkNumSamples(e,n,o,"steps"),s=[];if(r>0)throw new PL("Verbose mode is not implemented yet.");if(null!=o)throw new PL("steps mode in testLoop() is not implemented yet");for(var u=jU(a,n),l=yR(TB(0,a)),c=0;c<u.length;++c){var p=u[c][0],h=u[c][1],f=OB(l,p,h-p),d=WU(e,f),m=t(d);if(0===c)for(var v=0;v<m.length;++v)s.push(gR(0));for(v=0;v<m.length;++v)s[v]=RO(s[v],VO(h-p,m[v]))}for(v=0;v<s.length;++v)s[v]=DO(s[v],a);return s})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,e=[],n=0;n<t.length;++n){var r=t[n],o=r;UL(t,r)>1&&(o+="_"+UL(t.slice(0,n),r)),e.push(o)}return e},e.prototype.makeTrainFunction=function(){var t=this;return function(e){var n=[],r=e.slice(0,t.inputs.length),o=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),i=e.slice(t.inputs.length+t.outputs.length,t.inputs.length+2*t.outputs.length),a=[],s=t.collectedTrainableWeights.map(function(t){return t.read()});return[t.optimizer_.minimize(function(){for(var e=[],s=0;s<t.inputs.length;++s)e.push({key:t.inputs[s],value:r[s]});var u,l=new EU(e),c=NU(t.outputs,l,{training:!0});for(s=0;s<t.lossFunctions.length;++s){var p=(0,t.lossFunctions[s])(o[s],c[s]);null!=i[s]&&(p=OU(p,i[s]));var h=QM(p);n.push(h),u=0===s?p:RO(u,p)}for(s=0;s<t.metricsTensors.length;++s){var f=void 0;if(t.outputs.length>1&&s<t.outputs.length)f=n[s];else{var d=t.metricsTensors[s][1];f=QM((0,t.metricsTensors[s][0])(o[d],c[d]))}XI(f),a.push(f)}return u=QM(u),t.calculateLosses().forEach(function(t){u=RO(u,t)}),u},!0,s)].concat(a)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(e){return KI(function(){for(var n,r=[],o=e.slice(0,t.inputs.length),i=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),a=[],s=0;s<t.inputs.length;++s)a.push({key:t.inputs[s],value:o[s]});var u=new EU(a),l=NU(t.outputs,u);for(s=0;s<t.lossFunctions.length;++s){var c=QM((0,t.lossFunctions[s])(i[s],l[s]));n=0===s?c:RO(n,c),r.push(n)}for(s=0;s<t.metricsTensors.length;++s){var p=t.metricsTensors[s][1],h=QM((0,t.metricsTensors[s][0])(i[p],l[p]));r.push(h)}return r})}},e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),TL(this,void 0,void 0,function(){return _L(this,function(r){return[2,GU(this,t,e,n)]})})},e.prototype.fitDataset=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(n){return[2,LU(this,t,e)]})})},e.prototype.trainOnBatch=function(t,e){return TL(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return _L(this,function(p){switch(p.label){case 0:return[4,this.standardizeUserData(t,e)];case 1:n=p.sent(),r=n[0],o=n[1],i=this.makeTrainFunction(),a=i(r.concat(o)),s=[],u=0,l=a,p.label=2;case 2:return u<l.length?[4,l[u].data()]:[3,5];case 3:c=p.sent(),s.push(c[0]),p.label=4;case 4:return u++,[3,2];case 5:return $I(a),[2,VL(s)]}})})},e.prototype.getNamedWeights=function(t){for(var e=[],n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,o=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||e.push({name:r[i].originalName,tensor:o[i]});return e},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=t.prototype.dispose.call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var n=qI().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-qI().numTensors}return e},e.prototype.getLossIdentifiers=function(){var t;if("string"==typeof this.loss)t=jL(this.loss);else if(Array.isArray(this.loss)){for(var e=0,n=this.loss;e<n.length;e++)if("string"!=typeof n[e])throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(function(t){return jL(t)})}else{var r=Object.keys(this.loss);t={};for(var o=this.loss,i=0,a=r;i<a.length;i++){var s=a[i];if("string"!=typeof o[s])throw new Error("Serialization of non-string loss is not supported.");t[s]=jL(o[s])}}return t},e.prototype.getMetricIdentifiers=function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[jL(vU(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(t){return jL(vU(t))});var t={};for(var e in this.metrics)t[e]=jL(vU(this.metrics[e]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var e,n,r=Yz(xU(t.optimizer_config));if("string"==typeof t.loss)e=HL(t.loss);else if(Array.isArray(t.loss))e=t.loss.map(function(t){return HL(t)});else if(null!=t.loss)for(var o in e={},t.loss)e[o]=HL(t.loss[o]);if(Array.isArray(t.metrics))n=t.metrics.map(function(t){return HL(t)});else if(null!=t.metrics)for(var o in n={},t.metrics)n[o]=HL(t.metrics[o]);this.compile({loss:e,metrics:n,optimizer:r})},e.prototype.save=function(t,e){return TL(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,p;return _L(this,function(h){switch(h.label){case 0:if("string"==typeof t){if(0===(r=eL.getSaveHandlers(t)).length)throw new FL("Cannot find any save handlers for URL '"+t+"'");if(r.length>1)throw new FL("Found more than one ("+r.length+") save handlers for URL '"+t+"'");t=r[0]}if(null==t.save)throw new FL("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,eL.encodeWeights(this.getNamedWeights(e))];case 1:return o=h.sent(),i=this.toJSON(null,!1),a={modelTopology:i,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v"+CU,convertedBy:null},null!=e&&e.includeOptimizer&&null!=this.optimizer?(a.trainingConfig=this.getTrainingConfig(),s="optimizer",p=(c=eL).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,p.apply(c,[h.sent(),s])];case 3:u=h.sent(),l=u.data,(n=o.specs).push.apply(n,u.specs),o.data=eL.concatenateArrayBuffers([o.data,l]),h.label=4;case 4:return a.weightData=o.data,a.weightSpecs=o.specs,[2,t.save(a)]}})})},e.className="Model",e}(TU);function JU(t,e,n){return TL(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p;return _L(this,function(h){switch(h.label){case 0:if(null==n&&(n={}),null==t.load)throw new FL("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,t.load()];case 1:if(r=h.sent(),null!=(o=r.modelTopology).model_config&&(o=o.model_config),i=null==n.strict||n.strict,a=null!=r.weightData&&null!=r.weightSpecs&&i,s=Yz(xU(o),e,a),null!=(u=r.trainingConfig)&&s.loadTrainingConfig(u),null==r.weightData)return[3,4];if(null==r.weightSpecs)throw new FL("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return l=function(t,e){var n=eL.decodeWeights(t,e),r={},o=[];return e.forEach(function(t){"optimizer"===t.group?o.push({name:t.name,tensor:n[t.name]}):r[t.name]=n[t.name]}),{modelWeights:r,optimizerWeights:o}}(r.weightData,r.weightSpecs),p=l.optimizerWeights,s.loadWeights(c=l.modelWeights,i),null!=s.optimizer&&p.length>0?[4,s.optimizer.setWeights(p)]:[3,3];case 2:h.sent(),h.label=3;case 3:$I(c),$I(p.map(function(t){return t.tensor})),h.label=4;case 4:return[2,s]}})})}uL.registerClass(ZU);var tV=function(t){function e(e){var n=t.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},n.trainable=!0,n.built=!1,n.name=null!=e.name?e.name:bz("sequential_"),null!=e.layers)for(var r=0,o=e.layers;r<o.length;r++)n.add(o[r]);return n}return IL(e,t),e.prototype.checkShape=function(t){if(t.inboundNodes[0].outputTensors[0].shape.some(function(t){return t<0}))throw new FL("Negative dimension size caused by adding layer "+t.name+" with input shape ["+t.inboundNodes[0].inputTensors[0].shape+"]")},e.prototype.add=function(t){var n,r=t instanceof e||t instanceof ZU;if(r){if(1!==(n=t).outputs.length)throw new FL("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new FL("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new FL("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var o=Bz({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(o)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new FL("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer "+t.name+" which has "+t.inboundNodes.length+" pre-existing inbound connections.");if(1!==t.inboundNodes[0].outputTensors.length)throw new FL("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=function t(e,n,r){if((null==n||null!=r&&r>0)&&(n=e.sourceLayer,r=e.nodeIndex),0===n.inboundNodes.length)return[e];var o=n.inboundNodes[r];if(0===o.inboundLayers.length)return o.inputTensors;for(var i=[],a=0;a<o.inboundLayers.length;a++)for(var s=0,u=t(o.inputTensors[a],o.inboundLayers[a],o.nodeIndices[a]);s<u.length;s++){var l=u[s];-1===i.indexOf(l)&&i.push(l)}return i}(this.outputs[0])}this.inboundNodes=[],new Mz({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:BL(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(t){return t.shape}),outputShapes:this.outputs[0].shape})}else{var i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,e){return null==this.model&&this.build(),this.model.call(t,e)},e.prototype.build=function(t){if(Ez(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ZU({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),t.prototype.countParams.call(this)},e.prototype.summary=function(e,n,r){void 0===r&&(r=console.log),this.built||this.build(),t.prototype.summary.call(this,e,n,r)},e.prototype.setWeights=function(t){null==this.model&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,e,n){if(void 0===n&&(n={}),!this.built)throw new ML("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)},e.prototype.evaluateDataset=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(n){if(!this.built)throw new ML("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,e)]})})},e.prototype.predict=function(t,e){return void 0===e&&(e={}),null==this.model&&this.build(),this.model.predict(t,e)},e.prototype.predictOnBatch=function(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return null==this.model?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!0,configurable:!0}),e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),TL(this,void 0,void 0,function(){return _L(this,function(r){if(!this.built)throw new ML("The model needs to be compiled before being used.");return[2,this.model.fit(t,e,n)]})})},e.prototype.fitDataset=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(n){if(!this.built)throw new ML("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,e)]})})},e.prototype.trainOnBatch=function(t,e){return TL(this,void 0,void 0,function(){return _L(this,function(n){return[2,this.model.trainOnBatch(t,e)]})})},e.fromConfig=function(t,n,r,o){var i;void 0===r&&(r={}),void 0===o&&(o=!1);var a={};if(n instanceof Array){if(null==n[0].className||"Merge"===n[0].className)throw new FL("Legacy serialization format not supported yet.");i=n}else pN.assert(null!=n.layers,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),i=n.layers,delete n.layers,a=n;var s=new t(a);if(!(s instanceof e))throw new PL("Sequential.fromConfig called on non-Sequential input: "+s);for(var u=0,l=i;u<l.length;u++){var c=Yz(l[u],void 0,o);o&&c.setFastWeightInitDuringBuild(!0),s.add(c)}return s},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(null==this.model)throw new FL("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(null==this.model)throw new FL("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e],o={};o.className=r.getClassName(),o.config=r.getConfig(),t.push(o)}return t},e.className="Sequential",e}(ZU);function eV(t){return new ZU(t)}function nV(t){return new tV(t)}function rV(t,e){return null==e&&(e={}),function(t,e){return TL(this,void 0,void 0,function(){var n;return _L(this,function(r){if(null==e&&(e={}),"string"==typeof t){if(0===(n=eL.getLoadHandlers(t,e.onProgress)).length)n.push(eL.browserHTTPRequest(t,e));else if(n.length>1)throw new FL("Found more than one ("+n.length+") load handlers for URL '"+t+"'");t=n[0]}return[2,JU(t,void 0,e)]})})}(t,e)}function oV(t){return Bz(t)}function iV(t,e){$z.registerCallbackConstructor(t,e)}uL.registerClass(tV);var aV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.getConfig=function(){return{}},e}(uL.Serializable),sV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=1),function(t,e){if(void 0===e&&(e=1),1!==e)throw new PL("Support for alpha values other than 1 ("+e+") is not implemented yet.");return nF(t)}(t,e)},e.className="elu",e}(aV);uL.registerClass(sV);var uV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return aF(t)},e.className="selu",e}(aV);uL.registerClass(uV);var lV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return iF(t)},e.className="relu",e}(aV);uL.registerClass(lV);var cV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return KI(function(){return LO(6,iF(t))})},e.className="relu6",e}(aV);uL.registerClass(cV);var pV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return t},e.className="linear",e}(aV);uL.registerClass(pV);var hV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return XD(t)},e.className="sigmoid",e}(aV);uL.registerClass(hV);var fV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return function(t){return KI(function(){var e=RO(.5,VO(.2,t));return FD(e,0,1)})}(t)},e.className="hardSigmoid",e}(aV);uL.registerClass(fV);var dV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return nO(t)},e.className="softplus",e}(aV);uL.registerClass(dV);var mV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return function(t){return KI(function(){return DO(t,ID(t).add(1))})}(t)},e.className="softsign",e}(aV);uL.registerClass(mV);var vV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t){return sO(t)},e.className="tanh",e}(aV);uL.registerClass(vV);var gV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),FA(t,e)},e.className="softmax",e}(aV);uL.registerClass(gV);var yV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),PA(t,e)},e.className="logSoftmax",e}(aV);function bV(t){return t.getClassName()}function wV(t,e){return void 0===e&&(e={}),KL(t,uL.SerializationMap.getMap().classNameMap,e,"activation")}function xV(t){var e;return null==t?wV(e={className:"linear",config:{}}):"string"==typeof t?((e={}).className=t,e.config={},wV(e)):t instanceof aV?t:wV(t)}uL.registerClass(yV);var CV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e}(uL.Serializable),EV=function(t){function e(e){var n=t.call(this)||this;return n.l1=null==e||null==e.l1?.01:e.l1,n.l2=null==e||null==e.l2?.01:e.l2,n.hasL1=0!==n.l1,n.hasL2=0!==n.l2,n}return IL(e,t),e.prototype.apply=function(t){var e=this;return KI(function(){var n=ER([1]);return e.hasL1&&(n=RO(n,tF(VO(e.l1,ID(t))))),e.hasL2&&(n=RO(n,tF(VO(e.l2,WB(t))))),n.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,e){return new t({l1:e.l1,l2:e.l2})},e.className="L1L2",e}(CV);uL.registerClass(EV);var SV={l1l2:"L1L2"};function kV(t){return qL(t)}function NV(t,e){return void 0===e&&(e={}),KL(t,uL.SerializationMap.getMap().classNameMap,e,"regularizer")}function IV(t){return null==t?null:"string"==typeof t?NV({className:t in SV?SV[t]:t,config:{}}):t instanceof CV?t:NV(t)}var RV=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.supportsMasking=!0,null!=e&&(n.maxValue=e.maxValue),n}return IL(e,t),e.prototype.call=function(t,e){t=Cz(t);var n=iF(t);return null!=this.maxValue&&(n=FD(n,0,this.maxValue)),n},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={maxValue:this.maxValue},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ReLU",e}(Pz);uL.registerClass(RV);var AV=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_ALPHA=.3,null==e&&(e={}),n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return IL(e,t),e.prototype.call=function(t,e){var n=Cz(t);return rF(n,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LeakyReLU",e}(Pz);uL.registerClass(AV);var TV=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),n.supportsMasking=!0,n.alphaInitializer=dz(e.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=IV(e.alphaRegularizer),n.alphaConstraint=lB(e.alphaConstraint),null==e.sharedAxes)n.sharedAxes=null;else if(Array.isArray(e.sharedAxes))n.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new FL("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);n.sharedAxes=[e.sharedAxes]}return n}return IL(e,t),e.prototype.build=function(t){var e=(t=Ez(t)).slice(1);if(null!=this.sharedAxes)for(var n=0,r=this.sharedAxes;n<r.length;n++)e[(i=r[n])-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var o={};if(null!=this.sharedAxes)for(var i=1;i<t.length;++i)o[i]=t[i];this.inputSpec=[new _z({ndim:t.length,axes:o})],this.built=!0},e.prototype.call=function(t,e){return t=Cz(t),oF(t,this.alpha.read())},e.prototype.getConfig=function(){var e={alphaInitializer:fz(this.alphaInitializer),alphaRegularizer:kV(this.alphaRegularizer),alphaConstraint:sB(this.alphaConstraint),sharedAxes:this.sharedAxes},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="PReLU",e}(Pz);uL.registerClass(TV);var _V=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==n.DEFAULT_ALPHA)throw new PL("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return IL(e,t),e.prototype.call=function(t,e){var n=Cz(t);return nF(n)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ELU",e}(Pz);uL.registerClass(_V);var DV=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_THETA=1,null==e&&(e={}),n.theta=null==e.theta?n.DEFAULT_THETA:e.theta,n}return IL(e,t),e.prototype.call=function(t,e){var n=Cz(t);return n.mul(_B(n.greater(this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={theta:this.theta},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ThresholdedReLU",e}(Pz);uL.registerClass(DV);var OV=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_AXIS=1,null==e&&(e={}),n.softmax=(new gV).apply,n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n}return IL(e,t),e.prototype.call=function(t,e){var n=Cz(t);return this.softmax(n,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Softmax",e}(Pz);function MV(t,e,n){if("number"==typeof t)return BL(t,e);if(t.length!==e)throw new FL("The "+n+" argument must be an integer or tuple of "+e+" integers. Received: "+t.length+" elements.");for(var r=0;r<e;++r){var o=t[r];if(!kB(o))throw new FL("The "+n+" argument must be an integer or tuple of "+e+" integers. Received: "+JSON.stringify(t)+" including a non-integer number "+o)}return t}function FV(t,e,n,r,o){return void 0===o&&(o=1),null==t?t:Math.floor((("same"===n?t:t-(e+(e-1)*(o-1))+1)+r-1)/r)}function PV(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+AB([n-e,0]);else{if("same"!==r)throw new FL("Unsupport padding mode: "+r+".");t*=e}return t}function LV(t,e){return KI(function(){return vB(e),"channelsFirst"===e?sF(t,[0,2,3,1]):t})}uL.registerClass(OV);var BV=function(t){function e(n,r){var o=t.call(this,r)||this;if(o.bias=null,o.DEFAULT_KERNEL_INITIALIZER="glorotNormal",o.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(r),o.rank=n,JL(o.rank,"rank"),1!==o.rank&&2!==o.rank&&3!==o.rank)throw new PL("Convolution layer for rank other than 1, 2, or 3 ("+o.rank+") is not implemented yet.");if(o.kernelSize=MV(r.kernelSize,n,"kernelSize"),o.strides=MV(null==r.strides?1:r.strides,n,"strides"),o.padding=null==r.padding?"valid":r.padding,gB(o.padding),o.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,vB(o.dataFormat),o.activation=xV(r.activation),o.useBias=null==r.useBias||r.useBias,o.biasInitializer=dz(r.biasInitializer||o.DEFAULT_BIAS_INITIALIZER),o.biasConstraint=lB(r.biasConstraint),o.biasRegularizer=IV(r.biasRegularizer),o.activityRegularizer=IV(r.activityRegularizer),o.dilationRate=MV(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===o.rank&&Array.isArray(o.dilationRate)&&1!==o.dilationRate.length)throw new FL("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(o.dilationRate));if(2===o.rank){if("number"==typeof o.dilationRate)o.dilationRate=[o.dilationRate,o.dilationRate];else if(2!==o.dilationRate.length)throw new FL("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(o.dilationRate))}else if(3===o.rank)if("number"==typeof o.dilationRate)o.dilationRate=[o.dilationRate,o.dilationRate,o.dilationRate];else if(3!==o.dilationRate.length)throw new FL("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(o.dilationRate));return o}return IL(e,t),e.verifyArgs=function(t){if(zL("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!ZL(t.kernelSize,"number",1,3))throw new FL("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received "+JSON.stringify(t.kernelSize)+".")},e.prototype.getConfig=function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:bV(this.activation),useBias:this.useBias,biasInitializer:fz(this.biasInitializer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),biasConstraint:sB(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(Pz),zV=function(t){function e(n,r){var o=t.call(this,n,r)||this;return o.kernel=null,e.verifyArgs(r),o.filters=r.filters,JL(o.filters,"filters"),o.kernelInitializer=dz(r.kernelInitializer||o.DEFAULT_KERNEL_INITIALIZER),o.kernelConstraint=lB(r.kernelConstraint),o.kernelRegularizer=IV(r.kernelRegularizer),o}return IL(e,t),e.prototype.build=function(t){var e;t=Ez(t);var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new FL("The channel dimension of the input should be defined. Found "+t[n]);var r=t[n],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(e={},e[n]=r,e)}],this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){var e;t=Cz(t);var r=null==n.bias?null:n.bias.read();if(1===n.rank)e=function(t,e,n,r,o,i,a){return void 0===r&&(r=1),void 0===o&&(o="valid"),void 0===a&&(a=1),KI(function(){if(null==i&&(i="channelsLast"),vB(i),3!==t.shape.length)throw new FL("The input of a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead.");if(3!==e.shape.length)throw new FL("The kernel for a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new FL("The bias for a conv1dWithBias operation should be 1, but is "+e.shape.length+" instead");if("channelsFirst"===i&&(t=sF(t,[0,2,1])),"causal"===o)throw new PL("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=mM(t,e,r,"same"===o?"same":"valid","NWC",a);return null!=n&&(s=HB(s,n)),s})}(t,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)e=function(t,e,n,r,o,i,a){return void 0===r&&(r=[1,1]),void 0===o&&(o="valid"),KI(function(){if(null==i&&(i="channelsLast"),vB(i),3!==t.rank&&4!==t.rank)throw new FL("conv2dWithBias expects input to be of rank 3 or 4, but received "+t.rank+".");if(3!==e.rank&&4!==e.rank)throw new FL("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+t.rank+".");var s=LV(t,i);if("causal"===o)throw new PL("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return s=vM(s,e,r,"same"===o?"same":"valid","NHWC",a),null!=n&&(s=HB(s,n)),"channelsFirst"===i&&(s=sF(s,[0,3,1,2])),s})}(t,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new PL("convolutions greater than 3D are not implemented yet.");e=function(t,e,n,r,o,i,a){return void 0===r&&(r=[1,1,1]),void 0===o&&(o="valid"),KI(function(){if(null==i&&(i="channelsLast"),vB(i),4!==t.rank&&5!==t.rank)throw new FL("conv3dWithBias expects input to be of rank 4 or 5, but received "+t.rank+".");if(4!==e.rank&&5!==e.rank)throw new FL("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+t.rank+".");var s=function(t,e){return KI(function(){return vB(e),"channelsFirst"===e?sF(t,[0,2,3,4,1]):t})}(t,i);if("causal"===o)throw new PL("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=gM(s,e,r,"same"===o?"same":"valid","NDHWC",a),null!=n&&(s=HB(s,n)),"channelsFirst"===i&&(s=sF(s,[0,4,1,2,3])),s})}(t,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}return null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=Ez(t);for(var e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2),r=0;r<n.length;++r){var o=FV(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);e.push(o)}var i=[t[0]];return"channelsLast"===this.dataFormat?(i=i.concat(e)).push(this.filters):(i.push(this.filters),i=i.concat(e)),i},e.prototype.getConfig=function(){var e={filters:this.filters,kernelInitializer:fz(this.kernelInitializer),kernelRegularizer:kV(this.kernelRegularizer),kernelConstraint:sB(this.kernelConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.verifyArgs=function(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new FL("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))},e}(BV),UV=function(t){function e(n){var r=t.call(this,2,n)||this;return e.verifyArgs(n),r}return IL(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!ZL(t.kernelSize,"number",1,2))throw new FL("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv2D",e}(zV);uL.registerClass(UV);var VV=function(t){function e(n){var r=t.call(this,3,n)||this;return e.verifyArgs(n),r}return IL(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new FL("Conv3D expects config.kernelSize to be number or [number, number, number], but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv3D",e}(zV);uL.registerClass(VV);var WV=function(t){function e(e){var n=t.call(this,e)||this;if(n.inputSpec=[new _z({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new FL("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return IL(e,t),e.prototype.build=function(t){var e;if(4!==(t=Ez(t)).length)throw new FL("Input should have rank 4; Received input shape: "+JSON.stringify(t));var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new FL("The channel dimension of the inputs should be defined. Found `None`.");var r=t[n],o=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new _z({ndim:4,axes:(e={},e[n]=r,e)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){var e=Cz(t);if(4!==e.shape.length)throw new FL("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var r,o,i=e.shape;"channelsFirst"===n.dataFormat?(r=2,o=3):(r=1,o=2);var a=i[o],s=n.kernelSize[1],u=n.strides[1],l=[i[0],PV(i[r],n.strides[0],n.kernelSize[0],n.padding),PV(a,u,s,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(e=sF(e,[0,2,3,1]));var c=CM(e,n.kernel.read(),l,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(c=sF(c,[0,3,1,2])),null!=n.bias&&(c=HB(c,n.bias.read(),n.dataFormat)),null!=n.activation&&(c=n.activation.apply(c)),c})},e.prototype.computeOutputShape=function(t){var e,n,r,o=(t=Ez(t)).slice();"channelsFirst"===this.dataFormat?(e=1,n=2,r=3):(e=3,n=1,r=2);var i=this.kernelSize[0],a=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return o[e]=this.filters,o[n]=PV(o[n],s,i,this.padding),o[r]=PV(o[r],u,a,this.padding),o},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.dilationRate,e},e.className="Conv2DTranspose",e}(UV);uL.registerClass(WV);var jV=function(t){function e(e){return t.call(this,2,e)||this}return IL(e,t),e.className="SeparableConv2D",e}(function(t){function e(e,n){var r=t.call(this,e,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new FL("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new FL("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new FL("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=dz(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=IV(n.depthwiseRegularizer),r.depthwiseConstraint=lB(n.depthwiseConstraint),r.pointwiseInitializer=dz(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=IV(n.pointwiseRegularizer),r.pointwiseConstraint=lB(n.pointwiseConstraint),r}return IL(e,t),e.prototype.build=function(t){var e;if((t=Ez(t)).length<this.rank+2)throw new FL("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(t));var n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n]||t[n]<0)throw new FL("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[n]));for(var r=t[n],o=this.kernelSize.concat([r,this.depthMultiplier]),i=[],a=0;a<this.rank;++a)i.push(1);i.push(r*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.inputSpec=[new _z({ndim:this.rank+2,axes:(e={},e[n]=r,e)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){var e;if(t=Cz(t),1===n.rank)throw new PL("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(t=sF(t,[0,2,3,1])),e=xM(t,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(e=HB(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),"channelsFirst"===n.dataFormat&&(e=sF(e,[0,3,1,2])),e})},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=fz(this.depthwiseInitializer),e.pointwiseInitializer=fz(this.pointwiseInitializer),e.depthwiseRegularizer=kV(this.depthwiseRegularizer),e.pointwiseRegularizer=kV(this.pointwiseRegularizer),e.depthwiseConstraint=sB(this.depthwiseConstraint),e.pointwiseConstraint=sB(this.pointwiseConstraint),e},e.className="SeparableConv",e}(zV));uL.registerClass(jV);var HV=function(t){function e(n){var r=t.call(this,1,n)||this;return e.verifyArgs(n),r.inputSpec=[{ndim:3}],r}return IL(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},e.verifyArgs=function(t){if("number"!=typeof t.kernelSize&&!ZL(t.kernelSize,"number",1,1))throw new FL("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(t.kernelSize)+".")},e.className="Conv1D",e}(zV);uL.registerClass(HV);var GV=function(t){function e(e){var n=t.call(this,e)||this;return n.cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,n.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,n.inputSpec=[{ndim:4}],n}return IL(e,t),e.prototype.computeOutputShape=function(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,e){var n=this;return KI(function(){return t=Cz(t),"channelsLast"===n.dataFormat?FB(FB(t,n.cropping[0][0],t.shape[1]-n.cropping[0][0]-n.cropping[0][1],2),n.cropping[1][0],t.shape[2]-n.cropping[1][1]-n.cropping[1][0],3):FB(FB(t,n.cropping[0][0],t.shape[2]-n.cropping[0][0]-n.cropping[0][1],3),n.cropping[1][0],t.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)})},e.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Cropping2D",e}(Pz);uL.registerClass(GV);var qV=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=null==e.size?n.DEFAULT_SIZE:e.size,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,n}return IL(e,t),e.prototype.computeOutputShape=function(t){if("channelsFirst"===this.dataFormat){var e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}return[t[0],e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2],t[3]]},e.prototype.call=function(t,e){var n=this;return KI(function(){var e=Cz(t),r=e.shape;if("channelsFirst"===n.dataFormat){e=sF(e,[0,2,3,1]);var o=n.size[0]*r[2],i=n.size[1]*r[3],a=e.resizeNearestNeighbor([o,i]);return sF(a,[0,3,1,2])}return e.resizeNearestNeighbor([o=n.size[0]*r[1],i=n.size[1]*r[2]])})},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="UpSampling2D",e}(Pz);uL.registerClass(qV);var KV=function(t){function e(e){var n=t.call(this,2,e)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,n.depthwiseInitializer=dz(e.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=lB(e.depthwiseConstraint),n.depthwiseRegularizer=IV(e.depthwiseRegularizer),n}return IL(e,t),e.prototype.build=function(t){if((t=Ez(t)).length<4)throw new FL("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(t)+".");var e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new FL("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+t[e]+").");var n=t[e];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){var e=function(t,e,n,r,o,i){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),KI(function(){null==o&&(o="channelsLast"),vB(o);var i=LV(t,o);if(4!==t.rank)throw new FL("Input for depthwiseConv2d is required to be 4-D, but is instead "+t.rank+"-D");if(4!==e.rank)throw new FL("depthwiseKernel is required to be 4-D, but is instead "+e.rank+"-D");return i=wM(i,e,n,"same"===r?"same":"valid","NHWC",null),"channelsFirst"===o&&(i=sF(i,[0,3,1,2])),i})}(t=Cz(t),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat);return n.useBias&&(e=HB(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=Ez(t);var e="channelsFirst"===this.dataFormat?t[3]:t[2],n="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,r=FV("channelsFirst"===this.dataFormat?t[2]:t[1],this.kernelSize[0],this.padding,this.strides[0]),o=FV(e,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],n,r,o]:[t[0],r,o,n]},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=fz(this.depthwiseInitializer),e.depthwiseRegularizer=kV(this.depthwiseRegularizer),e.depthwiseConstraint=sB(this.depthwiseRegularizer),e},e.className="DepthwiseConv2D",e}(BV);uL.registerClass(KV);var $V=function(t){function e(e){var n=t.call(this,e)||this;if(n.rate=Math.max(Math.min(e.rate,1),0),n.noiseShape=e.noiseShape,n.seed=e.seed,null!=n.seed)throw new PL("Non-default seed is not implemented in Dropout layer yet: "+n.seed);return n.supportsMasking=!0,n}return IL(e,t),e.prototype.getNoiseShape=function(t){if(null==this.noiseShape)return this.noiseShape;for(var e=t.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?e[r]:this.noiseShape[r]);return n},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r=Cz(t);if(null!=n.noiseShape&&!pN.arraysEqual(r.shape,n.noiseShape))throw new PL("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(n.noiseShape));if(0<n.rate&&n.rate<1){var o=null!=e.training&&e.training,i=n.getNoiseShape(r);return qB(function(){return GB(r,n.rate,i,n.seed)},function(){return r},o)}return t})},e.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.prototype.dispose=function(){return t.prototype.dispose.call(this)},e.className="Dropout",e}(Pz);uL.registerClass($V);var XV=function(t){function e(e){var n=t.call(this,e)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var r=null;null!=e.batchSize&&(r=e.batchSize),n.batchInputShape=[r,e.inputDim]}return n.units=e.units,JL(n.units,"units"),n.activation=xV(e.activation),null!=e.useBias&&(n.useBias=e.useBias),n.kernelInitializer=dz(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=dz(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=lB(e.kernelConstraint),n.biasConstraint=lB(e.biasConstraint),n.kernelRegularizer=IV(e.kernelRegularizer),n.biasRegularizer=IV(e.biasRegularizer),n.activityRegularizer=IV(e.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return IL(e,t),e.prototype.build=function(t){var e,n=(t=Ez(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(e={},e[-1]=n,e)}],this.built=!0},e.prototype.computeOutputShape=function(t){var e=(t=Ez(t)).slice();return e[e.length-1]=this.units,e},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r,o=Cz(t),i=function(t){return"relu"===t?"relu":"linear"===t?"linear":null}(n.activation.getClassName());return null!=i?r=UB(o,n.kernel.read(),i,n.bias?n.bias.read():null):(r=UB(o,n.kernel.read()),null!=n.bias&&(r=HB(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r})},e.prototype.getConfig=function(){var e={units:this.units,activation:bV(this.activation),useBias:this.useBias,kernelInitializer:fz(this.kernelInitializer),biasInitializer:fz(this.biasInitializer),kernelRegularizer:kV(this.kernelRegularizer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),kernelConstraint:sB(this.kernelConstraint),biasConstraint:sB(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dense",e}(Pz);uL.registerClass(XV);var YV=function(t){function e(e){var n=t.call(this,e||{})||this;return n.inputSpec=[{minNDim:3}],n}return IL(e,t),e.prototype.computeOutputShape=function(t){for(var e=0,n=(t=Ez(t)).slice(1);e<n.length;e++)if(null==n[e])throw new FL('The shape of the input to "Flatten" is not fully defined (got '+t.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.');return[t[0],NB(t,1)]},e.prototype.call=function(t,e){var n=this;return KI(function(){return n.invokeCallHook(t,e),function(t){if(t.rank<=1)throw new FL("batchFlatten requires a minimum rank of 2. Got rank: "+t.rank+".");var e=[t.shape[0],NB(t.shape,1)];return t.reshape(e)}(Cz(t))})},e.className="Flatten",e}(Pz);uL.registerClass(YV);var QV=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.activation=xV(e.activation),n}return IL(e,t),e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r=Cz(t);return n.activation.apply(r)})},e.prototype.getConfig=function(){var e={activation:bV(this.activation)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Activation",e}(Pz);uL.registerClass(QV);var ZV=function(t){function e(e){var n=t.call(this,e)||this;return n.n=e.n,n.inputSpec=[{ndim:2}],n}return IL(e,t),e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,e){var n=this;return KI(function(){return function(t,e){return KI(function(){if(2!==t.shape.length)throw new FL("repeat() expects a rank-2 tensor, but received a rank-"+t.shape.length+" tensor.");return BB(DB(t,1),[1,e,1])})}(t=Cz(t),n.n)})},e.prototype.getConfig=function(){var e={n:this.n},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="RepeatVector",e}(Pz);uL.registerClass(ZV);var JV=function(t){function e(e){var n=t.call(this,e)||this;n.targetShape=e.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return IL(e,t),e.prototype.isUnknown=function(t){return t<0||null==t},e.prototype.fixUnknownDimension=function(t,e){for(var n="Total size of new array must be unchanged.",r=e.slice(),o=1,i=null,a=0;a<r.length;++a){var s=r[a];if(this.isUnknown(s)){if(null!==i)throw new FL("Can only specifiy one unknown dimension.");i=a}else o*=s}var u=NB(t);if(null!==i){if(0===o||u%o!=0)throw new FL(n);r[i]=u/o}else if(u!==o)throw new FL(n);return r},e.prototype.computeOutputShape=function(t){for(var e=!1,n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r=Cz(t),o=r.shape,i=o.slice(0,1).concat(n.fixUnknownDimension(o.slice(1),n.targetShape));return r.reshape(i)})},e.prototype.getConfig=function(){var e={targetShape:this.targetShape},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Reshape",e}(Pz);uL.registerClass(JV);var tW=function(t){function e(e){var n=t.call(this,e)||this;if(null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");var r=TB(1,e.dims.length+1);if(!pN.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=e.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new _z({ndim:n.dims.length+1})],n}return IL(e,t),e.prototype.computeOutputShape=function(t){var e=(t=Ez(t)).slice();return this.dims.forEach(function(n,r){e[r+1]=t[n]}),e},e.prototype.call=function(t,e){return sF(Cz(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var e={dims:this.dims},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Permute",e}(Pz);uL.registerClass(tW);var eW=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.supportsMasking=!0,n.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,n}return IL(e,t),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,e),n},e.prototype.computeMask=function(t,e){var n=Cz(t);return qM(iM(n,this.maskValue),-1)},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r=Cz(t),o=qM(iM(r,n.maskValue),-1,!0);return r.mul(o.asType(r.dtype))})},e.className="Masking",e}(Pz);uL.registerClass(eW);var nW=function(t){function e(e){var n=t.call(this,e)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var r=null;null!=e.batchSize&&(r=e.batchSize),n.batchInputShape=null==e.inputLength?[r,null]:[r].concat(WL(e.inputLength))}return n.inputDim=e.inputDim,JL(n.inputDim,"inputDim"),n.outputDim=e.outputDim,JL(n.outputDim,"outputDim"),n.embeddingsInitializer=dz(e.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=IV(e.embeddingsRegularizer),n.activityRegularizer=IV(e.activityRegularizer),n.embeddingsConstraint=lB(e.embeddingsConstraint),n.maskZero=e.maskZero,n.supportsMasking=e.maskZero,n.inputLength=e.inputLength,n}return IL(e,t),e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,e){var n=this;return KI(function(){return n.maskZero?(t=Cz(t),iM(t,RR(t))):null})},e.prototype.computeOutputShape=function(t){if(t=Ez(t),null==this.inputLength)return t.concat([this.outputDim]);var e=WL(this.inputLength);if(e.length!==t.length-1)throw new FL('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);for(var n=0,r=0;r<e.length;++r){var o=e[r],i=t[r+1];if(null!=o&&null!=i&&o!==i)throw new FL('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);null==o&&(e[n]=i),n++}return[t[0]].concat(e,[this.outputDim])},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r=Cz(t);return"int32"!==r.dtype&&(r=_B(r,"int32")),VB(n.embeddings.read(),r.as1D()).reshape(Ez(n.computeOutputShape(r.shape)))})},e.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:fz(this.embeddingsInitializer),embeddingsRegularizer:kV(this.embeddingsRegularizer),activityRegularizer:kV(this.activityRegularizer),embeddingsConstraint:sB(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Embedding",e}(Pz);uL.registerClass(nW);var rW=function(t){function e(e){var n=t.call(this,e||{})||this;return n.supportsMasking=!0,n}return IL(e,t),e.prototype.mergeFunction=function(t){throw new PL},e.prototype.computeElementwiseOpOutputShape=function(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;for(var n=t.slice(0,t.length-e.length),r=0;r<e.length;++r){var o=t[t.length-e.length+r],i=e[r];if(null==o||null==i||o<0||i<0)n.push(null);else if(1===o)n.push(i);else if(1===i)n.push(o);else{if(o!==i)throw new FL("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(o)}}return n},e.prototype.build=function(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Ez(t)]),(t=t).length<2)throw new FL("A merge layer should be called on an Array of at least 2 inputs. Got "+t.length+" input(s).");for(var e=[],n=0,r=t;n<r.length;n++)null!=(a=r[n])&&null!==a[0]&&e.push(a[0]);if((e=XL(e)).length>1)throw new FL("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(t)+".");for(var o=null==t[0]?null:t[0].slice(1),i=1;i<t.length;++i){var a=null==t[i]?null:t[i].slice(1);o=this.computeElementwiseOpOutputShape(o,a)}var s=t.map(function(t){return t.length});this.reshapeRequired=-1!==t.indexOf(null)||1!==XL(s).length},e.prototype.call=function(t,e){var n=this;return KI(function(){if(t=t,n.reshapeRequired){var e=[],r=t.map(function(t){return t.rank});if(-1===r.indexOf(null)){for(var o=AB(r),i=0,a=t;i<a.length;i++){for(var s=(h=a[i]).rank,u=0;u<o-s;++u)h=DB(h,1);e.push(h)}return n.mergeFunction(e)}for(var l=!1,c=0,p=t;c<p.length;c++){var h;if(null==(s=(h=p[c]).rank)){var f=h.shape,d=f[0],m=f.slice(1).concat([d]),v=h.reshape([d].concat(NB(f.slice(1))));v=(v=sF(v,[1,0])).reshape(m),e.push(v),l=!0}else if(s>1){var g=TB(1,s).concat([0]);e.push(sF(h,g)),l=!0}else e.push(h)}var y=n.mergeFunction(e),b=y.rank;if(l)if(null==b){var w=y.shape;m=[d=w[w.length-1]].concat(w.slice(0,w.length-1)),y=sF(y.reshape([-1,d]),[1,0]).reshape(m)}else b>1&&(g=[b-1].concat(TB(0,b-1)),y=sF(y,g));return y}return n.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var e;e=null==(t=t)[0]?null:t[0].slice(1);for(var n=1;n<t.length;++n){var r=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}for(var o=[],i=0,a=t;i<a.length;i++)null!=(r=a[i])&&null!==r[0]&&o.push(r[0]);return 1===(o=XL(o)).length?o.concat(e):[null].concat(e)},e.prototype.computeMask=function(t,e){return KI(function(){if(null==e)return null;if(!Array.isArray(e))throw new FL("`mask` should be an Array");if(!Array.isArray(t))throw new FL("`inputs` should be an Array");if(e.length!==t.length)throw new FL("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths ("+t.length+" vs "+e.length+")");if(e.every(function(t){return null==t}))return null;for(var n=(e=e.map(function(t){return null==t?t:JR(t,0)}))[0],r=1;r<e.length-1;++r)n=CO(n,e[r]);return n})},e}(Pz),oW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.mergeFunction=function(t){return KI(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=RO(e,t[n]);return e})},e.className="Add",e}(rW);uL.registerClass(oW);var iW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.mergeFunction=function(t){return KI(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=VO(e,t[n]);return e})},e.className="Multiply",e}(rW);uL.registerClass(iW);var aW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.mergeFunction=function(t){return KI(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=RO(e,t[n]);return VO(1/t.length,e)})},e.className="Average",e}(rW);uL.registerClass(aW);var sW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.mergeFunction=function(t){return KI(function(){for(var e=t[0],n=1;n<t.length;++n)e=FO(e,t[n]);return e})},e.className="Maximum",e}(rW);uL.registerClass(sW);var uW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.mergeFunction=function(t){return KI(function(){for(var e=t[0],n=1;n<t.length;++n)e=LO(e,t[n]);return e})},e.className="Minimum",e}(rW);uL.registerClass(uW);var lW=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_AXIS=-1,null==e&&(e={}),n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return IL(e,t),e.prototype.build=function(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new FL("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var e=!0,n=0,r=t=t;n<r.length;n++)if(null!=(c=r[n])){e=!1;break}if(!e){for(var o=[],i=0;i<t.length;++i){var a=t[i].slice();a.splice(this.axis,1);for(var s=!1,u=0,l=o;u<l.length;u++){var c=l[u];if(pN.arraysEqual(c,a)){s=!0;break}}s||o.push(a)}if(o.length>1)throw new FL("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var e=this;return KI(function(){return PB(t,e.axis)})},e.prototype.computeOutputShape=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new FL("A `Concatenate` layer should be called on a list of inputs.");for(var e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,o=0,i=e.slice(1);o<i.length;o++){var a=i[o];if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n},e.prototype.computeMask=function(t,e){var n=this;if(null==e)return null;if(!Array.isArray(e))throw new FL("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new FL("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new FL("Mismatch in the length of mask ("+e.length+") and the legnth of inputs ("+t.length+")");return KI(function(){var r=!0;if(e.forEach(function(t){null==t||(r=!1)}),r)return null;for(var o=[],i=0;i<t.length;++i)o.push(null==e[i]?IR(t[i]).asType("bool"):e[i].rank<t[i].rank?JR(e[i],-1):e[i]);var a=AR(o,n.axis);return GM(a,-1,!1)})},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Concatenate",e}(rW);function cW(t,e){for(;t<0;)t+=e;return t}uL.registerClass(lW);var pW=function(t){function e(e){var n=t.call(this,e)||this;return n.axes=e.axes,n.normalize=null!=e.normalize&&e.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return IL(e,t),e.prototype.build=function(t){pN.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var e=t[0],n=t[1];if(e.length>3||n.length>3)throw new PL("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new FL("Dimension incompatibility: "+e[r[0]]+" !== "+n[r[1]])},e.prototype.mergeFunction=function(t){if(2!==t.length)throw new FL("A `Dot` layer must be called on exactly 2 inputs, but received "+t.length+" input(s).");var e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(function(e,n){return cW(e,t[n].shape.length)}):[cW(this.axes,n.shape.length),cW(this.axes,r.shape.length)],this.normalize&&(n=Qz(n,e[0]),r=Qz(r,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new PL("batchDot is not implemented for tensors of 4D or higher rank yet");if(pN.assert(t.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, but got "+t.shape.length}),pN.assert(t.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, but got "+e.shape.length}),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new PL("batchDot is not implemented for complex64-type Tensors yet.");var r=t.shape.length,o=e.shape.length;null==n&&(n=[r-1,o-2]);var i=n;return KI(function(){var n,a;if(r>o){n=r-o;for(var s=[],u=0;u<n;++u)s.push(1);e=e.reshape(e.shape.concat(s))}else if(o>r){for(n=o-r,s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else n=0;if(a=2===t.shape.length&&2===e.shape.length?i[0]===i[1]?t.mulStrict(e).sum(i[0]):t.transpose([1,0]).mulStrict(e).sum(i[1]):t.matMul(e,i[0]!==t.shape.length-1,i[1]===e.shape.length-1),n>0){var l,c=[];for(u=l=r>o?r+o-3:r-1;u<l+n;++u)c.push(u);a=a.squeeze(c)}return 1===a.shape.length&&(a=a.expandDims(1)),a})}(n,r,e)},e.prototype.interpretAxes=function(t,e){return Array.isArray(this.axes)?this.axes:[cW(this.axes,t.length),cW(this.axes,e.length)]},e.prototype.computeOutputShape=function(t){pN.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new PL("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var o=e.concat(n);return 1===o.length&&o.push(1),o},e.prototype.computeMask=function(t,e){return null},e.prototype.getConfig=function(){var e={axes:this.axes,normalize:this.normalize},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dot",e}(rW);uL.registerClass(pW);var hW=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.stddev=e.stddev,n}return IL(e,t),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,e),n},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r=Cz(t);return qB(function(){return zB(r.shape,0,n.stddev).add(r)},function(){return r},e.training||!1)})},e.className="GaussianNoise",e}(Pz);uL.registerClass(hW);var fW=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.rate=e.rate,n}return IL(e,t),e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,e),n},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e);var r=Cz(t);return n.rate>0&&n.rate<1?qB(function(){var t=Math.sqrt(n.rate/(1-n.rate));return r.mul(zB(r.shape,1,t))},function(){return r},e.training||!1):r})},e.className="GaussianDropout",e}(Pz);uL.registerClass(fW);var dW=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.rate=e.rate,n.noiseShape=e.noiseShape,n}return IL(e,t),e.prototype._getNoiseShape=function(t){return this.noiseShape||Cz(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,e),n},e.prototype.call=function(t,e){var n=this;return KI(function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(t);return qB(function(){var e=Cz(t),o=-1.7580993408473766,i=ZO(pA(r),n.rate);i=_B(i,"float32");var a=Math.pow((1-n.rate)*(1+n.rate*Math.pow(o,2)),-.5),s=-a*o*n.rate;return e.mul(i).add(i.add(-1).mul(o)).mul(a).add(s)},function(){return Cz(t)},e.training||!1)}return t})},e.className="AlphaDropout",e}(Pz);function mW(t,e,n,r,o,i){var a;if(void 0===i&&(i=.001),2===t.rank)a=bO(t,e,n,r,o,i);else if(3===t.rank)a=wO(t,e,n,r,o,i);else{if(4!==t.rank)throw new PL("batchNormalization is not implemented for array of rank "+t.rank+" yet");a=xO(t,e,n,r,o,i)}return a}uL.registerClass(dW);var vW=function(t){function e(e){var n=this;return null==e&&(e={}),(n=t.call(this,e)||this).supportsMasking=!0,n.axis=null==e.axis?-1:e.axis,n.momentum=null==e.momentum?.99:e.momentum,n.epsilon=null==e.epsilon?.001:e.epsilon,n.center=null==e.center||e.center,n.scale=null==e.scale||e.scale,n.betaInitializer=dz(e.betaInitializer||"zeros"),n.gammaInitializer=dz(e.gammaInitializer||"ones"),n.movingMeanInitializer=dz(e.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=dz(e.movingVarianceInitializer||"ones"),n.betaConstraint=lB(e.betaConstraint),n.gammaConstraint=lB(e.gammaConstraint),n.betaRegularizer=IV(e.betaRegularizer),n.gammaRegularizer=IV(e.gammaRegularizer),n}return IL(e,t),e.prototype.build=function(t){var e;t=Ez(t);var n=this.axis>=0?this.axis:this.axis+t.length,r=t[n];if(null==r)throw new FL("Axis "+n+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(t)+".");this.inputSpec=[new _z({ndim:t.length,axes:(e={},e[n]=r,e)})];var o=[r];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){var r=null!=e.training&&e.training,o=Cz(t),i=o.shape,a=i.length,s=TB(0,a),u=n.axis>=0?n.axis:n.axis+a;s.splice(u,1);var l=BL(1,a);l[u]=i[u];var c=s.slice();c.sort();var p=!pN.arraysEqual(c,TB(0,a).slice(0,a-1));if(!r)return function(){if(p){var t=n.movingMean.read().reshape(l),e=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,i=n.scale?n.gamma.read().reshape(l):null;return mW(o,t,e,r,i,n.epsilon)}return mW(o,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=function(t,e,n,r,o){return void 0===o&&(o=.001),pN.arraysEqual(r.slice().sort(),TB(0,t.rank-1))?function(t,e,n,r,o){return void 0===o&&(o=.001),KI(function(){var i=JM(t,r),a=i.mean,s=i.variance;return[mW(t,a,s,n,e,o),a,s]})}(t,e,n,r,o):function(t,e,n,r,o){return void 0===o&&(o=.001),KI(function(){for(var i=JM(t,r),a=i.mean,s=i.variance,u=[],l=0,c=TB(0,t.rank);l<c.length;l++){var p=c[l];-1!==r.indexOf(p)?u.push(1):u.push(t.shape[p])}var h=a.reshape(u),f=s.reshape(u),d=null==e?null:e.reshape(u),m=null==n?null:n.reshape(u);return[mW(t,h,f,m,d,o),a,s]})}(t,e,n,r,o)}(o,n.gamma.read(),n.beta.read(),s,n.epsilon),f=h[0],d=h[2],m=function(t,e,n){KI(function(){var r=1-n,o=t.read(),i=o.sub(e).mul(r);t.write(o.sub(i))})};return m(n.movingMean,h[1],n.momentum),m(n.movingVariance,d,n.momentum),f})},e.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:fz(this.betaInitializer),gammaInitializer:fz(this.gammaInitializer),movingMeanInitializer:fz(this.movingMeanInitializer),movingVarianceInitializer:fz(this.movingVarianceInitializer),betaRegularizer:kV(this.betaRegularizer),gammaRegularizer:kV(this.gammaRegularizer),betaConstraint:sB(this.betaConstraint),gammaConstraint:sB(this.gammaConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="BatchNormalization",e}(Pz);uL.registerClass(vW);var gW=function(t){function e(e){var n=this;if(null==e&&(e={}),(n=t.call(this,e)||this).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)n.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new FL("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var r=void 0,o=void 0;if("number"==typeof e.padding[0])r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new FL("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(r=e.padding[0],2!==e.padding[1].length)throw new FL("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");o=e.padding[1]}n.padding=[r,o]}return n.inputSpec=[new _z({ndim:4})],n}return IL(e,t),e.prototype.computeOutputShape=function(t){return t=Ez(t),"channelsFirst"===this.dataFormat?[t[0],t[1],null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null]:[t[0],null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,t[3]]},e.prototype.call=function(t,e){var n=this;return KI(function(){return function(t,e,n){return KI(function(){if(4!==t.rank)throw new FL("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==e&&(e=[[1,1],[1,1]]),2!==e.length||2!==e[0].length||2!==e[1].length)throw new FL("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new FL("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");return rA(t,"channelsFirst"===n?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]])})}(Cz(t),n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ZeroPadding2D",e}(Pz);function yW(t,e,n,r,o,i){return KI(function(){var a;vB(o),QL(fB,"PoolMode",i),gB(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==o&&(o="channelsLast"),null==i&&(i="max"),t=LV(t,o);var s="same"===r?"same":"valid";return a="max"===i?MM(t,e,n,s):FM(t,e,n,s),"channelsFirst"===o&&(a=sF(a,[0,3,1,2])),a})}uL.registerClass(gW);var bW=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=2),n=t.call(this,e)||this,"number"==typeof e.poolSize)n.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new FL("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));n.poolSize=e.poolSize}if(JL(n.poolSize,"poolSize"),null==e.strides)n.strides=n.poolSize;else if("number"==typeof e.strides)n.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new FL("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));n.strides=e.strides}return JL(n.strides,"strides"),n.padding=null==e.padding?"valid":e.padding,gB(n.padding),n.inputSpec=[new _z({ndim:3})],n}return IL(e,t),e.prototype.computeOutputShape=function(t){var e=FV((t=Ez(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]},e.prototype.call=function(t,e){var n=this;return KI(function(){n.invokeCallHook(t,e),t=DB(Cz(t),2);var r=n.poolingFunction(Cz(t),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return dA(r,[2])})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(Pz),wW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return vB(o),gB(r),yW(t,e,n,r,o,"max")},e.className="MaxPooling1D",e}(bW);uL.registerClass(wW);var xW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return vB(o),gB(r),yW(t,e,n,r,o,"avg")},e.className="AveragePooling1D",e}(bW);uL.registerClass(xW);var CW=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=[2,2]),(n=t.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new FL("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");n.strides=e.strides}else n.strides=[e.strides,e.strides];return JL(n.poolSize,"poolSize"),JL(n.strides,"strides"),n.padding=null==e.padding?"valid":e.padding,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,vB(n.dataFormat),gB(n.padding),n.inputSpec=[new _z({ndim:4})],n}return IL(e,t),e.prototype.computeOutputShape=function(t){t=Ez(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=FV(e,this.poolSize[0],this.padding,this.strides[0]),n=FV(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]},e.prototype.call=function(t,e){var n=this;return KI(function(){return n.invokeCallHook(t,e),n.poolingFunction(Cz(t),n.poolSize,n.strides,n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(Pz),EW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return vB(o),gB(r),yW(t,e,n,r,o,"max")},e.className="MaxPooling2D",e}(CW);uL.registerClass(EW);var SW=function(t){function e(e){return t.call(this,e)||this}return IL(e,t),e.prototype.poolingFunction=function(t,e,n,r,o){return vB(o),gB(r),yW(t,e,n,r,o,"avg")},e.className="AveragePooling2D",e}(CW);uL.registerClass(SW);var kW=function(t){function e(e){var n=t.call(this,e)||this;return n.inputSpec=[new _z({ndim:3})],n}return IL(e,t),e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,e){throw new PL},e}(Pz),NW=function(t){function e(e){return t.call(this,e||{})||this}return IL(e,t),e.prototype.call=function(t,e){return KI(function(){var e=Cz(t);return QM(e,1)})},e.className="GlobalAveragePooling1D",e}(kW);uL.registerClass(NW);var IW=function(t){function e(e){return t.call(this,e||{})||this}return IL(e,t),e.prototype.call=function(t,e){return KI(function(){var e=Cz(t);return YM(e,1)})},e.className="GlobalMaxPooling1D",e}(kW);uL.registerClass(IW);var RW=function(t){function e(e){var n=t.call(this,e)||this;return n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,vB(n.dataFormat),n.inputSpec=[new _z({ndim:4})],n}return IL(e,t),e.prototype.computeOutputShape=function(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,e){throw new PL},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(Pz),AW=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.call=function(t,e){var n=this;return KI(function(){var e=Cz(t);return QM(e,"channelsLast"===n.dataFormat?[1,2]:[2,3])})},e.className="GlobalAveragePooling2D",e}(RW);uL.registerClass(AW);var TW=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.call=function(t,e){var n=this;return KI(function(){var e=Cz(t);return YM(e,"channelsLast"===n.dataFormat?[1,2]:[2,3])})},e.className="GlobalMaxPooling2D",e}(RW);function _W(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new FL("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function o(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=o(e),constants:n=o(n)}}function DW(t,e,n,r,o,i,a,s){return void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),KI(function(){var u=e.shape.length;if(u<3)throw new FL("Input should be at least 3D, but is "+u+"D.");var l=[1,0].concat(TB(2,u));if(e=sF(e,l),null!=i)throw new PL("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=o&&((o=o.asType("bool").asType("float32")).rank===u-1&&(o=JR(o,-1)),o=sF(o,l)),r&&(e=IM(e,0),null!=o&&(o=IM(o,0)));var c,p,h=[],f=n,d=e.shape[0],m=yA(e);null!=o&&(p=yA(o));for(var v,g=function(e){var n=m[e],r=KI(function(){return t(n,f)});if(null==o)c=r[0],f=r[1];else{var i=KI(function(){var t=p[e],n=IR(t).sub(t);return{output:r[0].mul(t).addStrict(f[0].mul(n)),newStates:f.map(function(e,o){return r[1][o].mul(t).addStrict(e.mul(n))})}});c=i.output,f=i.newStates}s&&h.push(c)},y=0;y<d;++y)g(y);return s&&(v=mA(h,1)),[c,v,f]})}uL.registerClass(TW);var OW=function(t){function e(e){var n,r=t.call(this,e)||this;if(null==e.cell)throw new FL("cell property is missing for the constructor of RNN.");if(null==(n=Array.isArray(e.cell)?new VW({cells:e.cell}):e.cell).stateSize)throw new FL("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new _z({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return IL(e,t),e.prototype.getStates=function(){return null==this.states_?TB(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(function(t){return null}):this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){wz(t)&&(t=t[0]),t=t;var e=this.cell.stateSize;Array.isArray(e)||(e=[e]);var n,r=e[0];if(n=this.returnSequences?[t[0],t[1],r]:[t[0],r],this.returnState){for(var o=[],i=0,a=e;i<a.length;i++)o.push([t[0],a[i]]);return[n].concat(o)}return n},e.prototype.computeMask=function(t,e){var n=this;return KI(function(){Array.isArray(e)&&(e=e[0]);var t=n.returnSequences?e:null;if(n.returnState){var r=n.states.map(function(t){return null});return[t].concat(r)}return t})},Object.defineProperty(e.prototype,"states",{get:function(){if(null==this.states_){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[],n=0;n<t;++n)e.push(null);return e}return this.states_},set:function(t){this.states_=t},enumerable:!0,configurable:!0}),e.prototype.build=function(t){if(null!=this.numConstants)throw new PL("Constants support is not implemented in RNN yet.");wz(t)&&(t=t[0]),t=t,this.inputSpec[0]=new _z({shape:[this.stateful?t[0]:null,null,t[t.length-1]]});var e,n=[t[0]].concat(t.slice(2));if(this.cell.build(n),e=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!pN.arraysEqual(this.stateSpec.map(function(t){return t.shape[t.shape.length-1]}),e))throw new FL("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=e.map(function(t){return new _z({shape:[null,t]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,e){var n=this;void 0===e&&(e=!1),KI(function(){if(!n.stateful)throw new OL("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=n.inputSpec[0].shape[0];if(null==r)throw new FL("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==n.states_)n.states_=Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(t){return ER([r,t])}):[ER([r,n.cell.stateSize])];else if(null==t)$I(n.states_),null!=n.keptStates&&($I(n.keptStates),n.keptStates=[]),Array.isArray(n.cell.stateSize)?n.states_=n.cell.stateSize.map(function(t){return ER([r,t])}):n.states_[0]=ER([r,n.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==n.states_.length)throw new FL("Layer "+n.name+" expects "+n.states_.length+" state(s), but it received "+t.length+" state value(s). Input received: "+t);!0===e?n.keptStates.push(n.states_.slice()):$I(n.states_);for(var o=0;o<n.states_.length;++o){var i=t[o],a=Array.isArray(n.cell.stateSize)?n.cell.stateSize[o]:n.cell.stateSize,s=[r,a];if(!pN.arraysEqual(i.shape,s))throw new FL("State "+o+" is incompatible with layer "+n.name+": expected shape="+s+", received shape="+i.shape);n.states_[o]=i}}n.states_=n.states_.map(function(t){return XI(t.clone())})})},e.prototype.apply=function(e,n){var r=null==n?null:n.initialState,o=null==n?null:n.constants;null==n&&(n={});var i=_W(e,r,o,this.numConstants);e=i.inputs,o=i.constants;var a=[],s=[];if(null!=(r=i.initialState)){n.initialState=r,a=a.concat(r),this.stateSpec=[];for(var u=0,l=r;u<l.length;u++)this.stateSpec.push(new _z({shape:l[u].shape}));s=s.concat(this.stateSpec)}if(null!=o&&(n.constants=o,a=a.concat(o),this.numConstants=o.length),a[0]instanceof Dz){var c=[e].concat(a),p=this.inputSpec.concat(s),h=this.inputSpec;this.inputSpec=p;var f=t.prototype.apply.call(this,c,n);return this.inputSpec=h,f}return t.prototype.apply.call(this,e,n)},e.prototype.call=function(t,e){var n=this;return KI(function(){var r=null==e?null:e.mask,o=null==e?null:e.training,i=null==e?null:e.initialState;t=Cz(t),null==i&&(i=n.stateful?n.states_:n.getInitialState(t));var a=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==a)throw new FL("RNN Layer has "+a+" state(s) but was passed "+i.length+" initial state(s).");n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:o},u=DW(function(t,e){var r=n.cell.call([t].concat(e),s);return[r[0],r.slice(1)]},t,i,n.goBackwards,r,null,n.unroll,n.returnSequences),l=u[0],c=u[1],p=u[2];n.stateful&&n.resetStates(p,o);var h=n.returnSequences?c:l;return n.returnState?[h].concat(p):h})},e.prototype.getInitialState=function(t){var e=this;return KI(function(){var n=ER(t.shape);return n=DB(n=tF(n,[1,2])),Array.isArray(e.cell.stateSize)?e.cell.stateSize.map(function(t){return t>1?BB(n,[1,t]):n}):e.cell.stateSize>1?[BB(n,[1,e.cell.stateSize])]:[n]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)},e.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var n=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:n};var r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.fromConfig=function(t,e,n){void 0===n&&(n={});var r=Yz(e.cell,n);return new t(Object.assign(e,{cell:r}))},e.className="RNN",e}(Pz);uL.registerClass(OW);var MW=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e}(Pz),FW=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,JL(n.units,"units"),n.activation=xV(null==e.activation?n.DEFAULT_ACTIVATION:e.activation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=dz(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=dz(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=dz(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=IV(e.kernelRegularizer),n.recurrentRegularizer=IV(e.recurrentRegularizer),n.biasRegularizer=IV(e.biasRegularizer),n.kernelConstraint=lB(e.kernelConstraint),n.recurrentConstraint=lB(e.recurrentConstraint),n.biasConstraint=lB(e.biasConstraint),n.dropout=RB([1,AB([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=RB([1,AB([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return IL(e,t),e.prototype.build=function(t){t=Ez(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){if(2!==(t=t).length)throw new FL("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var r=t[1];t=t[0];var o,i=null!=e.training&&e.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=WW(function(){return IR(t)},n.dropout,i)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=WW(function(){return IR(r)},n.recurrentDropout,i));var a=n.dropoutMask,s=n.recurrentDropoutMask;o=UB(null!=a?VO(t,a):t,n.kernel.read()),null!=n.bias&&(o=HB(o,n.bias.read())),null!=s&&(r=VO(r,s));var u=RO(o,UB(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]})},e.prototype.getConfig=function(){var e={units:this.units,activation:bV(this.activation),useBias:this.useBias,kernelInitializer:fz(this.kernelInitializer),recurrentInitializer:fz(this.recurrentInitializer),biasInitializer:fz(this.biasInitializer),kernelRegularizer:kV(this.kernelRegularizer),recurrentRegularizer:kV(this.recurrentRegularizer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),kernelConstraint:sB(this.kernelConstraint),recurrentConstraint:sB(this.recurrentConstraint),biasConstraint:sB(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="SimpleRNNCell",e}(MW);uL.registerClass(FW);var PW=function(t){function e(e){return e.cell=new FW(e),t.call(this,e)||this}return IL(e,t),e.prototype.call=function(e,n){var r=this;return KI(function(){return null!=r.cell.dropoutMask&&($I(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&($I(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t.prototype.call.call(r,e,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:bV(this.activation),useBias:this.useBias,kernelInitializer:fz(this.kernelInitializer),recurrentInitializer:fz(this.recurrentInitializer),biasInitializer:fz(this.biasInitializer),kernelRegularizer:kV(this.kernelRegularizer),recurrentRegularizer:kV(this.recurrentRegularizer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),kernelConstraint:sB(this.kernelConstraint),recurrentConstraint:sB(this.recurrentConstraint),biasConstraint:sB(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return new t(e)},e.className="SimpleRNN",e}(OW);uL.registerClass(PW);var LW=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,JL(n.units,"units"),n.activation=xV(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=xV(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=dz(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=dz(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=dz(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=IV(e.kernelRegularizer),n.recurrentRegularizer=IV(e.recurrentRegularizer),n.biasRegularizer=IV(e.biasRegularizer),n.kernelConstraint=lB(e.kernelConstraint),n.recurrentConstraint=lB(e.recurrentConstraint),n.biasConstraint=lB(e.biasConstraint),n.dropout=RB([1,AB([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=RB([1,AB([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return IL(e,t),e.prototype.build=function(t){var e=(t=Ez(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){if(2!==(t=t).length)throw new FL("GRUCell expects 2 input Tensors (inputs, h, c), got "+t.length+".");var r=null!=e.training&&e.training,o=t[1];t=t[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=WW(function(){return IR(t)},n.dropout,r,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=WW(function(){return IR(o)},n.recurrentDropout,r,3));var i,a,s,u=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(t=VO(t,n.dropoutMask[0]));var l=UB(t,n.kernel.read());n.useBias&&(l=HB(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(o=VO(o,u[0]));var c=n.recurrentKernel.read(),p=MR(c,[2*n.units,n.units],c.rank-1),h=p[1],f=UB(o,p[0]),d=MR(l,3,l.rank-1),m=d[0],v=d[1],g=d[2],y=MR(f,2,f.rank-1),b=y[1];i=n.recurrentActivation.apply(RO(m,y[0])),a=n.recurrentActivation.apply(RO(v,b));var w=UB(VO(a,o),h);s=n.activation.apply(RO(g,w));var x=RO(VO(i,o),VO(RO(1,GD(i)),s));return[x,x]})},e.prototype.getConfig=function(){var e={units:this.units,activation:bV(this.activation),recurrentActivation:bV(this.recurrentActivation),useBias:this.useBias,kernelInitializer:fz(this.kernelInitializer),recurrentInitializer:fz(this.recurrentInitializer),biasInitializer:fz(this.biasInitializer),kernelRegularizer:kV(this.kernelRegularizer),recurrentRegularizer:kV(this.recurrentRegularizer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),kernelConstraint:sB(this.kernelConstraint),recurrentConstraint:sB(this.recurrentConstraint),biasConstraint:sB(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="GRUCell",e}(MW);uL.registerClass(LW);var BW=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new LW(e),t.call(this,e)||this}return IL(e,t),e.prototype.call=function(e,n){var r=this;return KI(function(){return null!=r.cell.dropoutMask&&($I(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&($I(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t.prototype.call.call(r,e,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:bV(this.activation),recurrentActivation:bV(this.recurrentActivation),useBias:this.useBias,kernelInitializer:fz(this.kernelInitializer),recurrentInitializer:fz(this.recurrentInitializer),biasInitializer:fz(this.biasInitializer),kernelRegularizer:kV(this.kernelRegularizer),recurrentRegularizer:kV(this.recurrentRegularizer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),kernelConstraint:sB(this.kernelConstraint),recurrentConstraint:sB(this.recurrentConstraint),biasConstraint:sB(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="GRU",e}(OW);uL.registerClass(BW);var zW=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,JL(n.units,"units"),n.activation=xV(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=xV(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=dz(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=dz(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=dz(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=e.unitForgetBias,n.kernelRegularizer=IV(e.kernelRegularizer),n.recurrentRegularizer=IV(e.recurrentRegularizer),n.biasRegularizer=IV(e.biasRegularizer),n.kernelConstraint=lB(e.kernelConstraint),n.recurrentConstraint=lB(e.recurrentConstraint),n.biasConstraint=lB(e.biasConstraint),n.dropout=RB([1,AB([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=RB([1,AB([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return IL(e,t),e.prototype.build=function(t){var e,n,r=(t=Ez(t))[t.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,i=this.units;n=new((e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return IL(e,t),e.prototype.apply=function(t,e){var n=o.apply([i]),r=(new QB).apply([i]),a=o.apply([2*i]);return LB(LB(n,r),a)},e}(XB)).className="CustomInit",e)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,e){var n=this;return KI(function(){var r=null!=e.training&&e.training;if(3!==(t=t).length)throw new FL("LSTMCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");var o=t[1],i=t[2];t=t[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=WW(function(){return IR(t)},n.dropout,r,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=WW(function(){return IR(o)},n.recurrentDropout,r,4));var a,s,u,l,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(t=VO(t,n.dropoutMask[0]));var p=UB(t,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(o=VO(o,c[0])),p=RO(p,UB(o,n.recurrentKernel.read())),n.useBias&&(p=HB(p,n.bias.read()));var h=MR(p,4,p.rank-1),f=h[1],d=h[2],m=h[3];a=n.recurrentActivation.apply(h[0]),s=n.recurrentActivation.apply(f),u=RO(VO(s,i),VO(a,n.activation.apply(d))),l=n.recurrentActivation.apply(m);var v=VO(l,n.activation.apply(u));return[v,v,u]})},e.prototype.getConfig=function(){var e={units:this.units,activation:bV(this.activation),recurrentActivation:bV(this.recurrentActivation),useBias:this.useBias,kernelInitializer:fz(this.kernelInitializer),recurrentInitializer:fz(this.recurrentInitializer),biasInitializer:fz(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:kV(this.kernelRegularizer),recurrentRegularizer:kV(this.recurrentRegularizer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),kernelConstraint:sB(this.kernelConstraint),recurrentConstraint:sB(this.recurrentConstraint),biasConstraint:sB(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LSTMCell",e}(MW);uL.registerClass(zW);var UW=function(t){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new zW(e),t.call(this,e)||this}return IL(e,t),e.prototype.call=function(e,n){var r=this;return KI(function(){return null!=r.cell.dropoutMask&&($I(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&($I(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t.prototype.call.call(r,e,{mask:null==n?null:n.mask,training:null==n?null:n.training,initialState:null==n?null:n.initialState})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:bV(this.activation),recurrentActivation:bV(this.recurrentActivation),useBias:this.useBias,kernelInitializer:fz(this.kernelInitializer),recurrentInitializer:fz(this.recurrentInitializer),biasInitializer:fz(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:kV(this.kernelRegularizer),recurrentRegularizer:kV(this.recurrentRegularizer),biasRegularizer:kV(this.biasRegularizer),activityRegularizer:kV(this.activityRegularizer),kernelConstraint:sB(this.kernelConstraint),recurrentConstraint:sB(this.recurrentConstraint),biasConstraint:sB(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="LSTM",e}(OW);uL.registerClass(UW);var VW=function(t){function e(e){var n=t.call(this,e)||this;return n.cells=e.cells,n}return IL(e,t),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var t=[],e=0,n=this.cells.slice().reverse();e<n.length;e++){var r=n[e];Array.isArray(r.stateSize)?t.push.apply(t,r.stateSize):t.push(r.stateSize)}return t},enumerable:!0,configurable:!0}),e.prototype.call=function(t,e){var n=this;return KI(function(){for(var r=(t=t).slice(1),o=[],i=0,a=n.cells.slice().reverse();i<a.length;i++){var s=a[i];Array.isArray(s.stateSize)?o.push(r.splice(0,s.stateSize.length)):o.push(r.splice(0,1))}o.reverse();for(var u,l=[],c=0;c<n.cells.length;++c)s=n.cells[c],r=o[c],u=0===c?[t[0]].concat(r):[u[0]].concat(r),u=s.call(u,e),l.push(u.slice(1));r=[];for(var p=0,h=l.slice().reverse();p<h.length;p++)r.push.apply(r,h[p]);return[u[0]].concat(r)})},e.prototype.build=function(t){var e;wz(t)&&(t=t[0]),t=t;for(var n=0,r=this.cells;n<r.length;n++){var o=r[n];o.build(t),e=Array.isArray(o.stateSize)?o.stateSize[0]:o.stateSize,t=[t[0],e]}this.built=!0},e.prototype.getConfig=function(){for(var e=[],n=0,r=this.cells;n<r.length;n++){var o=r[n];e.push({className:o.getClassName(),config:o.getConfig()})}var i={cells:e},a=t.prototype.getConfig.call(this);return Object.assign(i,a),i},e.fromConfig=function(t,e,n){void 0===n&&(n={});for(var r=[],o=0,i=e.cells;o<i.length;o++)r.push(Yz(i[o],n));return new t({cells:r})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var t=[],e=0,n=this.cells;e<n.length;e++)t.push.apply(t,n[e].trainableWeights);return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var o=[],i=0,a=this.cells;i<a.length;i++)o.push.apply(o,(r=a[i]).trainableWeights);return o.concat(t)}return t},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var t=[],e=0,n=this.cells;e<n.length;e++)t.push.apply(t,n[e].weights);return Iz(t)},e.prototype.setWeights=function(t){for(var e=[],n=0,r=this.cells;n<r.length;n++)for(var o=r[n],i=t.splice(o.weights.length),a=0;a<o.weights.length;++a)e.push([o.weights[a],i[a]]);Rz(e)},e.className="StackedRNNCells",e}(MW);function WW(t,e,n,r){function o(){return GB(t(),e)}if(void 0===n&&(n=null),void 0===r&&(r=1),r>1){for(var i=[],a=0;a<r;a++)i.push(qB(o,t,n));return i.map(function(t){return XI(t.clone())})}return XI(qB(o,t,n).clone())}uL.registerClass(VW);var jW=function(t){function e(e){var n=t.call(this,e)||this;return n.layer=e.layer,n}return IL(e,t),e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(t){null!=this.layer&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)},e.fromConfig=function(t,e,n){void 0===n&&(n={});var r=Yz(e.layer,n);delete e.layer;var o={layer:r};return Object.assign(o,e),new t(o)},e}(Pz),HW=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n}return IL(e,t),e.prototype.build=function(e){if((e=Ez(e)).length<3)throw new FL("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),t.prototype.build.call(this,e)},e.prototype.computeOutputShape=function(t){var e=[(t=Ez(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e);return[n[0],t[1]].concat(n.slice(1))},e.prototype.call=function(t,e){var n=this;return KI(function(){return DW(function(t,r){return[Cz(n.layer.call(t,e)),[]]},t=Cz(t),[],!1,null,null,!1,!0)[1]})},e.className="TimeDistributed",e}(jW);uL.registerClass(HW);var GW="concat",qW=function(t){function e(e){var n=t.call(this,e)||this,r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,n.forwardLayer=Yz(o),r.goBackwards=!0!==r.goBackwards;var i={};if(i.className=e.layer.getClassName(),i.config=r,n.backwardLayer=Yz(i),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=void 0===e.mergeMode?GW:e.mergeMode,QL(dB,"BidirectionalMergeMode",n.mergeMode),e.weights)throw new PL("weights support is not implemented for Bidirectional layer yet.");return n._stateful=e.layer.stateful,n.returnSequences=e.layer.returnSequences,n.returnState=e.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=e.layer.inputSpec,n.numConstants=null,n}return IL(e,t),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var e=Math.floor(t.length/2);this.forwardLayer.setWeights(t.slice(0,e)),this.backwardLayer.setWeights(t.slice(e))},e.prototype.computeOutputShape=function(t){var e,n,r,o=this.forwardLayer.computeOutputShape(t);return Array.isArray(o)&&Array.isArray(o[0])||(o=[o]),o=o,this.returnState?(r=o.slice(1),e=o[0]):e=o[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):VL(n)},e.prototype.apply=function(e,n){var r=null==n?null:n.initialState,o=null==n?null:n.constants;null==n&&(n={});var i=_W(e,r,o,this.numConstants);if(e=i.inputs,r=i.initialState,o=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==o)return t.prototype.apply.call(this,e,n);var a=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new FL("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,a.push.apply(a,r);var l=r.map(function(t){return new _z({shape:t.shape})});this.forwardLayer.stateSpec=l.slice(0,u/2),this.backwardLayer.stateSpec=l.slice(u/2),s.push.apply(s,l)}if(null!=o)throw new PL("Support for constants in Bidirectional layers is not implemented yet.");for(var c=a[0]instanceof Dz,p=0,h=a;p<h.length;p++)if(h[p]instanceof Dz!==c)throw new FL("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){var f=[e].concat(a),d=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=d;var v=t.prototype.apply.call(this,f,n);return this.inputSpec=m,v}return t.prototype.apply.call(this,e,n)},e.prototype.call=function(t,e){var n=this;return KI(function(){if(null!=e.mask)throw new PL("The support for masking is not implemented for Bidirectional layers yet.");var r,o,i,a,s=e.initialState;if(null==s)r=n.forwardLayer.call(t,e),o=n.backwardLayer.call(t,e);else{var u=s.slice(0,s.length/2),l=s.slice(s.length/2);r=n.forwardLayer.call(t,Object.assign(e,{initialState:u})),o=n.backwardLayer.call(t,Object.assign(e,{initialState:l}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),n.returnSequences&&(o=IM(o,1)),"concat"===n.mergeMode?a=PB([r,o]):"sum"===n.mergeMode?a=RO(r,o):"ave"===n.mergeMode?a=VO(.5,RO(r,o)):"mul"===n.mergeMode?a=VO(r,o):null==n.mergeMode&&(a=[r,o]),n.returnState?null==n.mergeMode?a.concat(i):[a].concat(i):a})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var e=this;wB(this.forwardLayer.name,function(){e.forwardLayer.build(t)}),wB(this.backwardLayer.name,function(){e.backwardLayer.build(t)}),this.built=!0},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(e){t.prototype.setFastWeightInitDuringBuild.call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)},e.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.fromConfig=function(t,e){var n=Yz(e.layer);if(delete e.layer,null!=e.numConstants)throw new PL("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=e;return r.layer=n,new t(r)},e.className="Bidirectional",e}(jW);function KW(t){return new xW(t)}function $W(t){return new SW(t)}function XW(t){return new IW(t)}function YW(t){return new TW(t)}function QW(t){return new wW(t)}function ZW(t){return new EW(t)}uL.registerClass(qW);var JW=Object.freeze({inputLayer:function(t){return new Lz(t)},elu:function(t){return new _V(t)},reLU:function(t){return new RV(t)},leakyReLU:function(t){return new AV(t)},prelu:function(t){return new TV(t)},softmax:function(t){return new OV(t)},thresholdedReLU:function(t){return new DV(t)},conv1d:function(t){return new HV(t)},conv2d:function(t){return new UV(t)},conv2dTranspose:function(t){return new WV(t)},conv3d:function(t){return new VV(t)},separableConv2d:function(t){return new jV(t)},cropping2D:function(t){return new GV(t)},upSampling2d:function(t){return new qV(t)},depthwiseConv2d:function(t){return new KV(t)},activation:function(t){return new QV(t)},dense:function(t){return new XV(t)},dropout:function(t){return new $V(t)},flatten:function(t){return new YV(t)},repeatVector:function(t){return new ZV(t)},reshape:function(t){return new JV(t)},permute:function(t){return new tW(t)},embedding:function(t){return new nW(t)},add:function(t){return new oW(t)},average:function(t){return new aW(t)},concatenate:function(t){return new lW(t)},maximum:function(t){return new sW(t)},minimum:function(t){return new uW(t)},multiply:function(t){return new iW(t)},dot:function(t){return new pW(t)},batchNormalization:function(t){return new vW(t)},zeroPadding2d:function(t){return new gW(t)},averagePooling1d:KW,avgPool1d:function(t){return KW(t)},avgPooling1d:function(t){return KW(t)},averagePooling2d:$W,avgPool2d:function(t){return $W(t)},avgPooling2d:function(t){return $W(t)},globalAveragePooling1d:function(t){return new NW(t)},globalAveragePooling2d:function(t){return new AW(t)},globalMaxPooling1d:XW,globalMaxPooling2d:YW,maxPooling1d:QW,maxPooling2d:ZW,gru:function(t){return new BW(t)},gruCell:function(t){return new LW(t)},lstm:function(t){return new UW(t)},lstmCell:function(t){return new zW(t)},simpleRNN:function(t){return new PW(t)},simpleRNNCell:function(t){return new FW(t)},rnn:function(t){return new OW(t)},stackedRNNCells:function(t){return new VW(t)},bidirectional:function(t){return new qW(t)},timeDistributed:function(t){return new HW(t)},globalMaxPool1d:XW,globalMaxPool2d:YW,maxPool1d:QW,maxPool2d:ZW,Layer:Pz,RNN:OW,RNNCell:MW,input:oV,gaussianNoise:function(t){return new hW(t)},gaussianDropout:function(t){return new fW(t)},alphaDropout:function(t){return new dW(t)},masking:function(t){return new eW(t)}}),tj=Object.freeze({binaryAccuracy:function(t,e){return sU(t,e)},binaryCrossentropy:function(t,e){return pU(t,e)},sparseCategoricalAccuracy:function(t,e){return hU(t,e)},categoricalAccuracy:function(t,e){return uU(t,e)},categoricalCrossentropy:function(t,e){return fU(t,e)},precision:function(t,e){return cU(t,e)},recall:function(t,e){return function(t,e){return KI(function(){var n=lU(t,e),r=function(t,e){return KI(function(){return CO(t.equal(1),e.equal(0)).sum().cast("float32")})}(t,e),o=n.add(r);return NO(QO(o,0),n.div(o),0).cast("float32")})}(t,e)},cosineProximity:function(t,e){return oU(t,e)},meanAbsoluteError:function(t,e){return Jz(t,e)},meanAbsolutePercentageError:function(t,e){return tU(t,e)},MAPE:function(t,e){return tU(t,e)},mape:function(t,e){return tU(t,e)},meanSquaredError:function(t,e){return Zz(t,e)},MSE:function(t,e){return Zz(t,e)},mse:function(t,e){return Zz(t,e)}}),ej=Object.freeze({modelFromJSON:function(t,e){return TL(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l;return _L(this,function(c){switch(c.label){case 0:return"modelTopology"in t||(t={modelTopology:t}),null!=(n=(t=t).modelTopology).model_config&&(n=n.model_config),r=xU(n),o=Yz(r,e),null==t.weightsManifest?[3,2]:[4,eL.loadWeights(t.weightsManifest,t.pathPrefix,o.weights.map(function(t){return t.originalName}))];case 1:for(i=c.sent(),a={},s=0,u=o.weights;s<u.length;s++)a[(l=u[s]).originalName]=i[l.originalName];o.loadWeights(a),$I(i),c.label=2;case 2:return[2,o]}})})}}),nj=Object.freeze({l1l2:function(t){return new EV(t)},l1:function(t){return function(t){return new EV({l1:null!=t?t.l1:null,l2:0})}(t)},l2:function(t){return function(t){return new EV({l2:null!=t?t.l2:null,l1:0})}(t)}}),rj=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=null,e}return IL(e,t),e.prototype.setModel=function(t){if(!(t instanceof ZU))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(Wz);function oj(t,e){return t<e}function ij(t,e){return t>e}var aj,sj,uj=function(t){function e(e){var n=t.call(this)||this;if(null==e&&(e={}),e.restoreBestWeights)throw new PL("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=e.monitor||"val_loss",n.minDelta=Math.abs(e.minDelta||0),n.patience=e.patience||0,n.verbose=e.verbose||0,n.mode=e.mode||"auto",n.baseline=e.baseline,-1===["auto","min","max"].indexOf(n.mode)&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),n.monitorFunc="min"===n.mode?oj:"max"===n.mode?ij:-1!==n.monitor.indexOf("acc")?ij:oj,n.monitorFunc===oj&&(n.minDelta*=-1),n}return IL(e,t),e.prototype.onTrainBegin=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(t){return this.wait=0,this.stoppedEpoch=0,this.best=null!=this.baseline?this.baseline:this.monitorFunc===oj?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,e){return TL(this,void 0,void 0,function(){var n;return _L(this,function(r){switch(r.label){case 0:return[4,zz(e)];case 1:return r.sent(),null==(n=this.getMonitorValue(e))?[2]:(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return TL(this,void 0,void 0,function(){return _L(this,function(t){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},e.prototype.getMonitorValue=function(t){null==t&&(t={});var e=t[this.monitor];return null==e&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. Available metrics are: "+Object.keys(t)),e},e}(rj),lj={earlyStopping:function(t){return new uj(t)}},cj=function(){return(cj=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function pj(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function hj(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}!function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(aj||(aj={})),function(t){!function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))}(sj||(sj={}));var fj={};function dj(t,e){fj[t]={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e}}function mj(t){return fj[t]}function vj(t){delete fj[t]}function gj(t,e,n,r){var o=e.inputParams[t];if(o&&void 0!==o.inputIndexStart){var i=o.inputIndexStart,a=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?i+1:o.inputIndexEnd;if("tensor"===o.type)return yj(e.inputNames[o.inputIndexStart],n,r);if("tensors"===o.type)return e.inputNames.slice(i,a).map(function(t){return yj(t,n,r)});var s=Array.prototype.slice.call(yj(e.inputNames.slice(i)[0],n,r).dataSync());return"number"===o.type?s[0]:s}var u=e.attrParams[t];return u&&u.value}function yj(t,e,n){var r=xj(t),o=r[0],i=r[1],a=n.currentContextIds.find(function(t){return!!e[wj(o,t)]});return void 0!==a?e[wj(o,a)][i]:void 0}function bj(t,e){var n=xj(t),r=n[1];return[wj(n[0],e&&e.currentContextId),r]}function wj(t,e){return e?t+"-"+e:t}function xj(t){var e=t.lastIndexOf(":");return-1===e?[t,0]:[t.substring(0,e),Number(t.substring(e+1))]}function Cj(t,e){for(var n=[],r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}var Ej=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Sj=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),kj=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),Nj=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),Ij=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]}]}),Rj=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Aj=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),Tj=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),_j=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),Dj=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Oj=Object.freeze({json:[{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),Mj=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),Fj=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),Pj=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),Lj=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),Bj=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),zj=function(){function t(){var t=[].concat.apply([],[Ej,Sj,kj,Nj,Ij,Rj,Aj,Dj,_j,Tj,Oj,Mj,Fj,Pj,Lj,Bj].map(function(t){return t.json}));this.opMappers=t.reduce(function(t,e){return t[e.tfOpName]=e,t},{})}return Object.defineProperty(t,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),t.prototype.transformGraph=function(t){var e=this,n=[],r=[],o=t.node.reduce(function(t,o){return t[o.name]=e.mapNode(o),"Placeholder"===o.op&&n.push(t[o.name]),"Const"===o.op&&r.push(t[o.name]),t},{}),i=[],a=[],s=Object.keys(o);return s.forEach(function(t){var e=o[t];e.inputNames.forEach(function(t){var n=bj(t)[0];e.inputs.push(o[n]),o[n].children.push(e)}),0===e.inputs.length&&i.push(e)}),s.forEach(function(t){var e=o[t];0===e.children.length&&a.push(e)}),{nodes:o,inputs:i,outputs:a,weights:r,placeholders:n}},t.prototype.mapNode=function(t){var e=mj(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});var n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map(function(t){return t.startsWith("^")?t.substr(1):t}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(function(t,e){return t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t},{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(function(e,n){var r=n.type,o=void 0;switch(n.type){case"string":void 0===(o=Vj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=Vj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(o=Yj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=Yj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(o=jj(t.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(o=jj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(o=Xj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=Xj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(o=Wj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=Wj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(o=Zj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=Zj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(o=$j(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=$j(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(o=Qj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=Qj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(o=Gj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=Gj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(o=qj(t.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(o=qj(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+n.type+" for op: "+t.op)}return e[n.name]={value:o,type:r},e},{})),n},t}();function Uj(t,e){var n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){var e=xk.global;if(void 0!==e.atob)return e.atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(t);return e?n:n.toLowerCase()}function Vj(t,e,n,r){void 0===r&&(r=!1);var o=t[e];return null!=o?Uj(o.s,r):n}function Wj(t,e,n){var r=t[e];return r?r.b:n}function jj(t,e,n){var r=t[e]||{},o=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof o?o:parseInt(o,10)}function Hj(t){switch("string"==typeof t&&(t=aj[t]),t){case aj.DT_FLOAT:return"float32";case aj.DT_INT32:return"int32";case aj.DT_BOOL:return"bool";case aj.DT_DOUBLE:return"float32";case aj.DT_STRING:return"string";default:return null}}function Gj(t,e,n){var r=t[e];return r&&r.type?Hj(r.type):n}function qj(t,e,n){var r=t[e];return r&&r.list&&r.list.type?r.list.type.map(function(t){return Hj(t)}):n}function Kj(t){if(!t.unknownRank)return null!=t.dim?t.dim.map(function(t){return"number"==typeof t.size?t.size:parseInt(t.size,10)}):[]}function $j(t,e,n){var r=t[e];return r&&r.shape?Kj(r.shape):n}function Xj(t,e,n){var r=t[e];return r?(r.list.f&&r.list.f.length?r.list.f:r.list.i).map(function(t){return"number"==typeof t?t:parseInt(t,10)}):n}function Yj(t,e,n,r){void 0===r&&(r=!1);var o=t[e];return o&&o.list&&o.list.s?o.list.s.map(function(t){return Uj(t,r)}):n}function Qj(t,e,n){var r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map(function(t){return Kj(t)}):n}function Zj(t,e,n){var r=t[e];return r&&r.list&&r.list.b?r.list.b:n}var Jj=function(){function t(t,e,n){var r=this;this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(function(t){return r.getInput(t)}),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(function(t,e){return t[e]=r.getAttr(e),t},{}))}return t.prototype.getInput=function(t){return yj(t,this.tensorMap,this.context)},t.prototype.getAttr=function(t,e){var n=this.node.rawAttrs[t];if(null!=n.tensor)return yj(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return jj(this.node.rawAttrs,t,e);if(null!=n.s)return Vj(this.node.rawAttrs,t,e);if(null!=n.b)return Wj(this.node.rawAttrs,t,e);if(null!=n.shape)return $j(this.node.rawAttrs,t,e);if(null!=n.type)return Gj(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Xj(this.node.rawAttrs,t,e);if(null!=n.list.s)return Yj(this.node.rawAttrs,t,e);if(null!=n.list.shape)return Qj(this.node.rawAttrs,t,e);if(null!=n.list.b)return Zj(this.node.rawAttrs,t,e);if(null!=n.list.type)return qj(this.node.rawAttrs,t,e)}return e},t}(),tH=function(t,e,n){switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[RO(gj("a",t,e,n),gj("b",t,e,n))];case"AddN":return[AO(gj("tensors",t,e,n))];case"FloorMod":case"Mod":return[zO(gj("a",t,e,n),gj("b",t,e,n))];case"Mul":return[VO(gj("a",t,e,n),gj("b",t,e,n))];case"RealDiv":case"Div":return[DO(gj("a",t,e,n),gj("b",t,e,n))];case"FloorDiv":return[MO(gj("a",t,e,n),gj("b",t,e,n))];case"Sub":return[KO(gj("a",t,e,n),gj("b",t,e,n))];case"Minimum":return[LO(gj("a",t,e,n),gj("b",t,e,n))];case"Maximum":return[FO(gj("a",t,e,n),gj("b",t,e,n))];case"Pow":return[jO(gj("a",t,e,n),gj("b",t,e,n))];case"SquaredDifference":return[GO(gj("a",t,e,n),gj("b",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},eH=function(t,e,n){switch(t.op){case"Abs":case"ComplexAbs":return[ID(gj("x",t,e,n))];case"Acos":return[RD(gj("x",t,e,n))];case"Acosh":return[AD(gj("x",t,e,n))];case"Asin":return[TD(gj("x",t,e,n))];case"Asinh":return[_D(gj("x",t,e,n))];case"Atan":return[DD(gj("x",t,e,n))];case"Atan2":return[_O(gj("x",t,e,n),gj("y",t,e,n))];case"Atanh":return[OD(gj("x",t,e,n))];case"Ceil":return[MD(gj("x",t,e,n))];case"Complex":return[hR(gj("real",t,e,n),gj("imag",t,e,n))];case"Cos":return[PD(gj("x",t,e,n))];case"Cosh":return[LD(gj("x",t,e,n))];case"Elu":return[nF(gj("x",t,e,n))];case"Erf":return[BD(gj("x",t,e,n))];case"Exp":return[zD(gj("x",t,e,n))];case"Expm1":return[UD(gj("x",t,e,n))];case"Floor":return[VD(gj("x",t,e,n))];case"Log":return[WD(gj("x",t,e,n))];case"Log1p":return[jD(gj("x",t,e,n))];case"Neg":return[GD(gj("x",t,e,n))];case"Reciprocal":return[qD(gj("x",t,e,n))];case"Relu":return[iF(gj("x",t,e,n))];case"Round":return[KD(gj("x",t,e,n))];case"Selu":return[aF(gj("x",t,e,n))];case"Sigmoid":return[XD(gj("x",t,e,n))];case"Sin":return[tO(gj("x",t,e,n))];case"Sign":return[YD(gj("x",t,e,n))];case"Sinh":return[eO(gj("x",t,e,n))];case"Softplus":return[nO(gj("x",t,e,n))];case"Sqrt":return[rO(gj("x",t,e,n))];case"Square":return[oO(gj("x",t,e,n))];case"Tanh":return[sO(gj("x",t,e,n))];case"Tan":return[aO(gj("x",t,e,n))];case"Relu6":case"ClipByValue":return[FD(gj("x",t,e,n),gj("clipValueMin",t,e,n),gj("clipValueMax",t,e,n))];case"Rsqrt":return[$D(yj(t.inputNames[0],e,n))];case"Prod":return[eF(gj("x",t,e,n),gj("axes",t,e,n))];case"LeakyRelu":return[rF(gj("x",t,e,n),gj("alpha",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},nH=function(){function t(e,n,r,o,i,a,s){this.name=e,this.dtype=n,this.maxSize=r,this.elementShape=o,this.identicalElementShapes=i,this.dynamicSize=a,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=t.nextId++}return Object.defineProperty(t.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),t.prototype.clearAndClose=function(){this.tensors.forEach(function(t){return t.tensor.dispose()}),this.tensors=[],this.closed_=!0},t.prototype.size=function(){return this.tensors.length},t.prototype.read=function(t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||t>=this.tensors.length)throw new Error("Tried to read from index "+t+", but array size is: "+this.tensors.length);var e=this.tensors[t];if(e.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+t+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor},t.prototype.readMany=function(t){var e=this;return t.map(function(t){return e.read(t)})},t.prototype.write=function(t,e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error("Tried to write to index "+t+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+",\n          because the value dtype is "+e.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,e.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+t+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been written.");n.tensor=e,n.written=!0,this.tensors[t]=n},t.prototype.writeMany=function(t,e){var n=this;if(t.length!==e.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+t.length+" is not the same as tensors size: "+e.length+".");t.forEach(function(t,r){return n.write(t,e[r])})},t.prototype.gather=function(t,e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+e);if(!t){t=[];for(var n=0;n<this.size();n++)t.push(n)}if(0===t.length)return mR([],[0].concat(this.elementShape));var r=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),mA(r,0)},t.prototype.concat=function(t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+t);if(0===this.size())return mR([],[0].concat(this.elementShape));for(var e=[],n=0;n<this.size();n++)e.push(n);var r=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+r[0].shape+")"),AR(r,0)},t.prototype.scatter=function(t,e){if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+t.length+" vs. "+e.shape[0]);var n=Math.max.apply(Math,t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(t,yA(e,0))},t.prototype.split=function(t,e){var n=this;if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);var r=0,o=t.map(function(t){return r+=t});if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+r+", and tensor's shape is: "+e.shape);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+t.length+"), and the TensorArray is not marked as dynamically resizeable");var i=0===r?0:e.size/r,a=[];KI(function(){e=e.reshape([1,r,i]);for(var s=0;s<t.length;++s)a[s]=zM(e,[0,0===s?0:o[s-1],0],[1,t[s],i]).reshape(n.elementShape);return a});for(var s=[],u=0;u<t.length;u++)s[u]=u;this.writeMany(s,a)},t.prototype.assertShapesMatchAllowUndefinedSize=function(t,e,n){void 0===n&&(n=""),pN.assert(this.shapesEqualAllowUndefinedSize(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})},t.prototype.shapesEqualAllowUndefinedSize=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(-1!==t[n]&&-1!==e[n]&&t[n]!==e[n])return!1;return!0},t.nextId=0,t}(),rH=function(t,e,n){switch(t.op){case"Conv1D":var r=gj("stride",t,e,n),o=gj("pad",t,e,n),i=gj("dataFormat",t,e,n).toUpperCase(),a=gj("dilation",t,e,n);return[mM(gj("x",t,e,n),gj("filter",t,e,n),r,o,i,a)];case"Conv2D":r=gj("strides",t,e,n),o=gj("pad",t,e,n),i=gj("dataFormat",t,e,n).toUpperCase();var s=gj("dilations",t,e,n);return[vM(gj("x",t,e,n),gj("filter",t,e,n),[r[1],r[2]],o,i,[s[1],s[2]])];case"Conv2DBackpropInput":case"Conv2dTranspose":var u=gj("outputShape",t,e,n);return r=gj("strides",t,e,n),o=gj("pad",t,e,n),[CM(gj("x",t,e,n),gj("filter",t,e,n),u,[r[1],r[2]],o)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return r=gj("strides",t,e,n),o=gj("pad",t,e,n),s=gj("dilations",t,e,n),i=gj("dataFormat",t,e,n).toUpperCase(),[wM(gj("input",t,e,n),gj("filter",t,e,n),[r[1],r[2]],o,i,[s[1],s[2]])];case"AvgPool":r=gj("strides",t,e,n),o=gj("pad",t,e,n);var l=gj("kernelSize",t,e,n);return[FM(gj("x",t,e,n),[l[1],l[2]],[r[1],r[2]],o)];case"MaxPool":return r=gj("strides",t,e,n),o=gj("pad",t,e,n),l=gj("kernelSize",t,e,n),[MM(gj("x",t,e,n),[l[1],l[2]],[r[1],r[2]],o)];default:throw TypeError("Node type "+t.op+" is not implemented")}},oH=function(t,e,n){switch(t.op){case"Fill":var r=gj("shape",t,e,n),o=gj("dtype",t,e,n);return[SR(r,gj("value",t,e,n),o)];case"LinSpace":var i=gj("start",t,e,n);return[kR(i,gj("stop",t,e,n),gj("num",t,e,n))];case"OneHot":var a=gj("indices",t,e,n),s=gj("depth",t,e,n),u=gj("onValue",t,e,n),l=gj("offValue",t,e,n);return[nA(a,s,u,l)];case"Ones":return[CR(gj("shape",t,e,n),gj("dtype",t,e,n))];case"OnesLike":return[IR(gj("x",t,e,n))];case"RandomUniform":return[pA(gj("shape",t,e,n),gj("minval",t,e,n),gj("maxval",t,e,n),gj("dtype",t,e,n))];case"Range":return[NR(i=gj("start",t,e,n),gj("stop",t,e,n),gj("step",t,e,n),gj("dtype",t,e,n))];case"TruncatedNormal":r=gj("shape",t,e,n);var c=gj("mean",t,e,n),p=gj("stdDev",t,e,n),h=gj("seed",t,e,n);return[gA(r,c,p,gj("dtype",t,e,n),h)];case"Zeros":return[ER(gj("shape",t,e,n),gj("dtype",t,e,n))];case"ZerosLike":return[RR(gj("x",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},iH=function(t,e,n){switch(t.op){case"TopKV2":var r=gj("x",t,e,n),o=gj("k",t,e,n),i=gj("sorted",t,e,n),a=dF(r,o,i);return[a.values,a.indices];default:throw TypeError("Node type "+t.op+" is not implemented")}},aH=function(t,e,n){switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":var r=gj("default",t,e,n);return[yj(t.name,e,n)||r];case"Placeholder":return[yj(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[gj("x",t,e,n).clone()];case"IdentityN":return gj("x",t,e,n).map(function(t){return t.clone()});case"Snapshot":return[gj("x",t,e,n).clone()];case"Shape":return[yR(gj("x",t,e,n).shape,"int32")];case"ShapeN":return gj("x",t,e,n).map(function(t){return yR(t.shape)});case"Size":return[gR(gj("x",t,e,n).size,"int32")];case"Rank":return[gR(gj("x",t,e,n).rank,"int32")];case"NoOp":return[];case"Print":var o=gj("x",t,e,n),i=gj("data",t,e,n),a=gj("message",t,e,n),s=gj("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(var u=0;u<i.length;u++)console.log(Array.prototype.slice.call(i[u].dataSync()).slice(0,s));return[o];default:throw TypeError("Node type "+t.op+" is not implemented")}},sH=function(t,e,n){switch(t.op){case"ResizeBilinear":var r=gj("images",t,e,n),o=gj("size",t,e,n),i=gj("alignCorners",t,e,n);return[QF.resizeBilinear(r,[o[0],o[1]],i)];case"ResizeNearestNeighbor":return r=gj("images",t,e,n),o=gj("size",t,e,n),i=gj("alignCorners",t,e,n),[QF.resizeNearestNeighbor(r,[o[0],o[1]],i)];case"CropAndResize":var a=gj("image",t,e,n),s=gj("boxes",t,e,n),u=gj("boxInd",t,e,n),l=gj("cropSize",t,e,n),c=gj("method",t,e,n),p=gj("extrapolationValue",t,e,n);return[QF.cropAndResize(a,s,u,l,c,p)];default:throw TypeError("Node type "+t.op+" is not implemented")}},uH=function(t,e,n){switch(t.op){case"Equal":return[XO(gj("a",t,e,n),gj("b",t,e,n))];case"NotEqual":return[iM(gj("a",t,e,n),gj("b",t,e,n))];case"Greater":return[QO(gj("a",t,e,n),gj("b",t,e,n))];case"GreaterEqual":return[ZO(gj("a",t,e,n),gj("b",t,e,n))];case"Less":return[eM(gj("a",t,e,n),gj("b",t,e,n))];case"LessEqual":return[nM(gj("a",t,e,n),gj("b",t,e,n))];case"LogicalAnd":return[CO(gj("a",t,e,n),gj("b",t,e,n))];case"LogicalNot":return[EO(gj("a",t,e,n))];case"LogicalOr":return[SO(gj("a",t,e,n),gj("b",t,e,n))];case"Select":return[NO(gj("condition",t,e,n),gj("a",t,e,n),gj("b",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},lH=function(t,e,n){switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[SM(gj("a",t,e,n),gj("b",t,e,n),gj("transposeA",t,e,n),gj("transposeB",t,e,n))];case"Transpose":return[sF(gj("x",t,e,n),gj("perm",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},cH=function(t,e,n){switch(t.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[yO(gj("x",t,e,n),gj("mean",t,e,n),gj("variance",t,e,n),gj("offset",t,e,n),gj("scale",t,e,n),gj("epsilon",t,e,n))];case"LRN":return[uF(gj("x",t,e,n),gj("radius",t,e,n),gj("bias",t,e,n),gj("alpha",t,e,n),gj("beta",t,e,n))];case"Softmax":return[FA(gj("x",t,e,n))];case"LogSoftmax":return[PA(gj("x",t,e,n))];case"SparseToDense":return[xF(gj("sparseIndices",t,e,n),gj("outputShape",t,e,n),gj("sparseValues",t,e,n),gj("defaultValue",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},pH=function(t,e,n){switch(t.op){case"Max":var r=gj("axis",t,e,n),o=gj("keepDims",t,e,n);return[YM(gj("x",t,e,n),r,o)];case"Mean":return r=gj("axis",t,e,n),o=gj("keepDims",t,e,n),[QM(gj("x",t,e,n),r,o)];case"Min":return r=gj("axis",t,e,n),o=gj("keepDims",t,e,n),[ZM(gj("x",t,e,n),r,o)];case"Sum":return r=gj("axis",t,e,n),o=gj("keepDims",t,e,n),[tF(gj("x",t,e,n),r,o)];case"All":return r=gj("axis",t,e,n),o=gj("keepDims",t,e,n),[GM(gj("x",t,e,n),r,o)];case"Any":return r=gj("axis",t,e,n),o=gj("keepDims",t,e,n),[qM(gj("x",t,e,n),r,o)];case"ArgMax":return r=gj("axis",t,e,n),[KM(gj("x",t,e,n),r)];case"ArgMin":return r=gj("axis",t,e,n),[$M(gj("x",t,e,n),r)];case"Prod":return r=gj("axis",t,e,n),o=gj("keepDims",t,e,n),[eF(gj("x",t,e,n),r,o)];default:throw TypeError("Node type "+t.op+" is not implemented")}},hH=function(t,e,n){switch(t.op){case"ConcatV2":case"Concat":var r=gj("axis",t,e,n),o=gj("tensors",t,e,n);return[AR(o,r)];case"GatherV2":case"Gather":r=gj("axis",t,e,n);var i=gj("x",t,e,n),a=gj("indices",t,e,n);return[lM(i,a.asType("int32"),r)];case"ReverseV2":case"Reverse":return r=gj("axis",t,e,n),i=gj("x",t,e,n),[IM(i,r)];case"Slice":var s=gj("begin",t,e,n),u=gj("size",t,e,n);return[zM(gj("x",t,e,n),s,u)];case"StridedSlice":s=gj("begin",t,e,n);var l=gj("end",t,e,n),c=gj("strides",t,e,n),p=gj("beginMask",t,e,n),h=gj("endMask",t,e,n),f=gj("ellipsisMask",t,e,n),d=gj("newAxisMask",t,e,n),m=gj("shrinkAxisMask",t,e,n),v=gj("x",t,e,n);if(1===s.length&&v.shape.length>1)for(var g=1;g<v.shape.length;g++)s.push(0),l.push(v.shape[g]),c.push(c[0]);return[fF(v,s,l,c,p,h,f,d,m)];case"Pack":return KI(function(){var r=gj("axis",t,e,n),o=gj("tensors",t,e,n),i=o[0].shape,a=o[0].squeeze().shape,s=o.map(function(t){var e=pN.arraysEqual(t.shape,i);if(!e&&!pN.arraysEqual(t.squeeze().shape,a))throw new Error("the input tensors shape does not match");return e?t:t.reshape(i)});return[mA(s,r)]});case"Unpack":return KI(function(){var r=gj("axis",t,e,n),o=gj("tensor",t,e,n);return yA(o,r)});case"Tile":var y=gj("reps",t,e,n);return[vA(gj("x",t,e,n),y)];case"Split":case"SplitV":r=gj("axis",t,e,n);var b=gj("numOrSizeSplits",t,e,n);return MR(gj("x",t,e,n),b,r);case"ScatterNd":a=gj("indices",t,e,n);var w=gj("values",t,e,n),x=gj("shape",t,e,n);return[mF(a,w,x)];case"GatherNd":var C=gj("x",t,e,n);return a=gj("indices",t,e,n),[CF(C,a)];case"SparseToDense":a=gj("sparseIndices",t,e,n),x=gj("outputShape",t,e,n);var E=gj("sparseValues",t,e,n),S=gj("defaultValue",t,e,n);return[xF(a,E,x,E.dtype===S.dtype?S:S.asType(E.dtype))];default:throw TypeError("Node type "+t.op+" is not implemented")}},fH=function(t,e,n){switch(t.op){case"FFT":return[vF(gj("x",t,e,n))];case"IFFT":return[gF(gj("x",t,e,n))];case"RFFT":return[yF(gj("x",t,e,n))];case"IRFFT":return[bF(gj("x",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},dH=function(t,e,n){switch(t.op){case"Cast":return[XR(gj("x",t,e,n),gj("dtype",t,e,n))];case"ExpandDims":var r=gj("axis",t,e,n);return[JR(gj("x",t,e,n),r)];case"Squeeze":return r=gj("axis",t,e,n),[dA(gj("x",t,e,n),r)];case"Reshape":return[hA(gj("x",t,e,n),gj("shape",t,e,n))];case"PadV2":case"Pad":return[rA(gj("x",t,e,n),Cj(gj("padding",t,e,n),2),gj("constantValue",t,e,n))];case"SpaceToBatchND":var o=gj("blockShape",t,e,n),i=Cj(gj("paddings",t,e,n),2);return[fA(gj("x",t,e,n),o,i)];case"BatchToSpaceND":o=gj("blockShape",t,e,n);var a=Cj(gj("crops",t,e,n),2);return[$R(gj("x",t,e,n),o,a)];case"DepthToSpace":var s=gj("blockSize",t,e,n),u=gj("dataFormat",t,e,n).toUpperCase();return[ZR(gj("x",t,e,n),s,u)];default:throw TypeError("Node type "+t.op+" is not implemented")}};function mH(t,e,n){var r=function(t,e,n){switch(t.category){case"arithmetic":return tH(t,e,n);case"basic_math":return eH(t,e,n);case"control":return function(t,e,n){return pj(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,d,m,v,g,y,b,w,x,C,E,S,k,N,I,R,A,T,_,D,O,M,F,P;return hj(this,function(L){switch(L.label){case 0:switch(t.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[gj("pred",t,e,n).clone()]];case 2:return r=gj("pred",t,e,n),o=gj("data",t,e,n),[4,r.data()];case 3:return[2,L.sent()[0]?[void 0,o.clone()]:[o.clone(),void 0]];case 4:return[2,(i=t.inputNames.find(function(t){return void 0!==yj(t,e,n)}))?[yj(i,e,n).clone()]:void 0];case 5:return a=gj("frameName",t,e,n),s=gj("tensor",t,e,n),n.enterFrame(a),[2,[s.clone()]];case 6:return u=gj("tensor",t,e,n),n.exitFrame(),[2,[u.clone()]];case 7:return l=gj("tensor",t,e,n),n.nextIteration(),[2,[l.clone()]];case 8:return c=gj("size",t,e,n),p=gj("dtype",t,e,n),h=gj("elementShape",t,e,n),f=gj("dynamicSize",t,e,n),d=gj("clearAfterRead",t,e,n),m=gj("identicalElementShapes",t,e,n),v=gj("name",t,e,n),g=new nH(v,p,c,h,m,f,d),n.addTensorArray(g),[2,[gR(g.id),gR(1)]];case 9:return y=gj("tensorArrayId",t,e,n),b=gj("index",t,e,n),w=gj("tensor",t,e,n),n.getTensorArray(y).write(b,w),[2,[gR(1)]];case 10:return x=gj("tensorArrayId",t,e,n),C=gj("index",t,e,n),[2,[n.getTensorArray(x).read(C)]];case 11:return E=gj("tensorArrayId",t,e,n),S=gj("indices",t,e,n),k=gj("dtype",t,e,n),[2,[n.getTensorArray(E).gather(S,k)]];case 12:return N=gj("tensorArrayId",t,e,n),I=gj("indices",t,e,n),R=gj("tensor",t,e,n),n.getTensorArray(N).scatter(I,R),[2,[gR(1)]];case 13:return A=gj("tensorArrayId",t,e,n),T=n.getTensorArray(A),_=gj("dtype",t,e,n),[2,[T.concat(_)]];case 14:return D=gj("tensorArrayId",t,e,n),O=gj("tensor",t,e,n),M=gj("lengths",t,e,n),n.getTensorArray(D).split(M,O),[2,[gR(1)]];case 15:return F=gj("tensorArrayId",t,e,n),[2,[gR(n.getTensorArray(F).size(),"int32")]];case 16:return P=gj("tensorArrayId",t,e,n),n.getTensorArray(P).clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+t.op+" is not implemented")}})})}(t,e,n);case"convolution":return rH(t,e,n);case"creation":return oH(t,e,n);case"dynamic":return function(t,e,n){return pj(this,void 0,void 0,function(){var r,o,i,a,s;return hj(this,function(u){switch(u.label){case 0:switch(t.op){case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,3];case"ListDiff":return[3,5]}return[3,7];case 1:return r=gj("boxes",t,e,n),o=gj("scores",t,e,n),i=gj("maxOutputSize",t,e,n),a=gj("iouThreshold",t,e,n),s=gj("scoreThreshold",t,e,n),[4,QF.nonMaxSuppressionAsync(r,o,i,a,s)];case 2:return[2,[u.sent()]];case 3:return[4,IO(gj("condition",t,e,n))];case 4:return[2,[u.sent()]];case 5:return[4,bA(gj("x",t,e,n),gj("y",t,e,n))];case 6:return[2,u.sent()];case 7:throw TypeError("Node type "+t.op+" is not implemented")}})})}(t,e,n);case"evaluation":return iH(t,e,n);case"image":return sH(t,e,n);case"graph":return aH(t,e,n);case"logical":return uH(t,e,n);case"matrices":return lH(t,e,n);case"normalization":return cH(t,e,n);case"reduction":return pH(t,e,n);case"slice_join":return hH(t,e,n);case"spectral":return fH(t,e,n);case"transformation":return dH(t,e,n);case"custom":var r=mj(t.op);if(r&&r.customExecutor)return r.customExecutor(new Jj(t,e,n));throw TypeError("Custom op "+t.op+" is not registered.");default:throw TypeError("Unknown op '"+t.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(t,e,n);return r instanceof Promise?r.then(function(t){return[].concat(t)}):[].concat(r)}var vH=function(){function t(t,e){this.weightMap=t,this.tensorArrayMap=e,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return t.prototype.newFrame=function(t,e){return{id:t,frameName:e,iterationId:0}},Object.defineProperty(t.prototype,"currentContext",{get:function(){return this.contexts},set:function(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),t.prototype.generateCurrentContextIds=function(){for(var t=[],e=0;e<this.contexts.length-1;e++){var n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t},t.prototype.contextIdforContexts=function(t){return t?t.map(function(t){return 0===t.id&&0===t.iterationId?"":t.frameName+"-"+t.iterationId}).join("/"):""},t.prototype.enterFrame=function(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},t.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},t.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},t.prototype.getWeight=function(t){return this.weightMap[t]},t.prototype.addTensorArray=function(t){this.tensorArrayMap[t.id]=t},t.prototype.getTensorArray=function(t){return this.tensorArrayMap[t]},t}();function gH(t,e,n){for(var r=new Set,o=[],i=null,a=null,s=new Set,u=e.slice();u.length>0;){var l=u.pop();(wH(l)||xH(l))&&null==i&&(a=(i=l).children.map(function(t){return t.name}).filter(function(t){return r.has(t)})),r.add(l.name),null==n[l.name]&&null==t[l.name]&&(0!==l.inputs.length?l.inputs.forEach(function(t){s.has(t.name)||(s.add(t.name),u.push(t))}):o.push(l.name))}return{inputs:t,outputs:e,usedNodes:r,missingInputs:o,dynamicNode:i,syncInputs:a}}var yH=["Switch","Merge","Enter","Exit","NextIteration"],bH=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"];function wH(t){return yH.indexOf(t.op)>=0}function xH(t){return bH.indexOf(t.op)>=0}var CH=function(){function t(t){this.graph=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this.placeholders=t.placeholders,this._outputs=t.outputs}return Object.defineProperty(t.prototype,"weightMap",{get:function(){return this._weightMap},set:function(t){var e=Object.keys(t).map(function(e){return t[e].map(function(t){return t.id})});this.weightIds=[].concat.apply([],e),this._weightMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.placeholders.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this._outputs.map(function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(t){return t.name})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.outputs.map(function(t){return t.name})},enumerable:!0,configurable:!0}),t.prototype.getCompilationKey=function(t,e){var n=t.map(function(t){return t.name}).sort(),r=e.map(function(t){return t.name}).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)},t.prototype.compile=function(t,e){var n=gH(t,e,this.weightMap),r=n.missingInputs,o=n.dynamicNode;if(null!=o)throw new Error("This execution contains the node '"+o.name+"', which has the dynamic op '"+o.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+n.syncInputs+"]");if(r.length>0){var i=e.map(function(t){return t.name}),a=Object.keys(t);throw new Error("Cannot compute the outputs ["+i+"] from the provided inputs ["+a+"]. Missing the following inputs: ["+r+"]")}return function(t,e,n){var r=n.usedNodes,o=[];Object.keys(n.inputs).map(function(e){return t.nodes[e]}).forEach(function(t){r.has(t.name)&&o.push(t)}),t.weights.forEach(function(t){r.has(t.name)&&o.push(t)});for(var i=new Set,a=[];o.length>0;){var s=o.pop();i.add(s.name),e[s.name]||a.push(s),s.children.forEach(function(t){!i.has(t.name)&&r.has(t.name)&&t.inputs.every(function(t){return i.has(t.name)})&&o.push(t)})}return a}(this.graph,this.weightMap,n)},t.prototype.execute=function(t,e){var n=this,r=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),this.checkOutputs(e);var o=r.map(function(t){return n.graph.nodes[t]}),i=e.map(function(t){return n.graph.nodes[xj(t)[0]]}),a=this.getCompilationKey(o,i),s=this.compiledMap.get(a);null==s&&(s=this.compile(t,i),this.compiledMap.set(a,s));var u={};return KI(function(){var r=new vH(n._weightMap,u),o=cj({},n.weightMap);Object.keys(t).forEach(function(e){o[e]=[t[e]]});for(var i=n.getFrozenTensorIds(o),a={},l=0;l<s.length;l++){var c=s[l];if(!o[c.name]){var p=mH(c,o,r);if(p instanceof Promise)throw new Error("The execution of the op '"+c.op+"' returned a promise. Please use model.executeAsync() instead.");o[c.name]=p,n.checkTensorForDisposal(c.name,c,o,r,i,e,a)}}return e.map(function(t){return yj(t,o,r)})})},t.prototype.getFrozenTensorIds=function(t){var e=[].concat.apply([],Object.keys(t).map(function(e){return t[e]}).map(function(t){return t.map(function(t){return t.id})}));return new Set(e)},t.prototype.checkTensorForDisposal=function(t,e,n,r,o,i,a){"control"!==e.category&&-1===i.indexOf(t)&&(n[t].forEach(function(t){null!=t&&(a[t.id]=(a[t.id]||0)+e.children.length)}),e.inputs.forEach(function(t){if("control"!==t.category){var e=function(t,e,n){return e[wj(t,r.currentContextId)]}(t.name,n);null!=e&&e.forEach(function(t){if(t&&!o.has(t.id)){var e=a[t.id];1===e?(t.dispose(),delete a[t.id]):null!=e&&a[t.id]--}})}}))},t.prototype.executeAsync=function(t,e){return pj(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return hj(this,function(u){switch(u.label){case 0:return this.checkInputs(t),this.checkInputShapeAndType(t),this.checkOutputs(e),n=new vH(this._weightMap,{}),[4,this.executeWithControlFlow(t,n,e)];case 1:return r=u.sent(),o=e.map(function(t){return yj(t,r,n)}),i=new Set(o.map(function(t){return t.id})),a=new Set(Object.keys(t).map(function(e){return t[e].id})),Object.keys(r).forEach(function(t){r[t].forEach(function(t){!t||t.isDisposed||i.has(t.id)||a.has(t.id)||-1!==s.weightIds.indexOf(t.id)||t.dispose()})}),[2,o]}})})},t.prototype.executeWithControlFlow=function(t,e,n){return pj(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,p,h,f,d,m,v,g,y,b=this;return hj(this,function(w){switch(w.label){case 0:r=Object.keys(t),o=r.map(function(t){return b.graph.nodes[t]}),i=n.map(function(t){return b.graph.nodes[xj(t)[0]]}),a=gH(t,i,this.weightMap),s=a.usedNodes,u=a.missingInputs,l=a.dynamicNode,c=a.syncInputs,p=o.concat(this.graph.weights).map(function(t){return{node:t,contexts:e.currentContext}}),h=cj({},this.weightMap),Object.keys(t).forEach(function(e){h[e]=[t[e]]}),f={},d=this.getFrozenTensorIds(h),m={},w.label=1;case 1:return p.length>0?(v=this.processStack(o,p,e,h,m,d,n,f,s),[4,Promise.all(v)]):[3,3];case 2:return w.sent(),[3,1];case 3:if(null==l&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(g=i.filter(function(t){return!wH(t)&&!yj(t.name,h,e)}).map(function(t){return t.name})).length>0)throw y="",null!=l&&(y="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+c+"]"),new Error("Cannot compute the outputs ["+g+"] from the provided inputs ["+r+"]. Consider providing the following inputs: ["+u+"]. "+y);return[2,h]}})})},t.prototype.processStack=function(t,e,n,r,o,i,a,s,u){for(var l=this,c=[],p=function(){var p=e.pop();n.currentContext=p.contexts;var f="";if("Enter"===p.node.op&&gj("isConstant",p.node,r,n)&&(f=bj(p.node.name,n)[0]),-1===t.indexOf(p.node)){var d=mH(p.node,r,n);f||(f=bj(p.node.name,n)[0]);var m=n.currentContext;d instanceof Promise?c.push(d.then(function(t){return r[f]=t,n.currentContext=m,l.checkTensorForDisposal(f,p.node,r,n,i,a,s),l.processChildNodes(p.node,e,n,r,o,u),t})):(r[f]=d,h.checkTensorForDisposal(f,p.node,r,n,i,a,s),h.processChildNodes(p.node,e,n,r,o,u))}else h.processChildNodes(p.node,e,n,r,o,u)},h=this;e.length>0;)p();return c},t.prototype.processChildNodes=function(t,e,n,r,o,i){t.children.forEach(function(t){var a=bj(t.name,n)[0];!o[a]&&i.has(t.name)&&("Merge"===t.op?t.inputNames.some(function(t){return!!yj(t,r,n)})&&(o[a]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every(function(t){return!!yj(t,r,n)})&&(o[a]=!0,e.push({contexts:n.currentContext,node:t})))})},t.prototype.dispose=function(){var t=this;Object.keys(this.weightMap).forEach(function(e){return t.weightMap[e].forEach(function(t){return t.dispose()})})},t.prototype.checkInputShapeAndType=function(t){var e=this;Object.keys(t).forEach(function(n){var r=t[n],o=e.graph.nodes[n];if(o.attrParams.shape&&o.attrParams.shape.value){var i=o.attrParams.shape.value,a=i.length===r.shape.length&&r.shape.every(function(t,e){return-1===i[e]||i[e]===t});pN.assert(a,function(){return"The shape of dict['"+o.name+"'] provided in model.execute(dict) must be ["+i+"], but was ["+r.shape+"]"})}o.attrParams.dtype&&o.attrParams.dtype.value&&pN.assert(r.dtype===o.attrParams.dtype.value,function(){return"The dtype of dict['"+o.name+"'] provided in model.execute(dict) must be "+o.attrParams.dtype.value+", but was "+r.dtype})})},t.prototype.checkInputs=function(t){var e=this,n=Object.keys(t).filter(function(t){return!e.graph.nodes[t]});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+n+"] that are not part of graph")},t.prototype.checkOutputs=function(t){var e=this;t.forEach(function(t){var n=xj(t)[0];if(!e.graph.nodes[n])throw new Error("The output '"+t+"' is not found in the graph")})},t}(),EH="?tfjs-format=file",SH="model.json",kH=function(){function t(t,e){void 0===e&&(e={}),this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={})}return Object.defineProperty(t.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),t.prototype.findIOHandler=function(){var t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=eL.browserHTTPRequest(t,this.loadOptions);else{var e=eL.getLoadHandlers(t,this.loadOptions.onProgress);if(0===e.length)e.push(eL.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error("Found more than one ("+e.length+") load handlers for URL '"+[t]+"'");this.handler=e[0]}},t.prototype.load=function(){return pj(this,void 0,void 0,function(){var t,e,n;return hj(this,function(r){switch(r.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return t=r.sent(),this.version=(e=t.modelTopology).versions.producer+"."+e.versions.minConsumer,n=eL.decodeWeights(t.weightData,t.weightSpecs),this.executor=new CH(zj.Instance.transformGraph(e)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),[2,!0]}})})},t.prototype.predict=function(t,e){return this.execute(t,this.outputNodes)},t.prototype.normalizeInputs=function(t){if(!(t instanceof CN||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+t.length+" input tensors.");return this.inputNodes.reduce(function(e,n,r){return e[n]=t[r],e},{})},t.prototype.normalizeOutputs=function(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]},t.prototype.execute=function(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);var n=this.executor.execute(t,e);return n.length>1?n:n[0]},t.prototype.executeAsync=function(t,e){return pj(this,void 0,void 0,function(){var n;return hj(this,function(r){switch(r.label){case 0:return t=this.normalizeInputs(t),e=this.normalizeOutputs(e),[4,this.executor.executeAsync(t,e)];case 1:return[2,(n=r.sent()).length>1?n:n[0]]}})})},t.prototype.convertTensorMapToTensorsMap=function(t){return Object.keys(t).reduce(function(e,n){return e[n]=[t[n]],e},{})},t.prototype.dispose=function(){this.executor.dispose()},t}();function NH(t,e){return void 0===e&&(e={}),pj(this,void 0,void 0,function(){var n;return hj(this,function(r){switch(r.label){case 0:if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==e&&(e={}),e.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t=""+t+SH+EH),[4,(n=new kH(t,e)).load()];case 1:return r.sent(),[2,n]}})})}var IH="1.2.5",RH=function(t,e){return(RH=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function AH(t,e){function n(){this.constructor=t}RH(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function TH(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function _H(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function DH(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var OH=DH(function(t){!function(t,e,n){function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var n=new function(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.alea=o}(0,t)}),MH=DH(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor128=o}(0,t)}),FH=DH(function(t){!function(t,e,n){function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)}),PH=DH(function(t){!function(t,e,n){function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)}),LH=DH(function(t){!function(t,e,n){function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n=o[i]=(n^=n>>>15)^(t^=t>>>12),e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=0==(n=s[127&i]^=r+(a=a+1640531527|0))?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,s[o]=(r^=r>>>15)^(n^=n>>>12);t.w=a,t.X=s,t.i=o}(e,t)}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)}),BH=DH(function(t){!function(t,e,n){function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&r(o,n),i.state=function(){return r(n,{})}),i}e&&e.exports?e.exports=o:this.tychei=o}(0,t)}),zH=DH(function(t){!function(e,r){var o,i=this,a=256,s=6,u="random",l=r.pow(a,s),c=r.pow(2,52),p=2*c,h=a-1;function f(t,n,f){var g=[],y=m(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,v(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(t)),v(t)}catch(t){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,v(e)]}}():t,3),g),b=new function(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=h&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=h&o+1],n=n*a+s[h&(s[o]=s[i=h&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}(g),w=function(){for(var t=b.g(s),e=l,n=0;t<c;)t=(t+n)*a,e*=a,n=b.g(1);for(;t>=p;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|b.g(4)},w.quick=function(){return b.g(4)/4294967296},w.double=w,m(v(b.S),e),(n.pass||f||function(t,e,n,o){return o&&(o.S&&d(o,b),t.state=function(){return d(b,{})}),n?(r[u]=t,e):t})(w,y,"global"in n?n.global:this==r,n.state)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,r=t+"",o=0;o<r.length;)e[h&o]=h&(n^=19*e[h&o])+r.charCodeAt(o++);return v(e)}function v(t){return String.fromCharCode.apply(0,t)}if(r["seed"+u]=f,m(r.random(),e),t.exports){t.exports=f;try{o=n(7)}catch(t){}}}([],Math)});zH.alea=OH,zH.xor128=MH,zH.xorwow=FH,zH.xorshift7=PH,zH.xor4096=LH,zH.tychei=BH;var UH=zH.alea;function VH(t,e,n,r){if(void 0===n&&(n=new Map),void 0===r&&(r=new Set),null==t)return null;if(r.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);var o=e(t);if(o.recurse&&null!==o.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse){if(HH(t)){var i=Array.isArray(t)?[]:{};for(var a in r.add(t),t){var s=VH(t[a],e,n,r);i[a]=s}return r.delete(t),i}throw new Error("Can't recurse into non-iterable type: "+t)}return n.set(t,o.value),o.value}function WH(t){return null===t?null:HH(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function jH(t,e){return TH(this,void 0,void 0,function(){var n,r,o,i,a,s;return _H(this,function(u){switch(u.label){case 0:n=new Map,VH(t,e,n),r=0,o=Array.from(n.keys()),u.label=1;case 1:return r<o.length?(a=n.get(i=o[r]))instanceof Promise?[4,a]:[3,3]:[3,4];case 2:s=u.sent(),n.set(i,s),u.label=3;case 3:return r++,[3,1];case 4:return[2,VH(t,e,n)]}})})}function HH(t){return null!=t&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof CN))}function GH(t){return function(t,e){return VH(t,qH)}(t)}function qH(t){return t instanceof CN?{value:t.clone(),recurse:!1}:HH(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}var KH=function(){function t(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return t.prototype.wrap=function(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity},t.prototype.get=function(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]},t.prototype.set=function(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e},t.prototype.length=function(){var t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t},t.prototype.isFull=function(){return this.length()===this.capacity},t.prototype.isEmpty=function(){return 0===this.length()},t.prototype.push=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)},t.prototype.pushAll=function(t){for(var e=0,n=t;e<n.length;e++)this.push(n[e])},t.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var t=this.get(this.end);return this.set(this.end,void 0),t},t.prototype.unshift=function(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)},t.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t},t.prototype.shuffleExcise=function(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n},t}(),$H=function(t){function e(){return t.call(this,e.INITIAL_CAPACITY)||this}return AH(e,t),e.prototype.isFull=function(){return!1},e.prototype.push=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.push.call(this,e)},e.prototype.unshift=function(e){t.prototype.isFull.call(this)&&this.expand(),t.prototype.unshift.call(this,e)},e.prototype.expand=function(){for(var t=2*this.capacity,e=new Array(t),n=this.length(),r=0;r<n;r++)e[r]=this.get(this.wrap(this.begin+r));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n},e.INITIAL_CAPACITY=32,e}(KH);function XH(t){return new eG(t)}function YH(t){return new nG(t)}function QH(t,e){return new fG(t,e)}function ZH(t,e){return void 0===e&&(e=JH.FAIL),new dG(t,e)}var JH,tG=function(){function t(){}return t.prototype.toArray=function(){return TH(this,void 0,void 0,function(){var t,e;return _H(this,function(n){switch(n.label){case 0:return t=[],[4,this.next()];case 1:e=n.sent(),n.label=2;case 2:return e.done?[3,4]:(t.push(e.value),[4,this.next()]);case 3:return e=n.sent(),[3,2];case 4:return[2,t]}})})},t.prototype.toArrayForTest=function(){return TH(this,void 0,void 0,function(){var t,e,n;return _H(this,function(r){switch(r.label){case 0:return t=this.prefetch(100),e=[],[4,t.next()];case 1:n=r.sent(),r.label=2;case 2:return n.done?[3,4]:(e.push(n.value),[4,t.next()]);case 3:return n=r.sent(),[3,2];case 4:return[2,e]}})})},t.prototype.resolveFully=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){switch(e.label){case 0:return[4,this.next()];case 1:t=e.sent(),e.label=2;case 2:return t.done?[3,4]:[4,this.next()];case 3:return t=e.sent(),[3,2];case 4:return[2]}})})},t.prototype.resolveWhile=function(t){return TH(this,void 0,void 0,function(){var e,n;return _H(this,function(r){switch(r.label){case 0:return[4,this.next()];case 1:e=r.sent(),n=t(e.value),r.label=2;case 2:return e.done||!n?[3,4]:[4,this.next()];case 3:return e=r.sent(),n=t(e.value),[3,2];case 4:return[2]}})})},t.prototype.handleErrors=function(t){return new lG(this,t)},t.prototype.filter=function(t){return new sG(this,t)},t.prototype.map=function(t){return new uG(this,t)},t.prototype.mapAsync=function(t){return new cG(this,t)},t.prototype.serialMapAsync=function(t){return new cG(this,t).serial()},t.prototype.flatmap=function(t){return new hG(this,t)},t.prototype.forEachAsync=function(t){return TH(this,void 0,void 0,function(){return _H(this,function(e){return[2,this.map(t).resolveFully()]})})},t.prototype.serialForEach=function(t){return TH(this,void 0,void 0,function(){return _H(this,function(e){return[2,this.serialMapAsync(t).resolveWhile(function(t){return!0===t})]})})},t.prototype.rowMajorBatch=function(t,e){return void 0===e&&(e=!0),new aG(this,t,e)},t.prototype.columnMajorBatch=function(t,e,n){return void 0===e&&(e=!0),void 0===n&&(n=WH),this.rowMajorBatch(t,e).map(function(t){return function(t,e){return void 0===e&&(e=WH),function t(e,n,r){void 0===r&&(r=new Set);var o=e[0];if(r.has(o))throw new Error("Circular references are not supported.");var i=n(e);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(HH(o)){var a=Array.isArray(o)?[]:{};r.add(o);var s=function(o){var i=t(e.map(function(t){return t[o]}),n,r);a[o]=i};for(var u in o)s(u);return r.delete(o),a}throw new Error("Can't recurse into non-iterable type: "+o)}return i.value}(t,e)}(t,n)})},t.prototype.concatenate=function(t,e){return new fG(XH([this,t]),e)},t.prototype.take=function(t){return t<0||null==t?this:new iG(this,t)},t.prototype.skip=function(t){return t<0||null==t?this:new oG(this,t)},t.prototype.prefetch=function(t){return new mG(this,t)},t.prototype.shuffle=function(t,e){return new vG(this,t,e)},t.prototype.serial=function(){return new rG(this)},t}(),eG=function(t){function e(e){var n=t.call(this)||this;return n.items=e,n.trav=0,n}return AH(e,t),e.prototype.summary=function(){return"Array of "+this.items.length+" items"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:GH(t),done:!1}])})})},e}(tG),nG=function(t){function e(e){var n=t.call(this)||this;return n.nextFn=e,n}return AH(e,t),e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){try{return[2,this.nextFn()]}catch(t){throw t.message="Error thrown while iterating through a dataset: "+t.message,t}return[2]})})},e}(tG),rG=function(t){function e(e){var n=t.call(this)||this;return n.upstream=e,n.lastRead=Promise.resolve({value:null,done:!1}),n}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t=this;return _H(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){return[2,this.upstream.next()]})})},e}(tG),oG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.maxCount=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t=this;return _H(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){switch(e.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return(t=e.sent()).done?[2,t]:($I(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(tG),iG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.maxCount=n,r.count=0,r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Take"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(tG),aG=function(t){function e(e,n,r){void 0===r&&(r=!0);var o=t.call(this)||this;return o.upstream=e,o.batchSize=n,o.enableSmallLastBatch=r,o.lastRead=Promise.resolve({value:null,done:!1}),o}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t=this;return _H(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return TH(this,void 0,void 0,function(){var t,e;return _H(this,function(n){switch(n.label){case 0:t=[],n.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return(e=n.sent()).done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(e.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(tG),sG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.predicate=n,r.lastRead=Promise.resolve({value:null,done:!1}),r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t=this;return _H(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){switch(e.label){case 0:return[4,this.upstream.next()];case 1:return(t=e.sent()).done||this.predicate(t.value)?[2,t]:($I(t.value),[3,0]);case 2:return[2]}})})},e}(tG),uG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.transform=n,r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Map"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return _H(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done)return[2,{value:null,done:!0}];for(e=LN.getTensorsInContainer(t.value),n=this.transform(t.value),r=LN.getTensorsInContainer(n),o=0,i=e;o<i.length;o++)LN.isTensorInList(a=i[o],r)||a.dispose();return[2,{value:n,done:!1}]}})})},e}(tG),lG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.handler=n,r.count=0,r.lastRead=Promise.resolve({value:null,done:!1}),r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t=this;return _H(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){switch(e.label){case 0:e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,e.sent()];case 3:return t=e.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(tG),cG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.transform=n,r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return _H(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:return(t=s.sent()).done?[2,{value:null,done:!0}]:(e=LN.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:for(n=s.sent(),r=LN.getTensorsInContainer(n),o=0,i=e;o<i.length;o++)LN.isTensorInList(a=i[o],r)||a.dispose();return[2,{value:n,done:!1}]}})})},e}(tG),pG=function(t){function e(){var e=t.call(this)||this;return e.outputQueue=new $H,e.lastRead=Promise.resolve({value:null,done:!1}),e}return AH(e,t),e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t=this;return _H(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:return 0!==this.outputQueue.length()?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(tG),hG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.transform=n,r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},e.prototype.pump=function(){return TH(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return _H(this,function(s){switch(s.label){case 0:return[4,this.upstream.next()];case 1:if((t=s.sent()).done)return[2,!1];for(e=LN.getTensorsInContainer(t.value),n=this.transform(t.value),r=LN.getTensorsInContainer(n),this.outputQueue.pushAll(n),o=0,i=e;o<i.length;o++)LN.isTensorInList(a=i[o],r)||a.dispose();return[2,!0]}})})},e}(pG),fG=function(t){function e(e,n){var r=t.call(this)||this;return r.baseErrorHandler=n,r.lastRead=null,r.iterator=null,r.moreIterators=e,r}return AH(e,t),e.prototype.summary=function(){return"TODO: fill in upstream of chained summaries -> Chained"},e.prototype.next=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return TH(this,void 0,void 0,function(){var e,n;return _H(this,function(r){switch(r.label){case 0:return[4,t];case 1:return r.sent(),null!=this.iterator?[3,3]:[4,this.moreIterators.next()];case 2:if((e=r.sent()).done)return[2,{value:null,done:!0}];this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),r.label=3;case 3:return[4,this.iterator.next()];case 4:return(n=r.sent()).done?(this.iterator=null,[2,this.readFromChain(t)]):[2,n]}})})},e}(tG);!function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"}(JH||(JH={}));var dG=function(t){function e(e,n){void 0===n&&(n=JH.FAIL);var r=t.call(this)||this;return r.iterators=e,r.mismatchMode=n,r.count=0,r.currentPromise=null,r}return AH(e,t),e.prototype.summary=function(){return"{TODO: fill in upstream of zip summaries} -> Zip"},e.prototype.nextState=function(t){return TH(this,void 0,void 0,function(){function e(t){return t instanceof tG?{value:t.next().then(function(t){return n++,t.done&&r++,t.value}),recurse:!1}:{value:null,recurse:!0}}var n,r,o;return _H(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),n=0,r=0,[4,jH(this.iterators,e)];case 2:if(o=i.sent(),n===r)return[2,{value:null,done:!0}];if(r>0)switch(this.mismatchMode){case JH.FAIL:throw new Error("Zipped streams should have the same length. Mismatched at element "+this.count+".");case JH.SHORTEST:return[2,{value:null,done:!0}]}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:return this.currentPromise=this.nextState(this.currentPromise),[4,this.currentPromise];case 1:return[2,t.sent()]}})})},e}(tG),mG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.bufferSize=n,r.buffer=new KH(n),r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(tG),vG=function(t){function e(e,n,r){var o=t.call(this,e,n)||this;return o.upstream=e,o.windowSize=n,o.upstreamExhausted=!1,o.random=UH(r||pN.now().toString()),o.lastRead=Promise.resolve({value:null,done:!1}),o}return AH(e,t),e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t=this;return _H(this,function(e){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return TH(this,void 0,void 0,function(){var t,e;return _H(this,function(n){switch(n.label){case 0:this.upstreamExhausted||this.refill(),n.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:return(e=n.sent()).done?(this.upstreamExhausted=!0,[3,1]):(this.refill(),[2,e]);case 3:return[2,{value:null,done:!0}]}})})},e}(mG),gG=function(){function t(){this.size=null}return t.prototype.batch=function(t,e){var n=this;void 0===e&&(e=!0);var r=this;return pN.assert(t>0,function(){return"batchSize needs to be positive, but it is\n      "+t}),yG(function(){return TH(n,void 0,void 0,function(){return _H(this,function(n){switch(n.label){case 0:return[4,r.iterator()];case 1:return[2,n.sent().columnMajorBatch(t,e,xG)]}})})},this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t))},t.prototype.concatenate=function(t){var e=this,n=this;return yG(function(){return TH(e,void 0,void 0,function(){var e,r;return _H(this,function(o){switch(o.label){case 0:return[4,n.iterator()];case 1:return r=(e=o.sent()).concatenate,[4,t.iterator()];case 2:return[2,r.apply(e,[o.sent()])]}})})},this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null)},t.prototype.filter=function(t){var e=this,n=this;return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().filter(function(e){return KI(function(){return t(e)})})]}})})},this.size===1/0?1/0:null)},t.prototype.forEachAsync=function(t){return TH(this,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,this.iterator()];case 1:return[2,e.sent().forEachAsync(t)]}})})},t.prototype.forEach=function(t){return TH(this,void 0,void 0,function(){return _H(this,function(e){return GI("dataset.forEach() is deprecated and will be removed. Please use dataset.forEachAsync() instead"),[2,this.forEachAsync(t)]})})},t.prototype.map=function(t){var e=this,n=this;return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().map(function(e){return KI(function(){return t(e)})})]}})})},this.size)},t.prototype.mapAsync=function(t){var e=this,n=this;return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().mapAsync(t)]}})})},this.size)},t.prototype.prefetch=function(t){var e=this;if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().prefetch(t)]}})})},this.size)},t.prototype.repeat=function(t){var e=this,n=this;return yG(function(){return TH(e,void 0,void 0,function(){var e=this;return _H(this,function(r){return[2,QH(YH(function(){return TH(e,void 0,void 0,function(){var t;return _H(this,function(e){switch(e.label){case 0:return t={},[4,n.iterator()];case 1:return[2,(t.value=e.sent(),t.done=!1,t)]}})})}).take(t))]})})},null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null)},t.prototype.skip=function(t){var e=this,n=this;return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().skip(t)]}})})},null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null)},t.prototype.shuffle=function(t,e,n){var r=this;if(void 0===n&&(n=!0),null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size ("+this.size+" elements)");var o=this,i=UH(e||pN.now().toString());return yG(function(){return TH(r,void 0,void 0,function(){var e;return _H(this,function(r){switch(r.label){case 0:return e=i.int32(),n&&(e+=i.int32()),[4,o.iterator()];case 1:return[2,r.sent().shuffle(t,e.toString())]}})})},this.size)},t.prototype.take=function(t){var e=this,n=this;return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,n.iterator()];case 1:return[2,e.sent().take(t)]}})})},null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null)},t.prototype.toArray=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,t.sent().toArray()]}})})},t.prototype.toArrayForTest=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,t.sent().toArrayForTest()]}})})},t.MAX_BUFFER_SIZE=1e4,t}();function yG(t,e){return void 0===e&&(e=null),new(function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.size=e,t}return AH(r,n),r.prototype.iterator=function(){return TH(this,void 0,void 0,function(){return _H(this,function(e){return[2,t()]})})},r}(gG))}function bG(t){var e=this;return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(e){return[2,XH(t)]})})},t.length)}function wG(t){var e,n=this;if(!HH(t))throw new Error("The argument to zip() must be an object or array.");if(Array.isArray(t))for(var r=0;r<t.length;r++)e=null==e?t[r].size:Math.min(e,t[r].size);else if(t instanceof Object)for(var o in t)e=null==e?t[o].size:Math.min(e,t[o].size);return yG(function(){return TH(n,void 0,void 0,function(){return _H(this,function(e){switch(e.label){case 0:return[4,jH(t,function(t){if(t instanceof gG)return{value:t.iterator(),recurse:!1};if(HH(t))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return[2,ZH(e.sent(),JH.SHORTEST)]}})})},e)}function xG(t){return null===t?null:function(t){return null==t||function(t){return null===t||"object"!=typeof t&&"function"!=typeof t}(t)||Array.isArray(t)||"object"==typeof t&&t instanceof CN||pN.isTypedArray(t)}(t[0])?{value:CG(t),recurse:!1}:{value:null,recurse:!0}}function CG(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof CN?mA(t):mR(t)}var EG=function(t){function e(e){var n=t.call(this)||this;return n.input=e,n}return AH(e,t),e.prototype.iterator=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:return[4,this.input.iterator()];case 1:return[2,t.sent().decodeUTF8().split("\n").map(function(t){return t.endsWith("\r")&&(t=t.slice(0,-1)),t})]}})})},e}(gG),SG=Symbol("out"),kG=Symbol("field"),NG=Symbol("quote"),IG=Symbol("quoteafterquote"),RG=Symbol("quoteinquote"),AG=function(t){function e(e,n){var r=t.call(this)||this;return r.input=e,r.hasHeader=!0,r.fullColumnNames=null,r.columnNamesValidated=!1,r.columnConfigs=null,r.configuredColumnsOnly=!1,r.delimiter=",",r.delimWhitespace=!1,r.base=new EG(e),n||(n={}),r.hasHeader=!1!==n.hasHeader,r.fullColumnNames=n.columnNames,r.columnConfigs=n.columnConfigs,r.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(pN.assert(null==n.delimiter,function(){return"Delimiter should not be provided when delimWhitespace is true."}),r.delimWhitespace=!0,r.delimiter=" "):r.delimiter=n.delimiter?n.delimiter:",",r}return AH(e,t),e.prototype.columnNames=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return TH(this,void 0,void 0,function(){var t,e,n,r,o,i,a=this;return _H(this,function(s){switch(s.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=s.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&pN.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+a.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),e=this.fullColumnNames.reduce(function(t,e){return t[e]=t[e]+1||1,t},{}),n=Object.keys(e).filter(function(t){return e[t]>1}),pN.assert(0===n.length,function(){return"Duplicate column names found: "+n.toString()}),this.columnConfigs)for(r=0,o=Object.keys(this.columnConfigs);r<o.length;r++)if(-1===this.fullColumnNames.indexOf(i=o[r]))throw new Error('The key "'+i+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){switch(e.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return[4,e.sent().next()];case 2:if((t=e.sent()).done)throw new Error("No data was found for CSV parsing.");return[2,this.parseRow(t.value,!1)];case 3:return[2,null]}})})},e.prototype.iterator=function(){return TH(this,void 0,void 0,function(){var t,e=this;return _H(this,function(n){switch(n.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:n.sent(),n.label=2;case 2:return[4,this.base.iterator()];case 3:return t=n.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(t){return e.makeDataElement(t)})]}})})},e.prototype.makeDataElement=function(t){for(var e=this.parseRow(t),n={},r={},o=0;o<this.fullColumnNames.length;o++){var i=this.fullColumnNames[o],a=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||a){var s=e[o],u=null;if(""===s)if(a&&void 0!==a.default)u=a.default;else{if(a&&(a.required||a.isLabel))throw new Error("Required column "+i+" is empty in this line: "+t);u=void 0}else{var l=Number(s);if(isNaN(l))u=a&&"bool"===a.dtype?this.getBoolean(s):s;else if(a&&a.dtype)switch(a.dtype){case"float32":u=l;break;case"int32":u=Math.floor(l);break;case"bool":u=this.getBoolean(s);break;default:u=l}else u=l}a&&a.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}},e.prototype.getBoolean=function(t){return"1"===t||"true"===t.toLowerCase()?1:0},e.prototype.parseRow=function(t,e){void 0===e&&(e=!0);for(var n=[],r=0,o=t.length,i=SG,a=0;a<o;a++)switch(i){case SG:switch(t.charAt(a)){case'"':r=a+1,i=NG;break;case this.delimiter:if(r=a+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=SG;break;default:i=kG,r=a}break;case kG:switch(t.charAt(a)){case this.delimiter:n.push(t.substring(r,a)),i=SG,r=a+1}break;case NG:switch(t.charAt(a)){case'"':i=IG}break;case IG:switch(t.charAt(a)){case this.delimiter:n.push(t.substring(r,a-1)),i=SG,r=a+1;break;case'"':i=NG;break;default:i=RG}break;case RG:switch(t.charAt(a)){case'"':i=NG}}if(n.push(i===IG?t.substring(r,o-1):t.substring(r)),e&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+n);return n},e}(gG),TG=function(t){function e(e){var n=t.call(this)||this;n.microphoneConfig=e,n.isClosed=!1,n.fftSize=e.fftSize||1024;var r=Math.log2(n.fftSize);if(n.fftSize<0||r<4||r>14||!Number.isInteger(r))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+n.fftSize);if(n.numFrames=e.numFramesPerSpectrogram||43,n.sampleRateHz=e.sampleRateHz,n.columnTruncateLength=e.columnTruncateLength||n.fftSize,n.audioTrackConstraints=e.audioTrackConstraints,n.smoothingTimeConstant=e.smoothingTimeConstant||0,n.includeSpectrogram=!1!==e.includeSpectrogram,n.includeWaveform=!0===e.includeWaveform,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return AH(e,t),e.prototype.summary=function(){return"microphone"},e.create=function(t){return void 0===t&&(t={}),TH(this,void 0,void 0,function(){var n;return _H(this,function(r){switch(r.label){case 0:if(xk.get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");return[4,(n=new e(t)).start()];case 1:return r.sent(),[2,n]}})})},e.prototype.start=function(){return TH(this,void 0,void 0,function(){var t,e,n,r;return _H(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw e=o.sent(),new Error("Error thrown while initializing video stream: "+e.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(n=window.AudioContext||window.webkitAudioContext,this.audioContext=new n,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: Expected: "+this.sampleRateHz+"; Actual: "+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;return r=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,r.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t,e,n,r,o;return _H(this,function(i){switch(i.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return n=i.sent(),this.includeSpectrogram&&(r=this.flattenQueue(n.freqDataQueue),t=this.getTensorFromAudioDataArray(r,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(n.timeDataQueue),e=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:e},done:!1}]}})})},e.prototype.capture=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return TH(this,void 0,void 0,function(){var t,e,n,r=this;return _H(this,function(o){return t=[],e=[],n=0,[2,new Promise(function(o){var i=setInterval(function(){r.includeSpectrogram&&(r.analyser.getFloatFrequencyData(r.freqData),r.freqData[0]===-1/0&&o({freqDataQueue:t,timeDataQueue:e}),t.push(r.freqData.slice(0,r.columnTruncateLength))),r.includeWaveform&&(r.analyser.getFloatTimeDomainData(r.timeData),e.push(r.timeData.slice())),++n===r.numFrames&&(clearInterval(i),o({freqDataQueue:t,timeDataQueue:e}))},r.fftSize/r.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop()},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var e=t[0].length,n=new Float32Array(t.length*e);return t.forEach(function(t,r){return n.set(t,r*e)}),n},e.prototype.getTensorFromAudioDataArray=function(t,e){var n=new Float32Array(pN.sizeFromShape(e));return n.set(t,n.length-t.length),mR(n,e)},e}(tG),_G=function(t){function e(e,n){var r=t.call(this)||this;if(r.webcamVideoElement=e,r.webcamConfig=n,r.isClosed=!0,r.resize=!1,r.needToResize())if(r.resize=!0,r.cropSize=[r.webcamConfig.resizeHeight,r.webcamConfig.resizeWidth],r.cropBoxInd=yR([0],"int32"),r.webcamConfig.centerCrop){var o=1*r.webcamConfig.resizeWidth/r.webcamVideoElement.width,i=1*r.webcamConfig.resizeHeight/r.webcamVideoElement.height,a=(1-o)/2,s=(1-i)/2;r.cropBox=bR([s,a,i+s,a+o],[1,4])}else r.cropBox=bR([0,0,1,1],[1,4]);return r}return AH(e,t),e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return void 0===n&&(n={}),TH(this,void 0,void 0,function(){var r;return _H(this,function(o){switch(o.label){case 0:if(xk.get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return[4,(r=new e(t,n)).start()];case 1:return o.sent(),[2,r]}})})},e.prototype.start=function(){return TH(this,void 0,void 0,function(){var t,e,n=this;return _H(this,function(r){switch(r.label){case 0:this.webcamConfig.facingMode&&pN.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,function(){return"Invalid webcam facing mode: "+n.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),r.label=1;case 1:return r.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=r.sent(),[3,4];case 3:throw(e=r.sent()).message="Error thrown while initializing video stream: "+e.message,e;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(t){n.webcamVideoElement.onloadedmetadata=function(){t()}})]}})})},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){if(this.isClosed)return[2,{value:null,done:!0}];try{t=oL.fromPixels(this.webcamVideoElement)}catch(t){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(t))}if(!this.resize)return[2,{value:t,done:!1}];try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(t){throw new Error("Error thrown cropping the video: "+t.message)}finally{t.dispose()}return[2]})})},e.prototype.needToResize=function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)},e.prototype.cropAndResizeFrame=function(t){var e=this;return KI(function(){var n,r=t.toFloat().expandDims(0),o=(n=QF.cropAndResize(r,e.cropBox,e.cropBoxInd,e.cropSize,"bilinear")).shape;return n.reshape(o.slice(1))})},e.prototype.capture=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){this.stream.getTracks().forEach(function(t){return t.stop()});try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(tG),DG=function(){},OG=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return AH(e,t),e.prototype.split=function(t){return new MG(this,t)},e}(tG),MG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.impl=new FG(e,n),r}return AH(e,t),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){return[2,this.impl.next()]})})},e}(OG),FG=function(t){function e(e,n){var r=t.call(this)||this;return r.upstream=e,r.separator=n,r.carryover="",r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},e.prototype.pump=function(){return TH(this,void 0,void 0,function(){var t,e,n,r;return _H(this,function(o){switch(o.label){case 0:return[4,this.upstream.next()];case 1:if((t=o.sent()).done)return""===this.carryover?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);for((e=t.value.split(this.separator))[0]=this.carryover+e[0],n=0,r=e.slice(0,-1);n<r.length;n++)this.outputQueue.push(r[n]);return this.carryover=e[e.length-1],[2,!0]}})})},e}(pG),PG=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return AH(e,t),e.prototype.decodeUTF8=function(){return new LG(this)},e}(tG),LG=function(t){function e(e){var n=t.call(this)||this;return n.upstream=e,n.impl=new BG(e),n}return AH(e,t),e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){return[2,this.impl.next()]})})},e}(OG),BG=function(t){function e(e){var r=t.call(this)||this;if(r.upstream=e,xk.get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var o=n(8).StringDecoder;r.decoder=new o("utf8")}return r}return AH(e,t),e.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},e.prototype.pump=function(){return TH(this,void 0,void 0,function(){var t,e,n;return _H(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return(t=r.sent()).done?[2,!1]:(e=t.value,n=xk.get("IS_BROWSER")?this.decoder.decode(e,{stream:!0}):this.decoder.write(Buffer.from(e.buffer)),this.outputQueue.push(n),[2,!0])}})})},e}(pG),zG=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.file=e,r.options=n,pN.assert(e instanceof Uint8Array||!!xk.get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),r.offset=n.offset||0,r.chunkSize=n.chunkSize||1048576,r}return AH(e,t),e.prototype.summary=function(){return"FileChunks "+this.file},e.prototype.next=function(){return TH(this,void 0,void 0,function(){var t,e,n=this;return _H(this,function(r){switch(r.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(t,e){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)t(new Uint8Array(n.file.slice(n.offset,r)));else{var o=new FileReader;o.onload=function(n){var r=o.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return e(new TypeError("FileReader returned unknown type."));t(r)},o.onabort=function(t){return e(new Error("Aborted"))},o.onerror=function(t){return e(new Error(t.type))};var i=n.file.slice(n.offset,r);o.readAsArrayBuffer(i)}n.offset=r}),e={},[4,t]);case 1:return[2,(e.value=r.sent(),e.done=!1,e)]}})})},e}(PG);function UG(t,e){return void 0===e&&(e={}),TH(this,void 0,void 0,function(){var n,r,o,i,a;return _H(this,function(s){switch(s.label){case 0:return"string"==typeof t?n=t:(n=t.url,r=VG(t)),[4,pN.fetch(n,r)];case 1:return(o=s.sent()).ok?(a=Uint8Array.bind,[4,o.arrayBuffer()]):[3,3];case 2:return i=new(a.apply(Uint8Array,[void 0,s.sent()])),[2,new zG(i,e)];case 3:throw new Error(o.statusText)}})})}var VG=function(t){return{method:t.method,headers:t.headers,body:t.body,mode:t.mode,credentials:t.credentials,cache:t.cache,redirect:t.redirect,referrer:t.referrer,integrity:t.integrity}};function WG(t){return"string"==typeof t&&"file://"===t.substr(0,7)}var jG=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.input=e,r.options=n,r}return AH(e,t),e.prototype.iterator=function(){return TH(this,void 0,void 0,function(){var t;return _H(this,function(e){return WG(this.input)&&xk.get("IS_NODE")&&(t=n(9),this.input=t.readFileSync(this.input.substr(7))),[2,new zG(this.input,this.options)]})})},e}(DG),HG=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this)||this;return r.url=e,r.fileOptions=n,r}return AH(e,t),e.prototype.iterator=function(){return TH(this,void 0,void 0,function(){return _H(this,function(t){return WG(this.url)?[2,new jG(this.url,this.fileOptions).iterator()]:[2,UG(this.url,this.fileOptions)]})})},e}(DG);function GG(t,e){return void 0===e&&(e={}),new AG(new HG(t),e)}function qG(t){var e=this,n=YH(t);return yG(function(){return TH(e,void 0,void 0,function(){return _H(this,function(t){return[2,n]})})})}function KG(t){var e=this;return yG(function(){return TH(e,void 0,void 0,function(){var e;return _H(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return e=n.sent(),[2,YH(function(){return e.next()})]}})})})}function $G(t,e){return TH(this,void 0,void 0,function(){return _H(this,function(n){return[2,_G.create(t,e)]})})}function XG(t){return TH(this,void 0,void 0,function(){return _H(this,function(e){return[2,TG.create(t)]})})}var YG="1.2.5",QG={"tfjs-core":ek,"tfjs-data":YG,"tfjs-layers":CU,"tfjs-converter":IH,tfjs:"1.2.5"};function ZG(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function JG(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var tq={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},eq={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},nq={"1.00":{.25:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1","0.50":"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",.75:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1","1.00":"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1"},"2.00":{"0.50":"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",.75:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2","1.00":"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2"}};function rq(t,e){return void 0===t&&(t=1),void 0===e&&(e=1),ZG(this,void 0,void 0,function(){var n,r,i;return JG(this,function(a){switch(a.label){case 0:if(null==o)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(n=t.toFixed(2),r=e.toFixed(2),!(n in nq))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(nq));if(!(r in nq[n]))throw new Error("MobileNet constructed with invalid alpha "+e+". Valid multipliers for this version are: "+Object.keys(nq[n])+".");return[4,(i=new oq(n,r)).load()];case 1:return a.sent(),[2,i]}})})}var oq=function(){function t(t,e){this.version=t,this.alpha=e,this.normalizationOffset=nv(127.5)}return t.prototype.load=function(){return ZG(this,void 0,void 0,function(){var t,e,n=this;return JG(this,function(r){switch(r.label){case 0:return t=this,[4,NH(nq[this.version][this.alpha],{fromTFHub:!0})];case 1:return t.model=r.sent(),[4,(e=Cm(function(){return n.model.predict(cv([1,224,224,3]))})).data()];case 2:return r.sent(),e.dispose(),[2]}})})},t.prototype.infer=function(t,e){var n=this;return void 0===e&&(e=!1),Cm(function(){t instanceof Qf||(t=HS.fromPixels(t));var r=t.toFloat().sub(n.normalizationOffset).div(n.normalizationOffset),o=r;224===t.shape[0]&&224===t.shape[1]||(o=BE.resizeBilinear(r,[224,224],!0));var i=o.reshape([-1,224,224,3]);return e?n.model.execute(i,eq[n.version]).squeeze([1,2]):n.model.predict(i).slice([0,1],[-1,1e3])})},t.prototype.classify=function(t,e){return void 0===e&&(e=3),ZG(this,void 0,void 0,function(){var n,r;return JG(this,function(o){switch(o.label){case 0:return[4,iq(n=this.infer(t),e)];case 1:return r=o.sent(),n.dispose(),[2,r]}})})},t}();function iq(t,e){return ZG(this,void 0,void 0,function(){var n,r,o,i,a,s,u;return JG(this,function(l){switch(l.label){case 0:return[4,(n=t.softmax()).data()];case 1:for(r=l.sent(),n.dispose(),o=[],u=0;u<r.length;u++)o.push({value:r[u],index:u});for(o.sort(function(t,e){return e.value-t.value}),i=new Float32Array(e),a=new Int32Array(e),u=0;u<e;u++)i[u]=o[u].value,a[u]=o[u].index;for(s=[],u=0;u<a.length;u++)s.push({className:tq[a[u]],probability:i[u]});return[2,s]}})})}var aq=function(){function t(){this.loading=!0}return t.prototype.ngOnInit=function(){return c(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return console.log("loading mobilenet model..."),t=this,[4,rq()];case 1:return t.model=e.sent(),console.log("Sucessfully loaded model"),this.loading=!1,[2]}})})},t.prototype.fileChangeEvent=function(t){return c(this,void 0,void 0,function(){var e,n=this;return p(this,function(r){return t.target.files&&t.target.files[0]&&((e=new FileReader).readAsDataURL(t.target.files[0]),e.onload=function(t){n.imageSrc=t.target.result,setTimeout(function(){return c(n,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return t=this,[4,this.model.classify(this.imageEl.nativeElement)];case 1:return t.predictions=e.sent(),[2]}})})},0)}),[2]})})},t}(),sq=sr({encapsulation:0,styles:[[".cont[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:15px 0}img[_ngcontent-%COMP%]{width:300px;height:300px}"]],data:{}});function uq(t){return aa(0,[(t()(),qi(0,0,null,null,1,"div",[],null,null,null,null,null)),(t()(),qi(1,0,null,null,0,"img",[["src","./assets/loading.gif"]],null,null,null,null,null))],null,null)}function lq(t){return aa(0,[(t()(),qi(0,0,[[1,0],["img",1]],null,0,"img",[],[[8,"src",4]],null,null,null,null))],null,function(t,e){t(e,0,0,e.component.imageSrc)})}function cq(t){return aa(0,[(t()(),Gi(16777216,null,null,1,null,lq)),yo(1,16384,null,0,Ds,[jn,Vn],{ngIf:[0,"ngIf"]},null),(t()(),Gi(0,null,null,0))],function(t,e){t(e,1,0,e.component.imageSrc)},null)}function pq(t){return aa(0,[(t()(),qi(0,0,null,null,1,"div",[["class","list-group-item"]],null,null,null,null,null)),(t()(),ra(1,null,[" "," - "," "]))],null,function(t,e){t(e,1,0,e.context.$implicit.className,e.context.$implicit.probability)})}function hq(t){return aa(0,[Qi(671088640,1,{imageEl:0}),(t()(),qi(1,0,null,null,10,"div",[["class","cont d-flex justify-content-center align-items-center flex-column"]],null,null,null,null,null)),(t()(),qi(2,0,null,null,3,"div",[["class","custom-file"]],null,null,null,null,null)),(t()(),qi(3,0,null,null,0,"input",[["class","custom-file-input"],["type","file"]],null,[[null,"change"]],function(t,e,n){var r=!0;return"change"===e&&(r=!1!==t.component.fileChangeEvent(n)&&r),r},null,null)),(t()(),qi(4,0,null,null,1,"label",[["class","custom-file-label"]],null,null,null,null,null)),(t()(),ra(-1,null,["Choose file"])),(t()(),Gi(16777216,null,null,1,null,uq)),yo(7,16384,null,0,Ds,[jn,Vn],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),Gi(0,[["elseBlock",2]],null,0,null,cq)),(t()(),qi(9,0,null,null,2,"div",[["class","list-group"]],null,null,null,null,null)),(t()(),Gi(16777216,null,null,1,null,pq)),yo(11,278528,null,0,Ts,[jn,Vn,Mn],{ngForOf:[0,"ngForOf"]},null)],function(t,e){var n=e.component;t(e,7,0,n.loading,oo(e,8)),t(e,11,0,n.predictions)},null)}function fq(t){return aa(0,[(t()(),qi(0,0,null,null,1,"app-image-classfier-upload",[],null,null,null,hq,sq)),yo(1,114688,null,0,aq,[],null,null)],function(t,e){t(e,1,0)},null)}var dq=Kr("app-image-classfier-upload",aq,fq,{},{},[]),mq=function(){function t(){this.loading=!0}return t.prototype.ngOnInit=function(){return c(this,void 0,void 0,function(){var t,e=this;return p(this,function(n){switch(n.label){case 0:return console.log("loading mobilenet model..."),t=this,[4,rq()];case 1:return t.model=n.sent(),console.log("Sucessfully loaded model"),this.loading=!1,setInterval(function(){return c(e,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return t=this,[4,this.model.classify(this.video.nativeElement)];case 1:return t.predictions=e.sent(),[4,dk()];case 2:return e.sent(),[2]}})})},3e3),[2]}})})},t.prototype.ngAfterViewInit=function(){return c(this,void 0,void 0,function(){var t;return p(this,function(e){return t=this.video.nativeElement,navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){t.srcObject=e}).catch(function(t){console.log("Something went wrong!")}),[2]})})},t}(),vq=sr({encapsulation:0,styles:[[""]],data:{}});function gq(t){return aa(0,[(t()(),qi(0,0,null,null,1,"div",[],null,null,null,null,null)),(t()(),qi(1,0,null,null,0,"img",[["src","./assets/loading.gif"]],null,null,null,null,null))],null,null)}function yq(t){return aa(0,[(t()(),qi(0,0,null,null,1,"div",[["class","list-group-item"]],null,null,null,null,null)),(t()(),ra(1,null,[" "," - "," "]))],null,function(t,e){t(e,1,0,e.context.$implicit.className,e.context.$implicit.probability)})}function bq(t){return aa(0,[Qi(671088640,1,{video:0}),(t()(),qi(1,0,null,null,6,"div",[["class","d-flex justify-content-center align-items-center flex-column"]],null,null,null,null,null)),(t()(),qi(2,0,[[1,0],["video",1]],null,0,"video",[["autoplay",""],["height","300"],["id","webcam"],["muted",""],["playsinline",""],["width","300"]],null,null,null,null,null)),(t()(),Gi(16777216,null,null,1,null,gq)),yo(4,16384,null,0,Ds,[jn,Vn],{ngIf:[0,"ngIf"]},null),(t()(),qi(5,0,null,null,2,"div",[["class","list-group"]],null,null,null,null,null)),(t()(),Gi(16777216,null,null,1,null,yq)),yo(7,278528,null,0,Ts,[jn,Vn,Mn],{ngForOf:[0,"ngForOf"]},null)],function(t,e){var n=e.component;t(e,4,0,n.loading),t(e,7,0,n.predictions)},null)}function wq(t){return aa(0,[(t()(),qi(0,0,null,null,1,"app-image-classifier-webcam",[],null,null,null,bq,vq)),yo(1,4308992,null,0,mq,[],null,null)],function(t,e){t(e,1,0)},null)}var xq=Kr("app-image-classifier-webcam",mq,wq,{},{},[]),Cq=sr({encapsulation:0,styles:[[""]],data:{}});function Eq(t){return aa(0,[(t()(),qi(0,0,null,null,9,"div",[["class","d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow"]],null,null,null,null,null)),(t()(),qi(1,0,null,null,1,"h5",[["class","my-0 mr-md-auto font-weight-normal"]],null,null,null,null,null)),(t()(),ra(-1,null,["AI on JavaScript"])),(t()(),qi(3,0,null,null,6,"nav",[["class","my-2 my-md-0 mr-md-3"]],null,null,null,null,null)),(t()(),qi(4,0,null,null,2,"a",[["class","p-2 text-dark"],["routerLink","/upload"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==oo(t,5).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&r),r},null,null)),yo(5,671744,null,0,ch,[lh,Jc,gs],{routerLink:[0,"routerLink"]},null),(t()(),ra(-1,null,["Image Classifier - \u4e0a\u4f20\u56fe\u7247"])),(t()(),qi(7,0,null,null,2,"a",[["class","p-2 text-dark"],["routerLink","/webcam"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==oo(t,8).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&r),r},null,null)),yo(8,671744,null,0,ch,[lh,Jc,gs],{routerLink:[0,"routerLink"]},null),(t()(),ra(-1,null,["Image Classifier - \u7528\u6444\u50cf\u5934"])),(t()(),qi(10,0,null,null,2,"div",[["class","container"]],null,null,null,null,null)),(t()(),qi(11,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),yo(12,212992,null,0,dh,[fh,jn,cn,[8,null],Pn],null,null)],function(t,e){t(e,5,0,"/upload"),t(e,8,0,"/webcam"),t(e,12,0)},function(t,e){t(e,4,0,oo(e,5).target,oo(e,5).href),t(e,7,0,oo(e,8).target,oo(e,8).href)})}function Sq(t){return aa(0,[(t()(),qi(0,0,null,null,1,"app-root",[],null,null,null,Eq,Cq)),yo(1,49152,null,0,ds,[],null,null)],null,null)}var kq=Kr("app-root",ds,Sq,{},{},[]);function Nq(t,e){return new O(e?function(n){return e.schedule(Iq,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function Iq(t){t.subscriber.error(t.error)}function Rq(t,e,n,r){return g(n)&&(r=n,n=void 0),r?Rq(t,e,n).pipe(tt(function(t){return m(t)?r.apply(void 0,t):r(t)})):new O(function(r){!function t(e,n,r,o,i){var a;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(e)){var s=e;e.addEventListener(n,r,i),a=function(){return s.removeEventListener(n,r,i)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(e)){var u=e;e.on(n,r),a=function(){return u.off(n,r)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(e)){var l=e;e.addListener(n,r),a=function(){return l.removeListener(n,r)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var c=0,p=e.length;c<p;c++)t(e[c],n,r,o,i)}o.add(a)}(t,e,function(t){r.next(arguments.length>1?Array.prototype.slice.call(arguments):t)},r,n)})}var Aq=new O(T),Tq=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return a(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(Tz){n=!0,r=!!Tz&&Tz||new Error(Tz)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return a(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(w)),_q=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),Dq=new(function(t){function e(n,r){void 0===r&&(r=_q.now);var o=t.call(this,n,function(){return e.delegate&&e.delegate!==o?e.delegate.now():r()})||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return a(e,t),e.prototype.schedule=function(n,r,o){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,o):t.prototype.schedule.call(this,n,r,o)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(_q))(Tq),Oq=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return Gs(this.value);case"E":return Nq(this.error);case"C":return js()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}(),Mq=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Fq(t,this.delay,this.scheduler))},t}(),Fq=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.delay=n,o.scheduler=r,o.queue=[],o.active=!1,o.errored=!1,o}return a(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,r=t.scheduler,o=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(o);if(n.length>0){var i=Math.max(0,n[0].time-r.now());this.schedule(t,i)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new Pq(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(Oq.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(Oq.createComplete()),this.unsubscribe()},e}(I),Pq=function(){return function(t,e){this.time=t,this.notification=e}}(),Lq="Service workers are disabled or not supported by this browser",Bq=function(){function t(t){if(this.serviceWorker=t,t){var e=Rq(t,"controllerchange").pipe(tt(function(){return t.controller})),n=Au(Zs(function(){return Gs(t.controller)}),e);this.worker=n.pipe(tu(function(t){return!!t})),this.registration=this.worker.pipe(Nu(function(){return t.getRegistration()}));var r=Rq(t,"message").pipe(tt(function(t){return t.data})).pipe(tu(function(t){return t&&t.type})).pipe(gt(new z));r.connect(),this.events=r}else this.worker=this.events=this.registration=(o=Lq,Zs(function(){return Nq(new Error(o))}));var o}return t.prototype.postMessage=function(t,e){return this.worker.pipe(wu(1),uu(function(n){n.postMessage(s({action:t},e))})).toPromise().then(function(){})},t.prototype.postMessageWithStatus=function(t,e,n){var r=this.waitForStatus(n),o=this.postMessage(t,e);return Promise.all([r,o]).then(function(){})},t.prototype.generateNonce=function(){return Math.round(1e7*Math.random())},t.prototype.eventsOfType=function(t){return this.events.pipe(tu(function(e){return e.type===t}))},t.prototype.nextEventOfType=function(t){return this.eventsOfType(t).pipe(wu(1))},t.prototype.waitForStatus=function(t){return this.eventsOfType("STATUS").pipe(tu(function(e){return e.nonce===t}),wu(1),tt(function(t){if(!t.status)throw new Error(t.error)})).toPromise()},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return!!this.serviceWorker},enumerable:!0,configurable:!0}),t}(),zq=function(){function t(t){if(this.sw=t,this.subscriptionChanges=new z,!t.isEnabled)return this.messages=Aq,this.notificationClicks=Aq,void(this.subscription=Aq);this.messages=this.sw.eventsOfType("PUSH").pipe(tt(function(t){return t.data})),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(tt(function(t){return t.data})),this.pushManager=this.sw.registration.pipe(tt(function(t){return t.pushManager}));var e=this.pushManager.pipe(Nu(function(t){return t.getSubscription()}));this.subscription=ct(e,this.subscriptionChanges)}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this.sw.isEnabled},enumerable:!0,configurable:!0}),t.prototype.requestSubscription=function(t){var e=this;if(!this.sw.isEnabled)return Promise.reject(new Error(Lq));for(var n={userVisibleOnly:!0},r=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(r.length)),i=0;i<r.length;i++)o[i]=r.charCodeAt(i);return n.applicationServerKey=o,this.pushManager.pipe(Nu(function(t){return t.subscribe(n)}),wu(1)).toPromise().then(function(t){return e.subscriptionChanges.next(t),t})},t.prototype.unsubscribe=function(){var t=this;return this.sw.isEnabled?this.subscription.pipe(wu(1),Nu(function(e){if(null===e)throw new Error("Not subscribed to push notifications.");return e.unsubscribe().then(function(e){if(!e)throw new Error("Unsubscribe failed!");t.subscriptionChanges.next(null)})})).toPromise():Promise.reject(new Error(Lq))},t.prototype.decodeBase64=function(t){return atob(t)},t}(),Uq=function(){function t(t){if(this.sw=t,!t.isEnabled)return this.available=Aq,void(this.activated=Aq);this.available=this.sw.eventsOfType("UPDATE_AVAILABLE"),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED")}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this.sw.isEnabled},enumerable:!0,configurable:!0}),t.prototype.checkForUpdate=function(){if(!this.sw.isEnabled)return Promise.reject(new Error(Lq));var t=this.sw.generateNonce();return this.sw.postMessageWithStatus("CHECK_FOR_UPDATES",{statusNonce:t},t)},t.prototype.activateUpdate=function(){if(!this.sw.isEnabled)return Promise.reject(new Error(Lq));var t=this.sw.generateNonce();return this.sw.postMessageWithStatus("ACTIVATE_UPDATE",{statusNonce:t},t)},t}(),Vq=function(){return function(){}}(),Wq=new Ht("NGSW_REGISTER_SCRIPT");function jq(t,e,n,r){return function(){if(zs(r)&&"serviceWorker"in navigator&&!1!==n.enabled){var o;if(navigator.serviceWorker.addEventListener("controllerchange",function(){null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),"function"==typeof n.registrationStrategy)o=n.registrationStrategy();else{var i=f((n.registrationStrategy||"registerWhenStable").split(":")),a=i[0],s=i.slice(1);switch(a){case"registerImmediately":o=Gs(null);break;case"registerWithDelay":o=Gs(null).pipe(function(t,e){void 0===e&&(e=Dq);var n,r=(n=t)instanceof Date&&!isNaN(+n)?+t-e.now():Math.abs(t);return function(t){return t.lift(new Mq(r,e))}}(+s[0]||0));break;case"registerWhenStable":o=t.get(Ni).isStable.pipe(tu(function(t){return t}));break;default:throw new Error("Unknown ServiceWorker registration strategy: "+n.registrationStrategy)}}o.pipe(wu(1)).subscribe(function(){return navigator.serviceWorker.register(e,{scope:n.scope}).catch(function(t){return console.error("Service worker registration failed with:",t)})})}}}function Hq(t,e){return new Bq(zs(e)&&!1!==t.enabled?navigator.serviceWorker:void 0)}var Gq=function(){function t(){}var e;return e=t,t.register=function(t,n){return void 0===n&&(n={}),{ngModule:e,providers:[{provide:Wq,useValue:t},{provide:Vq,useValue:n},{provide:Bq,useFactory:Hq,deps:[Vq,Ho]},{provide:Bo,useFactory:jq,deps:[Xt,Wq,Vq,Ho],multi:!0}]}},t}(),qq=function(){return function(){}}(),Kq=ps(fs,[ds],function(t){return function(t){for(var e={},n=[],r=!1,o=0;o<t.length;o++){var i=t[o];i.token===rn&&!0===i.value&&(r=!0),1073741824&i.flags&&n.push(i.token),i.index=o,e[or(i.token)]=i}return{factory:null,providersByKey:e,providers:t,modules:n,isRoot:r}}([Br(512,cn,pn,[[8,[zh,dq,xq,kq]],[3,cn],fn]),Br(5120,zi,Wi,[[3,zi]]),Br(4608,Is,Rs,[zi,[2,Ns]]),Br(5120,Do,ji,[li]),Br(5120,Uo,Vo,[]),Br(5120,Mn,Ui,[]),Br(5120,Fn,Vi,[]),Br(4608,Ml,Fl,[Ps]),Br(6144,We,null,[Ml]),Br(4608,Il,Al,[]),Br(5120,tl,function(t,e,n,r,o,i,a,s){return[new kl(t,e,n),new Ol(r),new Tl(o,i,a,s)]},[Ps,li,Ho,Ps,Ps,Il,qo,[2,Rl]]),Br(4608,el,el,[tl,li]),Br(135680,ol,ol,[Ps]),Br(4608,pl,pl,[el,ol,Uo]),Br(6144,bn,null,[pl]),Br(6144,rl,null,[ol]),Br(4608,gi,gi,[li]),Br(5120,Jc,_h,[lh]),Br(4608,yh,yh,[]),Br(6144,vh,null,[yh]),Br(135680,bh,bh,[lh,Fo,ti,Xt,vh]),Br(4608,gh,gh,[]),Br(5120,wh,Nh,[lh,Us,xh]),Br(5120,Fh,Mh,[Dh]),Br(5120,Go,function(t){return[t]},[Fh]),Br(5120,Bq,Hq,[Vq,Ho]),Br(4608,zq,zq,[Bq]),Br(4608,Uq,Uq,[Bq]),Br(1073742336,Fs,Fs,[]),Br(1024,ve,jl,[]),Br(1024,xi,function(){return[Sh()]},[]),Br(512,Dh,Dh,[Xt]),Br(256,Wq,"ngsw-worker.js",[]),Br(256,Vq,{enabled:!0},[]),Br(1024,Bo,function(t,e,n,r,o,i){return[(a=t,Qu("probe",Ju),Qu("coreTokens",s({},Zu,(a||[]).reduce(function(t,e){return t[e.name]=e.token,t},{}))),function(){return Ju}),Oh(e),jq(n,r,o,i)];var a},[[2,xi],Dh,Xt,Wq,Vq,Ho]),Br(512,zo,zo,[[2,Bo]]),Br(131584,Ni,Ni,[li,qo,Xt,ve,cn,zo]),Br(1073742336,Hi,Hi,[Ni]),Br(1073742336,Hl,Hl,[[3,Hl]]),Br(1024,Ch,Rh,[[3,lh]]),Br(512,_c,Dc,[]),Br(512,fh,fh,[]),Br(256,xh,{},[]),Br(1024,gs,Ih,[ms,[2,ys],xh]),Br(512,bs,bs,[gs,ms]),Br(512,ti,ti,[]),Br(512,Fo,Ti,[ti,[2,Ri]]),Br(1024,nh,function(){return[[{path:"upload",component:aq},{path:"webcam",component:mq}]]},[]),Br(1024,lh,Th,[Ni,_c,fh,bs,Xt,Fo,ti,nh,xh,[2,oh],[2,th]]),Br(1073742336,kh,kh,[[2,Ch],[2,lh]]),Br(1073742336,qq,qq,[]),Br(1073742336,Gq,Gq,[]),Br(1073742336,fs,fs,[]),Br(256,rn,!0,[])])});(function(){if(ye)throw new Error("Cannot enable prod mode after platform setup.");ge=!1})(),Wl().bootstrapModuleFactory(Kq).catch(function(t){return console.error(t)})},zn8P:function(t,e){function n(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="zn8P"}},[[0,0]]]);